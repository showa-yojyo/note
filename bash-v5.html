<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>What’s New In Bash 5 ノート &#8212; 読書ノート 1.5dev documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=1a9a5cd9" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=91898170"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/mermaid.js?v=578dbed1"></script>
    <link rel="next" title="What’s New In C++11 ノート" href="cpp11/index.html" />
    <link rel="prev" title="What’s New In Bash 4 ノート" href="bash-v4.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="bash-v4.html" title="Previous document">What’s New In Bash 4 ノート</a>
        </li>
        <li>
          <a href="cpp11/index.html" title="Next document">What’s New In C++11 ノート</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <section id="what-s-new-in-bash-5">
<h1><a class="toc-backref" href="#id6" role="doc-backlink">What’s New In Bash 5 ノート</a><a class="headerlink" href="#what-s-new-in-bash-5" title="Permalink to this heading">¶</a></h1>
<p>Bash バージョン 5.x で追加された新機能のメモ。全部を追跡するのは無理だから気になるものと便利とされている機能を中心に拾っていく。</p>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#what-s-new-in-bash-5" id="id6">What’s New In Bash 5 ノート</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id7">バージョン 5.0</a></p></li>
<li><p><a class="reference internal" href="#id2" id="id8">バージョン 5.1</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id9">バージョン 5.2</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id10">参考資料</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="id1">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">バージョン 5.0</a><a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="https://lists.gnu.org/archive/html/bug-bash/2019-01/msg00063.html">Bash-5.0 release available</a>
からめぼしい項目に絞ってノートを取る。</p>
<blockquote>
<div><p>There is an <code class="docutils literal notranslate"><span class="pre">EPOCHSECONDS</span></code> variable, which expands to the time in seconds
since the Unix epoch.</p>
</div></blockquote>
<p>例えばコマンド <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">$EPOCHSECONDS</span></code> を実行すると、コマンド <code class="docutils literal notranslate"><span class="pre">date</span> <span class="pre">+%s</span></code> と同じものを出力する。</p>
<blockquote>
<div><p>There is an <code class="docutils literal notranslate"><span class="pre">EPOCHREALTIME</span></code> variable, which expands to the time in seconds
since the Unix epoch with microsecond granularity.</p>
</div></blockquote>
<p>これも同様で、コマンド <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">$EPOCHREALTIME</span></code> を実行すれば <code class="docutils literal notranslate"><span class="pre">date</span> <span class="pre">+%s.%6N</span></code> と同じ出力が得られる。</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">BASH_ARGV0</span></code>: a new variable that expands to <code class="docutils literal notranslate"><span class="pre">$0</span></code> and sets <code class="docutils literal notranslate"><span class="pre">$0</span></code> on
assignment.</p>
</div></blockquote>
<p>変数 <code class="docutils literal notranslate"><span class="pre">$0</span></code> に値を代入することは不可能だが、それを可能にするのが変数
<code class="docutils literal notranslate"><span class="pre">BASH_ARGV0</span></code> だ。デバッグ用途らしい。</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">history</span> <span class="pre">-d</span></code> understands negative arguments: negative arguments offset from
the end of the history list.</p>
</div></blockquote>
<p>例えば <code class="docutils literal notranslate"><span class="pre">history</span> <span class="pre">-d</span> <span class="pre">-10</span></code> とすれば、有効なコマンド履歴の十個前に実行したコマンドを履歴から削除する。</p>
<blockquote>
<div><p>The <code class="docutils literal notranslate"><span class="pre">wait</span></code> builtin now has a <code class="docutils literal notranslate"><span class="pre">-f</span></code> option, which signfies to wait until the
specified job or process terminates, instead of waiting until it changes
state.</p>
</div></blockquote>
<p>コマンド <code class="docutils literal notranslate"><span class="pre">wait</span> <span class="pre">-f</span> <span class="pre">ID</span></code> はジョブ状態が変更されたときに返るのではなく、ジョブ
<code class="docutils literal notranslate"><span class="pre">ID</span></code> が実際に終了するのを待ってからその終了コードを返すようになる。</p>
<blockquote>
<div><p>If a non-interactive shell with job control enabled detects that a foreground
job died due to <code class="docutils literal notranslate"><span class="pre">SIGINT</span></code>, it acts as if it received the <code class="docutils literal notranslate"><span class="pre">SIGINT</span></code>.</p>
</div></blockquote>
<p>これは既存の何かに影響するか？</p>
<blockquote>
<div><p>A new <code class="docutils literal notranslate"><span class="pre">shopt</span></code> option: <code class="docutils literal notranslate"><span class="pre">localvar_inherit</span></code>; if set, a local variable
inherits the value of a variable with the same name at the nearest preceding
scope.</p>
</div></blockquote>
<p>次の関数で説明する。局所変数 <code class="docutils literal notranslate"><span class="pre">var</span></code> を内側の局所変数スコープとそのすぐ外側のスコープに宣言する。このオプションを有効にすると、局所変数スコープ突入前に同名の変数に値が初期化済みならば、その値を引き継ぐようになる。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>demo_localvar_inherit
<span class="o">{</span>
<span class="w">    </span><span class="k">function</span><span class="w"> </span>outer
<span class="w">    </span><span class="o">{</span>
<span class="w">        </span><span class="nb">local</span><span class="w"> </span>var
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span>In<span class="w"> </span>call:<span class="w"> </span><span class="nv">$var</span>
<span class="w">        </span><span class="nv">var</span><span class="o">=</span>localvar
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span>In<span class="w"> </span>call,<span class="w"> </span>after<span class="w"> </span>setting:<span class="w"> </span><span class="nv">$var</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">var</span><span class="o">=</span>globalvar
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>Before<span class="w"> </span>call:<span class="w"> </span><span class="nv">$var</span>
<span class="w">    </span>outer
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>After<span class="w"> </span>call:<span class="w"> </span><span class="nv">$var</span>
<span class="o">}</span>
</pre></div>
</div>
<p>オプションを変えて関数を呼んだ結果を比較する：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bash$ shopt -u localvar_inherit; demo_localvar_inherit</span>
<span class="go">Before call: globalvar</span>
<span class="go">In call:</span>
<span class="go">In call, after setting: localvar</span>
<span class="go">After call: globalvar</span>

<span class="go">bash$ shopt -s localvar_inherit; demo_localvar_inherit</span>
<span class="go">Before call: globalvar</span>
<span class="go">In call: globalvar</span>
<span class="go">In call, after setting: localvar</span>
<span class="go">After call: globalvar</span>
</pre></div>
</div>
<p>継承しないほうが、つまり従来と同じ設定のほうが変数のスコープの意味が生きるから好みだ。</p>
<blockquote>
<div><p>The <code class="docutils literal notranslate"><span class="pre">history</span></code> builtin can now delete ranges of history entries using
<code class="docutils literal notranslate"><span class="pre">-d</span> <span class="pre">start-end</span></code>.</p>
</div></blockquote>
<p>コマンド履歴を履歴番号範囲を指定することで削除できるようになった。次を実行するとコマンド履歴番号 1103 から 1118 までの履歴を削除する：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bash$ history -d 1103-1118</span>
</pre></div>
</div>
<p>先ほど挙げた負のオフセットを <code class="docutils literal notranslate"><span class="pre">start</span></code> および <code class="docutils literal notranslate"><span class="pre">end</span></code> の値として受け入れる。例えば次のようなコマンドが考えられる：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go"> bash$ history -d -16--1</span>

<span class="go">The command completion code now matches aliases and shell function names</span>
<span class="go">case-insensitively if the readline ``completion-ignore-case`` variable is set.</span>
</pre></div>
</div>
<p>ファイル <code class="file docutils literal notranslate"><span class="pre">$HOME/.inputrc</span></code> で <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">completion-ignore-case</span> <span class="pre">on</span></code> を指定しているはずだ。こうすると <code class="docutils literal notranslate"><span class="pre">alias</span></code> や <code class="docutils literal notranslate"><span class="pre">function</span></code> の名前補完にも効果があるようになった。これは便利なのかどうかわからない。その手の識別子には小文字しか使わないようにしている。</p>
<blockquote>
<div><p>There is a new <code class="docutils literal notranslate"><span class="pre">assoc_expand_once</span></code> shell option that attempts to expand
associative array subscripts only once.</p>
</div></blockquote>
<p>これはなぜあるのだろう。</p>
<blockquote>
<div><p>The <code class="docutils literal notranslate"><span class="pre">umask</span></code> builtin now allows modes and masks greater than octal 777.</p>
</div></blockquote>
<p>要するに四桁のマスクを操作可能になったということか。</p>
<blockquote>
<div><p>The <code class="docutils literal notranslate"><span class="pre">complete</span></code> builtin now accepts a <code class="docutils literal notranslate"><span class="pre">-I</span></code> option that applies the
completion to the initial word on the line.</p>
</div></blockquote>
<p>行の最初の単語に補完を適用することができるようになった。</p>
<blockquote>
<div><p>The <code class="docutils literal notranslate"><span class="pre">localvar_inherit</span></code> option will not attempt to inherit a value from a
variable of an incompatible type (indexed vs. associative arrays, for
example).</p>
</div></blockquote>
<p>新規オプション <code class="docutils literal notranslate"><span class="pre">localvar_inherit</span></code> に関する仕様の一部。型を指定して局所変数を宣言するデモを書いて試したいところだ。</p>
<blockquote>
<div><p>The <code class="docutils literal notranslate"><span class="pre">globasciiranges</span></code> option is now enabled by default; it can be set to off
by default at configuration time.</p>
</div></blockquote>
<p>オプション <code class="docutils literal notranslate"><span class="pre">globasciiranges</span></code> 自体は以前からある。5.0 でこの既定値が on になったと言っている。例えば、パターン <code class="docutils literal notranslate"><span class="pre">[a-d]</span></code> が <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>, <code class="docutils literal notranslate"><span class="pre">c</span></code>, <code class="docutils literal notranslate"><span class="pre">d</span></code> のいずれかにマッチするパターンを意味するように指定したい場合（大文字などは不要）に有効にする。</p>
<blockquote>
<div><p>Associative and indexed arrays now allow subscripts consisting solely of
whitespace.</p>
</div></blockquote>
<p>配列の添字が空白文字のみから構成されても構わないと読めるが、実際には先頭の要素が参照されるという理解でいいか？</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">checkwinsize</span></code> is now enabled by default.</p>
</div></blockquote>
<p>このオプションは WSL が明示的に on にしているので気にしない。</p>
<blockquote>
<div><p>The <code class="docutils literal notranslate"><span class="pre">localvar_unset</span></code> <code class="docutils literal notranslate"><span class="pre">shopt</span></code> option is now visible and documented.</p>
</div></blockquote>
<p>隠しオプション <code class="docutils literal notranslate"><span class="pre">localvar_unset</span></code> が表に浮上。</p>
<p>このオプションが on の場合、直前の関数スコープにある局所変数に対する <code class="docutils literal notranslate"><span class="pre">unset</span></code>
呼び出しが、その関数が戻るまでに後続の検索でそれらが未設定であることをわかるように印をつけるようになる。この挙動は現在の関数スコープでローカル変数の設定を解除したときのそれと同じだ。</p>
<blockquote>
<div><p>The <code class="docutils literal notranslate"><span class="pre">progcomp_alias</span></code> shopt option is now visible and documented.</p>
</div></blockquote>
<p>隠しオプション <code class="docutils literal notranslate"><span class="pre">progcomp_alias</span></code> が表に浮上。仕様を読むと <code class="docutils literal notranslate"><span class="pre">alias</span></code> が絡むダブル補完を試みると読める。</p>
<blockquote>
<div><p>There is a new <code class="docutils literal notranslate"><span class="pre">seq</span></code> loadable builtin.</p>
</div></blockquote>
<p>手許の環境では存在しない。</p>
<blockquote>
<div><p>The <code class="docutils literal notranslate"><span class="pre">$_</span></code> variable doesn’t change when the shell executes a command that
forks.</p>
</div></blockquote>
<p>ではどうなるのか。</p>
<blockquote>
<div><p>POSIX mode now enables the <code class="docutils literal notranslate"><span class="pre">shift_verbose</span></code> option.</p>
</div></blockquote>
<p>コマンド <code class="docutils literal notranslate"><span class="pre">shift</span></code> で範囲外の数を指定すると、たいていのシェルではエラーとなる。しかし、本家 POSIX ではエラーとする仕様では特にない。Bash 5.0 からはこのオプション自体を有効にするようになった。そう解釈していいか。</p>
</section>
<section id="id2">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">バージョン 5.1</a><a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="https://lists.gnu.org/archive/html/info-gnu/2020-12/msg00003.html">Bash-5.1 release available</a>
のめぼしい項目に集中してノートをつづる。</p>
<blockquote>
<div><p><strong class="command">read -e</strong> may now be used with arbitrary file descriptors
(<strong class="command">read -u N</strong>).</p>
</div></blockquote>
<p>Readline が効いた状態と descriptors を指定することが両立可能になった。</p>
<blockquote>
<div><p>The <code class="docutils literal notranslate"><span class="pre">select</span></code> builtin now runs traps if its internal call to the <code class="docutils literal notranslate"><span class="pre">read</span></code>
builtin is interrupted by a signal.</p>
</div></blockquote>
<p>組み込みコマンド <strong class="command">select</strong> は、信号が <strong class="command">read</strong> の内部呼び出しに割り込んだときにトラップするようになった。</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">SRANDOM</span></code>: a new variable that expands to a 32-bit random number that is not
produced by an LCRNG, and uses <code class="docutils literal notranslate"><span class="pre">getrandom</span></code>/<code class="docutils literal notranslate"><span class="pre">getentropy</span></code>, falling back to
<code class="file docutils literal notranslate"><span class="pre">/dev/urandom</span></code> or <code class="docutils literal notranslate"><span class="pre">arc4random</span></code> if available. There is a fallback
generator if none of these are available.</p>
</div></blockquote>
<p>環境変数 <code class="docutils literal notranslate"><span class="pre">SRANDOM</span></code> から 32 ビット長の乱数を得られる。ここに言及されているような手段、関数で生成されるため、<code class="docutils literal notranslate"><span class="pre">srand</span></code> のようなものを使って乱数列を再現することは不可能のようだ。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bash$ echo $SRANDOM</span>
<span class="go">3687839026</span>
<span class="go">bash$ echo $SRANDOM</span>
<span class="go">1135571563</span>
<span class="go">bash$ echo $SRANDOM</span>
<span class="go">2451151285</span>
</pre></div>
</div>
<hr class="docutils" />
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">shell-transpose-words</span></code>: a new bindable readline command that uses the same
definition of word as <code class="docutils literal notranslate"><span class="pre">shell-forward-word</span></code>, etc.</p>
<p>The shell now adds default bindings for <code class="docutils literal notranslate"><span class="pre">shell-forward-word</span></code>,
<code class="docutils literal notranslate"><span class="pre">shell-backward-word</span></code>, <code class="docutils literal notranslate"><span class="pre">shell-transpose-words</span></code>, and <code class="docutils literal notranslate"><span class="pre">shell-kill-word</span></code>.</p>
</div></blockquote>
<p>新コマンド <code class="docutils literal notranslate"><span class="pre">shell-transpose-words</span></code> の意味は直観的に理解できると思うので説明を省く（パス文字列などで <code class="docutils literal notranslate"><span class="pre">transpose-words</span></code> との違いを実感できる）。</p>
<p>ここで挙げたコマンドに対するキーバインド既定値は次のとおり：</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>キーバインド</p></th>
<th class="head"><p>コマンド</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">M</kbd>-<kbd class="kbd docutils literal notranslate">C</kbd>-<kbd class="kbd docutils literal notranslate">b</kbd></kbd></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">shell-backward-word</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">M</kbd>-<kbd class="kbd docutils literal notranslate">C</kbd>-<kbd class="kbd docutils literal notranslate">d</kbd></kbd></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">shell-kill-word</span></code></p></td>
</tr>
<tr class="row-even"><td><p><kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">M</kbd>-<kbd class="kbd docutils literal notranslate">C</kbd>-<kbd class="kbd docutils literal notranslate">f</kbd></kbd></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">shell-forward-word</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">M</kbd>-<kbd class="kbd docutils literal notranslate">C</kbd>-<kbd class="kbd docutils literal notranslate">t</kbd></kbd></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">shell-transpose-words</span></code></p></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
<blockquote>
<div><p>If <strong class="command">unset</strong> is executed without option arguments, bash tries to unset
a shell function if a name argument cannot be a shell variable name because
it’s not an identifier.</p>
</div></blockquote>
<p>コマンド <strong class="command">unset</strong> をオプションなしで実行すると、引数を変数名として処理することをまず試みる。それが失敗すると、今度は関数名として処理する。</p>
<blockquote>
<div><p>The <strong class="command">test -N</strong> operator uses nanosecond timestamp granularity if it’s
available.</p>
</div></blockquote>
<p>ファイルが最後に読み込まれてからナノ秒単位の短時間の間に変更されたとしてもテストが機能するようになった。</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">BASH_REMATCH</span></code> is no longer readonly.</p>
</div></blockquote>
<p>この環境変数は <code class="docutils literal notranslate"><span class="pre">[[</span> <span class="pre">target</span> <span class="pre">=~</span> <span class="pre">pattern</span> <span class="pre">]]</span></code> テストの結果を格納する配列だ。その読み取りしかできない性質がなくなったということは？</p>
<blockquote>
<div><p><strong class="command">wait</strong>: has a new <code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">VARNAME</span></code> option, which stores the PID
returned by <strong class="command">wait -n</strong> or <strong class="command">wait</strong> without arguments.</p>
</div></blockquote>
<p>コマンド <strong class="command">wait</strong> 実行時にプロセス ID を保存しておく事態になったらこれを使おう。</p>
<blockquote>
<div><p>Sorting the results of pathname expansion now uses byte-by-byte comparisons if
two strings collate equally to impose a total order; the result of a POSIX
interpretation.</p>
</div></blockquote>
<p>それでもなお等しいということはあり得ないか。</p>
<blockquote>
<div><p>Bash now allows <code class="docutils literal notranslate"><span class="pre">SIGINT</span></code> <code class="docutils literal notranslate"><span class="pre">trap</span></code> handlers to execute recursively.</p>
</div></blockquote>
<p>これだけでは何のことかわからない。</p>
<blockquote>
<div><p>Process substitution is now available in posix mode.</p>
</div></blockquote>
<p>プロセス置換が POSIX モードで利用可能になったことは本バージョンの注目項目の一つとして紹介されている。</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">READLINE_MARK</span></code>: a new variable available while executing commands bound
with <strong class="command">bind -x</strong>, contains the value of the mark.</p>
</div></blockquote>
<p>変数 <code class="docutils literal notranslate"><span class="pre">READLINE_MARK</span></code> はコマンド <strong class="command">bind -x</strong> で使用する Readline ラインバッファー内の印の位置を含む変数だ。挿入点と印の間の文字列が region と呼ばれるものだ。</p>
<blockquote>
<div><p><strong class="command">test -v N</strong> can now test whether or not positional parameter <code class="docutils literal notranslate"><span class="pre">N</span></code> is
set.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">$1</span></code>, <code class="docutils literal notranslate"><span class="pre">$2</span></code>, … がセット済みかどうかを知る術は他にもある。</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">local</span></code> now honors the <code class="docutils literal notranslate"><span class="pre">-p</span></code> option to display all local variables at the
current context.</p>
</div></blockquote>
<p>今まで知らなかったが、実は <code class="docutils literal notranslate"><span class="pre">local</span></code> はシェル関数であったのだ。キーワードかと思っていた。何らかの関数中で <code class="docutils literal notranslate"><span class="pre">local</span> <span class="pre">-p</span></code> を呼び出すと、上述のように機能する。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>test-local<span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">a</span><span class="o">=</span><span class="m">3</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span><span class="nv">b</span><span class="o">=</span>Mono
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="nb">local</span>
<span class="w">    </span><span class="nb">local</span><span class="w"> </span>-p
<span class="o">}</span>
</pre></div>
</div>
<p>実行結果の例（この出力と一致しない場合があり得る）：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bash$ test-local</span>
<span class="go">test local</span>
<span class="go">declare -- a=&quot;3&quot;</span>
<span class="go">declare -- b=&quot;Mono&quot;</span>
</pre></div>
</div>
<hr class="docutils" />
<blockquote>
<div><p>The <code class="docutils literal notranslate"><span class="pre">&#64;a</span></code> variable transformation now prints attributes for unset array
variables.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">&#64;A</span></code> variable transformation now prints a declare command that sets a
variable’s attributes if the variable has attributes but is unset.</p>
</div></blockquote>
<p>やってみよう：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bash$ declare -a myarray</span>
<span class="go">bash$ echo ${myarray@a}</span>
<span class="go">a</span>
<span class="go">bash$ echo ${myarray@A}</span>
<span class="go">declare -a myarray</span>
</pre></div>
</div>
<hr class="docutils" />
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">declare</span></code> and <code class="docutils literal notranslate"><span class="pre">local</span></code> now have a <code class="docutils literal notranslate"><span class="pre">-I</span></code> option that inherits attributes
and value from a variable with the same name at a previous scope.</p>
</div></blockquote>
<p>これは入れ子スコープで変数を複製するのに利用できるだろうか。</p>
<blockquote>
<div><p>When run from a <code class="docutils literal notranslate"><span class="pre">-c</span></code> command, <code class="docutils literal notranslate"><span class="pre">jobs</span></code> now reports the status of completed
jobs.</p>
</div></blockquote>
<p>コマンド <strong class="command">jobs</strong> を <strong class="command">bash -h</strong> 中に実行するとジョブの実行状況を確認できる。</p>
<blockquote>
<div><p>New <code class="docutils literal notranslate"><span class="pre">U</span></code>, <code class="docutils literal notranslate"><span class="pre">u</span></code>, and <code class="docutils literal notranslate"><span class="pre">L</span></code> parameter transformations to convert to uppercase,
convert first character to uppercase, and convert to lowercase, respectively.</p>
</div></blockquote>
<p>変数変換 <code class="docutils literal notranslate"><span class="pre">${parameter&#64;operator}</span></code> において、<code class="docutils literal notranslate"><span class="pre">operator</span></code> 部分にこれらの記号が対応された。それぞれの変換は Emacs における <code class="docutils literal notranslate"><span class="pre">upcase-word</span></code>, <code class="docutils literal notranslate"><span class="pre">capitalize-word</span></code>,
<code class="docutils literal notranslate"><span class="pre">lowercase-word</span></code> に相当すると憶えておくといい。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">myvar=varName</span>
<span class="go">bash$ echo ${myvar@u} ${myvar@U} ${myvar@L}</span>
<span class="go">VarName VARNAME varname</span>
</pre></div>
</div>
<hr class="docutils" />
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">PROMPT_COMMAND</span></code>: can now be an array variable, each element of which can
contain a command to be executed like a string <code class="docutils literal notranslate"><span class="pre">PROMPT_COMMAND</span></code> variable.</p>
</div></blockquote>
<p>変数 <code class="docutils literal notranslate"><span class="pre">PROMPT_COMMAND</span></code> は <code class="docutils literal notranslate"><span class="pre">PS1</span></code> を表示する前に毎回実行されるコマンドを指定するものだ。複数のコマンドを実行するために配列を代入することが可能になった。例えば</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nv">PROMPT_COMMAND</span><span class="o">=(</span><span class="w"> </span><span class="s2">&quot;command1&quot;</span><span class="w"> </span><span class="s2">&quot;command2&quot;</span><span class="w"> </span>...<span class="w"> </span><span class="o">)</span>
</pre></div>
</div>
<p>とすると、端末でコマンドを何か入力、実行するたびに <code class="docutils literal notranslate"><span class="pre">command1</span></code>, <code class="docutils literal notranslate"><span class="pre">command2</span></code>, …がいちいち実行されるようになる。</p>
<blockquote>
<div><p><strong class="command">ulimit</strong> has a <code class="docutils literal notranslate"><span class="pre">-R</span></code> option to report and set the <code class="docutils literal notranslate"><span class="pre">RLIMIT_RTTIME</span></code>
resource.</p>
</div></blockquote>
<p>コマンド <strong class="command">ulimit</strong> 自体を全く利用しないので後回し。</p>
<blockquote>
<div><p>Associative arrays may be assigned using a list of key-value pairs within a
compound assignment. Compound assignments where the words are not of the form
<code class="docutils literal notranslate"><span class="pre">[key]=value</span></code> are assumed to be key-value assignments. A missing or empty
key is an error; a missing value is treated as <code class="docutils literal notranslate"><span class="pre">NULL</span></code>. Assignments may not
mix the two forms.</p>
</div></blockquote>
<p>連想配列への key-value の代入および追加方法が次のような式が合法になるように拡張された：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bash$ declare -A mymap=(k0 v0 k1 v1)</span>
<span class="go">bash$ echo &quot;${mymap[@]}&quot;</span>
<span class="go">v0 v1</span>
<span class="go">bash$ mymap+=(k2 v2 k3 v3)</span>
<span class="go">bash$ echo &quot;${mymap[@]}&quot;</span>
<span class="go">v0 v1 v2 v3</span>
</pre></div>
</div>
<hr class="docutils" />
<blockquote>
<div><p>New <code class="docutils literal notranslate"><span class="pre">K</span></code> parameter transformation to display associative arrays as key-value
pairs.</p>
</div></blockquote>
<p>連想配列の値を引用符で囲まれた可能性のある出力を生成する。先ほどの例の <code class="docutils literal notranslate"><span class="pre">mymap</span></code>
に適用すると：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">echo &quot;${mymap[@]@K}&quot;</span>
<span class="go">k0 &quot;v0&quot; k1 &quot;v1&quot; k2 &quot;v2&quot; k3 &quot;v3&quot;</span>
</pre></div>
</div>
<hr class="docutils" />
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">SECONDS</span></code> and <code class="docutils literal notranslate"><span class="pre">RANDOM</span></code> may now be assigned using arithmetic expressions,
since they are nominally integer variables. <code class="docutils literal notranslate"><span class="pre">LINENO</span></code> is not an integer
variable.</p>
</div></blockquote>
<p>そのようなことはしない。</p>
<blockquote>
<div><p>Bash temporarily suppresses the verbose option when running the <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> trap
while running a command from the <strong class="command">fc</strong> builtin.</p>
</div></blockquote>
<p>状況がわからない。</p>
<blockquote>
<div><p><strong class="command">wait -n</strong> now accepts a list of job specifications as arguments and
will wait for the first one in the list to change state.</p>
</div></blockquote>
<p>オプションの <code class="docutils literal notranslate"><span class="pre">-n</span></code> は the next の意。この変更は理に適っている。</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">HISTFILE</span></code> is now readonly in a restricted shell.</p>
</div></blockquote>
<p>制限シェル <strong class="command">rbash</strong> を起動して変数の属性を先ほど習った変数展開で調べる：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bash$ echo ${HISTFILE@a}</span>
<span class="go">r</span>
</pre></div>
</div>
<hr class="docutils" />
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">GLOBIGNORE</span></code> now ignores <code class="docutils literal notranslate"><span class="pre">.</span></code> and <code class="docutils literal notranslate"><span class="pre">..</span></code> as a terminal pathname component.</p>
</div></blockquote>
<p>環境変数 <code class="docutils literal notranslate"><span class="pre">GLOBIGNORE</span></code> はコロン区切りのパターンのリストであって、パス展開時に無視されるパターンを定義する。Bash 5.1 からはドットおよびドットドットが端末パス名構成要素としては無視されるようになったと言っている。</p>
</section>
<section id="id3">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">バージョン 5.2</a><a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h2>
<div class="admonition-todo admonition" id="id4">
<p class="admonition-title">Todo</p>
<p>現在利用している Ubuntu 22.04.2 LTS の Bash はバージョンが 5.1 だ。本節以降を記すのは Ubuntu をアップグレードしてバージョンが 5.2 以上になってからとする。</p>
</div>
</section>
<section id="id5">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">参考資料</a><a class="headerlink" href="#id5" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://hub.packtpub.com/gnu-bash-5-0-is-here-with-new-features-and-improvements/">Bash 5.0 is here with new features and improvements | Packt Hub</a></p></li>
<li><p><a class="reference external" href="https://itsfoss.com/bash-5-release/">Bash 5.0 Released with New Features</a></p></li>
<li><p><a class="reference external" href="https://www.shell-tips.com/bash/what-is-new-in-gnu-bash-5/">What’s New in GNU Bash 5?</a></p></li>
<li><p><a class="reference external" href="https://unix.stackexchange.com/questions/478590/whats-going-to-be-new-in-bash-5">upgrade - What’s going to be new in bash 5 - Unix &amp; Linux Stack Exchange</a></p></li>
<li><p><a class="reference external" href="https://stackoverflow.com/questions/1092631/get-current-time-in-seconds-since-the-epoch-on-linux-bash">Get current time in seconds since the Epoch on Linux, Bash - Stack Overflow</a></p></li>
<li><p><a class="reference external" href="https://unix.stackexchange.com/questions/493221/what-is-the-purpose-of-bash-argv0-in-bash">variable - What is the purpose of BASH_ARGV0 in bash? - Unix &amp;amp; Linux Stack Exchange</a></p></li>
<li><p><a class="reference external" href="https://stackoverflow.com/questions/54204612/bash-hide-global-variable-using-local-variable-with-same-name">scope - Bash: Hide global variable using local variable with same name - Stack Overflow</a></p></li>
<li><p><a class="reference external" href="https://debxp.org/globbing-e-as-variaveis-lang-e-lc_/">Globbing e as variáveis ‘LANG’ e ‘LC_’ – DEBXP COMUNIDADE</a></p></li>
<li><p><a class="reference external" href="https://stackoverflow.com/questions/14750650/how-to-delete-history-of-last-10-commands-in-shell">linux - How to delete history of last 10 commands in shell? - Stack Overflow</a></p></li>
<li><p><a class="reference external" href="https://phoenixnap.com/kb/bash-wait-command">Bash wait Command with Examples</a></p></li>
<li><p><a class="reference external" href="https://www.linuxadictos.com/en/bash-5-1-has-already-been-released-and-these-are-its-news.html">Bash 5.1 has already been released and these are its news | Linux Addicts</a></p></li>
<li><p><a class="reference external" href="https://unix.stackexchange.com/questions/460651/is-prompt-command-a-colon-separated-list">bash - Is $PROMPT_COMMAND a colon-separated list? - Unix &amp; Linux Stack Exchange</a></p></li>
<li><p><a class="reference external" href="https://adamtheautomator.com/bash-fc-command/">Bash fc Command : Easily Wield the Bash Shell Like a Pro</a></p></li>
<li><p>その他、Bash Reference Manual やヘルプなど</p></li>
</ul>
</section>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="bash-v4.html" title="Previous document">What’s New In Bash 4 ノート</a>
        </li>
        <li>
          <a href="cpp11/index.html" title="Next document">What’s New In C++11 ノート</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
      </div>
      <div class="clearer"></div>
    </div>
<div class="footer">
  <ul>
    <li id="footer_logo">
      <a class="image-reference" href="https://showa-yojyo.github.io/" title="プレハブ小屋 Since 1999"><img src="_static/logos.png"/></a>
    </li>
    <li id="footer_copyright">
      Copyright &copy; 1999-2023, プレハブ小屋 All rights reserved.
    </li>
  </ul>
</div>
  </body>
</html>