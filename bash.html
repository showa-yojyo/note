<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Bash 手筋集 &#8212; 読書ノート 1.6dev documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=1a9a5cd9" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=5a6f99c4"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/mermaid.js?v=578dbed1"></script>
    <link rel="next" title="What’s New In Bash 2 ノート" href="bash-v2.html" />
    <link rel="prev" title="ノート準備中書籍群 2018 年編" href="preliminary2018.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
    <div class="related top">
      &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="preliminary2018.html" title="Previous">ノート準備中書籍群 2018 年編</a>
        </li>
      
        <li>
          <a href="bash-v2.html" title="Next">What’s New In Bash 2 ノート</a>
          &rarr;
        </li>
    </ul>
  </nav>
    </div>


          <div class="body" role="main">
            
  <section id="bash">
<h1>Bash 手筋集<a class="headerlink" href="#bash" title="Permalink to this heading">¶</a></h1>
<p>編集方針が定まっていないが出航。</p>
<nav class="contents local" id="id1">
<p class="topic-title">本章見出し</p>
<ul class="simple">
<li><p><a class="reference internal" href="#id2" id="id4">チュートリアル</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id5">手筋</a></p></li>
</ul>
</nav>
<section id="id2">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">チュートリアル</a><a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h2>
<dl class="simple">
<dt><a class="reference external" href="https://www.freecodecamp.org/news/bash-scripting-tutorial-linux-shell-script-and-command-line-for-beginners/">Bash Scripting Tutorial - Linux Shell Script and Command Line for Beginners</a></dt><dd><p>シェルスクリプト作成に集中した手引。スクリプトのデバッグ手法に関する記述がありがたい。</p>
<ul class="simple">
<li><p>今自分が使っているシェルが何かわからない場合は <strong class="program">ps</strong> で確認する。</p></li>
<li><p>めったに使わぬゆえ忘れていたがコマンド <strong class="command">read</strong> を使ってユーザー入力を読むことができる。</p></li>
<li><p>よく使われるコマンド一覧にディスク空き容量を見るための <strong class="program">df</strong> があるが、ほとんど使ったことがない。</p></li>
<li><p>Case statements: 入門者向けの記事で <code class="docutils literal notranslate"><span class="pre">case</span></code> 文を扱うのは珍しいかもしれない。</p></li>
<li><p>スクリプトの最初に <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">-x</span></code> を設定する。デバッグモードが有効になり、Bash
が実行したコマンドそれぞれの先頭に <code class="docutils literal notranslate"><span class="pre">+</span></code> 記号を付けて端末に出力する。端末でやってもよい。解除は <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">+x</span></code> とする。</p></li>
<li><p>Bash はエラーが発生すると、エラーの内容を示す終了コードを変数 <code class="docutils literal notranslate"><span class="pre">?</span></code> に設定する。値 0 は成功を表し、それ以外の値はエラーを表す。<code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">$?</span> <span class="pre">-ne</span> <span class="pre">0</span> <span class="pre">]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">-e</span></code> を用いると、スクリプト内のコマンドが失敗した場合に Bash がエラーで終了するようになり、エラーの特定が容易になる。</p></li>
</ul>
</dd>
<dt><a class="reference external" href="https://linuxconfig.org/bash-scripting-tutorial">Bash Scripting Tutorial - Linux Tutorials - Learn Linux Configuration</a></dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">date</span> <span class="pre">+20220209</span></code> には何の意味が？</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">args=(&quot;$&#64;&quot;)</span></code> は面白い記法だ。<code class="docutils literal notranslate"><span class="pre">${args[0]}</span></code>, … のほうが可読性はある。</p></li>
<li><p>Bash スクリプトの中で別のシェルコマンドを実行する最善の方法は
<code class="samp docutils literal notranslate"><span class="pre">$(</span><em><span class="pre">command</span></em><span class="pre">)</span></code> 構文を使ってサブシェルを作成することだ。</p></li>
<li><p><strong class="command">read</strong> は変数を複数取れる。特に、<code class="docutils literal notranslate"><span class="pre">read</span> <span class="pre">-a</span></code> で配列が使える。</p></li>
<li><p>Bash Trap Command: <strong class="command">trap</strong> を Bash スクリプトで使用すると、スクリプトに送られた信号を捕捉し、その信号が発生したときにサブルーチンを実行することができる。<kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">C</kbd>-<kbd class="kbd docutils literal notranslate">c</kbd></kbd> を押した時に止めるコードなどを実現できる。</p></li>
<li><p>Read file into bash array: このコードは <strong class="command">exec</strong> を用いたリダイレクト操作を理解するのが難しい。</p></li>
<li><p>算術比較演算子と文字列比較演算子を区別して理解しろ。
<code class="docutils literal notranslate"><span class="pre">-n</span></code>, <code class="docutils literal notranslate"><span class="pre">-z</span></code> は文字列に対する単項演算子。</p></li>
<li><p>さらに出番の少ない <code class="docutils literal notranslate"><span class="pre">select</span></code> 文。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$'</span> <span class="pre">'</span></code> という特殊な引用構文？がある。</p></li>
<li><p>STDERR from bash script to STDOUT: <code class="docutils literal notranslate"><span class="pre">2&gt;&amp;1</span></code> は頻出。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&gt;&amp;</span></code> や <code class="docutils literal notranslate"><span class="pre">&amp;&gt;</span></code> という記法もある。</p></li>
</ul>
</li>
<li><p>エラーだけ要る場合は <code class="docutils literal notranslate"><span class="pre">2&gt;</span></code></p></li>
<li><p>最後のリンク集も当然気になる。</p></li>
</ul>
</dd>
<dt><a class="reference external" href="https://ryanstutorials.net/bash-scripting-tutorial/">Bash Scripting Tutorial - Ryans Tutorials</a></dt><dd><p>文章が骨太でたいへん良い。八章構成。類似記事の Linux Tutorial も読みたい。</p>
<ul class="simple">
<li><p><span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code> にカレントディレクトリーを含めない理由は複数ある。</p></li>
<li><p>コマンドラインで <strong class="program">env</strong> を実行すると、参照できる変数の一覧が表示される。</p></li>
<li><p>変数の <strong class="command">export</strong> は一方通行。</p></li>
<li><p>これまで見てきたどの記事も <strong class="command">read</strong> を重視している。</p>
<ul>
<li><p>オプション <code class="docutils literal notranslate"><span class="pre">-p</span></code> でプロンプトテキストを指示する。</p></li>
<li><p>オプション <code class="docutils literal notranslate"><span class="pre">-s</span></code> でエコーを止める。パスワードを求める場合に有用。</p></li>
</ul>
</li>
<li><p>スクリプトが特定の方法でデータを処理するだけなら、標準入力を使うのが最善だろう。パイプラインに簡単に追加できる。</p></li>
<li><p><strong class="command">let</strong> は算術式を引数？に取る。</p></li>
<li><p><strong class="command">expr</strong> は算術式を引数に取る。</p></li>
<li><p><code class="samp docutils literal notranslate"><span class="pre">((</span> <em><span class="pre">expression</span></em> <span class="pre">))</span></code>, <code class="samp docutils literal notranslate"><span class="pre">((</span> <span class="pre">$</span><em><span class="pre">expression</span></em> <span class="pre">))</span></code> がおすすめ。</p></li>
<li><p>条件式のキモはやはり角括弧。角括弧は <strong class="command">test</strong> への参照に過ぎない。端末で試すときに使う。E.g. <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">-s</span> <span class="pre">myfile;</span> <span class="pre">echo</span> <span class="pre">$?</span></code></p></li>
<li><p>二項論理演算子は角括弧同士の間に入れる。角括弧の中ではない。</p></li>
<li><p>なぜ Bash は <strong class="command">while</strong> と <strong class="command">until</strong> があるのか。</p></li>
<li><p>完全に忘れていたが <code class="docutils literal notranslate"><span class="pre">{10..0..2}</span></code> という記法が合法。</p></li>
<li><p>Bash における関数定義では丸括弧は飾り。引数リストを記述するわけではない。というか、何かを記述することは許されない。</p></li>
<li><p>関数内でローカル変数を使用することは、関数内のすべてを保つ良い習慣と一般的にはみなされている。関数内ではいつでもローカル変数を使え。</p></li>
<li><p><strong class="command">command</strong> は対象エイリアスや関数のオリジナルの形式を引き戻すのにも使える。</p></li>
<li><p>関数が最も再利用しやすいのは、単一の課題しか実行しないものだ。</p></li>
<li><p>ユーザーインターフェイスの章がこの手の読み物ではあまり見られない内容で面白い。<strong class="program">tput</strong> はほとんど見聞きしない。</p></li>
</ul>
</dd>
<dt><a class="reference external" href="https://www.javatpoint.com/bash">Bash Tutorial | Bash Scripting Tutorial - Javatpoint</a></dt><dd><ul class="simple">
<li><p>複数行コメントには here-document 書式を流用できる。</p></li>
<li><p>システム由来変数の一覧を見るには次のコマンドを使える：</p>
<ul>
<li><p><strong class="command">set</strong></p></li>
<li><p><strong class="program">env</strong></p></li>
<li><p><strong class="program">printenv</strong></p></li>
</ul>
</li>
<li><p><strong class="command">read</strong> を引数なしで使うと、変数 <code class="docutils literal notranslate"><span class="pre">REPLY</span></code> にユーザー入力が代入される。</p></li>
<li><p>Bash が文字列を分割する場合、変数 <code class="docutils literal notranslate"><span class="pre">IFS</span></code> が使われる。普通は空白文字。例えば <code class="docutils literal notranslate"><span class="pre">IDS=,</span></code> としてから <strong class="command">read -a</strong> に CSV 行を与える。この場合には
<code class="docutils literal notranslate"><span class="pre">read</span> <span class="pre">-d,</span> <span class="pre">-a</span></code> としてもよい。</p></li>
<li><p>いつも忘れる <code class="samp docutils literal notranslate"><span class="pre">${</span><em><span class="pre">parameter</span></em><span class="pre">%%</span><em><span class="pre">word</span></em><span class="pre">}</span></code>,
<code class="samp docutils literal notranslate"><span class="pre">${</span><em><span class="pre">parameter</span></em><span class="pre">#</span><em><span class="pre">word</span></em><span class="pre">}</span></code>, etc.</p></li>
<li><p>Python の slicing の要領で文字列変数の値から部分文字列を得られる。</p></li>
<li><p>文字列連結方法は Bash 言語仕様の範囲内に限定してもさまざまだ。代表的なものは：</p>
<ul>
<li><p>文字列変数やリテラル文字列を二重引用符内で単に連結する</p></li>
<li><p>演算子 <code class="docutils literal notranslate"><span class="pre">+=</span></code> を用いる</p></li>
<li><p><code class="samp docutils literal notranslate"><span class="pre">printf</span> <span class="pre">-v</span> <em><span class="pre">var</span></em></code> を用いる</p></li>
</ul>
</li>
<li><p><strong class="command">command</strong> と似たようなものに <strong class="command">builtin</strong> がある。対象をその組み込み版に引き戻す。</p></li>
<li><p>配列変数を明示的に定義するのに <code class="samp docutils literal notranslate"><span class="pre">declare</span> <span class="pre">-a</span> <em><span class="pre">var</span></em></code> を使える。</p></li>
<li><p><code class="samp docutils literal notranslate"><span class="pre">declare</span> <span class="pre">-A</span> <em><span class="pre">var</span></em></code> は連想配列を定義する。</p></li>
<li><p>配列変数を確認するには <code class="samp docutils literal notranslate"><span class="pre">declare</span> <span class="pre">-p</span> <em><span class="pre">var</span></em></code> を使う。</p></li>
<li><p><strong class="command">unset</strong> を配列要素にも配列全体にも使うことがある。</p></li>
<li><p><code class="samp docutils literal notranslate"><span class="pre">var=$(&lt;</span><em><span class="pre">file</span></em><span class="pre">)</span></code> でファイルの内容を変数に読み込める。</p></li>
<li><p>条件文の単角括弧と二重角括弧の違いは、前者は POSIX 互換であるということだ。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-v</span></code> と <code class="docutils literal notranslate"><span class="pre">-z</span></code> の違い</p></li>
</ul>
</dd>
</dl>
</section>
<section id="id3">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">手筋</a><a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h2>
<dl class="simple">
<dt><a class="reference external" href="https://www.fosslinux.com/105140/10-must-know-bash-shell-scripting-tips-and-tricks-for-beginners.htm">Bash Shell Scripting: 10 Must-Know Tips for Beginners</a></dt><dd><p>この記事はかなり入門者向け。</p>
<ul class="simple">
<li><p>変数名をいつでも braces で囲むと曖昧さがなくなる。<code class="docutils literal notranslate"><span class="pre">$varname</span></code> ではなく
<code class="docutils literal notranslate"><span class="pre">${varname}</span></code></p></li>
<li><p>この記事を読むまで気づかなかったが、<code class="samp docutils literal notranslate"><span class="pre">$(</span><em><span class="pre">command</span></em><span class="pre">)</span></code> 形式で自作関数を指定可能。</p></li>
</ul>
</dd>
<dt><a class="reference external" href="https://www.freecodecamp.org/news/bash-command-line-tips-to-help-you-work-faster/">Bash Command Line Tips to Help You Work Faster</a></dt><dd><ul class="simple">
<li><p><code class="samp docutils literal notranslate"><span class="pre">nohup</span> <em><span class="pre">command</span></em> <span class="pre">&amp;</span></code> パターン</p></li>
<li><p><code class="samp docutils literal notranslate"><span class="pre">time</span> <em><span class="pre">command</span></em></code> パターン</p></li>
<li><p>整数の算術演算は <code class="samp docutils literal notranslate"><span class="pre">echo</span> <span class="pre">$((</span><em><span class="pre">arithmetic-expr</span></em><span class="pre">))</span></code> パターンと
<strong class="program">bc</strong> にパイプするパターンがある。</p></li>
<li><p>Brace expansion は日常的に用いる。</p></li>
</ul>
</dd>
<dt><a class="reference external" href="https://www.redhat.com/sysadmin/stupid-bash-tricks">Stupid Bash tricks: History, reusing arguments, files and directories, functions, and more | Enable Sysadmin</a></dt><dd><ul class="simple">
<li><p>最初の例は <code class="docutils literal notranslate"><span class="pre">^status^start^</span></code> でもいい？</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HISTSIZE</span></code> を 5000 にしている。私の五倍ある。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">history</span> <span class="pre">-d</span></code> のほうがゴミコマンドを柔軟に削除できまいか？</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$_</span></code> の値は直前コマンドの最終引数。<code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">work</span> <span class="pre">&amp;&amp;</span> <span class="pre">cd</span> <span class="pre">$_</span></code> のように使う。</p></li>
<li><p>再帰の深さを制限する変数 <code class="docutils literal notranslate"><span class="pre">FUNCNEST</span></code> を何かのために覚えておく。</p></li>
<li><p><strong class="command">kubectl</strong> のラッパー関数を作成するハメになるのは、オリジナルの設計が良くないか、構成ファイルに見落としがあるか、等ではないか？</p></li>
</ul>
</dd>
<dt><a class="reference external" href="https://opensource.com/article/18/5/bash-tricks">Bash tips for everyday at the command line | Opensource.com</a></dt><dd><ul class="simple">
<li><p>Bash オプション <code class="docutils literal notranslate"><span class="pre">histappend</span></code> はオンにする。</p></li>
<li><p>今まで <kbd class="kbd docutils literal notranslate">↑</kbd> 押しでいいではないかと思ってまったく使わなかった <code class="docutils literal notranslate"><span class="pre">!!</span></code> の真価。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">!*</span></code> は「直前コマンドの <code class="docutils literal notranslate"><span class="pre">$0</span></code> 以外」に展開される。</p></li>
<li><p>履歴の中で最も実行されたコマンドの例は、履歴一覧書式によって <strong class="program">awk</strong>
部分を書き換える。また、無視されるコマンドは当然現れない。</p></li>
<li><p>Bash オプション <code class="docutils literal notranslate"><span class="pre">cdspell</span></code> はオンにする。</p></li>
<li><p>キーバインドの確認には <code class="docutils literal notranslate"><span class="pre">bind</span> <span class="pre">-p</span></code> を実行する。</p></li>
<li><p>コマンドラインでの <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">C</kbd>-<kbd class="kbd docutils literal notranslate">u</kbd></kbd> は <code class="docutils literal notranslate"><span class="pre">unix-line-discard</span></code> なので使おう。</p></li>
<li><p>長いジョブ実行中のポーズを試したい。キーバインドは <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">C</kbd>-<kbd class="kbd docutils literal notranslate">s</kbd></kbd> らしい。アンポーズは <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">C</kbd>-<kbd class="kbd docutils literal notranslate">q</kbd></kbd> 押し。コマンド <code class="docutils literal notranslate"><span class="pre">sleep</span> <span class="pre">1</span></code> 実行中に試したところ、確かに機能しているらしい。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">2&gt;&amp;1</span></code> リダイレクトの技法は基本的。</p></li>
<li><p>組み込みコマンド <strong class="command">command</strong> を <code class="docutils literal notranslate"><span class="pre">-V</span></code> 付きで呼び出すと
<strong class="command">which</strong> 以上に便利。</p></li>
</ul>
</dd>
<dt><a class="reference external" href="https://www.marquette.edu/high-performance-computing/tips-and-tricks.php">Tips and Tricks for the Novice Bash User // High Performance Computing // Marquette University</a></dt><dd><ul class="simple">
<li><p>Wildcards: <code class="docutils literal notranslate"><span class="pre">*</span></code>, <code class="docutils literal notranslate"><span class="pre">?</span></code>, <code class="docutils literal notranslate"><span class="pre">[]</span></code> の三つともワイルドカードの一種。一度にこれらを複数組み合わせることが可能。</p></li>
<li><p>Curly Brace Expansions: <code class="docutils literal notranslate"><span class="pre">{}</span></code> で範囲を指定するときは <code class="docutils literal notranslate"><span class="pre">..</span></code> を使う。角括弧と異なる。列挙はカンマ。パターンの展開順序は左から。ワイルドカードと混ぜてパターンを組める。</p></li>
<li><p>ワイルドカードは現在ディレクトリーの中身に基づいて展開される。</p></li>
<li><p>Environment Variables: <span class="target" id="index-1"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code> の独特な更新方法について。</p></li>
<li><p>For Loops and If Statements: <code class="docutils literal notranslate"><span class="pre">for</span></code> ループで理解が不確かなのは <code class="docutils literal notranslate"><span class="pre">in</span></code> の引数の書き方だ。配列のようなものだとは思うが。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">if</span></code> 文の条件記述では <code class="samp docutils literal notranslate"><span class="pre">[</span> <em><span class="pre">condition</span></em> <span class="pre">]</span></code> を用いる。演算子は覚えるしかない。</p></li>
</ul>
</li>
</ul>
</dd>
<dt><a class="reference external" href="https://about.codecov.io/blog/6-bash-scripting-tips-and-tricks/">6 Bash Scripting Tips and Tricks - Codecov</a></dt><dd><ul class="simple">
<li><p>Printing to stdout and saving to variable from stderr: 再現しようとすると改行文字が変数中から失われるが？</p></li>
<li><p>Print the length of an array: 基本なので <code class="docutils literal notranslate"><span class="pre">$#ARRAY[&#64;]</span></code> を覚える。</p></li>
<li><p>Transform a space-separated list into an array: 中括弧を使って
<code class="docutils literal notranslate"><span class="pre">${ARRAY[&#64;]}</span></code> や <code class="docutils literal notranslate"><span class="pre">${#ARRAY[&#64;]}</span></code> と書くと正しい値が出力される。ちなみに配列定義は <code class="docutils literal notranslate"><span class="pre">ARRAY=($(echo</span> <span class="pre">&quot;one</span> <span class="pre">two</span> <span class="pre">three&quot;))</span></code> と一気に書ける。</p></li>
<li><p>Join an array with “: <code class="docutils literal notranslate"><span class="pre">[&#64;]</span></code> と <code class="docutils literal notranslate"><span class="pre">[*]</span></code> の違いをよく理解する。先ほどの配列長を得るのに前者が本質的だった理由がこれでわかる。</p></li>
</ul>
</dd>
</dl>
</section>
</section>


          </div>
    <div class="related bottom">
      &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="preliminary2018.html" title="Previous">ノート準備中書籍群 2018 年編</a>
        </li>
      
        <li>
          <a href="bash-v2.html" title="Next">What’s New In Bash 2 ノート</a>
          &rarr;
        </li>
    </ul>
  </nav>
    </div>

      </div>
      <div class="clearer"></div>
    </div>
<div class="footer">
  <ul>
    <li id="footer_logo">
      <a class="image-reference" href="index.html" title="読書ノート Home"><img src="_images/logo.svg"/></a>
    </li>
    <li id="footer_copyright">
      Copyright &copy; 1999-2024, プレハブ小屋 All rights reserved.
    </li>
  </ul>
</div>
  </body>
</html>