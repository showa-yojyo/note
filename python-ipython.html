<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>IPython 利用ノート &#8212; 読書ノート 1.6dev</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=c9b0a06a" />
    <script src="_static/documentation_options.js?v=4354bf25"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/mermaid.js?v=578dbed1"></script>
    <link rel="next" title="Jupyter 利用ノート" href="python-jupyter.html" />
    <link rel="prev" title="Nose 利用ノート [obsolete]" href="python-nose.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
    <div class="related top">
      &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="python-nose.html" title="Previous">Nose 利用ノート [obsolete]</a>
        </li>
      
        <li>
          <a href="python-jupyter.html" title="Next">Jupyter 利用ノート</a>
          &rarr;
        </li>
    </ul>
  </nav>
    </div>


          <div class="body" role="main">
            
  <section id="ipython">
<h1>IPython 利用ノート<a class="headerlink" href="#ipython" title="Link to this heading">¶</a></h1>
<p>本稿は <a class="reference external" href="https://ipython.org/">IPython</a> に関する個人的な覚え書きである。 <a class="reference external" href="https://www.numpy.org/">NumPy</a>, <a class="reference external" href="https://www.scipy.org/">SciPy</a>, <a class="reference external" href="https://matplotlib.org/">Matplotlib</a> のドキュメントを読んでいるとこのツールの名前が頻繁に出てくる。無視するのはもったいない気がするので調査する。</p>
<nav class="contents local" id="id1">
<p class="topic-title">見出し一覧</p>
<ul class="simple">
<li><p><a class="reference internal" href="#id2" id="id18">IPython とは何か</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id19">インストールから初回起動まで</a></p>
<ul>
<li><p><a class="reference internal" href="#id4" id="id20">初回起動</a></p></li>
<li><p><a class="reference internal" href="#pyreadline" id="id21">PyReadline をインストール</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id22">テスト</a></p>
<ul>
<li><p><a class="reference internal" href="#ipython-3-0-0" id="id23">IPython 3.0.0</a></p></li>
<li><p><a class="reference internal" href="#ipython-4-0-0" id="id24">IPython 4.0.0</a></p></li>
<li><p><a class="reference internal" href="#ipython-5-0-0" id="id25">IPython 5.0.0</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#id6" id="id26">環境設定</a></p>
<ul>
<li><p><a class="reference internal" href="#id7" id="id27">環境変数による設定</a></p></li>
<li><p><a class="reference internal" href="#id8" id="id28">設定ファイルによる設定</a></p></li>
<li><p><a class="reference internal" href="#id9" id="id29">コマンドライン引数による設定</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id10" id="id30">使い勝手を試す</a></p></li>
<li><p><a class="reference internal" href="#qt" id="id31">Qt コンソールを試す</a></p>
<ul>
<li><p><a class="reference internal" href="#pyzmq" id="id32">PyZMQ をインストールする</a></p></li>
<li><p><a class="reference internal" href="#id12" id="id33">Qt コンソールを起動する（シンプル）</a></p></li>
<li><p><a class="reference internal" href="#id13" id="id34">Qt コンソールを起動する（プロットインライン）</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id14" id="id35">その他</a></p></li>
</ul>
</nav>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>OS</p>
<ul>
<li><p>Windows 7 Home Premium x64 SP1</p></li>
<li><p>Windows 10 Home x64</p></li>
<li><p>設定ファイルの辺りだけ WSL2</p></li>
</ul>
</li>
<li><p>本稿において、利用した各パッケージのバージョンは次のとおり。</p>
<ul>
<li><p><a class="reference external" href="https://www.python.org/">Python</a> 3.4.1, 3.5.0, 3.5.2, 3.6.6, 3.12.3</p></li>
<li><p><a class="reference external" href="https://ipython.org/">IPython</a> 3.0.0, 4.0.0, 5.0.0, 6.4.0, 8.24.0</p></li>
<li><p><a class="reference external" href="http://ipython.org/pyreadline.html">PyReadline</a> 2.0, 2.1, n/a</p></li>
<li><p><a class="reference external" href="https://nose.readthedocs.io/en/latest/">Nose</a> 1.3.4, 1.3.7</p></li>
<li><p><a class="reference external" href="http://www.riverbankcomputing.co.uk/software/pyqt/">PyQt</a> v5.3.1 for Python v3.4 (x64), n/a for Python v3.5 (x64), 4.11.4</p></li>
<li><p><a class="reference external" href="http://zeromq.github.io/pyzmq/">PyZMQ</a> 14.5.0, 14.7.0, TODO</p></li>
</ul>
</li>
</ul>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>本稿では文字列 <code class="docutils literal notranslate"><span class="pre">%PYTHONDIR%</span></code> を <code class="file docutils literal notranslate"><span class="pre">python.exe</span></code> が存在するディレクトリーのパスを意味する環境変数のようなものを表現するものであることにする。例えば、正規の Python 3.5 インストーラーを用いて D ドライブ直下にインストールした環境ではこの値は <code class="file docutils literal notranslate"><span class="pre">D:\Python35</span></code> であり、 Miniconda の 3.5 インストーラーを用いて D ドライブ直下にインストールした環境ではこの値は
<code class="file docutils literal notranslate"><span class="pre">D:\Miniconda3</span></code> である。</p>
</div>
<section id="id2">
<h2><a class="toc-backref" href="#id18" role="doc-backlink">IPython とは何か</a><a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<p>ドキュメントによると &lt;IPython is meant to work as a drop-in replacement for the
standard interactive interpreter&gt; だそうだ。標準の Python インタープリターの上位版のようなモノだ。</p>
</section>
<section id="id3">
<h2><a class="toc-backref" href="#id19" role="doc-backlink">インストールから初回起動まで</a><a class="headerlink" href="#id3" title="Link to this heading">¶</a></h2>
<p>次の条件を初回条件と呼ぶことにする。</p>
<ul class="simple">
<li><p>Python がインストール済みである。</p></li>
<li><p><strong class="program">conda</strong> または <strong class="program">pip</strong> の実行ファイルのあるフォルダーに
<code class="docutils literal notranslate"><span class="pre">PATH</span></code> が通っている。</p></li>
</ul>
<p>これを満たす環境において、<a class="reference internal" href="python-miniconda.html#python-pkg-proc"><span class="std std-ref">一般のサードパーティー製 Python パッケージのインストール手順</span></a> に示したようにすると IPython
をインストールできる。</p>
<p>次に <strong class="program">conda</strong> によるインストール手続きの例を示す。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bash$ conda install ipython</span>
<span class="go">Fetching package metadata: ....</span>
<span class="go">Solving package specifications: .........</span>

<span class="go">Package plan for installation in environment D:\Miniconda3:</span>

<span class="go">The following packages will be downloaded:</span>

<span class="go">    package                    |            build</span>
<span class="go">    ---------------------------|-----------------</span>
<span class="go">    vs2015_runtime-14.0.25123  |                0         1.9 MB</span>
<span class="go">    colorama-0.3.7             |           py35_0          19 KB</span>
<span class="go">    conda-env-2.5.2            |           py35_0          67 KB</span>
<span class="go">    decorator-4.0.10           |           py35_0          12 KB</span>
<span class="go">    ipython_genutils-0.1.0     |           py35_0          33 KB</span>
<span class="go">    menuinst-1.4.1             |           py35_0         107 KB</span>
<span class="go">    path.py-8.2.1              |           py35_0          47 KB</span>
<span class="go">    pycosat-0.6.1              |           py35_1          80 KB</span>
<span class="go">    pygments-2.1.3             |           py35_0         1.3 MB</span>
<span class="go">    pyyaml-3.11                |           py35_4         169 KB</span>
<span class="go">    requests-2.10.0            |           py35_0         656 KB</span>
<span class="go">    ruamel_yaml-0.11.14        |           py35_0         217 KB</span>
<span class="go">    setuptools-23.0.0          |           py35_0         692 KB</span>
<span class="go">    simplegeneric-0.8.1        |           py35_1           7 KB</span>
<span class="go">    six-1.10.0                 |           py35_0           8 KB</span>
<span class="go">    wcwidth-0.1.7              |           py35_0          21 KB</span>
<span class="go">    win_unicode_console-0.5    |           py35_0          27 KB</span>
<span class="go">    conda-4.1.11               |           py35_0         247 KB</span>
<span class="go">    pickleshare-0.7.3          |           py35_0           8 KB</span>
<span class="go">    pip-8.1.2                  |           py35_0         1.6 MB</span>
<span class="go">    prompt_toolkit-1.0.3       |           py35_0         308 KB</span>
<span class="go">    traitlets-4.2.2            |           py35_0         113 KB</span>
<span class="go">    ipython-5.0.0              |           py35_0         1.0 MB</span>
<span class="go">    ------------------------------------------------------------</span>
<span class="go">                                           Total:         8.6 MB</span>

<span class="go">The following NEW packages will be INSTALLED:</span>

<span class="go">    colorama:            0.3.7-py35_0</span>
<span class="go">    conda:               4.1.11-py35_0</span>
<span class="go">    conda-env:           2.5.2-py35_0</span>
<span class="go">    decorator:           4.0.10-py35_0</span>
<span class="go">    ipython:             5.0.0-py35_0</span>
<span class="go">    ipython_genutils:    0.1.0-py35_0</span>
<span class="go">    menuinst:            1.4.1-py35_0</span>
<span class="go">    path.py:             8.2.1-py35_0</span>
<span class="go">    pickleshare:         0.7.3-py35_0</span>
<span class="go">    pip:                 8.1.2-py35_0</span>
<span class="go">    prompt_toolkit:      1.0.3-py35_0</span>
<span class="go">    pycosat:             0.6.1-py35_1</span>
<span class="go">    pygments:            2.1.3-py35_0</span>
<span class="go">    pyyaml:              3.11-py35_4</span>
<span class="go">    requests:            2.10.0-py35_0</span>
<span class="go">    ruamel_yaml:         0.11.14-py35_0</span>
<span class="go">    setuptools:          23.0.0-py35_0</span>
<span class="go">    simplegeneric:       0.8.1-py35_1</span>
<span class="go">    six:                 1.10.0-py35_0</span>
<span class="go">    traitlets:           4.2.2-py35_0</span>
<span class="go">    vs2015_runtime:      14.0.25123-0</span>
<span class="go">    wcwidth:             0.1.7-py35_0</span>
<span class="go">    wheel:               0.29.0-py35_0</span>
<span class="go">    win_unicode_console: 0.5-py35_0</span>

<span class="go">Proceed ([y]/n)?</span>
</pre></div>
</div>
<section id="id4">
<h3><a class="toc-backref" href="#id20" role="doc-backlink">初回起動</a><a class="headerlink" href="#id4" title="Link to this heading">¶</a></h3>
<p><code class="file docutils literal notranslate"><span class="pre">%PYTHONDIR%\Scripts\ipython3.exe</span></code> を起動するだけでよい。Windows の
<span class="guilabel">ファイル名を指定して実行</span> で同実行ファイルを指定すると、コンソールウィンドウが出現する。</p>
<p>私の環境でのスタートアップ時の出力を記す。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go">WARNING: Readline services not available or not loaded.</span>
<span class="go">WARNING: Proper color support under MS Windows requires the pyreadline library.</span>
<span class="go">You can find it at:</span>
<span class="go">http://ipython.org/pyreadline.html</span>

<span class="go">Defaulting color scheme to &#39;NoColor&#39;</span>
<span class="go">Python 3.4.1 (v3.4.1:c0e311e010fc, May 18 2014, 10:45:13) [MSC v.1600 64 bit (AMD64)]</span>
<span class="go">Type &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span>

<span class="go">IPython 3.0.0 -- An enhanced Interactive Python.</span>
<span class="go">?         -&gt; Introduction and overview of IPython&#39;s features.</span>
<span class="go">%quickref -&gt; Quick reference.</span>
<span class="go">help      -&gt; Python&#39;s own help system.</span>
<span class="go">object?   -&gt; Details about &#39;object&#39;, use &#39;object??&#39; for extra details.</span>

<span class="gp">In [1]:</span>
</pre></div>
</div>
<ul class="simple">
<li><p>WARNING のメッセージが気になるので、ここから攻める。指示に従い pyreadline なるパッケージをインストールしよう。</p></li>
</ul>
</section>
<section id="pyreadline">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">PyReadline をインストール</a><a class="headerlink" href="#pyreadline" title="Link to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>このパッケージは IPython 5.0.0 では依存関係がなくなっているようだ。</p>
</div>
<p>名前からして Python 版 readline と思われるパッケージを <strong class="program">pip</strong> でインストールして、再度 IPython を起動したい。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bash$ pip install pyreadline</span>
<span class="go">Downloading/unpacking pyreadline</span>
<span class="go">  Running setup.py (path:D:\cygwin64\tmp\pip_build_work\pyreadline\setup.py) egg_info for package pyreadline</span>

<span class="go">    package init file &#39;pyreadline\configuration\__init__.py&#39; not found (or not a regular file)</span>
<span class="go">Installing collected packages: pyreadline</span>
<span class="go">  Running setup.py install for pyreadline</span>
<span class="go">    package init file &#39;pyreadline\configuration\__init__.py&#39; not found (or not a regular file)</span>

<span class="go">Successfully installed pyreadline</span>
<span class="go">Cleaning up...</span>
</pre></div>
</div>
<p>インストール後 <strong class="program">ipython</strong> を起動すると次の変化が見られた。</p>
<ul class="simple">
<li><p>WARNING メッセージが表示されなくなった。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">In</span> <span class="pre">[1]:</span></code>, <code class="docutils literal notranslate"><span class="pre">Out</span> <span class="pre">[1]:</span></code> 等のプロンプト文字列に色がついた。</p></li>
<li><p>例えば <kbd class="kbd docutils literal notranslate">Ctrl</kbd> + <kbd class="kbd docutils literal notranslate">A</kbd> （以下 Emacs 風に表記する。これは <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">C</kbd>-<kbd class="kbd docutils literal notranslate">a</kbd></kbd> と表記することになる）で「キャレットがコマンドライン行の先頭に移動する」等の
Emacs 風のキーバインドがなされている。これが一番ありがたい変化。この機能があるというだけで私には通常の Python 対話モードから IPython に乗り換える動機になる。</p></li>
</ul>
<p>よい変化なので、PyReadline のインストールの状態を保ったまま先に進もう。</p>
</section>
<section id="id5">
<h3><a class="toc-backref" href="#id22" role="doc-backlink">テスト</a><a class="headerlink" href="#id5" title="Link to this heading">¶</a></h3>
<p>ここで IPython の動作確認テストを行いたい。</p>
<section id="ipython-3-0-0">
<h4><a class="toc-backref" href="#id23" role="doc-backlink">IPython 3.0.0</a><a class="headerlink" href="#ipython-3-0-0" title="Link to this heading">¶</a></h4>
<p>公式ドキュメントに従い、初回条件で <strong class="program">iptest</strong> を実行すると以下のようになった。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bash$ iptest3</span>
<span class="go">Traceback (most recent call last):</span>
<span class="go">  File &quot;D:\Python34\lib\runpy.py&quot;, line 170, in _run_module_as_main</span>
<span class="go">    &quot;__main__&quot;, mod_spec)</span>
<span class="go">  File &quot;D:\Python34\lib\runpy.py&quot;, line 85, in _run_code</span>
<span class="go">    exec(code, run_globals)</span>
<span class="go">  File &quot;D:\Python34\Scripts\iptest3.exe\__main__.py&quot;, line 5, in &lt;module&gt;</span>
<span class="go">  File &quot;D:\Python34\lib\site-packages\IPython\testing\iptestcontroller.py&quot;, line 20, in &lt;module&gt;</span>
<span class="go">    import requests</span>
<span class="go">ImportError: No module named &#39;requests&#39;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>モジュール <code class="docutils literal notranslate"><span class="pre">requests</span></code> を別途インストールする必要がありそうだ。</p>
<ul>
<li><p>インストールしたが、今度は <code class="docutils literal notranslate"><span class="pre">ImportError:</span> <span class="pre">you</span> <span class="pre">need</span> <span class="pre">to</span> <span class="pre">have</span> <span class="pre">pywin32</span> <span class="pre">installed</span> <span class="pre">for</span> <span class="pre">this</span> <span class="pre">to</span> <span class="pre">work</span></code>
なるエラーが。</p></li>
</ul>
</li>
</ul>
<p>結論としては、これは面倒そうなので諦めた。</p>
</section>
<section id="ipython-4-0-0">
<h4><a class="toc-backref" href="#id24" role="doc-backlink">IPython 4.0.0</a><a class="headerlink" href="#ipython-4-0-0" title="Link to this heading">¶</a></h4>
<p>一連の自動テストが実行された。エラーがボロボロと現れる。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bash$ iptest3</span>

<span class="go">Test group: core</span>
<span class="go">............................</span>
<span class="go">省略</span>
<span class="go">______________________________________________________________________</span>
<span class="go">Test suite completed for system with the following information:</span>
<span class="go">IPython version: 4.0.0</span>
<span class="go">IPython commit : f534027 (installation)</span>
<span class="go">IPython package: d:\python35\lib\site-packages\IPython</span>
<span class="go">Python version : 3.5.0 (v3.5.0:374f501f4567, Sep 13 2015, 02:27:37) [MSC v.1900 64 bit (AMD64)]</span>
<span class="go">sys.executable : d:\python35\python.exe</span>
<span class="go">Platform       : Windows-10.0.10240</span>

<span class="go">Tools and libraries available at test time:</span>
<span class="go">   matplotlib pygments sqlite3</span>

<span class="go">Status: ERROR - 1 out of 7 test groups failed (core). Took 125.286s.</span>

<span class="go">You may wish to rerun these, with:</span>
<span class="go">  iptest core</span>
</pre></div>
</div>
</section>
<section id="ipython-5-0-0">
<h4><a class="toc-backref" href="#id25" role="doc-backlink">IPython 5.0.0</a><a class="headerlink" href="#ipython-5-0-0" title="Link to this heading">¶</a></h4>
<p>Conda で IPython をインストールしたところ、<code class="file docutils literal notranslate"><span class="pre">Scripts</span></code> に <strong class="program">iptest3</strong>
がないようだ。開発版では当然存在する。</p>
</section>
</section>
</section>
<section id="id6">
<h2><a class="toc-backref" href="#id26" role="doc-backlink">環境設定</a><a class="headerlink" href="#id6" title="Link to this heading">¶</a></h2>
<p>IPython の挙動を次の各項目により制御できるはずなので、本章ではそれらを調べていこう。</p>
<ul class="simple">
<li><p>環境変数</p></li>
<li><p>設定ファイル</p></li>
<li><p>コマンドライン引数</p></li>
</ul>
<section id="id7">
<h3><a class="toc-backref" href="#id27" role="doc-backlink">環境変数による設定</a><a class="headerlink" href="#id7" title="Link to this heading">¶</a></h3>
<p>既定では、IPython は使用者固有の設定ファイル群（プロファイル）を次の優先順位で定まるディレクトリーから読み込む：</p>
<ol class="arabic simple">
<li><p>環境変数 <code class="docutils literal notranslate"><span class="pre">IPYTHONDIR</span></code> が定義されていればディレクトリー <code class="file docutils literal notranslate"><span class="pre">$IPYTHONDIR</span></code></p></li>
<li><p>環境変数 <code class="docutils literal notranslate"><span class="pre">XDG_CONFIG_HOME</span></code> が定義されていればディレクトリー
<code class="file docutils literal notranslate"><span class="pre">$XDG_CONFIG_HOME/.ipython/</span></code></p></li>
<li><p>ディレクトリー <code class="file docutils literal notranslate"><span class="pre">$HOME/.config/</span></code> が存在すればディレクトリー
<code class="file docutils literal notranslate"><span class="pre">$HOME/.config/ipython</span></code></p></li>
<li><p>ディレクトリー <code class="file docutils literal notranslate"><span class="pre">$HOME/.ipython/</span></code></p></li>
</ol>
<p><a class="reference internal" href="xdg.html"><span class="doc">XDG Base Directory 利用ノート</span></a> の方針に従い、次のことを実施しておく：</p>
<ul>
<li><p>ディレクトリー <code class="file docutils literal notranslate"><span class="pre">$HOME/.config/ipython</span></code> を用意する</p></li>
<li><p>上記ノートで述べように当該 XDG 環境変数を定義しておく</p></li>
<li><p>心配なら対話シェル初期化スクリプトで次の定義を入れておく：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">IPYTHONDIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$XDG_CONFIG_HOME</span><span class="s2">/ipython&quot;</span>
</pre></div>
</div>
</li>
</ul>
<p>現在の設定ファイル置場パスは、コマンドラインから次を実行して確認可能だ：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ipython<span class="w"> </span>locate
<span class="go">/home/USERNAME/.config/ipython</span>
</pre></div>
</div>
</section>
<section id="id8">
<h3><a class="toc-backref" href="#id28" role="doc-backlink">設定ファイルによる設定</a><a class="headerlink" href="#id8" title="Link to this heading">¶</a></h3>
<p>設定ファイル置場が定まったので、IPython 設定ディレクトリーにプロファイルと呼ばれる設定ファイルの雛形を作成する：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bash$ ipython profile create</span>
<span class="go">[ProfileCreate] Generating default config file: PosixPath(&#39;/home/USERNAME/.config/ipython/profile_dummy/ipython_config.py&#39;)</span>
<span class="go">[ProfileCreate] Generating default config file: PosixPath(&#39;/home/USERNAME/.config/ipython/profile_dummy/ipython_kernel_config.py&#39;)</span>
</pre></div>
</div>
<p>これでテンプレファイル <code class="file docutils literal notranslate"><span class="pre">ipython_config.py</span></code> ができあがった。テキストエディターでこれを開き、有効にしたい箇所のコメントアウトを解除するとよさそうだ。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">InteractiveShellApp</span><span class="o">.</span><span class="n">pylab</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span>
</pre></div>
</div>
<p>これぐらいやっておくと、NumPy や Matplotlib の構成要素のインポートを自動的に行なってくれる。例えば <code class="code docutils literal notranslate"><span class="pre">import</span> <span class="pre">numpy</span> <span class="pre">as</span> <span class="pre">np</span></code> しなくても <code class="code docutils literal notranslate"><span class="pre">np.arange(10)</span></code>
のようなコードが通じる。さらに、下記の項目を有効にすると <code class="code docutils literal notranslate"><span class="pre">np.</span></code> すら不要になる。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">InteractiveShellApp</span><span class="o">.</span><span class="n">pylab_import_all</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>一見タイプの手間が省けて便利なようだが、たまにこれらのパッケージの識別子の名前と
Python 組み込みのオブジェクトの識別子がカブるようなもの (e.g. <code class="code docutils literal notranslate"><span class="pre">all</span></code>,
<code class="code docutils literal notranslate"><span class="pre">any</span></code>, etc.) があると事態が少々複雑になる。個人的には全インポートは無効にしておき、 NumPy や Matplotlib のモジュールとしてのインポートだけに留めておきたい。</p>
<p>敢えて NumPy と Matplotlib の自動インポートを抑制した状況でセッションを開きたい場合は名前付きプロファイルを生成して、設定ファイルの対応項目を False にする。そして、IPython 起動時に <code class="docutils literal notranslate"><span class="pre">--profile</span></code> コマンドラインオプションで設定名を指示する。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ipython<span class="w"> </span>profile<span class="w"> </span>create<span class="w"> </span>sympy
<span class="gp">$ </span>edit<span class="w"> </span><span class="nv">$XDG_CONFIG_HOME</span>/ipython/profile_sympy/ipython_config.py
<span class="gp">$ </span>ipython<span class="w"> </span>--profile<span class="o">=</span>sympy
</pre></div>
</div>
</section>
<section id="id9">
<h3><a class="toc-backref" href="#id29" role="doc-backlink">コマンドライン引数による設定</a><a class="headerlink" href="#id9" title="Link to this heading">¶</a></h3>
<p>プロファイルディレクトリーをコマンドラインから指定することも可能だ：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ipython<span class="w"> </span>--ipython-dir<span class="o">=</span>/path/to/ipython-dir<span class="w"> </span>--profile<span class="o">=</span>my-profile
</pre></div>
</div>
<p>IPython のすべての設定可能な値はコマンドライン引数から構成できる。</p>
<ul class="simple">
<li><p>通常は次の形式で指定する： <code class="docutils literal notranslate"><span class="pre">ipython</span> <span class="pre">--ClassName.attribute=value</span></code></p></li>
<li><p>ただし頻繁に用いられるオプションは短い別名形式が用意してある。例えば
<code class="docutils literal notranslate"><span class="pre">ipython</span> <span class="pre">--matplotlib</span></code> など。</p>
<ul>
<li><p>そのようなオプションの一覧は <code class="docutils literal notranslate"><span class="pre">ipython</span> <span class="pre">help</span></code> の Options のセクションで確認できる。</p></li>
</ul>
</li>
</ul>
<p>コマンドラインで指定したオプションは、設定ファイルのそれを上書きする。</p>
</section>
</section>
<section id="id10">
<h2><a class="toc-backref" href="#id30" role="doc-backlink">使い勝手を試す</a><a class="headerlink" href="#id10" title="Link to this heading">¶</a></h2>
<p>IPython コンソールウィンドウでの各種機能をひと通り試していこう。</p>
<ul class="simple">
<li><p>単に <code class="docutils literal notranslate"><span class="pre">?</span></code> を入力することで IPython に関するちょっとしたドキュメントが出力する。10 ページ弱で終了する。</p></li>
<li><p><strong class="command">%quickref</strong> で <em>Quick Reference Card</em> なるドキュメントが出力する。こちらはページ数が多め。</p></li>
<li><p>引数なしの <code class="code docutils literal notranslate"><span class="pre">help()</span></code> で対話的ヘルプモードになる。</p>
<ul>
<li><p>通常の <code class="code docutils literal notranslate"><span class="pre">help(X)</span></code> では、普通の Python コンソール同様の機能 X に関するヘルプが出力することを確認した。</p></li>
</ul>
</li>
<li><p><code class="code docutils literal notranslate"><span class="pre">X?</span></code> で IPython スタイルの機能 X に関するヘルプが出力することを確認した。</p>
<ul>
<li><p><code class="code docutils literal notranslate"><span class="pre">X??</span></code> で詳細な情報が出力されるとのことだが、あまり変わらない？</p></li>
</ul>
</li>
<li><p>タイプが面倒に感じたら、即タブキーを押す。残り文字列が補完されて便利。</p>
<ul>
<li><p>補完されるのは識別子、Python キーワード。なんとファイルパスも補完対象。</p></li>
</ul>
</li>
<li><p><strong class="command">%pdoc X</strong> で機能 X の docstring が出力することを確認した。</p></li>
<li><p><strong class="command">%pfile X</strong> でモジュール X のテキスト的な内容が出力することを確認した。</p></li>
<li><p><strong class="command">%timeit</strong> と <strong class="command">%%timeit</strong> を試した。</p></li>
<li><p><strong class="command">%lsmagic</strong> で利用可能なマジックの一覧と <strong class="command">%automagic</strong> スイッチの ON/OFF 状況が出力することを確認した。</p></li>
<li><p><strong class="command">%history</strong> でコマンド入力の履歴が出力することを確認した。</p>
<ul>
<li><p>詳しくは後述する。</p></li>
</ul>
</li>
<li><p><code class="code docutils literal notranslate"><span class="pre">!X</span></code> でシステムシェルコマンド X を実行できることを確認した。</p></li>
</ul>
<p>マジック機能のメモがたくさんできるがしょうがない。
<a class="reference external" href="http://ipython.org/ipython-doc/stable/interactive/magics.html">Built-in magic commands</a>
を眺めて使えそうなものを試そう。</p>
<ul>
<li><p><strong class="command">%who</strong>, <strong class="command">%whos</strong> で自分が定義した識別子のリストを出力できる。後者は利用回数も確認できてたいへん便利。</p></li>
<li><p>履歴機能操作は readline に強く依存することに留意するべし。</p>
<ul class="simple">
<li><p><kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">C</kbd>-<kbd class="kbd docutils literal notranslate">r</kbd></kbd> で Bash でいうところの reverse-i-search 機能が使える。すなわち、過去のコマンド入力をインクリメンタルサーチする。</p></li>
<li><p><kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">C</kbd>-<kbd class="kbd docutils literal notranslate">p</kbd></kbd>, <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">C</kbd>-<kbd class="kbd docutils literal notranslate">n</kbd></kbd>, 上矢印または下矢印キーで入力履歴を一個ずつ移動できる。</p></li>
</ul>
</li>
<li><p>履歴リストについて。</p>
<ul class="simple">
<li><p>オプション <code class="code docutils literal notranslate"><span class="pre">-n</span></code> を常に指定して、履歴番号を表示するようにしたい。この番号情報を基に <strong class="command">%recall</strong> することになるはずだから。</p></li>
<li><p>例えば <strong class="command">%history -g print</strong> のようにすると履歴の <strong class="program">grep</strong> が行える。オプション <code class="code docutils literal notranslate"><span class="pre">-g</span></code> を指定するときには、同じコマンド入力が重複して出力されないように、オプション <code class="code docutils literal notranslate"><span class="pre">-u</span></code> も併せて指定することも許される。</p></li>
<li><p>オプション <code class="code docutils literal notranslate"><span class="pre">-l</span></code> で直近の数コマンドだけを表示できる。</p></li>
<li><p>オプション <code class="code docutils literal notranslate"><span class="pre">-o</span></code> と <code class="code docutils literal notranslate"><span class="pre">-p</span></code> を同時に指定すると、履歴の表示が doctest
の書式で出力される。このテキストをこのノートにそのまま貼り付けて、サンプルコードのメモ作業を楽にすることもできる。</p></li>
</ul>
</li>
<li><p>TBW: 自動インデントの空白文字数調整</p></li>
<li><p>ログ機能について。</p>
<ul class="simple">
<li><p><strong class="command">%logstart</strong> でセッションログを保存できる。コンソールでの入出力を適宜テキストファイルに保存するものだ。</p></li>
</ul>
</li>
<li><p>TBW: <strong class="command">%alias</strong></p></li>
<li><p>Input caching system: IPython が記憶しているユーザーのコンソールでの入力を再利用できる。</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">_i</span></code> で 1 つ前の入力を得られる。</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">_ii</span></code> で 2 つ前の入力を得られる。</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">_iii</span></code> で 3 つ前の入力を得られる。</p></li>
<li><p>リスト <code class="code docutils literal notranslate"><span class="pre">In</span></code>, <code class="code docutils literal notranslate"><span class="pre">_ih</span></code> でプロンプト番号を添字にして入力を得られる。</p></li>
<li><p>実は <code class="code docutils literal notranslate"><span class="pre">_i5</span></code> やら <code class="code docutils literal notranslate"><span class="pre">_i100</span></code> やらからも（もし存在すれば）入力を得られる。</p></li>
</ul>
</li>
<li><p>Output caching system: 上記の機能の出力バージョン。</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">_</span></code> で 1 つ前の出力を得られる。通常の Python コンソールと同じ。</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">__</span></code> で 2 つ前の出力を得られる。</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">___</span></code> で 3 つ前の出力を得られる。</p></li>
<li><p>辞書 <code class="code docutils literal notranslate"><span class="pre">Out</span></code>, <code class="code docutils literal notranslate"><span class="pre">_oh</span></code> でプロンプト番号をキーにして出力を得られる。</p></li>
</ul>
</li>
<li><p>ディレクトリー移動履歴も管理している。</p>
<ul class="simple">
<li><p>リスト <code class="code docutils literal notranslate"><span class="pre">_dh</span></code> に作業ディレクトリーをユーザーが訪問した順に保存する。</p></li>
<li><p>コマンド <strong class="command">%cd X</strong> を実行すれば、作業ディレクトリーを X に移動する。</p></li>
<li><p>コマンド <strong class="command">%dhist</strong> を実行すれば、作業ディレクトリーを訪問順に一覧できる。</p></li>
</ul>
</li>
<li><p>スクリプトを IPython のセッションから起動できる。次のコード片は自作のスクリプトを <strong class="command">%run</strong> コマンドにより起動した様子を再現したものだ。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="o">%</span><span class="k">run</span> ~/bin/listmanager.py remove showa_yojyo bot zzz
<span class="go">0-15: Wait...</span>
<span class="go">0-15: OK:</span>
<span class="go">zzz</span>
</pre></div>
</div>
<ul>
<li><p>スクリプトのファイル名の拡張子は省略可能のようだ。</p></li>
<li><p>オプション <code class="code docutils literal notranslate"><span class="pre">-t</span></code> で実行時間を測定する。コマンドラインでいうところの
<strong class="command">time python commands</strong> のようなものだ。例を示す。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="o">%</span><span class="k">run</span> -t ./bin/mjscore.py -F --today
<span class="go">集計期間           2016/09/01 00:40 - 2016/09/01 02:13</span>
<span class="go">...</span>

<span class="go">IPython CPU timings (estimated):</span>
<span class="go">  User   :       1.20 s.</span>
<span class="go">  System :       0.00 s.</span>
<span class="go">Wall time:       1.19 s.</span>
</pre></div>
</div>
</li>
<li><p>オプション <code class="code docutils literal notranslate"><span class="pre">-d</span></code> で対象を <strong class="program">pdb</strong> の支配下で実行する。ブレイクポイント等のデバッガーオプションも同時に指定できる。</p></li>
<li><p>オプション <code class="code docutils literal notranslate"><span class="pre">-p</span> <span class="pre">[profile</span> <span class="pre">options]</span></code> でプロファイルをとれる。というより、コマンド <strong class="command">%prun</strong> のラッパーだと思われる。</p></li>
<li><p>オプション <code class="code docutils literal notranslate"><span class="pre">-m</span> <span class="pre">module_name</span></code> で指定モジュールをスクリプトとして実行する。コマンドラインでいうところの <strong class="command">python -m module</strong> の Python コード限定版という感じだ。</p></li>
</ul>
</li>
<li><p><strong class="command">%prun</strong>, <strong class="command">%%prun</strong> はプロファイラー付きでコードを実行する。コマンドラインで <strong class="command">python -m cProfile [options] file</strong> を実行するのに近い。</p></li>
<li><p>複数行に亘る関数の定義のコーディングは IPython ウィンドウ内で行うよりも、常用しているテキストエディターで行えるほうが効率的だ。コマンド <strong class="command">%edit</strong> はそれを実現する。このコマンドを実行すると、デフォルトでは <strong class="program">notepad</strong> が開く。ここでコードを書いて保存して閉じる。すると IPython のセッションにその内容が伝わる。エディターで定義した関数を呼び出すことができる。</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [2]: </span><span class="o">%</span><span class="k">edit</span>
<span class="go">IPython will make a temporary file named: D:\Temp\ipython_edit_3cn_y47j\ipython_edit_osmxydqq.py</span>
<span class="go">Editing... done. Executing edited code...</span>
<span class="gh">Out[2]: </span><span class="go">&#39;def need_to_be_in_love():\n\tpass\n&#39;</span>

<span class="gp">In [3]: </span><span class="n">need_to_be_in_love</span><span class="p">()</span>

<span class="gp">In [4]:</span>
</pre></div>
</div>
<p><strong class="program">notepad</strong> では逆にテキスト編集の効率が落ちるはずなので、オプション
<code class="docutils literal notranslate"><span class="pre">TerminalInteractiveShell.editor</span></code> で馴染みのテキストエディターを指定する。</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set the editor used by IPython (default to $EDITOR/vi/notepad).</span>
<span class="n">c</span><span class="o">.</span><span class="n">TerminalInteractiveShell</span><span class="o">.</span><span class="n">editor</span> <span class="o">=</span> <span class="s1">&#39;D:/Program Files/xyzzy/xyzzy.exe&#39;</span>
</pre></div>
</div>
</li>
<li><p>クリップボードの内容を Python のコードとして評価することができる。</p>
<ul class="simple">
<li><p>キーボードで <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">C</kbd>-<kbd class="kbd docutils literal notranslate">S</kbd>-<kbd class="kbd docutils literal notranslate">v</kbd></kbd> を押すと、クリップボードに保存されている Python コードを即時評価する。</p></li>
<li><p>コマンド <strong class="command">%paste</strong> を実行すると、いったんクリップボードの内容を画面にエコーしてから、コード内容を評価する。</p></li>
<li><p>代わりにコマンド <strong class="command">%cpaste</strong> を実行すると、まずはクリップボードに保存されている Python コードの編集モードになる。次にユーザーが <code class="code docutils literal notranslate"><span class="pre">--</span></code> という行を入力すると編集終了となり、そこに書かれたコードが最終的に評価される。</p></li>
</ul>
</li>
<li><p>作業内容のリセット機能がある。</p>
<ul class="simple">
<li><p>コマンド <strong class="command">%reset</strong> でセッションの各種状態（ユーザー定義のオブジェクト、入力履歴、出力履歴、ディレクトリー移動履歴）をクリアすることができる。</p>
<ul>
<li><p>異色なのは <strong class="command">%reset array</strong> だろう。NumPy の配列オブジェクトをすべて削除するというものだ。</p></li>
</ul>
</li>
<li><p>コマンド <strong class="command">%reset_selective</strong> を用いれば、クリアしたいユーザー定義のオブジェクトを正規表現で指定できる。</p></li>
</ul>
</li>
</ul>
<div class="admonition-todo admonition" id="id11">
<p class="admonition-title">Todo</p>
<ul class="simple">
<li><p>Windows だと <strong class="command">!</strong> コマンドが使えてもあまりうれしくない。 Cygwin のコマンドを使いたいので設定可能か調べる。単に <code class="file docutils literal notranslate"><span class="pre">/bin</span></code> に <code class="docutils literal notranslate"><span class="pre">PATH</span></code> を通すだけかもしれない。</p></li>
<li><p>Output caching system の <code class="code docutils literal notranslate"><span class="pre">_&lt;n&gt;</span></code> の有効な <em>n</em> を知りたい場合は？</p></li>
</ul>
</div>
</section>
<section id="qt">
<h2><a class="toc-backref" href="#id31" role="doc-backlink">Qt コンソールを試す</a><a class="headerlink" href="#qt" title="Link to this heading">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>本節の記述は現時点では公式に deprecated 扱いされている。 Jupyter とやらを利用するようにとのことだ。</p>
</div>
<p><a class="reference external" href="http://www.riverbankcomputing.co.uk/software/pyqt/">PyQt</a> と <a class="reference external" href="http://zeromq.github.io/pyzmq/">PyZMQ</a> が利用可能であれば、IPython を PyQt ウィンドウで再現できる。私の環境では PyQt はインストールが済んでいるものの、PyZMQ が入っていなかった。本節では PyZMQ のインストール作業から記す。</p>
<section id="pyzmq">
<h3><a class="toc-backref" href="#id32" role="doc-backlink">PyZMQ をインストールする</a><a class="headerlink" href="#pyzmq" title="Link to this heading">¶</a></h3>
<p><a class="reference external" href="http://zeromq.github.io/pyzmq/">PyZMQ</a> が何であるのかを理解するのは後回しにして、まずはインストールだ。IPython
のドキュメントにあるように、素直に <strong class="program">pip</strong> でインストールできる。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bash$ pip install pyzmq</span>
<span class="go">Downloading/unpacking pyzmq</span>
<span class="go">Installing collected packages: pyzmq</span>
<span class="go">Successfully installed pyzmq</span>
<span class="go">Cleaning up...</span>
<span class="go">bash$ pip list | grep -i pyzmq</span>
<span class="go">pyzmq (14.5.0)</span>
</pre></div>
</div>
</section>
<section id="id12">
<h3><a class="toc-backref" href="#id33" role="doc-backlink">Qt コンソールを起動する（シンプル）</a><a class="headerlink" href="#id12" title="Link to this heading">¶</a></h3>
<p>Windows の <span class="guilabel">ファイル名を指定して実行</span> で次のように指定する。</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>%PYTHONDIR%\Scripts\ipython3.exe qtconsole
</pre></div>
</div>
<p>一旦真っ黒なウィンドウが表示され、次に Qt ウィンドウが表示される。後者がコンソールとなる。通常の IPython のように使えるだけでなく、よく見ると便利なコマンドを起動するメニューがウィンドウ上部に備えられている。</p>
</section>
<section id="id13">
<h3><a class="toc-backref" href="#id34" role="doc-backlink">Qt コンソールを起動する（プロットインライン）</a><a class="headerlink" href="#id13" title="Link to this heading">¶</a></h3>
<p>Matplotlib のプロット図をインラインに Qt コンソール内に描画させる。この機能が Qt
コンソールの目玉であると思われる。まずは IPython を次のようなコマンドライン引数を指定して起動する。ドキュメントには <strong class="command">qtconsole --matplotlib inline</strong> と指定すると記されているが、私の環境ではダメだった。</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>%PYTHONDIR%\Scripts\ipython3.exe qtconsole --pylab=inline
</pre></div>
</div>
<p>試しに Matplotlib を内部的に利用した NetworkX のメソッドを経由して描画してみよう。</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/ipython-qtconsole-inline.png"><img alt="IPython Qt Console" src="_images/ipython-qtconsole-inline.png" style="width: 307.0px; height: 301.0px;" />
</a>
</figure>
<p>インラインでグラフを描画できて何がうれしいのかと言うと、このコンソールウィンドウを保存できるからだ。ファイルメニューの <span class="menuselection">Save</span> を選択すると、コンソールでの入出力をHTML と画像とに分けてファイルとして保存できる。</p>
</section>
</section>
<section id="id14">
<h2><a class="toc-backref" href="#id35" role="doc-backlink">その他</a><a class="headerlink" href="#id14" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>YouTube で <code class="code docutils literal notranslate"><span class="pre">IPython</span></code> で検索すると、面白いビデオが大量に見つかる。
<code class="code docutils literal notranslate"><span class="pre">IPython</span> <span class="pre">Windows</span></code> 等もよい。</p></li>
<li><p>ConEmu ユーザーならば、当然 IPython をタブ化できるようにしておくのが筋だろう。ところで Qt コンソールウィンドウはタブ化できないのだろうか。「元ウィンドウ」はタブ化できる。</p></li>
<li><p>このノートをだいたい書き終わったあとに気づいたが、オライリーの
<a class="reference external" href="http://www.oreilly.co.jp/books/9784873116556/">Python によるデータ分析入門</a>
という本が IPython を紹介するのに一章分紙幅を割いている。たいへんまとまっていて便利だ。</p></li>
</ul>
</section>
</section>


          </div>
    <div class="related bottom">
      &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="python-nose.html" title="Previous">Nose 利用ノート [obsolete]</a>
        </li>
      
        <li>
          <a href="python-jupyter.html" title="Next">Jupyter 利用ノート</a>
          &rarr;
        </li>
    </ul>
  </nav>
    </div>

      </div>
      <div class="clearer"></div>
    </div>
<div class="footer">
  <ul>
    <li id="footer_logo">
      <a class="image-reference" href="index.html" title="読書ノート Home"><img src="_images/logo.svg"/></a>
    </li>
    <li id="footer_copyright">
      Copyright &copy; 1999-2024, プレハブ小屋 All rights reserved.
    </li>
  </ul>
</div>
  </body>
</html>