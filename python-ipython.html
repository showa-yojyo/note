
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>IPython 利用ノート &#8212; 読書ノート v1.4</title>
    <link rel="stylesheet" href="_static/prefab.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/mathjaxconf.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="next" title="Jupyter 利用ノート" href="python-jupyter.html" />
    <link rel="prev" title="Nose 利用ノート" href="python-nose.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="python-jupyter.html" title="Jupyter 利用ノート"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="python-nose.html" title="Nose 利用ノート"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">読書ノート</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <div class="section" id="ipython">
<h1><a class="toc-backref" href="#id17">IPython 利用ノート</a><a class="headerlink" href="#ipython" title="Permalink to this headline">¶</a></h1>
<p>本稿は <a class="reference external" href="http://ipython.org/">IPython</a> に関する個人的な覚え書きである。
<a class="reference external" href="http://www.numpy.org/">NumPy</a>, <a class="reference external" href="http://www.scipy.org/">SciPy</a>, <a class="reference external" href="http://matplotlib.org/">Matplotlib</a> のドキュメントを読んでいるとこのツールの名前が頻繁に出てくる。無視するのはもったいない気がするので調査する。</p>
<div class="contents topic" id="id1">
<p class="topic-title first">ノート目次</p>
<ul class="simple">
<li><a class="reference internal" href="#ipython" id="id17">IPython 利用ノート</a><ul>
<li><a class="reference internal" href="#id2" id="id18">IPython とは何か</a></li>
<li><a class="reference internal" href="#id3" id="id19">インストールから初回起動まで</a><ul>
<li><a class="reference internal" href="#id4" id="id20">初回起動</a></li>
<li><a class="reference internal" href="#pyreadline" id="id21">PyReadline をインストール</a></li>
<li><a class="reference internal" href="#id5" id="id22">テスト</a><ul>
<li><a class="reference internal" href="#ipython-3-0-0" id="id23">IPython 3.0.0</a></li>
<li><a class="reference internal" href="#ipython-4-0-0" id="id24">IPython 4.0.0</a></li>
<li><a class="reference internal" href="#ipython-5-0-0" id="id25">IPython 5.0.0</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id6" id="id26">環境設定</a><ul>
<li><a class="reference internal" href="#id7" id="id27">環境変数による設定</a></li>
<li><a class="reference internal" href="#id8" id="id28">設定ファイルによる設定</a></li>
<li><a class="reference internal" href="#id9" id="id29">コマンドライン引数による設定</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id10" id="id30">使い勝手を試す</a></li>
<li><a class="reference internal" href="#qt" id="id31">Qt コンソールを試す</a><ul>
<li><a class="reference internal" href="#pyzmq" id="id32">PyZMQ をインストールする</a></li>
<li><a class="reference internal" href="#id11" id="id33">Qt コンソールを起動する（シンプル）</a></li>
<li><a class="reference internal" href="#id12" id="id34">Qt コンソールを起動する（プロットインライン）</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id13" id="id35">その他</a></li>
</ul>
</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>OS<ul>
<li>Windows 7 Home Premium x64 SP1</li>
<li>Windows 10 Home x64</li>
</ul>
</li>
<li>本稿において、利用した各パッケージのバージョンは次のとおり。<ul>
<li><a class="reference external" href="http://www.python.org/">Python</a> 3.4.1, 3.5.0, 3.5.2</li>
<li><a class="reference external" href="http://ipython.org/">IPython</a> 3.0.0, 4.0.0, 5.0.0</li>
<li><a class="reference external" href="http://ipython.org/pyreadline.html">PyReadline</a> 2.0, 2.1, n/a</li>
<li><a class="reference external" href="http://readthedocs.org/docs/nose/">Nose</a> 1.3.4, 1.3.7</li>
<li><a class="reference external" href="http://www.riverbankcomputing.co.uk/software/pyqt/">PyQt</a> v5.3.1 for Python v3.4 (x64), n/a for Python v3.5 (x64), 4.11.4</li>
<li><a class="reference external" href="http://zeromq.github.io/pyzmq/">PyZMQ</a> 14.5.0, 14.7.0, TODO</li>
</ul>
</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">本稿では文字列 <code class="docutils literal notranslate"><span class="pre">%PYTHONDIR</span></code> を <code class="file docutils literal notranslate"><span class="pre">python.exe</span></code> が存在するディレクトリーのパスを意味する環境変数のようなものを表現するものであることにする。例えば、正規の Python 3.5 インストーラーを用いて D ドライブ直下にインストールした環境ではこの値は <code class="file docutils literal notranslate"><span class="pre">D:\Python35</span></code> であり、
Miniconda の 3.5 インストーラーを用いて D ドライブ直下にインストールした環境ではこの値は <code class="file docutils literal notranslate"><span class="pre">D:\Miniconda3</span></code> である。</p>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id18">IPython とは何か</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>ドキュメントによると &lt;IPython is meant to work as a drop-in replacement
for the standard interactive interpreter&gt; だそうだ。標準の Python インタープリターの上位版のようなモノだ。</p>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id19">インストールから初回起動まで</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>次の条件を初回条件と呼ぶことにする。</p>
<ul class="simple">
<li>Python がインストール済みである。</li>
<li><strong class="program">conda</strong> または <strong class="program">pip</strong> の実行ファイルのあるフォルダーに PATH が通っている。</li>
</ul>
<p>これを満たす環境において、
<a class="reference internal" href="python-miniconda.html#python-pkg-proc"><span class="std std-ref">一般のサードパーティー製 Python パッケージのインストール手順</span></a> に示したようにすると IPython をインストールできる。</p>
<p>次に <strong class="program">conda</strong> によるインストール手続きの例を示す。</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span>$ conda install ipython
Fetching package metadata: ....
Solving package specifications: .........

Package plan for installation in environment D:\Miniconda3:

The following packages will be downloaded:

    package                    |            build
    ---------------------------|-----------------
    vs2015_runtime-14.0.25123  |                0         1.9 MB
    colorama-0.3.7             |           py35_0          19 KB
    conda-env-2.5.2            |           py35_0          67 KB
    decorator-4.0.10           |           py35_0          12 KB
    ipython_genutils-0.1.0     |           py35_0          33 KB
    menuinst-1.4.1             |           py35_0         107 KB
    path.py-8.2.1              |           py35_0          47 KB
    pycosat-0.6.1              |           py35_1          80 KB
    pygments-2.1.3             |           py35_0         1.3 MB
    pyyaml-3.11                |           py35_4         169 KB
    requests-2.10.0            |           py35_0         656 KB
    ruamel_yaml-0.11.14        |           py35_0         217 KB
    setuptools-23.0.0          |           py35_0         692 KB
    simplegeneric-0.8.1        |           py35_1           7 KB
    six-1.10.0                 |           py35_0           8 KB
    wcwidth-0.1.7              |           py35_0          21 KB
    win_unicode_console-0.5    |           py35_0          27 KB
    conda-4.1.11               |           py35_0         247 KB
    pickleshare-0.7.3          |           py35_0           8 KB
    pip-8.1.2                  |           py35_0         1.6 MB
    prompt_toolkit-1.0.3       |           py35_0         308 KB
    traitlets-4.2.2            |           py35_0         113 KB
    ipython-5.0.0              |           py35_0         1.0 MB
    ------------------------------------------------------------
                                           Total:         8.6 MB

The following NEW packages will be INSTALLED:

    colorama:            0.3.7-py35_0
    conda:               4.1.11-py35_0
    conda-env:           2.5.2-py35_0
    decorator:           4.0.10-py35_0
    ipython:             5.0.0-py35_0
    ipython_genutils:    0.1.0-py35_0
    menuinst:            1.4.1-py35_0
    path.py:             8.2.1-py35_0
    pickleshare:         0.7.3-py35_0
    pip:                 8.1.2-py35_0
    prompt_toolkit:      1.0.3-py35_0
    pycosat:             0.6.1-py35_1
    pygments:            2.1.3-py35_0
    pyyaml:              3.11-py35_4
    requests:            2.10.0-py35_0
    ruamel_yaml:         0.11.14-py35_0
    setuptools:          23.0.0-py35_0
    simplegeneric:       0.8.1-py35_1
    six:                 1.10.0-py35_0
    traitlets:           4.2.2-py35_0
    vs2015_runtime:      14.0.25123-0
    wcwidth:             0.1.7-py35_0
    wheel:               0.29.0-py35_0
    win_unicode_console: 0.5-py35_0

Proceed ([y]/n)?
</pre></div>
</div>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id20">初回起動</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p><code class="file docutils literal notranslate"><span class="pre">%PYTHONDIR%\Scripts\ipython3.exe</span></code> を起動するだけでよい。
Windows の「ファイル名を指定して実行」で同実行ファイルを指定すると、コンソールウィンドウが出現する。</p>
<p>私の環境でのスタートアップ時の出力を記す。</p>
<div class="code ipython highlight-default notranslate"><div class="highlight"><pre><span></span>WARNING: Readline services not available or not loaded.
WARNING: Proper color support under MS Windows requires the pyreadline library.
You can find it at:
http://ipython.org/pyreadline.html

Defaulting color scheme to &#39;NoColor&#39;
Python 3.4.1 (v3.4.1:c0e311e010fc, May 18 2014, 10:45:13) [MSC v.1600 64 bit (AMD64)]
Type &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.

IPython 3.0.0 -- An enhanced Interactive Python.
?         -&gt; Introduction and overview of IPython&#39;s features.
%quickref -&gt; Quick reference.
help      -&gt; Python&#39;s own help system.
object?   -&gt; Details about &#39;object&#39;, use &#39;object??&#39; for extra details.

In [1]:
</pre></div>
</div>
<ul class="simple">
<li>WARNING のメッセージが気になるので、ここから攻める。指示に従い
pyreadline なるパッケージをインストールしよう。</li>
</ul>
</div>
<div class="section" id="pyreadline">
<h3><a class="toc-backref" href="#id21">PyReadline をインストール</a><a class="headerlink" href="#pyreadline" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">このパッケージは IPython 5.0.0 では依存関係がなくなっているようだ。</p>
</div>
<p>名前からして Python 版 readline と思われるパッケージを <strong class="program">pip</strong> でインストールして、再度 IPython を起動したい。</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install pyreadline
Downloading/unpacking pyreadline
  Running setup.py (path:D:\cygwin64\tmp\pip_build_work\pyreadline\setup.py) egg_info for package pyreadline

    package init file &#39;pyreadline\configuration\__init__.py&#39; not found (or not a regular file)
Installing collected packages: pyreadline
  Running setup.py install for pyreadline
    package init file &#39;pyreadline\configuration\__init__.py&#39; not found (or not a regular file)

Successfully installed pyreadline
Cleaning up...
</pre></div>
</div>
<p>インストール後 <strong class="program">ipython</strong> を起動すると次の変化が見られた。</p>
<ul class="simple">
<li>WARNING メッセージが表示されなくなった。</li>
<li><code class="docutils literal notranslate"><span class="pre">In</span> <span class="pre">[1]:</span></code>, <code class="docutils literal notranslate"><span class="pre">Out</span> <span class="pre">[1]:</span></code> 等のプロンプト文字列に色がついた。</li>
<li>例えば <kbd class="kbd docutils literal notranslate">Ctrl + A</kbd> （以下 Emacs 風に表記する。これは <kbd class="kbd docutils literal notranslate">C-a</kbd> と表記することになる）で「キャレットがコマンドライン行の先頭に移動する」等の Emacs 風のキーバインドがなされている。これが一番ありがたい変化。この機能があるというだけで私には通常の Python 対話モードから IPython に乗り換える動機になる。</li>
</ul>
<p>よい変化なので、PyReadline のインストールの状態を保ったまま先に進もう。</p>
</div>
<div class="section" id="id5">
<h3><a class="toc-backref" href="#id22">テスト</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>ここで IPython の動作確認テストを行いたい。</p>
<div class="section" id="ipython-3-0-0">
<h4><a class="toc-backref" href="#id23">IPython 3.0.0</a><a class="headerlink" href="#ipython-3-0-0" title="Permalink to this headline">¶</a></h4>
<p>公式ドキュメントに従い、初回条件で <strong class="program">iptest</strong> を実行すると以下のようになった。</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span>$ iptest3
Traceback (most recent call last):
  File &quot;D:\Python34\lib\runpy.py&quot;, line 170, in _run_module_as_main
    &quot;__main__&quot;, mod_spec)
  File &quot;D:\Python34\lib\runpy.py&quot;, line 85, in _run_code
    exec(code, run_globals)
  File &quot;D:\Python34\Scripts\iptest3.exe\__main__.py&quot;, line 5, in &lt;module&gt;
  File &quot;D:\Python34\lib\site-packages\IPython\testing\iptestcontroller.py&quot;, line 20, in &lt;module&gt;
    import requests
ImportError: No module named &#39;requests&#39;
</pre></div>
</div>
<ul class="simple">
<li>モジュール <code class="docutils literal notranslate"><span class="pre">requests</span></code> を別途インストールする必要がありそうだ。<ul>
<li>インストールしたが、今度は <code class="docutils literal notranslate"><span class="pre">ImportError:</span> <span class="pre">you</span> <span class="pre">need</span> <span class="pre">to</span> <span class="pre">have</span> <span class="pre">pywin32</span> <span class="pre">installed</span> <span class="pre">for</span> <span class="pre">this</span> <span class="pre">to</span> <span class="pre">work</span></code>
なるエラーが。</li>
</ul>
</li>
</ul>
<p>結論としては、これは面倒そうなので諦めた。</p>
</div>
<div class="section" id="ipython-4-0-0">
<h4><a class="toc-backref" href="#id24">IPython 4.0.0</a><a class="headerlink" href="#ipython-4-0-0" title="Permalink to this headline">¶</a></h4>
<p>一連の自動テストが実行された。エラーがボロボロと現れる。</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span>$ iptest3

Test group: core
............................
省略
______________________________________________________________________
Test suite completed for system with the following information:
IPython version: 4.0.0
IPython commit : f534027 (installation)
IPython package: d:\python35\lib\site-packages\IPython
Python version : 3.5.0 (v3.5.0:374f501f4567, Sep 13 2015, 02:27:37) [MSC v.1900 64 bit (AMD64)]
sys.executable : d:\python35\python.exe
Platform       : Windows-10.0.10240

Tools and libraries available at test time:
   matplotlib pygments sqlite3

Status: ERROR - 1 out of 7 test groups failed (core). Took 125.286s.

You may wish to rerun these, with:
  iptest core
</pre></div>
</div>
</div>
<div class="section" id="ipython-5-0-0">
<h4><a class="toc-backref" href="#id25">IPython 5.0.0</a><a class="headerlink" href="#ipython-5-0-0" title="Permalink to this headline">¶</a></h4>
<p>Conda で IPython をインストールしたところ、<code class="file docutils literal notranslate"><span class="pre">Scripts</span></code> に <strong class="program">iptest3</strong> がないようだ。開発版では当然存在する。</p>
</div>
</div>
</div>
<div class="section" id="id6">
<h2><a class="toc-backref" href="#id26">環境設定</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>IPython の挙動を次の各項目により制御できるはずなので、本章ではそれらを調べていこう。</p>
<ul class="simple">
<li>環境変数</li>
<li>設定ファイル</li>
<li>コマンドライン引数</li>
</ul>
<div class="section" id="id7">
<h3><a class="toc-backref" href="#id27">環境変数による設定</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>IPython 固有の環境変数としては <span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">IPYTHON_DIR</span></code> ただひとつしかない？これはユーザー設定データ、履歴、拡張モジュールを格納するディレクトリーのパスを表現する環境変数だろう。デフォルトでは <code class="file docutils literal notranslate"><span class="pre">~/.ipython</span></code> であり、通常の利用状況ではこの値をわざわざ変更することはなさそうだ。</p>
<p>結論としては、環境変数のことは意識しない。</p>
</div>
<div class="section" id="id8">
<h3><a class="toc-backref" href="#id28">設定ファイルによる設定</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>ドキュメントによると、IPython のセッティングを指定する方法の基本として
<code class="file docutils literal notranslate"><span class="pre">~/.ipython/profile_default</span></code> ディレクトリー以下の py ファイルでプログラムを書くことがあるようだ。</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipython3 profile create
[ProfileCreate] Generating default config file: &#39;D:/home/yojyo/.ipython/profile_default/ipython_config.py&#39;
</pre></div>
</div>
<p>これでテンプレファイル <code class="file docutils literal notranslate"><span class="pre">ipython_config.py</span></code> ができあがった。テキストエディターでこれを開き、有効にしたい箇所のコメントアウトを解除するとよさそうだ。</p>
<div class="code python3 highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">InteractiveShellApp</span><span class="o">.</span><span class="n">pylab</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span>
</pre></div>
</div>
<p>これぐらいやっておくと、NumPy や Matplotlib の構成要素のインポートを自動的に行なってくれる。例えば <code class="code docutils literal notranslate"><span class="pre">import</span> <span class="pre">numpy</span> <span class="pre">as</span> <span class="pre">np</span></code> しなくても <code class="code docutils literal notranslate"><span class="pre">np.arange(10)</span></code> のようなコードが通じる。さらに、下記の項目を有効にすると <code class="code docutils literal notranslate"><span class="pre">np.</span></code> すら不要になる。</p>
<div class="code python3 highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">InteractiveShellApp</span><span class="o">.</span><span class="n">pylab_import_all</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>一見タイプの手間が省けて便利なようだが、たまにこれらのパッケージの識別子の名前と
Python 組み込みのオブジェクトの識別子がカブるようなもの
(e.g. <code class="code docutils literal notranslate"><span class="pre">all</span></code>, <code class="code docutils literal notranslate"><span class="pre">any</span></code>, etc.) があると事態が少々複雑になる。個人的には全インポートは無効にしておき、
NumPy や Matplotlib のモジュールとしてのインポートだけに留めておきたい。</p>
<p>敢えて NumPy と Matplotlib の自動インポートを抑制した状況でセッションを開きたい場合は名前付きプロファイルを生成して、設定ファイルの対応項目を False にする。そして、IPython 起動時に <code class="docutils literal notranslate"><span class="pre">--profile</span></code> コマンドラインオプションで設定名を指示する。</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span>$ ipython3 profile create sympy
$ edit ~/.ipython/profile_sympy/ipython_config.py
$ ipython3 --profile=sympy
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h3><a class="toc-backref" href="#id29">コマンドライン引数による設定</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>IPython のすべての設定可能な値はコマンドラインパラメーターから構成できる。<ul>
<li>通常は次の形式で指定する： <code class="code docutils literal notranslate"><span class="pre">ipython</span> <span class="pre">--ClassName.attribute=value</span></code></li>
<li>ただし頻繁に用いられるオプションは短い別名形式が用意してある。例えば <code class="code docutils literal notranslate"><span class="pre">ipython</span> <span class="pre">--matplotlib</span></code> など。<ul>
<li>そのようなオプションの一覧は <code class="code docutils literal notranslate"><span class="pre">ipython</span> <span class="pre">help</span></code> の
Options のセクションで確認できる。</li>
</ul>
</li>
</ul>
</li>
<li>コマンドラインで指定したオプションは、設定ファイルのそれを上書きする。</li>
</ul>
<p>今のところ、特に毎回指定したくなるコマンドライン引数はなさそうだ。</p>
</div>
</div>
<div class="section" id="id10">
<h2><a class="toc-backref" href="#id30">使い勝手を試す</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<p>IPython コンソールウィンドウでの各種機能をひと通り試していこう。</p>
<ul class="simple">
<li>単に <code class="docutils literal notranslate"><span class="pre">?</span></code> を入力することで IPython に関するちょっとしたドキュメントが出力する。
10 ページ弱で終了する。</li>
<li><code class="code docutils literal notranslate"><span class="pre">%quickref</span></code> で <em>Quick Reference Card</em> なるドキュメントが出力する。こちらはページ数が多め。</li>
<li>引数なしの <code class="code docutils literal notranslate"><span class="pre">help()</span></code> で対話的ヘルプモードになる。<ul>
<li>通常の <code class="code docutils literal notranslate"><span class="pre">help(X)</span></code> では、普通の Python コンソール同様の機能 X に関するヘルプが出力することを確認した。</li>
</ul>
</li>
<li><code class="code docutils literal notranslate"><span class="pre">X?</span></code> で IPython スタイルの機能 X に関するヘルプが出力することを確認した。<ul>
<li><code class="code docutils literal notranslate"><span class="pre">X??</span></code> で詳細な情報が出力されるとのことだが、あまり変わらない？</li>
</ul>
</li>
<li>タイプが面倒に感じたら、即タブキーを押す。残り文字列が補完されて便利。<ul>
<li>補完されるのは識別子、Python キーワード。なんとファイルパスも補完対象。</li>
</ul>
</li>
<li><code class="code docutils literal notranslate"><span class="pre">%pdoc</span> <span class="pre">X</span></code> で機能 X の docstring が出力することを確認した。</li>
<li><code class="code docutils literal notranslate"><span class="pre">%pfile</span> <span class="pre">X</span></code> でモジュール X のテキスト的な内容が出力することを確認した。</li>
<li><code class="code docutils literal notranslate"><span class="pre">%timeit</span></code> と <code class="code docutils literal notranslate"><span class="pre">%%timeit</span></code> を試した。</li>
<li><code class="code docutils literal notranslate"><span class="pre">%lsmagic</span></code> で利用可能なマジックの一覧と
<code class="code docutils literal notranslate"><span class="pre">%automagic</span></code> スイッチの ON/OFF 状況が出力することを確認した。</li>
<li><code class="code docutils literal notranslate"><span class="pre">%history</span></code> でコマンド入力の履歴が出力することを確認した。<ul>
<li>詳しくは後述する。</li>
</ul>
</li>
<li><code class="code docutils literal notranslate"><span class="pre">!X</span></code> でシステムシェルコマンド X を実行できることを確認した。</li>
</ul>
<p>マジック機能のメモがたくさんできるがしょうがない。
<a class="reference external" href="http://ipython.org/ipython-doc/stable/interactive/magics.html">Built-in magic commands</a>
を眺めて使えそうなものを試そう。</p>
<ul>
<li><p class="first"><code class="code docutils literal notranslate"><span class="pre">%who</span></code>, <code class="code docutils literal notranslate"><span class="pre">%whos</span></code> で自分が定義した識別子のリストを出力できる。後者は利用回数も確認できてたいへん便利。</p>
</li>
<li><p class="first">履歴機能操作は readline に強く依存することに留意するべし。</p>
<ul class="simple">
<li><kbd class="kbd docutils literal notranslate">C-r</kbd> で Bash でいうところの reverse-i-search 機能が使える。すなわち、過去のコマンド入力をインクリメンタルサーチする。</li>
<li><kbd class="kbd docutils literal notranslate">C-p</kbd>, <kbd class="kbd docutils literal notranslate">C-n</kbd>, 上矢印または下矢印キーで入力履歴を一個ずつ移動できる。</li>
</ul>
</li>
<li><p class="first">履歴リストについて。</p>
<ul class="simple">
<li>オプション <code class="code docutils literal notranslate"><span class="pre">-n</span></code> を常に指定して、履歴番号を表示するようにしたい。この番号情報を基に <code class="code docutils literal notranslate"><span class="pre">%recall</span></code> することになるはずだから。</li>
<li>例えば <code class="code docutils literal notranslate"><span class="pre">%history</span> <span class="pre">-g</span> <span class="pre">print</span></code> のようにすると履歴の <strong class="program">grep</strong> が行える。オプション <code class="code docutils literal notranslate"><span class="pre">-g</span></code> を指定するときには、同じコマンド入力が重複して出力されないように、オプション <code class="code docutils literal notranslate"><span class="pre">-u</span></code> も併せて指定することも許される。</li>
<li>オプション <code class="code docutils literal notranslate"><span class="pre">-l</span></code> で直近の数コマンドだけを表示できる。</li>
<li>オプション <code class="code docutils literal notranslate"><span class="pre">-o</span></code> と <code class="code docutils literal notranslate"><span class="pre">-p</span></code> を同時に指定すると、履歴の表示が doctest の書式で出力される。このテキストをこのノートにそのまま貼り付けて、サンプルコードのメモ作業を楽にすることもできる。</li>
</ul>
</li>
<li><p class="first">TBW: 自動インデントの空白文字数調整</p>
</li>
<li><p class="first">ログ機能について。</p>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">%logstart</span></code> でセッションログを保存できる。コンソールでの入出力を適宜テキストファイルに保存するものだ。</li>
</ul>
</li>
<li><p class="first">TBW: <code class="code docutils literal notranslate"><span class="pre">%alias</span></code></p>
</li>
<li><p class="first">Input caching system: IPython が記憶しているユーザーのコンソールでの入力を再利用できる。</p>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">_i</span></code> で 1 つ前の入力を得られる。</li>
<li><code class="code docutils literal notranslate"><span class="pre">_ii</span></code> で 2 つ前の入力を得られる。</li>
<li><code class="code docutils literal notranslate"><span class="pre">_iii</span></code> で 3 つ前の入力を得られる。</li>
<li>リスト <code class="code docutils literal notranslate"><span class="pre">In</span></code>, <code class="code docutils literal notranslate"><span class="pre">_ih</span></code> でプロンプト番号を添字にして入力を得られる。</li>
<li>実は <code class="code docutils literal notranslate"><span class="pre">_i5</span></code> やら <code class="code docutils literal notranslate"><span class="pre">_i100</span></code> やらからも（もし存在すれば）入力を得られる。</li>
</ul>
</li>
<li><p class="first">Output caching system: 上記の機能の出力バージョン。</p>
<ul class="simple">
<li><code class="code docutils literal notranslate"><span class="pre">_</span></code> で 1 つ前の出力を得られる。通常の Python コンソールと同じ。</li>
<li><code class="code docutils literal notranslate"><span class="pre">__</span></code> で 2 つ前の出力を得られる。</li>
<li><code class="code docutils literal notranslate"><span class="pre">___</span></code> で 3 つ前の出力を得られる。</li>
<li>辞書 <code class="code docutils literal notranslate"><span class="pre">Out</span></code>, <code class="code docutils literal notranslate"><span class="pre">_oh</span></code> でプロンプト番号をキーにして出力を得られる。</li>
</ul>
</li>
<li><p class="first">ディレクトリー移動履歴も管理している。</p>
<ul class="simple">
<li>リスト <code class="code docutils literal notranslate"><span class="pre">_dh</span></code> に作業ディレクトリーをユーザーが訪問した順に保存する。</li>
<li>コマンド <code class="code docutils literal notranslate"><span class="pre">%cd</span> <span class="pre">X</span></code> を実行すれば、作業ディレクトリーを X に移動する。</li>
<li>コマンド <code class="code docutils literal notranslate"><span class="pre">%dhist</span></code> を実行すれば、作業ディレクトリーを訪問順に一覧できる。</li>
</ul>
</li>
<li><p class="first">スクリプトを IPython のセッションから起動できる。次のコード片は自作のスクリプトを <code class="code docutils literal notranslate"><span class="pre">%run</span></code> コマンドにより起動した様子を再現したものだ。</p>
<div class="code ipython highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="o">%</span><span class="n">run</span> <span class="o">~/</span><span class="nb">bin</span><span class="o">/</span><span class="n">listmanager</span><span class="o">.</span><span class="n">py</span> <span class="n">remove</span> <span class="n">showa_yojyo</span> <span class="n">bot</span> <span class="n">zzz</span>
<span class="mi">0</span><span class="o">-</span><span class="mi">15</span><span class="p">:</span> <span class="n">Wait</span><span class="o">...</span>
<span class="mi">0</span><span class="o">-</span><span class="mi">15</span><span class="p">:</span> <span class="n">OK</span><span class="p">:</span>
<span class="n">zzz</span>
</pre></div>
</div>
<ul>
<li><p class="first">スクリプトのファイル名の拡張子は省略可能のようだ。</p>
</li>
<li><p class="first">オプション <code class="code docutils literal notranslate"><span class="pre">-t</span></code> で実行時間を測定する。例を示す。</p>
<div class="code ipython highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="o">%</span><span class="n">run</span> <span class="o">-</span><span class="n">t</span> <span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">mjscore</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">F</span> <span class="o">--</span><span class="n">today</span>
<span class="n">集計期間</span>           <span class="mi">2016</span><span class="o">/</span><span class="mi">09</span><span class="o">/</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">40</span> <span class="o">-</span> <span class="mi">2016</span><span class="o">/</span><span class="mi">09</span><span class="o">/</span><span class="mi">01</span> <span class="mi">02</span><span class="p">:</span><span class="mi">13</span>
<span class="o">...</span>

<span class="n">IPython</span> <span class="n">CPU</span> <span class="n">timings</span> <span class="p">(</span><span class="n">estimated</span><span class="p">):</span>
  <span class="n">User</span>   <span class="p">:</span>       <span class="mf">1.20</span> <span class="n">s</span><span class="o">.</span>
  <span class="n">System</span> <span class="p">:</span>       <span class="mf">0.00</span> <span class="n">s</span><span class="o">.</span>
<span class="n">Wall</span> <span class="n">time</span><span class="p">:</span>       <span class="mf">1.19</span> <span class="n">s</span><span class="o">.</span>
</pre></div>
</div>
</li>
<li><p class="first">オプション <code class="code docutils literal notranslate"><span class="pre">-d</span></code> で対象を pdb の支配下で実行する。ブレイクポイント等のデバッガーオプションも同時に指定できる。</p>
</li>
</ul>
</li>
<li><p class="first">複数行に亘る関数の定義のコーディングは IPython ウィンドウ内で行うよりも、常用しているテキストエディターで行えるほうが効率的だ。コマンド <code class="code docutils literal notranslate"><span class="pre">%edit</span></code> はそれを実現する。このコマンドを実行すると、デフォルトでは <strong class="program">notepad</strong> が開く。ここでコードを書いて保存して閉じる。すると IPython のセッションにその内容が伝わる。エディターで定義した関数を呼び出すことができる。</p>
<div class="code ipython highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="o">%</span><span class="n">edit</span>
<span class="n">IPython</span> <span class="n">will</span> <span class="n">make</span> <span class="n">a</span> <span class="n">temporary</span> <span class="n">file</span> <span class="n">named</span><span class="p">:</span> <span class="n">D</span><span class="p">:</span>\<span class="n">Temp</span>\<span class="n">ipython_edit_3cn_y47j</span>\<span class="n">ipython_edit_osmxydqq</span><span class="o">.</span><span class="n">py</span>
<span class="n">Editing</span><span class="o">...</span> <span class="n">done</span><span class="o">.</span> <span class="n">Executing</span> <span class="n">edited</span> <span class="n">code</span><span class="o">...</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="s1">&#39;def need_to_be_in_love():</span><span class="se">\n\t</span><span class="s1">pass</span><span class="se">\n</span><span class="s1">&#39;</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">need_to_be_in_love</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
</pre></div>
</div>
<p><strong class="program">notepad</strong> では逆にテキスト編集の効率が落ちるはずなので、オプション
<code class="docutils literal notranslate"><span class="pre">TerminalInteractiveShell.editor</span></code> で馴染みのテキストエディターを指定する。</p>
<div class="code python3 highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set the editor used by IPython (default to $EDITOR/vi/notepad).</span>
<span class="n">c</span><span class="o">.</span><span class="n">TerminalInteractiveShell</span><span class="o">.</span><span class="n">editor</span> <span class="o">=</span> <span class="s1">&#39;D:/Program Files/xyzzy/xyzzy.exe&#39;</span>
</pre></div>
</div>
</li>
<li><p class="first">クリップボードの内容を Python のコードとして評価することができる。</p>
<ul class="simple">
<li>キーボードで <kbd class="kbd docutils literal notranslate">C-S-v</kbd> を押すと、クリップボードに保存されている Python コードを即時評価する。</li>
<li>コマンド <code class="code docutils literal notranslate"><span class="pre">%paste</span></code> を実行すると、いったんクリップボードの内容を画面にエコーしてから、コード内容を評価する。</li>
<li>代わりにコマンド <code class="code docutils literal notranslate"><span class="pre">%cpaste</span></code> を実行すると、まずはクリップボードに保存されている Python コードの編集モードになる。次にユーザーが <code class="code docutils literal notranslate"><span class="pre">--</span></code> という行を入力すると編集終了となり、そこに書かれたコードが最終的に評価される。</li>
</ul>
</li>
<li><p class="first">作業内容のリセット機能がある。</p>
<ul class="simple">
<li>コマンド <code class="code docutils literal notranslate"><span class="pre">%reset</span></code> でセッションの各種状態（ユーザー定義のオブジェクト、入力履歴、出力履歴、ディレクトリー移動履歴）をクリアすることができる。<ul>
<li>異色なのは <code class="code docutils literal notranslate"><span class="pre">%reset</span> <span class="pre">array</span></code> だろう。
NumPy の配列オブジェクトをすべて削除するというものだ。</li>
</ul>
</li>
<li>コマンド <code class="code docutils literal notranslate"><span class="pre">%reset_selective</span></code> を用いれば、クリアしたいユーザー定義のオブジェクトを正規表現で指定できる。</li>
</ul>
</li>
</ul>
<div class="admonition-todo admonition" id="index-2">
<p class="first admonition-title">Todo</p>
<ul class="last simple">
<li>Windows だと <code class="code docutils literal notranslate"><span class="pre">!</span></code> コマンドが使えてもあまりうれしくない。
Cygwin のコマンドを使いたいので設定可能か調べる。単に
<code class="docutils literal notranslate"><span class="pre">/bin</span></code> に <span class="target" id="index-1"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code> を通すだけかもしれない。</li>
<li>Output caching system の <code class="code docutils literal notranslate"><span class="pre">_&lt;n&gt;</span></code> の有効な <em>n</em> を知りたい場合は？</li>
</ul>
</div>
</div>
<div class="section" id="qt">
<h2><a class="toc-backref" href="#id31">Qt コンソールを試す</a><a class="headerlink" href="#qt" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">本節の記述は現時点では公式に deprecated 扱いされている。
Jupyter とやらを利用するようにとのことだ。</p>
</div>
<p><a class="reference external" href="http://www.riverbankcomputing.co.uk/software/pyqt/">PyQt</a> と <a class="reference external" href="http://zeromq.github.io/pyzmq/">PyZMQ</a> が利用可能であれば、IPython を PyQt ウィンドウで再現できる。私の環境では PyQt はインストールが済んでいるものの、PyZMQ が入っていなかった。本節では PyZMQ のインストール作業から記す。</p>
<div class="section" id="pyzmq">
<h3><a class="toc-backref" href="#id32">PyZMQ をインストールする</a><a class="headerlink" href="#pyzmq" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://zeromq.github.io/pyzmq/">PyZMQ</a> が何であるのかを理解するのは後回しにして、まずはインストールだ。
IPython のドキュメントにあるように、素直に <strong class="program">pip</strong> でインストールできる。</p>
<div class="code console highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install pyzmq
Downloading/unpacking pyzmq
Installing collected packages: pyzmq
Successfully installed pyzmq
Cleaning up...
$ pip list | grep -i pyzmq
pyzmq (14.5.0)
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h3><a class="toc-backref" href="#id33">Qt コンソールを起動する（シンプル）</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>Windows の「ファイル名を指定して実行」で次のように指定する。</p>
<div class="code text highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">PYTHONDIR</span><span class="o">%</span>\<span class="n">Scripts</span>\<span class="n">ipython3</span><span class="o">.</span><span class="n">exe</span> <span class="n">qtconsole</span>
</pre></div>
</div>
<p>一旦真っ黒なウィンドウが表示され、次に Qt ウィンドウが表示される。後者がコンソールとなる。通常の IPython のように使えるだけでなく、よく見ると便利なコマンドを起動するメニューがウィンドウ上部に備えられている。</p>
</div>
<div class="section" id="id12">
<h3><a class="toc-backref" href="#id34">Qt コンソールを起動する（プロットインライン）</a><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>Matplotlib のプロット図をインラインに Qt コンソール内に描画させる。この機能が Qt コンソールの目玉であると思われる。まずは IPython を次のようなコマンドライン引数を指定して起動する。ドキュメントには
<code class="code docutils literal notranslate"><span class="pre">qtconsole</span> <span class="pre">--matplotlib</span> <span class="pre">inline</span></code> と指定すると記されているが、私の環境ではダメだった。</p>
<div class="code text highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">PYTHONDIR</span><span class="o">%</span>\<span class="n">Scripts</span>\<span class="n">ipython3</span><span class="o">.</span><span class="n">exe</span> <span class="n">qtconsole</span> <span class="o">--</span><span class="n">pylab</span><span class="o">=</span><span class="n">inline</span>
</pre></div>
</div>
<p>試しに Matplotlib を内部的に利用した NetworkX のメソッドを経由して描画してみよう。</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/ipython-qtconsole-inline.png"><img alt="IPython Qt Console" src="_images/ipython-qtconsole-inline.png" style="width: 307.0px; height: 301.0px;" /></a>
</div>
<p>インラインでグラフを描画できて何がうれしいのかと言うと、このコンソールウィンドウを保存できるからだ。ファイルメニューの Save を選択すると、コンソールでの入出力を HTML と画像とに分けてファイルとして保存できる。</p>
</div>
</div>
<div class="section" id="id13">
<h2><a class="toc-backref" href="#id35">その他</a><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>YouTube で <code class="docutils literal notranslate"><span class="pre">IPython</span></code> で検索すると、面白いビデオが大量に見つかる。
<code class="docutils literal notranslate"><span class="pre">IPython</span> <span class="pre">Windows</span></code> 等もよい。</li>
<li>ConEmu ユーザーならば、当然 IPython をタブ化できるようにしておくのが筋だろう。ところで Qt コンソールウィンドウはタブ化できないのだろうか。「元ウィンドウ」はタブ化できる。</li>
<li>このノートをだいたい書き終わったあとに気づいたが、オライリーの
<a class="reference external" href="http://www.oreilly.co.jp/books/9784873116556/">Python によるデータ分析入門</a> という本が
IPython を紹介するのに一章分紙幅を割いている。たいへんまとまっていて便利だ。</li>
</ul>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="python-jupyter.html" title="Jupyter 利用ノート"
             >next</a></li>
        <li class="right" >
          <a href="python-nose.html" title="Nose 利用ノート"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">読書ノート</a> &#187;</li> 
      </ul>
    </div>
    <div id="footer">
      <div id="footer_logo">
        <a class="imga" href="https://showa-yojyo.github.io/" title="プレハブ小屋 Since 1999"><img src="_static/logos.png" width="88" height="31" /></a>
      </div>
      <div id="footer_copyright">
        Since 1999<br />
        Copyright &copy; 1999-2018, プレハブ小屋 All rights reserved.
      </div>
    </div>
  </body>
</html>