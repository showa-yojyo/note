======================================================================
PowerRename
======================================================================

PowerRename は Linux におけるコマンド :command:`rename` の GUI 版と解釈できる。

.. attention::

   :doc:`./index` 冒頭の前提条件に留意すること。

.. contents::

概要
======================================================================

PowerRename はファイルを多数一括処理することを念頭に置くツールだ。ここで言う一括
処理とは、次を意図する：

* どのファイルにも名前を重複することなく、多数のファイルを改名する。
* ファイル名の対象部分に対して検索と置換を実行する。
* 複数のファイルに対して正規表現を用いた改名をする。
* 一括改名を確定する前にプレビューウィンドウで結果を確認する。
* 改名操作が完了した後に元に戻すことができる。

PowerRename 画面
======================================================================

メイン画面は Windows エクスプローラーから間接的に表示させるものだ：

1. Windows のエクスプローラーでファイルを普通は複数選択する。
2. コンテキストメニューを表示する。設定次第では :kbd:`Shift` キーを押したまま表
   示する。
3. 項目 :menuselection:`PowerRename` を選択する。

これで :guilabel:`PowerRename` 画面が表示される。選択した項目の数が表示され、検
索値や置換値、オプションのリスト、入力した検索値や置換値の結果を表示するプレ
ビューウィンドウが表示される。

左側のテキストボックス二つを操作する。Linux の :command:`rename` の要領で、置換
前後のファイル名パターンを指定する。

一つ目のテキストボックスに文字列または正規表現を入力すると、PowerRename は条件に
合致するファイルを選択範囲から絞り込む。合致した項目は右側のプレビューウィンドウ
に表示される。二つ目のテキストボックスには、先ほどの指定部分を置き換えるテキスト
を入力する。プレビューウィンドウで元の変更前後のファイル名を確認できる。

正規表現を使用
----------------------------------------------------------------------

:guilabel:`正規表現を使用` をチェックした場合、一つ目の入力欄の値は正規表現とし
て解釈される。この場合、置換値には正規表現変数を含めることもできる。チェックされ
ていない場合、文字列はプレーンテキストとして解釈され、これが二つ目の入力欄のテキ
ストに置換される。

すべての出現箇所を一致させる
----------------------------------------------------------------------

:guilabel:`すべての出現箇所を一致させる` をオンにすると、同一ファイル名内に指定
パターンが複数箇所出現する場合、そのすべてに対して置換が適用される。

正規表現を使用する場合はこれをオンにしたい。

.. admonition:: 利用者ノート

   次の二つの違いと同じ：

   * :command:`sed s/pattern/replacement/g`
   * :command:`sed s/pattern/replacement/`

大文字と小文字を区別する
----------------------------------------------------------------------

:guilabel:`大文字と小文字を区別する` をオンにすると、一つ目の入力欄で指定したも
のは、大文字と小文字が同じ場合にのみ、項目内のテキストと一致する。既定値はオフだ。

ファイル作成日時を利用した置換
----------------------------------------------------------------------

ファイルの作成日時属性は、``$YYYY`` などのパターンを第ニ入力欄で利用可能だ。右に
あるアイコンをクリックするとサポートされているパターンを表示し、そこから選択する
ことも可能だ。

適用の対象
----------------------------------------------------------------------

:guilabel:`適用の対象` は合致したファイルのどの部分に対して置換を適用するのかを
細かく指定するオプションと、ファイル、フォルダー単位の除外指定がある。

コンボボックス：

.. csv-table::
   :delim: @
   :header-rows: 1
   :widths: auto

   値 @ 主旨
   :guilabel:`Filename + extension` @ ファイル名全体に置換を適用する
   :guilabel:`Filename only` @ ファイル名の :command:`basename` に置換を適用する
   :guilabel:`Extension only` @ 拡張子にしか置換を適用しない

紙アイコンのトグルボタン三つ：

:guilabel:`ファイルを含める`
    オフにするとファイルが対象外となる
:guilabel:`フォルダーを含める`
    オフにするとフォルダーが対象外となる
:guilabel:`サブフォルダーを含める`
    オフにするとフォルダー内のファイルは対象外となる

テキストの書式設定
----------------------------------------------------------------------

最初の四つのコントロールはラジオボタンだ。次のうちから高々一つをオンにして構わな
い：

* :guilabel:`小文字`
* :guilabel:`大文字`
* :guilabel:`各単語の先頭文字をすべて大文字にする`
* :guilabel:`各単語を大文字にする`

ボタン :guilabel:`項目の列挙` をオンにすると、操作で変更されたファイル名に数字の
接尾辞を付加する。例えば :file:`foo.jpg` は :file:`foo (1).jpg` といった具合だ。

出力フィルター
----------------------------------------------------------------------

右上の漏斗アイコンのメニューは項目がラジオボタン的動作をする。いずれか一方を選択する。

.. admonition:: 利用者ノート

   おそらく今後の更新で UI が変更されると思われる。項目が増えるのか、コントロー
   ルの型ごと変わるのか。

設定
======================================================================

:guilabel:`PowerRename を有効化する` を ON にすることで、エクスプローラーのコン
テキストメニューが本機能に対応する。

シェルの統合
----------------------------------------------------------------------

ドロップダウンリスト :guilabel:`PowerRename を表示する場所` で、エクスプローラー
のコンテキストメニューにいつ出現させるかを指定できる。

.. csv-table::
   :delim: @
   :header-rows: 1
   :widths: auto

   値 @ 主旨
   :guilabel:`既定および拡張コンテキストメニュー` @ メニュー表示時に常時出現する
   :guilabel:`拡張コンテキストメニューのみ` @ :kbd:`Shift` キーを押しながらメニューを表示しないと出現しない

チェックボックス :guilabel:`コンテキストメニューのアイコンを非表示にする` をオン
にするとPowerRename アイコンが描画されなくなる。メニュー項目が組み込みコマンドで
あるかのような外見にしたい場合に指定するのだろう。

オートコンプリート
----------------------------------------------------------------------

:guilabel:`検索と置換のフィールドのオートコンプリートを有効にする`
    PowerRename の過去の使用実績に基づいて、検索欄および置換欄で使用する文字列を自動的に補完するかどうか。
:guilabel:`項目の最大数`
    表示する検索・置換候補の最大数。
:guilabel:`最近使用した文字列の表示`
    PowerRename を開くと、検索欄と置換欄には直近の入力値がセットされる。

動作
----------------------------------------------------------------------

:guilabel:`Boost ライプラリを使用する` をオンにすると、正規表現エンジンが Boost
になる。これにより、標準ライブラリーでは対応されていない lookaround のようなもの
が有効になる。

なお、PowerRename の既定の正規表現エンジンは ECMAScript の文法に対応している。
