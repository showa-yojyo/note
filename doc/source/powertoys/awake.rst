======================================================================
Awake
======================================================================

一般的には、一定時間入力がないと OS としての Windows はディスプレイを切り、ス
リープまたはサスペンドモードに移行する。この動作は内部的には
:guilabel:`電源とスリープ` の設定に従う。Awake は、この OS 設定を上書きすること
ができる。つまり、Windows を起動したままにする機能を有するユーティリティーだ。何
らかの長時間処理を実行するときに、スリープやサスペンドから抑止するという用途に
うってつけだ。

.. attention::

   :doc:`./index` 冒頭の前提条件に留意すること。

.. contents::

稼働方法
======================================================================

Awake は設定画面から直接稼働するか、スタンドアロン実行ファイルから稼働することが
可能だ。設定画面から起動している場合、さらにシステムトレイから管理することも可能
だ。

Awake は Windows の電源プラン設定を一切変更せず、カスタム電源プラン設定に依存し
ない。その代わり、バックグラウンドスレッドを生成し、マシンの特定の状態を必要とす
ることを Windows に伝える。

設定
======================================================================

:guilabel:`Awake` スイッチを入れて Awake にコンピューターの覚醒状態を管理させる。

動作
----------------------------------------------------------------------

:guilabel:`モード` では、本ツールが有効であるときに PC の状態の管理方法を指定す
る。決定できるのは次の三つのいずれかとなる：

:guilabel:`選択した電源プランを引き続き使用する`
    PC 本来の電源プランを適用する。つまり当ツール固有の機能を用いない。
:guilabel:`無期限に起動したままにする`
    この設定を変更するまで、PC の通知、実行を維持する。
:guilabel:`一時的に起動したままにする`
    設定画面のタイマーで設定されている一定時間 PC を起動させ続ける。
    時間切れになると、PC 本来の電源プランに戻る。

下二つのモードでは、OS の時刻を変更すると Awake タイマーがリセットされる。

:guilabel:`画面をオンにしたままにする` は Awake によって PC を起動状態にしている
ときに、ディスプレイを点けたままにするかどうかを切り替えられる。オフのままでは
PC がスリープ状態にならなくてもディスプレイは切られることに注意。

タスクトレイ
======================================================================

Awake が有効であるとき、Windows のタスクトレイに専用アイコンが出現する。そのメ
ニューから上述のモードを設定することができる。

CLI
======================================================================

Awake を独立プロセスとして直接実行することも可能だ。PowerToys が存在するフォル
ダーを作業ディレクトリーとして実行する。

:program:`PowerToys.Awake.exe` を端末または ``.lnk`` ショートカットファイルから
実行する場合、次のコマンドライン引数を指定することが可能だ：

.. option:: --use-pt-config

   PowerToys の設定ファイルを使用して設定を管理する。前提としては PowerToys が
   保管している Awake 用の設定ファイル :file:`settings.json` がすでに存在し、そ
   こには必要なランタイム情報をすべて含んでいるとする。これは設定画面の
   :guilabel:`動作` で指定されている内容だ。

   このオプションが使用されると、他のオプションはすべて無視される。Awake は
   ファイル :file:`settings.json` の変更を探して、状態を更新する。

.. option:: --display-on=FLAG

   マシンが覚醒している間、ディスプレイを点けておくか消しておくかを指定する。
   値は ``true`` または ``false`` とする。

.. option:: --time-limit=SECONDS

   Awake がコンピュータを覚醒させておく時間を秒単位で指定する。
   :option:`--display-on` と組み合わせて使用する。

.. option:: --pid=PID

   Awake の実行をプロセスにアタッチする。与えられた PID を持つプロセスが終了する
   と Awake も終了する。

   .. admonition:: 利用者ノート

      この機能を上手に使いこなせれば「何かの作業を終了したら Windows を即閉じる」
      のようなタスクを実現できると読める。要研究。

コンソールから :program:`PowerToys.Awake.exe` を実行する場合には、
コマンドラインオプションを指定することもできる。引数なしで起動すると、Awake は
:guilabel:`無期限に起動したままにする` 相当の挙動を呈する。

例えば、オプション :option:`--time-limit` に値を設定する場合、次の両方の引数指定
形式を受け入れる：

.. code:: pwsh

   > PowerToys.Awake.exe --time-limit 36000
   > PowerToys.Awake.exe --time-limit=36000
