======================================================================
Writer Guide Chapter 18, Forms ノート
======================================================================

.. include:: ./writer-inc.txt

.. contents:: 章見出し
   :depth: 3
   :local:

Introduction
======================================================================

Writer 文書内での対話型フォームの使用について説明する。フォームには編集されない
部分と、読者が変更できるように設計された部分がある。たとえば、アンケートには導入
部と質問（変更はできない）があり、読者が回答を入力したり、与えられた選択肢から選
択したりするための場所がある。

.. admonition:: 読者ノート

   英語の a form を何と和訳するのが適切だろうか。書式が近いとは思う。

Writer にはチェックボックス、オプションボタン、テキストボックス、プルダウンリス
トなど、フォームに情報を入力するための方法が用意されている。

LibreOffice のフォームには多くの機能がある。特筆すべきは |HTML| 文書でのフォーム
の使用と、フォームコントロールにリンクするマクロの記述だ。

LibreOffice Calc, Impress, Draw も Writer とほぼ同様にフォームを支援している。

When to use forms
======================================================================

フォームには使い方が三つある：

* 受信者が記入するための簡単な文書を作成する。例えば、アンケートを記入して返送す
  る団体に送信する。
* データベースやデータ給源にリンクし、使用者が情報を入力できるようにする。営業部
  門の誰かが、購入者の情報をフォームを使ってデータベースに入力する。
* データベースやデータ給源にある情報を見る。図書館員が本に関する情報を呼び出す。

データベースにアクセスするためにフォームを使用すると、複雑な GUI を迅速かつ簡単
に構築することができる。フォームには、データ給源にリンクするフィールドだけでな
く、テキスト、画像、表組、図面、その他の要素を含めることができる。

単純なフォームの典型的な使い方：

#. 己がフォームを設計し保存する。
#. そのフォームを人に送る。
#. 人がフォームに記入し、己に送り返す。
#. 己がその回答を見る。

.. tip::

   データ給源を使ったり、ウェブ上で更新するフォームを設定したりすることでデータ
   を自動的に収集することができる。しかし、これらの方法はより複雑なので、この章
   では扱わない。

Alternatives to using forms in Writer
----------------------------------------------------------------------

LibreOffice Base はデータ給源にアクセスする別の方法を提供する。Base と Writerの
フォームには多くの共通点があるが、特定の仕事にはどちらかを使用したほうがよい場合
もある。Base はフォームがデータ給源にアクセスする場合に限り適している。

Creating a simple form
======================================================================

データ給源やデータベースとは連動せず、高度なカスタマイズも行わない単純なフォーム
の作成方法。

Create a document
----------------------------------------------------------------------

フォームとして使用する文書を作成する際に特別なことをする必要はないが、コントロー
ルを正確に配置できるように格子を有効にするとよかろう。|MenuBar| で
:menuselection:`&View-->Gr&id and Helplines-->` と進み、

* :menuselection:`&Display Grid` をオンにする。
* :menuselection:`&Snap to Grid` をオンにするといい場合がある。

:menuselection:`&File-->&New-->&Text document` で Writer 文書を新規作成しろ。

Open the form toolbars
----------------------------------------------------------------------

.. |FormControlsToolbar| replace:: :guilabel:`Form Controls` ツールバー
.. |FormDesignToolbar| replace:: :guilabel:`Form Design` ツールバー

二つのツールバーがフォームの作成を操作する：

* |FormControlsToolbar|
* |FormDesignToolbar|

メニューの :menuselection:`&View-->&Toolbars-->` に各ツールバーの表示切り替え項
目がある。また、|FormControlsToolbar| 上で |FormDesignToolbar| を開くことも可能。

|FormControlsToolbar| にはよく使われるコントロールの種類ごとに図像がある。これら
のコントロールのいくつかは :menuselection:`Fo&rm-->` メニューにもある。

これらのツールバーは Writer ウィンドウのさまざまな場所に入渠することも、浮動のま
まにすることもできる。浮動の場合、ツールバーを垂直から水平に変更したり、一列に並
ぶツールの数を変更したりすることもできる。これらの変更を行うには、ツールバーの角
をドラッグする。

これらのツールバーのツールの説明は :ref:`writer18-anchor-reference` にある。

Activate design mode
----------------------------------------------------------------------

.. |DesignModeIcon| replace:: :guilabel:`Design Mode` 図像

設計モードをオンにするには、|FormControlsToolbar| の |DesignModeIcon| を使う。こ
れにより、フォームコントロールをはめ込むための図像が活動を開始したり停止したりし
て、編集用のコントロールが選択される。

設計モードがオフの場合、フォームは末端使用者と同じように動作する。ボタンを押した
り、チェックボックスを切り替えたり、一覧項目を選択したりすることは可能だ。

Insert form controls
----------------------------------------------------------------------

#. フォームコントロールを文書にはめ込むには、コントロールの図像をクリックして選
   択する。マウスポインターの形が変わる。
#. コントロールを表示したい文書内の場所をクリックする（後で移動可能）。
#. マウスボタンを押したまま、コントロールをドラッグして寸法を調整する。コント
   ロールによっては、固定寸法の記号の後にコントロール名が付いているものもある。
#. コントロール図像は活動中のままなので、ツールバーに戻ることなく、同じ型のコン
   トロールを複数はめ込むことができる。
#. 他のツールに変更するにはツールバーの図像をクリックする。
#. コントロールのはめ込みを止めるには |FormControlsToolbar| の選択図像をクリック
   するか、はめ込んだコントロールのどれかをクリックする。マウスポインターは通常
   表示に戻る。

.. tip::

   フォームコントロールを正方形にしたり、均整を維持するには、|Shift| を押しなが
   ら作成したり寸法を変更したりする。

Configure controls
----------------------------------------------------------------------

コントロールをはめ込んだ後はその見栄えや動作を設定する必要がある。文書内でフォー
ムコントロールを右クリックし、コンテキストメニューからコントロールを選択するか、
フォームコントロールをダブルクリックすると、選択したコントロールの
|PropertiesDlg| が開く。

|PropertiesDlg| にはタブが三つある：

* |GeneralTab|
* |DataTab|
* |EventsTab|

単純なフォームでは |GeneralTab| しか必要ない。詳細については次の説明を読め：

* :ref:`writer18-anchor-configure`
* :ref:`writer18-anchor-formatting`
* |Help|

データベースで使用するための設定については :ref:`writer18-anchor-data` を当たれ。

このダイアログボックスのフィールドはコントロールの型によって異なる。追加フィール
ドを見るには、スクロールバーを使うか、ダイアログボックスを縦に拡大する。

Use the form
----------------------------------------------------------------------

フォームを使用するには、|DesignModeIcon| をクリックして設計モードを解除する。
フォーム文書を保存する。

.. _writer18-anchor-reference:

Form controls reference
======================================================================

Writer で表示される図像は、本書に表示されているものと異なる場合や、ツールバーの
順序が異なる場合がある。

.. list-table:: Tools on Form Controls toolbar
   :align: left
   :header-rows: 0
   :stub-columns: 1
   :widths: auto

   * - 1
     - Select
     - フォームコントロールを選択して、それに対して何らかの動作を実行する。
   * - 2
     - Design Mode
     - フォームを編集するモードと使用するモードを切り替える。オンで前者。
   * - 3
     - Toggle Form Control Wizards
     - リストボックスとコンボボックスではウィザードが使える。これらのコントロー
       ルの作成時にウィザードを起動させたくない場合はオフにしろ。
   * - 4
     - Form Design
     - |FormDesignToolbar| を進水させる。
   * - 5
     - Label
     - テキストラベル。コントロールとして、ラベルフィールドをマクロに連動させる
       ことができる点がただページに入力するのとは異なる。
   * - 6
     - Text Box
     - フォーム使用者が任意のテキストを入力する欄を作成するコントロール。
   * - 7
     - Check Box
     - フォーム上でオンオフできる箱。ラベルを付けることが可能。
   * - 8
     - Option Button
     - オプションボタン（ラジオボタン）を作成する。複数のボタンがグループ化され
       ている場合、一度に選択できるのは一つだけだ。グループ化する方法は本文に記
       述がある。
   * - 9
     - List Box
     - 使用者が選択できるプルダウンメニューとして選択肢の一覧を作成する。フォー
       ムがデータ給源にリンクされていてウィザードがオンの場合、リストボックスを
       作成するとリストボックスウィザードが起動する。

       リンクされていない場合は、ウィザードをオフにして空のリストボックスを作成
       しろ。それから |GeneralTab| の :guilabel:`Li&st entries` 欄に、一覧に表示
       する選択肢を入力しろ。
   * - 10
     - Combo Box
     - リストボックスと同様に、選択肢の一覧を設定する。さらに、上部にある盤には
       選択された内容が表示されるか、フォーム使用者が別の内容を入力することがで
       きる。これはリストボックスと同じ働きをする。
   * - 11
     - Push Button
     - マクロにリンクできるボタンを作成する。ラベルはボタンに表示される。
   * - 12
     - Image Button
     - プッシュボタンと全く同じ動作をするが、絵として表示される。
       :guilabel:`Control Properties` ダイアログボックス |GeneralTab|
       :guilabel:`Graphics` オプションで画像を選択する。
   * - 13
     - Formatted Field
     - 数値の書式オプションを設定できるコントロール。例えば、入力する数値の最大
       値や最小値、数値の種類（小数点以下、科学的、通貨）を設定することが可能。
   * - 14
     - Date Field
     - 日付を格納する。フィールドが受け付ける最も古い日付と最も新しい日付、既定
       の日付、日付書式を設定する必要がある。スピナーを追加できる。
   * - 15
     - Numerical Field
     - 数値を表示する。書式、最大値、最小値、既定値を指定する必要がある。スピ
       ナーを追加できる。
   * - 16
     - Group Box
     - グループボックスには使い方が二つある。ウィザードがオンの場合、グループ
       ボックスを作成すると、:guilabel:`Group Element Wizard` が起動する。これは
       オプションボタンのグループを作成する。たいていの場合、グループボックスを
       使うのが、オプションボタン群を作成する最善の方法だ。

       ウィザードがオフの場合、グループボックスは単に異なるコントロールをグルー
       プ化するための視覚的効果を得るためのものだ。コントロールの動作には何の影
       響も及ぼさない。
   * - 17
     - Time Field
     - 日付フィールドの時刻版。
   * - 18
     - Currency Field
     - 数値フィールドと同様に機能し、さらに通貨記号を追加できる。
   * - 19
     - Pattern Field
     - フォームがデータ給源に連動している場合に便利。編集マスクを指定して、使用
       者がフィールドに入力できる内容を制限する。リテラルマスクを指定して、デー
       タ給源から表示されるデータを制限する。
   * - 20
     - Table Control
     - 表組コントロールはデータ給源がある場合に限り有効だ。データ給源が指定され
       ていない場合は :guilabel:`Table Element Wizard` でデータ給源を選択するプ
       ロンプトが表示される。その後、表示するフィールドを選択し、設計モードがオ
       フの場合、データが表組に表示される。表組にはレコードをステップ実行するた
       めのコントロールも含まれている。

       レコードの追加、削除、変更が可能。
   * - 21
     - Navigation Bar
     - |FormNavigationToolbar| と同じだが、文書のどこにでも配置でき、寸法も変更
       できる。
   * - 22
     - Image Control
     - フォームがデータ給源に接続されていて、データ給源に画像を保持できるフィー
       ルドが存在する場合に限り有効だ。データベースに新しい画像を追加したり、
       データベースから画像を取得して表示したりすることができる。
   * - 23
     - File Selection
     - パスと名前を直接入力するか、|Browse| を押してダイアログボックスからファイ
       ルを選択する。
   * - 24
     - Spin Button
     - フォーム使用者が数値の一覧を循環して数値を選択できるようにする。最大値、
       最小値、既定値、数値間の段階を指定できる。

       このコントロールは Writer ではあまり使われない。
   * - 25
     - Scrollbar
     - スクロールバーを作成し、多くのオプションで正確な見てくれを定義する。この
       コントロールは Writer ではあまり使われない。

.. list-table:: Tools on Form Design toolbar
   :align: left
   :header-rows: 0
   :stub-columns: 1
   :widths: auto

   * - 1
     - Select anchor for object
     - どのフォームコントロールも、ページ、段落、文字に繋留することができ、また
       文字として繋留することもできる。
   * - 2
     - Align Objects
     - コントロールが文字として固定されていない限り無効。コントロールの上端や下
       端をテキストの上端や下端に合わせるなど、さまざまな方法でコントロールを整
       列させる。
   * - 3
     - Bring to Front
     - コントロールを他のものより手前に配置する。
   * - 4
     - Forward One
     - コントロールをスタックの一段上に移す。
   * - 5
     - Back One
     - コントロールをスタックの一段下に移す。
   * - 6
     - Send to Back
     - コントロールをスタックの最下段に移す。
   * - 7
     - To Foreground
     - オブジェクトをテキストの前に移動する。
   * - 8
     - To Background
     - オブジェクトをテキストの後ろに移動する。
   * - 9
     - Select
     - 先述のものと同じ。
   * - 10
     - Design Mode
     - 先述のものと同じ。
   * - 11
     - Control Properties
     - フォームコントロールの |PropertiesDlg| を開く。異なるコントロールが選択さ
       れている間開いておくことが可能。
   * - 12
     - Form Properties
     - どのデータ給源に接続するかなど、フォーム全体の性質を制御する
       |FormPropertiesDlg| を開く。
   * - 13
     - Form Navigator
     - 現在の文書内のフォームとコントロールをすべて表示し、編集や削除が簡単にで
       きる。

       Form Navigator を使用する場合はコントロールに名前を付けておくと見分けがつ
       くようになる。
   * - 14
     - Add Field
     - フォームにデータ給源を指定した場合にしか役立たない。そうでない場合は空の
       箱が開く。

       データ給源を指定した場合、フィールドの追加で指定した表組のすべてのフィー
       ルドの一覧が表示される。フィールドは、その前にフィールド名を付けてページ
       に配置される。
   * - 15
     - Activation Order
     - コントロール間でフォーカスが移動する順序を指定できる。設計モードを終了
       し、|Tab| を使ってコントロールを切り替えることで、その順序を試すことがで
       きる。
   * - 16
     - Open in Design Mode
     - 現在のフォームを設計モードで開く。フォームにデータを入力するのではなく、
       フォームを編集する。
   * - 17
     - Automatic Control Focus
     - 活動中になると、最初のフォームコントロールにフォーカスが設定される。
   * - 18
     - Position and Size
     - |Position&SizeDlg| を開き、コントロールをドラッグする代わりに正確な値を入
       力することができる。誤って変更されないように、寸法や位置をロックすること
       もできる。コントロールによっては、回転させたり、傾きや角の半径を設定する
       こともできる。
   * - 19
     - Display Grid
     - ページ上に点の格子を表示。コントロールを並べるのに役立つ。
   * - 20
     - Snap to Grid
     - コントロールが格子点や線に近づくと、そこへ吸着する。これにより、コント
       ロールを配置するのが簡単になる。
   * - 21
     - Helplines While Moving
     - コントロールが移動しているとき、それから水平方向と垂直方向に線が伸び、正
       確な位置決めができる。

Example: a simple form
======================================================================

.. admonition:: 読者ノート

   この節は好きな形調査なるアンケートのフォームを構築するチュートリアルだ。次の
   コントロールから構成される：

   * 回答者の名前（テキストボックス）
   * 回答者の性別（ラジオボタン）
   * 好きな形（リストボックス）
   * 好きな形すべてを選ぶ（チェックボックス四個）

Create the document
----------------------------------------------------------------------

新規文書を開き、含めるテキストを入力する。後で変更することは容易だが、フォームを
設計するときの指南として、最終的な結果を素描しておくとよい。

.. admonition:: 読者ノート

   最終フォームからコントロール類全部を除去した内容を文書上に打ち込めばいいよう
   だ。

Add form controls
----------------------------------------------------------------------

次の段階は文書にフォームコントロールを追加することだ。次のコントロールを用意す
る：

* `Name` はテキストボックスだ。
* `Gender` は male, female, other のオプションボタンだ。
* `Favorite shape` は選択肢の一覧だ。
* `All shapes you like` は一連のチェックボックスだ。いくつでも選択可能。

これらのコントロールを追加するには

#. |FormControlsToolbar| を開く。
#. ツールが活動停止している場合は |DesignModeIcon| をクリックして活動開始する。
#. :guilabel:`Text Box` 図像をクリック。文書内をクリックして、`Name` テキスト
   ボックスの形をドラッグして希望の寸法に合わせる。`Name:` ラベルと一直線になる
   ようにドラッグする。
#. :guilabel:`Toggle Form Control Wizards` がオフになっていることを確認する。
   :guilabel:`Option Button` 図像をクリックする。クリックしてドラッグし、文書の
   `Gender:` ラベルの近くにオプションボタンを三つ作成する。これらは次の節で設定
   する。
#. :guilabel:`List Box` 図像をクリックし、文書内の `Favourite shape:` のそばにそ
   れを描く。これは今のところ単なる空の窓だ。
#. :guilabel:`Check Box` 図像をクリックし、`All shapes you like` によるチェック
   ボックスを、ページの端から端まで四つ並べて作成する。

コントロールが不格好に並んでいても心配するな。この後修正する。

.. admonition:: 読者ノート

   コントロール各種の錨が適切でない初期値であることが整列が難しい原因だと考えら
   れる。

.. _writer18-anchor-configure:

Configure form controls
----------------------------------------------------------------------

.. |Step1| replace:: :guilabel:`Design Mode` がオンで、:guilabel:`Wizards` がオフであることを確認する。

Text box
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Nameフィールドにはこれ以上の設定は必要ないが、フィールドの高さや幅、背景色、その
他の書式を変更したいかもしれない。その場合は

#. |Step1|
#. `Name` フィールドをダブルクリックして |PropertiesDlg| を開く。
#. |GeneralTab| で下にスクロールし、:guilabel:`Width` と :guilabel:`Height` の性
   質を見つける。必要に応じてこれらを変更する。
#. ダイアログボックスを閉じるか、開いたままにして他のコントロールを設定する。

Option buttons
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

`Gender` オプションボタンは、三つのうち一つだけを選択できるように設定する必要が
ある。これには、ここで説明するような個別のオプションボタンを使用する方法と、
Group Box を使用する方法がある。

#. |Step1|
#. |PropertiesDlg| が開いている場合は、最初のオプションボタンを一度クリックし
   て、ダイアログボックスをオプションボタン用に変更する。ダイアログボックスが開
   いていない場合は、最初のオプションボタンをダブルクリックする。
#. |GeneralTab| で :guilabel:`&Label` 欄に `Male` と入力し、:guilabel:`&Group
   name` 欄に `Gender` と入力する。
#. 他の二つのオプション `Female` と `Other` も同様にする。グループ化により、一度
   に選択できるオプションは一つだけだ。

オプションボタンが離れ過ぎている場合は、それぞれを順番にクリックし、左右にドラッ
グする。

オプションボタンがきれいに並んでいない場合は、このようにしろ：

#. |FormControlsToolbar| の :guilabel:`Select` ボタンを押し。マウスで三つのオプ
   ションボタンコントロールの周囲に箱を描いてすべてを選択する。
#. 右メニューから :menuselection:`Alig&n Objects-->&Top` を選択する。

List box
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

リストボックスに選択肢の一覧を追加するには、次のようにする：

#. |Step1|
#. リストボックスコントロールをダブルクリックして |PropertiesDlg| を開く。
   |GeneralTab| を選択する。
#. スクロールダウンして :guilabel:`Li&st entries` 欄を見つける。右の▼を押して図
   形の名前を一つずつ入力する。

.. admonition:: 読者ノート

   最後の項目入力方法が本書と現況とで異なるので、修正しておく。

Check boxes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

チェックボックスに名前を付けるには

#. |Step1|
#. 最初のチェックボックスコントロールをダブルクリックする。
#. |PropertiesDlg| ダイアログボックスで、:guilabel:`Label` フィールドのテキスト
   を `Circle` に変更し、|Enter| を押す。キャレットが次の行に移動し、文書の
   チェックボックスのラベルが直ちに変更される。
#. 他の三つのチェックボックスを順番にクリックする。|PropertiesDlg| のラベルテキ
   スト入力ボックスのテキストを、三角形、四角形、五角形に順番に変更する。
#. ダイアログボックスを閉じる。
#. :guilabel:`Design Mode` をオフにする。

Group box
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

`Gender` 用に個別のオプションボタンを作成するのではなく、Group Box を使ってオプ
ションボタンのグループをはめ込むこともできる。グループボックスは選択項目を一つず
つ積み重ねるが、個々のボタンは好きな配置に移動させることができる。

個々のオプションボタンの代わりにグループボックスを使うには：

#. :guilabel:`Design Mode` がオンで、:guilabel:`Wizards` がオンであることを確認
   する（ここだけオン）。
#. :guilabel:`Group Box` 図像をクリックし、`Gender:` ラベルの横にボックスを描く。
   :guilabel:`Group Element Wizard` が自動的に開く。
#. 左の入力欄に `Male` と入力する。:guilabel:`&>>` ボタンを押して右側の
   :guilabel:`Option fields` 箱に移動する。
#. `Female` と `Other` も同様に入力する。|Next| をクリックする。
#. 次のページで、:guilabel:`No, one particular field is not going to be selected
   as default.` を選択する。|Next| を押すクリックする。
#. 次のページでは何も変更しない。|Next| をクリックする。
#. 次のページでは説明領域から `Group Box` の文字を削除する。フォームに `Gender:`
   ラベルがすでにない場合は、説明に `Gender` と入力するとよいだろう。
#. |Finish| を押す。

Finishing touches
----------------------------------------------------------------------

フォームは完成しているが、文書にさらに変更を加えたいと思うかもしれない。これを他
の人に送信して記入してもらうつもりなら、おそらく文書を読み取り専用にして、使用者
がフォームに記入することはできても、文書に他の変更を加えることができないようにし
たいだろう。

文書を読み取り専用にするには |FilePropertiesM| を選択し、|SecurityTab| タブを選
択して :guilabel:`&Open file read-only` をオンにする。

.. note::

   文書が読み取り専用の場合、フォーム記入者は :menuselection:`&File-->Save
   &As...` で文書を保存する必要がある。

Accessing data sources
======================================================================

フォームの最も一般的な用途は、データベースに情報を入力することだ。例えば、他の人
が連絡先データベースに情報を入力するためのフォームを設計することができる。フォー
ムは文書の一部なので、画像、書式、表組、その他の要素を含めることができ、思い通り
の体裁にすることができる。フォームの変更は文書の編集と同じくらい簡単だ。

LibreOffice は多数のデータ給源にアクセスできる。ODBC, MySQL, Oracle JDBC, スプ
レッドシート、テキストファイルなどだ。原則として、データベースは読み書きのために
アクセスできるが、その他のデータ給源（スプレッドシートなど）は読み取り専用だ。

.. tip::

   使用中の OS が支援するデータ給源型の一覧を表示するには、
   :menuselection:`&File-->&New-->Data&base...` を選択する。:guilabel:`Database
   Wizard` の最初のページで :guilabel:`Connect to an e&xisting database` を選択
   し、ドロップダウン一覧を開く。

データベースまたはその他のデータ給源を作成し、Writer で使用するために登録した済
みであるものとする。|Writer14| にデータベースの作成と登録方法について説明がある。

.. _writer18-anchor-data:

Creating a form for data entry
----------------------------------------------------------------------

データベースが LibreOffice に登録されたら、次の手順に従ってフォームをデータ給源
にリンクする：

#. Writer で新規文書を作成する。
#. 実際のフィールドを入れずにフォームを設計する（後でいつでも変更可能）。
#. |FormControlsToolbar| と |FormDesignToolbar| を表示する。
#. |DesignModeIcon| をクリックして文書を設計モードにする。
#. :guilabel:`Text Box` 図像をクリックする。文書内をクリックしてドラッグし、最初
   のフォームフィールド用のテキストボックスを作成する。
#. 任意の型のフィールドを同じ方法（クリックしてドラッグ）で追加できる。

ここまでは最初のフォームを作成したときと同じ手順をたどっている。登録済みデータ給
源とフォームを連動させるには、次のようにする：

.. |ControlPropertiesItem| replace:: :menuselection:`Con&trol Properties...`
.. |FormPropertiesDlg| replace:: :guilabel:`Form Properties` ダイアログボックス

#. |FormDesignToolbar| の :guilabel:`Form Properties` 図像をクリックするか、はめ
   込んだフィールドのいずれかを右クリックして |FormProperiesItem| を選択し、
   |FormPropertiesDlg| を開く。
#. |FormPropertiesDlg| で |DataTab| を選択する。

   * :guilabel:`&Data Source` を登録したデータ給源に設定する。
   * :guilabel:`&Content type` を `Table` に設定する。
   * :guilabel:`Cont&ent` をアクセスしたい表組名に設定する。

   ダイアログボックスを閉じる。
#. 各フォームコントロールを順番にクリックして選択し、|PropertiesDlg| を起動す
   る。右クリックして |ControlPropertiesItem| を選択するか、|FormDesignToolbar|
   の :guilabel:`Control Properties` 図像をクリックする。
#. |PropertiesDlg| で |DataTab| をクリックする。フォームを正しく構成していれば、
   :guilabel:`&Data field` オプションにデータ給源の異なるフィールド（例えば、名
   前、住所、電話番号）の一覧が表示される。必要なフィールドを選択する。
#. フィールドに割り当てるべきコントロールがすべて割り当てられるまで、各コント
   ロールを順番に繰り返す。

.. caution::

   LibreOffice Base でデータベースを作成し、主キーフィールドの AutoValue を
   `Yes` に設定した場合、そのフィールドはフォームの一部である必要はない。
   AutoValue が `No` に設定されている場合、そのフィールドを含める必要があり、使
   用者は新規入力のたびにそのフィールドに一意の値を入力する必要がある。

Entering data into a form
----------------------------------------------------------------------

フォームを作成し、データベースと結びつけたら、そのフォームを使ってデータベースに
データを入力したり、すでにあるデータを修正したりする：

.. |FormNavigationToolbar| replace:: :guilabel:`Form Navigation` ツールバー

#. フォームが設計モードでないことを確認する。
#. |FormNavigationToolbar| がオンになっていることを確認する。このツールバーは通
   常、作業場所の床下に表示される。
#. データ給源に既存のデータがある場合は |FormNavigationToolbar| のコントロールボ
   タンを使用して、さまざまなレコードを参照する。レコードのデータを修正するに
   は、フォームの値を編集する。変更を送信するには、最後のフィールドにキャレット
   がある状態で |Enter| を押す。レコードが保存され、次のレコードが表示され
   る。
#. フォームにデータがない場合は、フォームのフィールドに入力して情報を入力する。
   新しいレコードを送信するには、最後のフィールドにキャレットがある状態で
   |Enter| を押す。
#. |FormNavigationToolbar| からレコードの削除や新規レコードの追加など、その他の
   機能を実行できる。

.. note::

   ユーザがフォームに入力しようとして `Attempt to insert null into a
   non-nullable column` というエラーが表示された場合、フォーム設計者はデータベー
   スに戻り、主キーフィールドに AutoValue が `Yes` に設定されていることを確認す
   る必要がある。このエラーによりレコード保存不能になる。

Advanced form customization
======================================================================

Linking a macro to a form control
----------------------------------------------------------------------

任意のフォームコントロールに、何らかのイベントがトリガーされたときにアクションを
実行するように設定することができる。

マクロをイベントに割り当てる手順：

.. |AssignActionDlg| replace:: :guilabel:`Assign Action` ダイアログボックス

#. マクロを作成する。|Guide| の Chapter 13 を参照しろ。
#. フォームが設計モードであることを確認する。フォームコントロールを右クリック
   し、コンテキストメニューから :menuselection:`Con&trol Properties...` を選択
   し、|EventsTab| をクリックする。
#. イベントの横の |Browse| を押して |AssignActionDlg| を開く。
#. :guilabel:`Macro` ボタンを押し、:guilabel:`Macro Selector` ダイアログボックス
   の一覧からマクロを選択する。|AssignActionDlg| に戻る。必要に応じてこれを繰り
   返し、|OK| を押してダイアログボックスを閉じる。

マクロをフォーム全体に関するイベントに割り当てることもできる。これを行うには、文
書内のフォームコントロールを右クリックし、|FormProperiesItem| を選択し、
|EventsTab| をクリックする。

Fine-tuning database access permissions
----------------------------------------------------------------------

.. |FormProperiesItem| replace:: :menuselection:`For&m Properties...`

既定では、フォームからデータベースにアクセスすると、レコードの追加、削除、修正な
ど、あらゆる変更が可能になる。この挙動が望ましくない場合がある。例えば、使用者は
新しいレコードを追加することしかできないようにしたり、既存のレコードを削除するこ
とを禁止したいことがある。

設計モードでフォームコントロールを右クリックし、コンテキストメニューから
|FormProperiesItem| を選択する。|FormPropertiesDlg| の |DataTab| で、以下の各オ
プション :guilabel:`Yes` または :guilabel:`No` に設定し、使用者のデータ給源への
アクセスを制御する：

* :guilabel:`Allo&w additions`
* :guilabel:`Allow delet&ions`
* :guilabel:`Allow &modifications`
* :guilabel:`Add data &only`

個々のフィールドを保護することもできる。これは、品目の説明が固定で数量が変更可能
な在庫一覧のように、使用者がレコードの一部を変更でき、他の部分のみを表示できるよ
うにしたい場合に便利だ。

個々のフィールドを読み取り専用にするには、設計モードで文書内のフォームコントロー
ルを右クリックし、コンテキストメニューから |FormProperiesItem| を選択する。
|GeneralTab| を選択し、:guilabel:`&Read-only` を :guilabel:`Yes` に設定する。

.. _writer18-anchor-formatting:

Form control formatting options
----------------------------------------------------------------------

フォームコントロールの見てくれや動作はさまざまな方法でカスタマイズできる。これら
はすべて設計モードで行う。フォームコントロールを右クリックし、コンテキストメ
ニューから |ControlPropertiesItem| を選択し、|PropertiesDlg| |GeneralTab| を選択
する。

* :guilabel:`&Label` 欄にコントロールのラベルを設定する。プッシュボタンやオプ
  ションボタンなどのいくつかのフォームコントロールには設定可能な可視ラベルがあ
  る。また、テキストボックスのように、ラベルを設定できないものもある。
* :guilabel:`&Printable` 選択肢で文書を印刷する場合、フォームコントロールが印刷
  されるかどうかを設定する。
* :guilabel:`Font` 設定を使用して、フィールドのラベルまたはフィールドに入力され
  たテキストのフォント、書体、寸法を設定する。この設定はチェックボックスやオプ
  ションボタンの寸法には影響しない。
* テキストボックスに対してはテキストの最大長を設定できる。データベースにレコード
  を追加するときに便利だ。データベースのテキストフィールドすべてには最大長が設定
  されており、入力されたデータが長すぎる場合、LibreOffice はエラーメッセージを表
  示する。フォームコントロールの最大テキスト長をデータベースフィールドの最大テキ
  スト長と同じに設定することでこのエラーを回避できる。
* フォームコントロールの既定オプションを設定することができる。既定では、コント
  ロールは空白、またはすべてのオプションがオフである状態だ。特定のオプションや一
  覧項目が選択された状態でコントロールを開始するように設定することができる。
* パスワードが入力されるコントロールの場合、パスワード文字（たとえば米印）を設定
  すると、その文字だけが表示され、使用者が実際に入力した内容は保存される。
* フォームコントロールに追加情報やヘルプテキストを追加することができる。
* コントロールの表示方法をさらに定義するために、背景色、立体的な容姿、テキスト書
  式、スクロールバー、境界などの他のフォーマットコントロールを使用することができ
  る。

Using content controls
======================================================================

中身コントロールはプレースホルダーだ。雛形、フォーム、文書で使用するために、中身
コントロールを追加したりカスタマイズしたりすることができる。中身コントロールには
その使用方法を示すことができる。この章で前述したコントロールと似ているものもある
が、作業や書式設定がより簡単になる。ただし、いくつかのフィールドとは異なり、中身
コントロールはデータベース内のデータには接続しない。

Rich Text
   カスタムフォーマットされたテキストや、表組、画像、その他の中身コントロールな
   どのアイテムが含まれる。
Plain Text
   単一または複数の段落のプレーンテキストに限られる。リッチテキストとは異なり、
   表組、画像、その他の中身コントロールなどの他のアイテムを含めることはできな
   い。
Picture
   文字として固定された画像を一つ含む。中身コントロールをクリックすると
   |OpenFileDlg| が開き、プレースホルダーを置き換える画像を選択できる。
Check Box
   対話するためのチェックボックス文字が一つ含まれている。中身コントロールをク
   リックすると、チェックボックスのチェック状態が切り替わる。
Combo Box
   選択可能な一覧項目のドロップダウンリストと、直接編集可能なテキストボックスか
   らなる。
Drop-down List
   表示テキストと値のペアの一覧を持つドロップダウンボタンコントロールが含まれて
   いる。コンボボックスとは異なり、ドロップダウンリストは使用者がカスタム入力を
   入力することはできない。
Date
   カレンダーコントロールを含む。テキストを一段落に制限する。

文書、雛形、またはフォームに中身コントロールをはめ込む手順：

#. コントロールを表示したい場所にキャレットを置く。
#. |MenuBar| で :menuselection:`Fo&rm-->Content Controls-->` から欲しいコントロー
   ルを選択する。
#. |MenuBar| で :menuselection:`For&m-->Content Controls-->Propertie&s...` を選
   択する。ピクチャコントロールでは使用不可。
#. :guilabel:`Content Control Properties` ダイアログボックスで、オプションで
   :guilabel:`Content is placeholder text` を選択し、表題とタグを打ち込む。性質
   はコントロールによって異なる。詳細は |Help| を見ろ。
