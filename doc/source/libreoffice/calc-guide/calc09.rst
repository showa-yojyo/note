======================================================================
Calc Guide Chapter 9 Using Pivot Tables ノート
======================================================================

.. include:: ./calc-inc.txt

.. contents:: 章見出し
   :local:

Introduction
======================================================================

ピボットテーブルは、大量のデータを簡単に組み合わせ、比較、分析、要約するための
ツールだ。これを使用すると、ソースデータのさまざまな概要や関心分野の詳細を表示し
たり、報告書を作成したりできる。

ピボットテーブルで作業するには、行と列で構成される、データベースのテーブルに似た
生データの一覧が必要だ。フィールド名は一覧の最初の行だ。

ピボットテーブルを作成するコマンドは次のいずれか：

* セルが選択されている状態で、メニューバーの :menuselection:`&Insert --> Pi&vot
  Table...` を実行
* :menuselection:`&Data --> &Pivot Table --> &Insert or Edit...` を実行
* :guilabel:`Standard` ツールバーの :guilabel:`Insert or Edit Pivot Table` 図像
  を押す

:guilabel:`Select Source` ダイアログが開く。選択されているセル領域で良ければ次へ
進め。

The Pivot Table Layout dialog
======================================================================

ピボットテーブルの機能は :guilabel:`Pivot Table Layout` ダイアログとスプレッド
シートでの結果の操作で管理する。

* レイアウトを選択するには :guilabel:`&Available Fields` 欄から他の四欄にフィー
  ルドをドラッグ＆ドロップする。
* 逆に、フィールドを四欄から削除する場合、項目をドラッグ＆ドラップで
  :guilabel:`&Available Fields` に戻す。

:guilabel:`&Data Fields` 欄には最低一つはフィールドが必要だ。

* 上級者はここにフィールドを複数使用する。
* 当欄のフィールドには、例えば ``SUM`` などの集計関数が使用される。

:guilabel:`&Row Firlds` と :guilabel:`Col&umn Fields` は、結果がどのグループから
ソートされるかを示す。

* 行または列の小計を得るために、一度にフィールドが複数使用される場合が多い。
* フィールドの順序は、全体的なものから特定のものへの合計の順序を与える。

:guilabel:`&Filters` 欄に配置されたフィールドは、ドロップダウンリストとして結果の
ピボットテーブルの上部に表示される。

:guilabel:`Col&umn Fields` に最初から入っている :guilabel:`Data` は使うつもりがな
くても、自分で追加した項目の下に移動させておけ。

ダイアログの :guilabel:`O&ptions` をクリックするとチェックボックスが複数現れる。
好みで。

ダイアログの :guilabel:`Source and Destination` をクリックすると、ピボットテーブ
ルの入出力場所を編集可能な入力欄が現れる。これを使えば新シートに表を生成しないよ
うにできる。

----

フィールドの設定を変更するには、ダイアログの四欄内にある対象フィールドをダブルク
リックしろ。:guilabel:`Data Field` ダイアログが開く。

* :guilabel:`&Data Fields` 欄とそれ以外でダイアログの内容が若干異なる。
* :guilabel:`Function` 欄では :guilabel:`Sum` などの集計関数が選択可能だ。
* :guilabel:`Subtotals` をオンにして小計を表示させることも可能。試すときにはマ
  ニュアルのように行フィールドを二つ以上指定するとわかりやすい。

ダイアログの :guilabel:`&Options...` ボタンで開くダイアログボックスで、さらなる
表示周りの項目を指定可能。

* :guilabel:`Compact Layout` オプションが魅力的だが、日付の書式が保存されないよ
  うで困る。

Working with the results of the pivot table
======================================================================

ピボットテーブル上で :guilabel:`Pivot Table Layout` ダイアログを開いて、フィール
ドをドラッグ＆ドロップし直せば、表のレイアウトを容易に変更可能だ。そして、ピボッ
トテーブルの結果ビューでも操作可能なものがある。それらしい UI 要素をマウスでド
ラッグして試して覚えろ。

* フィールドを列と行を変更するようにドラッグする
* フィールドを表の外側にドラッグして削除する

TODO: グループ化

----

ピボットテーブルの結果は、列および行の区分が昇順で表示されるように並べ替えられ
る。下三角の印から察せられるように、この順序を変更することが可能だ。

* 下三角をクリックすると、ソートオプションとフィルター一覧からなるミニウィンドウ
  が開く。
* 先述の :guilabel:`Data Field Options` ダイアログでソート種別を昇順、降順、辞書
  式から指定可能。

----

:guilabel:`&Enable drill to details` をオンにしていると、ピボットテーブル内の列
内セルをダブルクリックすると :guilabel:`Show Details` ダイアログボックスを開くよ
うになる。

----

ピボットテーブル全体に作用するフィルターは、表分析を元データの部分集合に制限す
る機能だ。

フィルターフィールドボタンに隣接するテキストは、絞り込み状態を示す。

* 何も絞られていない場合は :guilabel:`- all -`
* 全てではないが複数の項目が絞られる場合は :guilabel:`- multiple -`
* その値だけが絞られる場合はその値

----

ピボットテーブルを作成した後では元データを変更しても表は自動的に更新されない。基
こういう場合はピボットテーブルを手動で更新する必要がある。

更新するにはピボットテーブルをクリックして次のいずれかを実行する：

* メインメニューから :menuselection:`&Data --> &Pivot Table --> &Refresh`
* 右クリックメニューから :menuselection:`&Refresh`

元データのレコードが増えたなどの場合には、ピボットテーブルのレイアウトダイアログ
の :guilabel:`Source` 欄で範囲を変更することで表を更新しろ。面倒な場合にはピボッ
トテーブル全体を作り直せ。

----

ピボットテーブルのセル書式設定は自動で決まる。サイドバー :guilabel:`Styles` で言
うところの次が適用されている：

* Pivot Table Category
* Pivot Table Corner
* Pivot Table Field
* Pivot Table Result
* Pivot Table Title
* Pivot Table Value

カスタマイズしたければ、このスタイルを :menuselection:`&Edit Style...` すればい
い。

----

ピボットテーブルを削除する方法は次のいずれかを実行する：

* メインメニューから :menuselection:`&Data --> &Pivot Table --> &Delete`
* 右クリックメニューから :menuselection:`&Delete`

ピボットテーブル専用シートを割り当てている場合には、シート丸ごと削除でもいい。

Using pivot table results elsewhere
======================================================================

関数 ``GETPIVOTDATA`` というものがある。ピボットテーブルの結果をスプレッドシート
内の別の場所で再利用する場合に、数式で使用可能。出番が来たら調べる。

Using pivot charts
======================================================================

ピボットチャートはピボットテーブルの視覚的表現物だ。ピボットテーブルの出力からピ
ボットチャートを作成でき、ピボットテーブルが変更された場合はピボットチャートも変
更される。

ピボットチャートは汎用チャートの特化版だ。次のような特徴がある：

* テーブルの変化を追跡し、それに応じてチャートのデータ系列とデータ範囲を自動的に
  調整する。
* チャートにはチャートボタンが備わっている。

----

ピボットチャートの作成方法は次のいずれか：

* メインメニュー :menuselection:`&Insert --> &Chart...`
* :guilabel:`Standard` ツールバーの :guilabel:`Insert Chart` を押す

:guilabel:`Chart Wizard` ダイアログボックスが開く。適宜設定。

----

チャートボタン（下三角が示されているもの）でフィールド項目を絞り込む。

* 元ピボットテーブルと連動している？
* 絞り込み機能はチャートのほうがむしろ有用かもしれない。

----

ピボットチャートを削除するには、チャートを選択状態にして :kbd:`Del` を押せ。
