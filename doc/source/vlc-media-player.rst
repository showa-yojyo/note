======================================================================
VLC media player 利用ノート
======================================================================

.. include:: _include/kbd.txt
.. |VLC| replace:: VLC media player

.. note::

   本稿執筆環境：

   :Windows: 10 Home 22H2
   :VLC media player: 3.0.20

.. contents:: 本章見出し
   :depth: 3
   :local:

概略
======================================================================

|VLC| は DVD, VCD, 様々なストリーミングプロトコル、多様な音声および映像形式
(MPEG, DivX/Xvid, Ogg, etc.) に対する高可搬性マルチメディア再生ツールだ。さまざ
まな形式の生映像やオンデマンド映像をネットワークやインターネットにストリーミング
する、強力なサーバーとしても機能する。以上が Video Lan Wiki の冒頭に述べられてい
る。

本稿の主旨は、MP4 ファイルなどの非ストリーミングメディアを快適に再生する技法を追
求することにある。

アプリケーションとプロセス
======================================================================

インストール
----------------------------------------------------------------------

公式が推奨するインストール方法は、ダウンロードページからインストーラーを入手し、
実行してインストールウィザードを実行するものだが、本稿では :program:`winget` を
用いる方法を採用したい。この実行ファイル管理ツールについては :doc:`/winget` を見
ろ。

初回インストールでは PowerShell などのコマンドライン窓から次を実行しろ：

.. sourcecode:: ps1con
   :caption: VLC media player をインストールするコマンド例

   PS> winget add -e --id VideoLAN.VLC

起動と終了
----------------------------------------------------------------------

初回は Windows タスクバーの検索欄からキーボードで ``vlc`` と打ち込んで
:guilabel:`アプリ` 区画にある項目をクリックすれば |VLC| が起動する。いったん起動
したらタスクバーにピン留めするといい。

Windows Explorer でメディアファイル項目をダブルクリックや |Enter| で |VLC| を開
くように関連付けを指定することも可能だ。その手順は環境設定の節で記す。

実行中の |VLC| の終了方法は一般的な Windows アプリケーションと同様だ。次のいずれ
でもかまわない：

* メインウィンドウ右上のバツボタンをクリックする
* キーバインド |Ctrl+Q|
* メニューバーから :menuselection:`&Media-->&Quit` を選択する
* タスクバーのタスク右クリックメニューから :menuselection:`ウィンドウを閉じる`
  を選択する
* タスクトレイのアイコン右クリックメニューから :menuselection:`Quit` を選択する

アンインストール
----------------------------------------------------------------------

公式推奨方法は Windows 標準の :menuselection:`アプリと機能` から |VLC| を選択、
アンインストールするものだ。何かの作業で :program:`winget` を利用する機会があれ
ば、そのついでにアンインストールするのもよい。

.. sourcecode:: ps1con
   :caption: VLC media player をアンインストールするコマンド例

   PS> winget rm -e --id VideoLAN.VLC --purge

環境構成
======================================================================

次の手順のどちらかで設定ダイアログボックスが開く：

* メニューバーから :menuselection:`Tool&s-->&Preferences` を選択
* キーバインド |Ctrl+P|

ダイアログボックスのタイトルバーには :guilabel:`Show settings` モードによって
:guilabel:`Simple Preferences` か :guilabel:`Advanced Preferences` と記載されて
いる。|VLC| の動作を調整するには、このダイアログボックスにある項目を操作する。

初期化方法
----------------------------------------------------------------------

インストール直後の状態に環境を戻すには、ダイアログボックス左下付近にある
:guilabel:`&Reset Preferences` ボタンを押し、確認メッセージボックスで
:guilabel:`OK` を押す。

設定ファイル
----------------------------------------------------------------------

このようにして行ったアプリケーション設定はテキストファイル
:file:`%APPDATA%/vlc/vlcrc` に保存されている。ヘビーユーザーはこの五千行以上ある
ファイルをバージョン管理すると考えられる。

GUI
======================================================================

Windows 版 |VLC| は Qt で実装されているとのことで、十分柔軟なインターフェイスが
備わっている。

主要インターフェイス
----------------------------------------------------------------------

|VLC| メインウィンドウを解剖するとだいだいこうなる：

メニューバー
   たいていの Windows アプリケーションにある GUI なので、|VLC| にもある。
トラックスライダー
   ビデオファイルが再生すると、映像再生エリアの下にあるこれが使用可能になる。
   YouTube でいうシークバーに相当する。スライダーを左や右にドラッグすると再生位
   置を操作できる。ストリーミングで再生する場合、トラックスライダーは動かない。
コントロールボタン
   トラックスライダーの下にあるボタン群は基本的な再生機能をすべて対処する。
音量コントロール
   コントロールボタン群のはるか右に位置する。見れば使い方はわかる。
再生一覧
   これは後述。Floating と Docking のどちらかの状態をとる。
ステータスバー
   これもたいていの Windows アプリケーションにある GUI だ。テキストが選択可能で
   あるのがささやかながらも有益だ。

メニューバー
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

`Documentation:Play HowTo/Basic Use/Menus - VideoLAN Wiki
<https://wiki.videolan.org/Documentation:Play_HowTo/Basic_Use/Menus/>`__ にキー
バインド付きコマンド一覧がある。記述が現行バージョンに比べて古いようだが、考え方
を変えれば、残っているコマンドがほんとうに重要だということだろう。

.. admonition:: 利用者ノート

   未知の概念を含むコマンド名を控えておき、後で調査する。

   * Bookmarks
   * Subtitle

トラックスライダー
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

メインスライダー
   再生対象メディアのタイムラインを操作する。

   タイムラインのどこかをクリックすると、その位置まで映像・音声がスキップする。
   タイムラインのスライダーをドラッグすると、映像・音声上の位置に追従する。

   マウスカーソルがスライダー上にホバーすると、クリックしたときの位置がツール
   チップに表示される。
サウンドスライダー
   この三角形の UI では音量を操作することが可能だ。

   サウンドスライダーのどこかをクリックすると音量が変化する。スライダーをクリッ
   ク＆ドラッグすると音量も変化する。スライダーの外側でクリックを離すと以前の音
   量値に再設定する。

   マウスカーソルをホバーすると、クリックしたときの音量がツールチップに表示され
   る。

   三角形の左側のスピーカー図像をクリックすると消音モードオンオフ切り替え。
サウンド範囲
   音量は 0% から 125% までの係数で制御する。

   100% は増幅なしの通常のファイル出力を意味する。100% 以上はソフトウェア増幅を
   使用する可能性があり、音が歪むことがあることを意味する（通常は歪まないが、そ
   の可能性はある）。

.. admonition:: 利用者ノート

   メインスライダー右側の時刻表示をクリックすると、(1) 絶対時刻と (2) 終了時刻か
   らの相対時刻、言い換えれば残り再生時間に表記が切り替わる。FFmpeg などを使って
   メディアファイルから終端付近を切り落とす際の引数を得るのに (2) がなかなか便利
   だ。

再生コントロール
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

トラックスライダー下のツールバーのような領域でメディアの再生を操作する。

.. list-table:: Playback Controls
   :align: left
   :header-rows: 1
   :stub-columns: 0
   :widths: auto

   * - ボタン
     - 動作
   * - Play/Pause
     - 三角形の図像のときは演奏、縦棒二本のときは中断する。トグル。
   * - Previous
     - 再生一覧中の前の項目の冒頭へ戻る。
   * - Stop
     - 再生一覧全体の再生を終了する。
   * - Next
     - 再生一覧中の次の項目の冒頭へ飛ぶ。
   * - Full Screen
     - 全画面表示オンオフを切り替える。
   * - Effects
     - :guilabel:`Adjustments and Effects` ダイアログボックスを開く。
   * - Playlist
     - 再生一覧とメディアの表示を切り替える。
   * - Repeat
     - 再生一覧全体を反復、現在の項目を反復、反復なしのいずれかに切り替える。
   * - Shuffle
     - 再生一覧項目をランダムな順序で再生する。

.. admonition:: 利用者ノート

   Play/Pause, Stop, Previous, Next に関しては右クリックメニューからも実行可能。

   このツールバー自体の表示切替が |Ctrl+H| で可能。

再生一覧
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Windows Explorer のように図像表示、詳細表示、一覧表示がある。これらのビューを再
生一覧上部にある :guilabel:`Change Playlistview` 図像をクリックして循環変更する
ことが可能だ。直接変更するには次のいずれかを行う：

* メニューバーから :menuselection:`V&iew-->Playlist Viewmode-->Detailed List` な
  どを選択
* 右クリックメニューから :menuselection:`Playlist View Mode-->Detailed List` な
  どを選択

再生一覧の消去や並べ替えは、表示窓の背景を右クリックすることで行える。また、この
メニューから表示寸法を変更することもできる。

.. admonition:: 利用者ノート

   どの表示モードも一長一短ある。画像ビューワーでは図像表示が好みだとしても
   |VLC| でもそうなるとは限らない。サムネイルの縦横が歪んで気になる。

   詳細表示モードでは採用するテーブル列をある程度指定可能であることに気をつけ
   ろ。特に YouTube ビデオを並べるときは Artist や Description も出しておくとい
   い。なぜか Date 項目の値が存在しないのが残念だ。

ステータスバー
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

|VLC| のステータスバーは三区画に分割されている。

第一区画は名前ラベルと呼ばれていて、現在再生中のメディアのタイトルが表示されるも
のと思われる。ここではマウスを読み取り専用テキストボックスであるかのように操作す
ることが可能だ。例えばテキスト選択、それをクリップボードにコピーすることも可能
だ。

第二区画は再生速度を示す区画だろう。通常は ``1.00x`` のように表示されている。マ
ウスでクリックすると細かい速度調整を表示するコントロールが表示される。操作方法は
見ればわかる。ダブルクリックで再生速度を標準に戻せる。

第三区画は再生時刻を示す区画だ。先述のサウンドスライダーの右端の時刻表示と同期し
ている。クリックで同様に時刻表記を切り替える。ダブルクリックで :guilabel:`Go to
Time` ダイアログボックスが開く（多分後述する）。|VLC| が総時間を把握しない手段で
再生している場合は経過時間しか表示せず、尺の代わりに ``--:--`` を表示する。

タスクトレイアイコン
----------------------------------------------------------------------

|VLC| のタスクトレイアイコンをクリックすると、ウィンドウやタスクバーボタンの表示
状態が切り替わる。隠してもアプリケーションが終了するわけではない。バックグラウン
ドで実行中のままだ。タスクトレイアイコンを右クリックすると基本的操作を含むメ
ニューが表示される。

キーバインド
----------------------------------------------------------------------

メニューバーから :menuselection:`Tool&s-->&Preferences` を選択し、
:guilabel:`Hotkeys` ページを開くとキーバインド定義を一覧形式で確認できる。ドロッ
プダウンリストで `Hotkeys` を選択するのがいい。

一覧の登録項目をダブルクリックするとキーバインドを変更できるかのようなメッセージ
ボックスが開く。:strong:`このまま所望のキーバインドを打ち込む` ことでキーバイン
ドを更新する（こんな UI はかつて見たことがない）。

.. admonition:: 利用者ノート

   設定ダイアログを Advanced モードで表示しておくのがいい。:guilabel:`Hotkeys
   settings` ページの下に :guilabel:`Jump sizes` 区画が現れ、メディアの再生位置
   を調整するコマンドの間隔秒数を指定可能であるのがありがたい。

必修キーバインド
----------------------------------------------------------------------

カスタマイズ可能なものとそうでないものとを |VLC| は区別して管理している？

コントロールボタン対応
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. list-table:: コントロールボタンに対応するキーバインド
   :align: left
   :header-rows: 1
   :stub-columns: 0
   :widths: auto

   * - 動作
     - キーバインド
   * - Play/Pause
     - |Space|
   * - Previous
     - :kbd:`P`
   * - Stop
     - :kbd:`S`
   * - Next
     - :kbd:`N`
   * - Fullscreen
     - :kbd:`F` または |F11|
   * - Effects and Filters
     - |Ctrl+E|
   * - Toggle Playlist
     - |Ctrl+L|
   * - Normal/Loop/Repeat
     - :kbd:`L`
   * - Random
     - :kbd:`R`

キーフレーム移動
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

ビデオ再生時にはキーボードでフレーム移動を行うのが便利なので、次のキーバインドは
体得しておくべし：

.. list-table:: フレーム移動キーバインド
   :align: left
   :header-rows: 1
   :stub-columns: 0
   :widths: auto

   * - 動作
     - キーバインド
   * - Very short backwards jump
     - |Shift| + |ArrowL|
   * - Short backwards jump
     - |Alt| + |ArrowL|
   * - Medium backwards jump
     - |Ctrl| + |ArrowL|
   * - Long backwards jump
     - |Ctrl+Alt| + |ArrowL|

ここで、Very short/Short/Medium/Long の定義は先述の :guilabel:`Jump sizes` に
従う。前方の代わりに後方ジャンプをするには、それぞれにおいて |ArrowL| を
|ArrowR| に代えたキーバインドを用いる。

さらに、Next frame 動作をキーバインド :kbd:`E` で引き起こすことを覚えておく。残
念ながら Previous frame は動作自体が存在しない。

再生速度操作
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. list-table:: 再生速度操作必修キーバインド
   :align: left
   :header-rows: 1
   :stub-columns: 0
   :widths: auto

   * - 動作
     - キーバインド
   * - Faster
     - |Plus|
   * - Slower
     - |Minus|
   * - Normal rate
     - :kbd:`=`

音声
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. list-table:: 音声操作必修キーバインド
   :align: left
   :header-rows: 1
   :stub-columns: 0
   :widths: auto

   * - 動作
     - キーバインド
   * - Volume down
     - |Ctrl| + |ArrowD|
   * - Volume up
     - |Ctrl| + |ArrowU|
   * - Mute
     - :kbd:`M`

メニューコマンド
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. list-table:: コマンドに対応する必修キーバインド
   :align: left
   :header-rows: 1
   :stub-columns: 0
   :widths: auto

   * - コマンド
     - キーバインド
   * - Open Location from clipboard
     - |Ctrl+V|
   * - Quit
     - |Ctrl+Q|
   * - Jump to Specific Time
     - |Ctrl+T|
   * - Preferences
     - |Ctrl+P|

その他
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

その他、有用だったり知らないと不都合であるものを最後に示す：

.. list-table:: その他の必修キーバインド
   :align: left
   :header-rows: 1
   :stub-columns: 0
   :widths: auto

   * - 動作
     - キーバインド
   * - Exit fullscreen
     - |Esc|
   * - Clear the playlist
     - |Ctrl+W|
   * - 1:1 Original
     - |Alt| + :kbd:`3`
   * - Take video snapshot
     - |Shift| + :kbd:`S`
   * - Record
     - |Shift| + :kbd:`R`

メディア再生手順
======================================================================

単一メディアファイルを再生する
----------------------------------------------------------------------

方法は複数ある：

* |VLC| メニューバーから :menuselection:`&Media-->Open &File...` を選択し、再生
  したいメディアファイルを選択して :guilabel:`開く (&O)` ボタンを押す。
* |VLC| 再生一覧にドラッグ＆ドロップする。
* Windows Explorer で再生したいファイルを見つけ、ダブルクリックまたは選択して
  |Enter| を押す。

指定されたメディアファイルの再生が開始する。

メディアフォルダーを丸ごと再生する
----------------------------------------------------------------------

一定の主題に沿ったメディアファイルが配置されているフォルダーがあるときに、これを
行いたい場合がある。

#. |VLC| が起動していなかったら起動する。
#. メニューバーから :menuselection:`&Media-->Open &Folder...` を選択する。
#. :guilabel:`Open Folder` ダイアログボックスで対象フォルダーを選択する。
#. :guilabel:`フォルダーの選択` ボタンを押す。

.. admonition:: 利用者ノート

   メディアファイルだけが再生一覧に入るのかと思いきや、LibreOffice Calc ファイル
   なども登録項目として現れる。ここは挙動を改善していただきたい。

CD/DVD/VCD を再生する
----------------------------------------------------------------------

円盤をディスクトレイに入れると OS が何をしたいか聞いてくる。|VLC| で再生をする選
択肢があるはずなのでそれを選択し、:guilabel:`OK` ボタンを押す。

もう入っている場合の手順もある：

#. メニューバーから :menuselection:`&Media-->Open &Disc...` を選択する。
#. :guilabel:`Open Media` ダイアログボックス :guilabel:`Disc` タブが開く。
#. :guilabel:`Disc Selection` 区画でメディアの型を選択する。
#. :guilabel:`Disc Device` ドロップダウンリストからドライブ文字を選択してメディ
   アファイルのあるドライブを選択するか、:guilabel:`Browse...` ボタンを押して再
   生したいメディアを閲覧するためのダイアログボックスを開く。
#. 適宜オプションを指定する。
#. :guilabel:`&Play` ボタンを押して再生を開始する。あるいは :guilabel:`Enqueue`
   を選んで再生一覧に追加するのもいい。

ネットワークストリームを再生する
----------------------------------------------------------------------

#. メニューバーから :menuselection:`&Media-->Open &Network Stream...` を選択する。
#. :guilabel:`Open Media` ダイアログボックスが開き :guilabel:`Network` タブ
   が開いている。
#. :guilabel:`Please enter a network URL` コンボボックスにメディアのアドレスを入
   力する。
#. :guilabel:`&Play` ボタンを押して再生を開始する。

再生中に stuttering が発生する場合は、読み取りバッファーを大きくしろ：

#. ダイアログボックスの :guilabel:`Show &more options` をオンにする。
#. :guilabel:`Caching` スピンボックスで、再生開始前に |VLC| がデータをバッファー
   に保存する時間（ミリ秒単位）を調整する。

.. admonition:: 利用者ノート

   このコマンドで YouTube のビデオを再生することが可能だ。

データ記録カード（仮）から再生する
----------------------------------------------------------------------

#. メニューバーから :menuselection:`&Media-->Open &Capture Device...` を選択する。
#. :guilabel:`Open Media` ダイアログボックスが開く。:guilabel:`Capture Device`
   タブが開いている。

ここから :guilabel:`Capture mode` と :guilabel:`Video device name` /
:guilabel:`Audio device name` を選択できる。また、:guilabel:`Show &more options`
をオンにしてこれらのデバイスの設定を調整することもできる。また、
:guilabel:`Advanced Options` ボタン押すと、DirectShow プラグインで再生するビデオ
のサイズや、:guilabel:`Device properties`, :guilabel:`Tuner properties` などのオ
プションを設定できる。

.. admonition:: 利用者ノート

   私の場合、カメラ＆マイク代わりに使用している携帯電話の名前がドロップダウンリ
   ストに現れる。ということは？

再生一覧
======================================================================

再生一覧ビューは左側にサイドバー、右側に一覧領域という構成だ。サイドバーは各種情
報と映像窓からなる。

概要
----------------------------------------------------------------------

再生一覧とは、試聴対象メディアファイル群のカスタマイズされた目録だ。再生一覧を使
用すると、|VLC| を起動するたびに聞きたいメディアファイルを指定できる。再生一覧に
は CD, ラジオ局、映画のトラックを追加できる。

再生一覧が隠れている場合は次のいずれかの操作で現れる：

* メニューバーから :menuselection:`V&iew-->Playlist` を選択
* 再生コントロールにある Playlist ボタンを押す
* キーバインド |Ctrl+L|

一覧に項目を追加
----------------------------------------------------------------------

再生一覧にはメディアファイルを複数追加することが可能だ。メディアファイルを Media
Library やその他の給源から選択できる。

ファイルを追加するには：

#. 再生一覧が隠れている場合はそれを表示する。
#. 一覧領域で右クリックするとポップアップメニューが現れる。

   * ファイルを再生一覧に追加する場合は :menuselection:`Add Files...` を選択する。
   * メディアファイルを含むフォルダーを再生一覧に追加する場合は
     :menuselection:`Add Folder...` を選択する。

再生コントロールから次のボタンを適宜押してトラック再生を制御する：

* Random ボタン
* Repeat ボタン

読み込み
----------------------------------------------------------------------

他のメディアプレイヤーで作成された再生一覧を |VLC| のそれに追加することが可能だ。
次の形式の再生一覧を取り込める：

* XML Shareable Playlist Format (.xspf)
* Windows Media Player (.asx)
* Winamp3 XML based playlist (.b4s)
* Moving Picture Experts Group Audio Layer 3 Uniform Resource Locator (.m3u)

読み込む手順は：

#. :menuselection:`&Media-->Open &File...` を選択。ファイルダイアログボックスが
   開く。
#. 右下のドロップダウンリストで :guilabel:`Playlist Files` を選択。
#. 一覧から再生一覧を見つけて :guilabel:`開く (&O)` ボタンを押す。

選択した再生一覧ファイルの中身が |VLC| の再生一覧に追加される。

保存
----------------------------------------------------------------------

再生一覧を保存する機能のほうが重要だ。ファイルに保存可能であり、その手順は：

#. 上述のようにして |VLC| に再生一覧を構成する。
#. メニューバーから :menuselection:`&Media-->Save Playlist to File...` を選択す
   る。Windows 標準のファイル保存ダイアログボックスが開く。
#. :guilabel:`ファイル名 (&N)` に再生一覧ファイルの名前を入力する。
#. :guilabel:`ファイルの種類 (&T)` ドロップダウンリストから再生一覧形式を選択す
   る。次のものが選択可能：

   * XSPF playlist (.xspf)
   * M3U playlist (.m3u)
   * M3U8 playlist (.m3u8)
   * HTML playlist (.html)
#. :guilabel:`保存 (&S)` ボタンを押す。

検索
----------------------------------------------------------------------

メディアファイルを検索するには、:guilabel:`Search` 欄に名前を入力する。特定の名
前または形式のメディアファイルを検索するには、単語または語句を入力する。指定した
名前を持つファイルすべてが一覧表示される。

.. admonition:: 利用者ノート

   検索というより絞り込みとして用いたい。例えばビデオゲーム音楽フォルダーから再
   生一覧を構成し、「ドラキュラ」と入力すれば悪魔城ドラキュラ関連のサウンドト
   ラックが出来上がる。

移動
----------------------------------------------------------------------

再生一覧ビューモードが List または Detailed List の場合は項目をドラッグ＆ドロッ
プで移動可能だ。

コンテキストメニュー
----------------------------------------------------------------------

項目を右クリックまたは |Ctrl| を押しながらクリックすると、コンテクストメニューが
表示され、さまざまな機能にアクセスできる。

.. admonition:: 利用者ノート

   ビューモードが Detailed List でない場合に特に便利だ。本稿執筆時にしか使わない
   可能性があるものの、全項目削除コマンドも素早く有用だ。

CLI
======================================================================

TBW

資料
======================================================================

* `VLC Home page <https://www.videolan.org/vlc/>`__
* `VLC media player - VideoLAN Wiki <https://wiki.videolan.org/VLC_media_player/>`__
