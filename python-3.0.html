
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>What’s New In Python 3.0 ノート &#8212; 読書ノート v1.4</title>
    <link rel="stylesheet" href="_static/prefab.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/mathjaxconf.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="next" title="What’s New In Python 3.1 ノート" href="python-3.1.html" />
    <link rel="prev" title="ノート準備中書籍群 2018 年編" href="preliminary2018.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="python-3.1.html" title="What’s New In Python 3.1 ノート"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="preliminary2018.html" title="ノート準備中書籍群 2018 年編"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">読書ノート</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <div class="section" id="what-s-new-in-python-3-0">
<h1><a class="toc-backref" href="#id13">What’s New In Python 3.0 ノート</a><a class="headerlink" href="#what-s-new-in-python-3-0" title="Permalink to this headline">¶</a></h1>
<p>What’s New In Python 3.0 を読んで、個人的に関心のある項目に注釈を付けていく。</p>
<div class="contents topic" id="id1">
<p class="topic-title first">ノート目次</p>
<ul class="simple">
<li><a class="reference internal" href="#what-s-new-in-python-3-0" id="id13">What’s New In Python 3.0 ノート</a><ul>
<li><a class="reference internal" href="#id2" id="id14">要注意項目</a></li>
<li><a class="reference internal" href="#id3" id="id15">構文周り</a><ul>
<li><a class="reference internal" href="#id4" id="id16">新規の構文仕様</a></li>
<li><a class="reference internal" href="#id5" id="id17">変更された構文仕様</a></li>
<li><a class="reference internal" href="#id6" id="id18">廃止された構文仕様</a></li>
</ul>
</li>
<li><a class="reference internal" href="#python-2-6" id="id19">Python 2.6 での変更</a></li>
<li><a class="reference internal" href="#id7" id="id20">標準ライブラリーの変更</a></li>
<li><a class="reference internal" href="#id8" id="id21">文字列フォーマット</a></li>
<li><a class="reference internal" href="#id9" id="id22">例外に関係する仕様の変更</a></li>
<li><a class="reference internal" href="#id10" id="id23">その他の変更</a><ul>
<li><a class="reference internal" href="#id11" id="id24">演算子、特殊メソッド</a></li>
<li><a class="reference internal" href="#id12" id="id25">組み込み</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id14">要注意項目</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>メジャーバージョンアップによる劇的な変更点を記述している。</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">print</span></code> が関数化した。キーワード引数の仕様を確認したい。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">sep</span></code> は引数を区切る文字列。</li>
<li><code class="docutils literal notranslate"><span class="pre">end</span></code> は引数をすべて出力したあとにさらに追加的に出力する文字列。</li>
<li><code class="docutils literal notranslate"><span class="pre">file</span></code> は出力先オブジェクト。メソッド <code class="docutils literal notranslate"><span class="pre">write()</span></code> を実装していることを必要とする。</li>
</ul>
</li>
<li><p class="first">かなりのメソッドや関数が <code class="docutils literal notranslate"><span class="pre">list</span></code> や <code class="docutils literal notranslate"><span class="pre">dict</span></code> オブジェクトではなく、その iterator を返すように変更された。効率を考えるとそのほうがうれしい。</p>
<p>本当に <code class="docutils literal notranslate"><span class="pre">list</span></code> や <code class="docutils literal notranslate"><span class="pre">dict</span></code> オブジェクトが欲しい場合には、戻り値を明示的にそれらのコンストラクターの引数にしてオブジェクトを生成すればよい。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">dict</span></code> の <code class="docutils literal notranslate"><span class="pre">iter</span></code> から始まるメソッド群は廃止。名前に <code class="docutils literal notranslate"><span class="pre">iter</span></code> のつかないメソッドが iterator を返すようになったので要らない。</li>
<li><code class="docutils literal notranslate"><span class="pre">filter</span></code> も iterator を返すようになったが、個人的には元々これを使わない。内包表記のほうが書きやすいし効率的らしいから。</li>
<li><code class="docutils literal notranslate"><span class="pre">xrange</span></code> は廃止。<code class="docutils literal notranslate"><span class="pre">range</span></code> が変更されて、
<code class="docutils literal notranslate"><span class="pre">list</span></code> ではなく、何らかの iterable オブジェクトを返すようになったため。</li>
<li><code class="docutils literal notranslate"><span class="pre">zip</span></code> は iterator を返す。</li>
</ul>
</li>
<li><p class="first">比較周りが変更。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&lt;</span></code> などで両辺の型がマッチしないと TypeError が送出されるように変更された。
<code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">&lt;</span> <span class="pre">None</span></code> のような評価もこの例外送出が起こるので、ある意味では C/C++ より厳密だ。</li>
<li><code class="docutils literal notranslate"><span class="pre">sort</span></code> 系で <code class="docutils literal notranslate"><span class="pre">cmp</span></code> 引数が廃止された。これは C の <code class="docutils literal notranslate"><span class="pre">qsort</span></code> のアレだ。代わりに <code class="docutils literal notranslate"><span class="pre">key</span></code> 引数を用いる。この <code class="docutils literal notranslate"><span class="pre">key</span></code> 引数はキーワード専用引数なので、利用するのに仮引数名への代入の明示が必要。ちなみに <code class="docutils literal notranslate"><span class="pre">reverse</span></code> も同様。</li>
<li><code class="docutils literal notranslate"><span class="pre">cmp()</span></code> が廃止された。つまり <code class="docutils literal notranslate"><span class="pre">__cmp__()</span></code> も無意味になった。
<code class="docutils literal notranslate"><span class="pre">__le__()</span></code> や <code class="docutils literal notranslate"><span class="pre">__eq()__</span></code> を使う。<ul>
<li>そもそも <code class="docutils literal notranslate"><span class="pre">cmp(a,</span> <span class="pre">b)</span></code> とは <code class="docutils literal notranslate"><span class="pre">(a</span> <span class="pre">&gt;</span> <span class="pre">b)</span> <span class="pre">-</span> <span class="pre">(a</span> <span class="pre">&lt;</span> <span class="pre">b)</span></code> だ。</li>
</ul>
</li>
</ul>
</li>
<li><p class="first">整数型の変更点はけっこう注意が要る。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">long</span></code> は <code class="docutils literal notranslate"><span class="pre">int</span></code> に吸収統合された。</li>
<li><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">/</span> <span class="pre">int</span></code> の結果は <code class="docutils literal notranslate"><span class="pre">float</span></code> になる。
C 言語のような振る舞いが望みならば <code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">//</span> <span class="pre">int</span></code> とする。</li>
<li>八進数リテラルのプレフィックスが変更されたが、個人的にはこの基数は使わない。</li>
</ul>
</li>
<li><p class="first">文字列周り</p>
<ul class="simple">
<li>文字列は <code class="docutils literal notranslate"><span class="pre">str</span></code> しかない。しかも Unicode 文字列である。</li>
<li><code class="docutils literal notranslate"><span class="pre">u</span></code> プレフィックスは廃止。</li>
<li><code class="docutils literal notranslate"><span class="pre">str</span></code> と <code class="docutils literal notranslate"><span class="pre">bytes</span></code> は混在して使えない。両者を変換するメソッドやコンストラクターが提供されている。</li>
<li>自分ではやろうとは思わないが、非 ASCII 文字を識別子に使える。</li>
<li><code class="docutils literal notranslate"><span class="pre">StringIO</span></code>, <code class="docutils literal notranslate"><span class="pre">cStringIO</span></code> は廃止。
<code class="docutils literal notranslate"><span class="pre">io.StringIO</span></code> または <code class="docutils literal notranslate"><span class="pre">io.BytesIO</span></code> を採用すればよい。</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id15">構文周り</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>メジャーバージョンアップということで言語構文の変更がある。</p>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id16">新規の構文仕様</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>関数の引数と戻り値に対して注釈を付けられるようになった。これも使わない。</li>
<li>キーワード専用引数。キーワード引数であることを呼び出し側も明示しないといけない機能。すなわち、必要に応じて仮引数名イコール実引数と書く。</li>
<li>予約語 <code class="docutils literal notranslate"><span class="pre">nonlocal</span></code> の追加。入れ子の関数を書くときに有用。入れ子の関数スコープから、その外側の関数スコープの変数にアクセスするのに用いる。</li>
<li>左辺で iterator の unpack が可能になった。<code class="docutils literal notranslate"><span class="pre">a,</span> <span class="pre">b,</span> <span class="pre">*rest</span> <span class="pre">=</span> <span class="pre">some_sequence</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">dict</span></code> で <code class="docutils literal notranslate"><span class="pre">list</span></code> のように内包的記法ができるようになった。実行効率も期待できる。</li>
<li><code class="docutils literal notranslate"><span class="pre">set</span></code> が外延的記法と内包的記法のどちらでもオブジェクトを定義できるようになった。<ul>
<li><code class="docutils literal notranslate"><span class="pre">{2,</span> <span class="pre">4,</span> <span class="pre">6,</span> <span class="pre">8,</span> <span class="pre">10}</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">{x</span> <span class="pre">*</span> <span class="pre">2</span> <span class="pre">for</span> <span class="pre">x</span> <span class="pre">in</span> <span class="pre">range(1,</span> <span class="pre">5)}</span></code></li>
<li>ただし空集合は <code class="docutils literal notranslate"><span class="pre">set()</span></code> としか書けない。</li>
</ul>
</li>
<li>二進数の指定が楽になった。ROM 解析のビットフラグを見るのに使いたい。リテラル値の指定に <code class="docutils literal notranslate"><span class="pre">0b</span></code> プレフィックスが使える。<ul>
<li>関数 <code class="docutils literal notranslate"><span class="pre">bin()</span></code> も整数を二進数で表すのに便利だ。</li>
</ul>
</li>
<li>バイトリテラルもある。プレフィックス <code class="docutils literal notranslate"><span class="pre">b</span></code> が付いた文字列リテラルとして値を宣言する。または <code class="docutils literal notranslate"><span class="pre">bytes()</span></code> でオブジェクトを生成することができる。</li>
</ul>
</div>
<div class="section" id="id5">
<h3><a class="toc-backref" href="#id17">変更された構文仕様</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>例外送出構文が <code class="docutils literal notranslate"><span class="pre">raise</span> <span class="pre">[expr</span> <span class="pre">[from</span> <span class="pre">expr]]</span></code> に変更された。</li>
<li><code class="docutils literal notranslate"><span class="pre">as</span></code>, <code class="docutils literal notranslate"><span class="pre">with</span></code> が予約語になった。</li>
<li><code class="docutils literal notranslate"><span class="pre">True</span></code>, <code class="docutils literal notranslate"><span class="pre">False</span></code>, <code class="docutils literal notranslate"><span class="pre">None</span></code> が予約語になった。</li>
<li>例外ハンドルのキャッチ部の文法が変更された。
<code class="docutils literal notranslate"><span class="pre">except</span> <span class="pre">TypeError</span> <span class="pre">as</span> <span class="pre">e</span></code> のように書く。</li>
</ul>
</div>
<div class="section" id="id6">
<h3><a class="toc-backref" href="#id18">廃止された構文仕様</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>整数型の統合により <code class="docutils literal notranslate"><span class="pre">L</span></code> サフィックス廃止。</li>
<li>文字列の Unicode 化により <code class="docutils literal notranslate"><span class="pre">u</span></code> プレフィックス廃止。</li>
<li><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">module</span> <span class="pre">import</span> <span class="pre">*</span></code> 文はモジュールレベルでしか利用できなくなった。</li>
</ul>
</div>
</div>
<div class="section" id="python-2-6">
<h2><a class="toc-backref" href="#id19">Python 2.6 での変更</a><a class="headerlink" href="#python-2-6" title="Permalink to this headline">¶</a></h2>
<p>Python 3.0 用の機能仕様が一部 2.6 にも導入されているので、そちらのドキュメントを当たること。</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">with</span> <span class="pre">A</span> <span class="pre">as</span> <span class="pre">B</span></code> 文。</li>
<li><code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code> モジュール。</li>
<li>進化版文字列書式、すなわち <code class="docutils literal notranslate"><span class="pre">format()</span></code> と中括弧をふんだんに使う書式文字列のタッグ。</li>
<li><code class="docutils literal notranslate"><span class="pre">io</span></code> モジュール。</li>
<li><code class="docutils literal notranslate"><span class="pre">abc</span></code> モジュール。</li>
<li>クラスデコレーター。</li>
<li><code class="docutils literal notranslate"><span class="pre">numbers</span></code> モジュール。</li>
</ul>
</div>
<div class="section" id="id7">
<h2><a class="toc-backref" href="#id20">標準ライブラリーの変更</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p>What’s New では時間的制約のため、変更点を要点にしぼって記述している。</p>
<ul class="simple">
<li>大量の古いモジュールが撤廃された。使っていないものばかりなので見なくていい。</li>
<li>いくつかのモジュールの名前が変更された。個人的には <code class="docutils literal notranslate"><span class="pre">configparser</span></code> だけ注意すれば良さそうだ。</li>
<li><code class="docutils literal notranslate"><span class="pre">urllib</span></code> 周りのモジュールがここに統廃合された。</li>
<li><code class="docutils literal notranslate"><span class="pre">__builtins__</span></code> が <code class="docutils literal notranslate"><span class="pre">builtins</span></code> に改名。</li>
</ul>
</div>
<div class="section" id="id8">
<h2><a class="toc-backref" href="#id21">文字列フォーマット</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<p>文字列の <code class="docutils literal notranslate"><span class="pre">%</span></code> 演算子ではなく、<code class="docutils literal notranslate"><span class="pre">str.format()</span></code> や <code class="docutils literal notranslate"><span class="pre">format()</span></code> を使うようになる。</p>
</div>
<div class="section" id="id9">
<h2><a class="toc-backref" href="#id22">例外に関係する仕様の変更</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>すべての例外クラスは直接的または間接的に BaseException の派生クラスであるものとする。<ul>
<li>ただし、ユーザーが例外クラスを定義するならば Exception を直接的または間接的に継承するのが当然だ。したがって「すべての例外を捕捉する」を意味するコードは <code class="docutils literal notranslate"><span class="pre">except</span> <span class="pre">Exception</span></code> となる。</li>
<li>例外の送出構文が変更された。</li>
<li>例外の捕捉構文が変更された。</li>
<li>すごく難しいのだが <code class="docutils literal notranslate"><span class="pre">raise</span> <span class="pre">SecondaryException()</span> <span class="pre">from</span> <span class="pre">primary_exception</span></code> 構文。</li>
<li>例外オブジェクトの <code class="docutils literal notranslate"><span class="pre">__traceback__</span></code> メンバーにトレースバックがセットされるようになった。</li>
<li>Windows が拡張モジュールのロードに失敗したときの例外メッセージがマシになった。これは PyQt や Pillow などの DLL が何かおかしいときに実行時に出るエラーのことか。</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id10">
<h2><a class="toc-backref" href="#id23">その他の変更</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id11">
<h3><a class="toc-backref" href="#id24">演算子、特殊メソッド</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">!=</span> <span class="pre">b</span></code> と <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">==</span> <span class="pre">b</span></code> の評価が常に逆になるようになった。以前は何だった？</li>
<li><code class="docutils literal notranslate"><span class="pre">__slice__()</span></code> 系は廃止された。</li>
<li><code class="docutils literal notranslate"><span class="pre">iterator.next()</span></code> が <code class="docutils literal notranslate"><span class="pre">iterator.__next__()</span></code> に名前を変えた。</li>
<li><code class="docutils literal notranslate"><span class="pre">__nonzero()__</span></code> が <code class="docutils literal notranslate"><span class="pre">__bool__()</span></code> に名前を変えた。</li>
</ul>
</div>
<div class="section" id="id12">
<h3><a class="toc-backref" href="#id25">組み込み</a><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">super()</span></code> が使いやすくなった。引数なしで呼べるのがありがたい。</li>
<li><code class="docutils literal notranslate"><span class="pre">raw_input()</span></code> は <code class="docutils literal notranslate"><span class="pre">input()</span></code> に改名。</li>
<li>関数 <code class="docutils literal notranslate"><span class="pre">next()</span></code> で iterator を進めることができる。この関数は上述の <code class="docutils literal notranslate"><span class="pre">iterator.__next__()</span></code> を呼び出すことになっている。</li>
<li><code class="docutils literal notranslate"><span class="pre">apply()</span></code> や <code class="docutils literal notranslate"><span class="pre">reduce()</span></code> が廃止。それはそうだ。</li>
<li><code class="docutils literal notranslate"><span class="pre">callable()</span></code> が廃止。代替案が面倒なので、こういうコードは良くないということだろう。</li>
<li><code class="docutils literal notranslate"><span class="pre">file</span></code> 型が廃止。<code class="docutils literal notranslate"><span class="pre">open()</span></code> でさまざまなストリームを生成できる。</li>
<li><code class="docutils literal notranslate"><span class="pre">dict.has_key()</span></code> が廃止。<code class="docutils literal notranslate"><span class="pre">in</span></code> 演算子を用いればよい。</li>
</ul>
</div>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="python-3.1.html" title="What’s New In Python 3.1 ノート"
             >next</a></li>
        <li class="right" >
          <a href="preliminary2018.html" title="ノート準備中書籍群 2018 年編"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">読書ノート</a> &#187;</li> 
      </ul>
    </div>
    <div id="footer">
      <div id="footer_logo">
        <a class="imga" href="https://showa-yojyo.github.io/" title="プレハブ小屋 Since 1999"><img src="_static/logos.png" width="88" height="31" /></a>
      </div>
      <div id="footer_copyright">
        Since 1999<br />
        Copyright &copy; 1999-2018, プレハブ小屋 All rights reserved.
      </div>
    </div>
  </body>
</html>