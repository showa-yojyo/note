<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>OpenGL: A Primer Second Edition 読書ノート 3/4 &mdash; 読書ノート v1.2.1</title>
    
    <link rel="stylesheet" href="_static/prefab.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.2.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/twitter-button.js"></script>
    <link rel="top" title="読書ノート v1.2.1" href="index.html" />
    <link rel="up" title="OpenGL: A Primer Second Edition 読書ノート" href="angel05.html" />
    <link rel="next" title="OpenGL: A Primer Second Edition 読書ノート 4/4" href="angel05-note4.html" />
    <link rel="prev" title="OpenGL: A Primer Second Edition 読書ノート 2/4" href="angel05-note2.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="index.html">読書ノート v1.2.1</a> &raquo;</li>
          <li><a href="angel05.html" accesskey="U">OpenGL: A Primer Second Edition 読書ノート</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body">
            
  <div class="section" id="opengl-a-primer-second-edition-3-4">
<h1><a class="toc-backref" href="#id2">OpenGL: A Primer Second Edition 読書ノート 3/4</a><a class="headerlink" href="#opengl-a-primer-second-edition-3-4" title="Permalink to this headline">¶</a></h1>
<p><a class="reference internal" href="angel05-note2.html"><em>OpenGL: A Primer Second Edition 読書ノート 2/4</em></a> からの続き。</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">著者:</th><td class="field-body">Edward Angel</td>
</tr>
<tr class="field-even field"><th class="field-name">出版社:</th><td class="field-body">Peason Education, Inc.</td>
</tr>
<tr class="field-odd field"><th class="field-name">ISBN:</th><td class="field-body">0-321-26982-9</td>
</tr>
</tbody>
</table>
<div class="contents topic" id="id1">
<p class="topic-title first">ノート目次</p>
<ul class="simple">
<li><a class="reference internal" href="#opengl-a-primer-second-edition-3-4" id="id2">OpenGL: A Primer Second Edition 読書ノート 3/4</a><ul>
<li><a class="reference internal" href="#lights-and-matrials" id="id3">Lights and Matrials</a><ul>
<li><a class="reference internal" href="#light-material-interatctions" id="id4">Light-Material Interatctions</a></li>
<li><a class="reference internal" href="#the-phong-model" id="id5">The Phong Model</a><ul>
<li><a class="reference internal" href="#diffuse-reflection" id="id6">Diffuse Reflection</a></li>
<li><a class="reference internal" href="#specular-reflection" id="id7">Specular Reflection</a></li>
<li><a class="reference internal" href="#ambient-reflection" id="id8">Ambient Reflection</a></li>
<li><a class="reference internal" href="#emission" id="id9">Emission</a></li>
</ul>
</li>
<li><a class="reference internal" href="#opengl-lighting" id="id10">OpenGL Lighting</a></li>
<li><a class="reference internal" href="#specifying-light-sources" id="id11">Specifying Light Sources</a><ul>
<li><a class="reference internal" href="#light-sources-and-transformations" id="id12">Light Sources and Transformations</a></li>
<li><a class="reference internal" href="#specifying-a-material" id="id13">Specifying a Material</a></li>
</ul>
</li>
<li><a class="reference internal" href="#shading-the-rotating-cube" id="id14">Shading the Rotating Cube</a></li>
<li><a class="reference internal" href="#controlling-the-shading-calculation" id="id15">Controlling the Shading Calculation</a></li>
<li><a class="reference internal" href="#smooth-shading" id="id16">Smooth Shading</a></li>
<li><a class="reference internal" href="#working-with-normals" id="id17">Working with Normals</a></li>
<li><a class="reference internal" href="#transparancy" id="id18">Transparancy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#images" id="id19">Images</a><ul>
<li><a class="reference internal" href="#pixels-and-bitmaps" id="id20">Pixels and Bitmaps</a></li>
<li><a class="reference internal" href="#bitmaps" id="id21">Bitmaps</a><ul>
<li><a class="reference internal" href="#displaying-a-bitmap" id="id22">Displaying a Bitmap</a></li>
<li><a class="reference internal" href="#mixing-bitmaps-and-geometry" id="id23">Mixing Bitmaps and Geometry</a></li>
<li><a class="reference internal" href="#colors-and-masks" id="id24">Colors and Masks</a></li>
</ul>
</li>
<li><a class="reference internal" href="#drawing-modes" id="id25">Drawing Modes</a></li>
<li><a class="reference internal" href="#reading-and-writing-pixels" id="id26">Reading and Writing Pixels</a><ul>
<li><a class="reference internal" href="#writing-pixels" id="id27">Writing Pixels</a></li>
<li><a class="reference internal" href="#reading-pixels" id="id28">Reading Pixels</a></li>
<li><a class="reference internal" href="#copying-pixels" id="id29">Copying Pixels</a></li>
</ul>
</li>
<li><a class="reference internal" href="#selecting-buffers" id="id30">Selecting Buffers</a></li>
<li><a class="reference internal" href="#pixel-store-modes" id="id31">Pixel Store Modes</a></li>
<li><a class="reference internal" href="#displaying-a-ppm-image" id="id32">Displaying a PPM Image</a></li>
<li><a class="reference internal" href="#using-luminace" id="id33">Using Luminace</a></li>
<li><a class="reference internal" href="#pixel-mapping" id="id34">Pixel Mapping</a></li>
<li><a class="reference internal" href="#pixel-zoom" id="id35">Pixel Zoom</a></li>
<li><a class="reference internal" href="#image-processing-in-opengl" id="id36">Image Processing in OpenGL</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="lights-and-matrials">
<h2><a class="toc-backref" href="#id3">Lights and Matrials</a><a class="headerlink" href="#lights-and-matrials" title="Permalink to this headline">¶</a></h2>
<div class="section" id="light-material-interatctions">
<h3><a class="toc-backref" href="#id4">Light-Material Interatctions</a><a class="headerlink" href="#light-material-interatctions" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>色の説明</dt>
<dd>&lt;The colors that we see in the real world are based on the
interaction between light coming from light sources and
the materials of which the objects are made&gt; (p. 123)</dd>
<dt>影の説明</dt>
<dd><p class="first">&lt;These shadows are determined by light-material interactions&gt;
(p. 123)</p>
<p>&lt;Such a calculation is beyond the capabilities of real-time
rendering&gt; (p. 123)</p>
<p>&lt;Thus in OpenGL, shading must be done locally on a vertex-by-vertex
basis&gt; (p. 123)</p>
<p class="last">&lt;we can do a fairly good job of shading on a vertex-by-vertex
basis&gt; (p. 123)</p>
</dd>
</dl>
</div>
<div class="section" id="the-phong-model">
<h3><a class="toc-backref" href="#id5">The Phong Model</a><a class="headerlink" href="#the-phong-model" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">OpenGL では modifed Phong モデルをシェーディング計算に採用している。</p>
</li>
<li><p class="first">ある曲面をシェーディングしたいとする。このとき、曲面上の点 P に
対して、次の四つのベクトルを導入する。</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">L:</th><td class="field-body"><p class="first">The direction to the light source from P.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">V:</th><td class="field-body"><p class="first">The viewer is located in the direction V from P.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">N:</th><td class="field-body"><p class="first">The normal vector at P.
局所的な曲面の向きという捉え方。</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">R:</th><td class="field-body"><p class="first">perfect reflector;
&lt;If the surface is highly refective, it will act like a
mirror and most of the light will go off in the direction of
a perfect reflector R&gt; (p. 125)</p>
<p class="last">&lt;The vector R can be computed from N and L&gt; (p. 125)</p>
</td>
</tr>
</tbody>
</table>
</li>
<li><p class="first">Phong モデルは P のシェーディングには、以下の四種類のものが
寄与 (contributions) していると考える：</p>
<ul class="simple">
<li><strong>diffuse reflections</strong></li>
<li><strong>specular reflections</strong></li>
<li><strong>ambient reflections</strong></li>
<li><strong>emissive light</strong></li>
</ul>
</li>
</ul>
<div class="section" id="diffuse-reflection">
<h4><a class="toc-backref" href="#id6">Diffuse Reflection</a><a class="headerlink" href="#diffuse-reflection" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>曲面に照りつける光は、一部は材質により吸収され、一部は散乱する。
この散乱は等方向に発生するので、diffuse の計算は V に依存しない。</li>
<li>&lt;Diffuse surfaces tend to look dull like plastic&gt; (p. 125)</li>
</ul>
</div>
<div class="section" id="specular-reflection">
<h4><a class="toc-backref" href="#id7">Specular Reflection</a><a class="headerlink" href="#specular-reflection" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>specular = 鏡のように反射する。</li>
<li>&lt;a specular surface is smooth and the reflected light is
concentrated along the direction R&gt; (p. 126)</li>
<li>&lt;The Phong model characterizes this concentration with
a <strong>shininess coefficient</strong>&gt; (p. 126)</li>
<li>光沢のある材質が specular な曲面なのだ。
&lt;Specular surfaces include polished materials, such as metals&gt;
(p. 126)</li>
<li>OpenGL では R を L + V で代用して計算に用いる。</li>
</ul>
</div>
<div class="section" id="ambient-reflection">
<h4><a class="toc-backref" href="#id8">Ambient Reflection</a><a class="headerlink" href="#ambient-reflection" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>環境反射に関しては、これだけ憶えておけばいいか。
&lt;the light that we see does not depend on any of the four vectors,
only on the incoming light and the fraction that is reflected&gt;
(p. 126)</li>
</ul>
</div>
<div class="section" id="emission">
<h4><a class="toc-backref" href="#id9">Emission</a><a class="headerlink" href="#emission" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>物体が発光するケースもサポート。
&lt;we can add on an emissive term that is not affected by
incoming light and can help model visible light sources
or glowing objects&gt; (p.126)</li>
</ul>
</div>
</div>
<div class="section" id="opengl-lighting">
<h3><a class="toc-backref" href="#id10">OpenGL Lighting</a><a class="headerlink" href="#opengl-lighting" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">OpenGL は三種類の光源があることをおさえる。
&lt;In OpenGL, we can have point sources, spotlights, and ambient sources&gt;
(p. 127)</p>
</li>
<li><p class="first">光源は材質と共通するある性質を有している。
&lt;For each source there are separate diffuse, specular, and ambient
RGB parameters&gt; (p. 127)</p>
</li>
<li><p class="first">光源をオンにすることを忘れないこと。
&lt;Enabling lighting asks OpenGL to do the shading calculations&gt; (p 127)</p>
</li>
<li><p class="first">一旦カラーのことを忘れよう。
&lt;Once lighting is enabled, colors assigned by <tt class="docutils literal"><span class="pre">glColor*()</span></tt> are no longer used&gt;
(p. 127)</p>
</li>
<li><p class="first">照光処理では、法線ベクトルの質が死活的に重要となる。
&lt;the user generally must supply the normal vectors through <tt class="docutils literal"><span class="pre">glNormal*()</span></tt>&gt;
(p. 127)</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">glNormal3(dx,</span> <span class="pre">dy,</span> <span class="pre">dz)</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">dx, dy, dz:</th><td class="field-body">法線ベクトルの各成分。</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
<div class="section" id="specifying-light-sources">
<h3><a class="toc-backref" href="#id11">Specifying Light Sources</a><a class="headerlink" href="#specifying-light-sources" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">glLight</span></tt> に関する説明に紙幅を割いているが、ポイントは前半部に集中。</li>
<li>&lt;The defaults are slightly different for light 0 and all the other sources&gt;
(p. 128)</li>
<li>ライト 0 は白色なのだが、その他は黒となっている。
&lt;The default value of the position is (0.0, 0.0, 1.0, 0.0).  This value is
in eye coordinates, so it is  behind the default camera&gt; (p. 128)</li>
<li>z 軸の正の方向に無限の距離だけ離れたところが初期値。
&lt;w component indicates that the source is at infinity because w = 0
indicates it is the representation of direction rather than of a point&gt;
(p. 128)</li>
<li>スポットライトのカットオフ角の初期値は 180 度だ。</li>
<li>光の減衰を指定するパラメータ (<tt class="docutils literal"><span class="pre">GL_xxx_ATTENUATION</span></tt>) があるが、
デフォルトが減衰なしであることを憶えておけば、今はいい。</li>
</ul>
<div class="section" id="light-sources-and-transformations">
<h4><a class="toc-backref" href="#id12">Light Sources and Transformations</a><a class="headerlink" href="#light-sources-and-transformations" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">glLight</span></tt> で指定する光源の位置と向きは、モデルビュー変換の影響を受ける。</li>
</ul>
</div>
<div class="section" id="specifying-a-material">
<h4><a class="toc-backref" href="#id13">Specifying a Material</a><a class="headerlink" href="#specifying-a-material" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">&lt;Material properties match the lighting properties.  A material has
reflectively properties for each type of light&gt; (p. 131)</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">glMaterial(face,</span> <span class="pre">name,</span> <span class="pre">value)</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">face:</th><td class="field-body"><tt class="docutils literal"><span class="pre">GL_FRONT</span></tt>, <tt class="docutils literal"><span class="pre">GL_BACK</span></tt>, <tt class="docutils literal"><span class="pre">GL_FRONT_AND_BACK</span></tt></td>
</tr>
<tr class="field-even field"><th class="field-name">name:</th><td class="field-body"><tt class="docutils literal"><span class="pre">GL_AMBIENT</span></tt> 等</td>
</tr>
</tbody>
</table>
<p>&lt;Often the ambient and diffuce properties are the same and can be
set together using <tt class="docutils literal"><span class="pre">GL_AMBIENT_AND_DIFFUSE</span></tt>&gt; (p. 132)</p>
</li>
<li><p class="first">材質のアルファ値は、その材質の透明感をシミュレートする用途で使うことができる。</p>
</li>
<li><p class="first">余力があれば、材質のデフォルト値を憶えておく。</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">GL_SHININESS</span></tt> については、
&lt;The higher the value of this parameter, the shinier the material appears
as the specular highlights are concentrated in a small area near the
angle of a perfect reflection&gt; (p. 132)
とのこと。</p>
</li>
</ul>
</div>
</div>
<div class="section" id="shading-the-rotating-cube">
<h3><a class="toc-backref" href="#id14">Shading the Rotating Cube</a><a class="headerlink" href="#shading-the-rotating-cube" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">ここのコードのポイントは以下の通り。</p>
<ul>
<li><p class="first">照光処理を有効にして、利用する光源を有効にする。</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_LIGHTING</span><span class="p">);</span>
<span class="n">glEnable</span><span class="p">(</span><span class="n">GL_LIGHT0</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p class="first">現在の材質を設定する。この例では前面だけに指定している。</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">glMaterialfv</span><span class="p">(</span><span class="n">GL_FRONT</span><span class="p">,</span> <span class="n">GL_AMBIENT</span><span class="p">,</span> <span class="n">currentMaterials</span><span class="o">-&gt;</span><span class="n">ambient</span><span class="p">);</span>
<span class="n">glMaterialfv</span><span class="p">(</span><span class="n">GL_FRONT</span><span class="p">,</span> <span class="n">GL_DIFFUSE</span><span class="p">,</span> <span class="n">currentMaterials</span><span class="o">-&gt;</span><span class="n">diffuse</span><span class="p">);</span>
<span class="n">glMaterialfv</span><span class="p">(</span><span class="n">GL_FRONT</span><span class="p">,</span> <span class="n">GL_SPECULAR</span><span class="p">,</span> <span class="n">currentMaterials</span><span class="o">-&gt;</span><span class="n">specular</span><span class="p">);</span>
<span class="n">glMaterialf</span><span class="p">(</span><span class="n">GL_FRONT</span><span class="p">,</span> <span class="n">GL_SHININESS</span><span class="p">,</span> <span class="n">currentMaterials</span><span class="o">-&gt;</span><span class="n">shininess</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p class="first">光源の特徴を設定する。</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">glLightfv</span><span class="p">(</span><span class="n">GL_LIGHT0</span><span class="p">,</span> <span class="n">GL_AMBIENT</span><span class="p">,</span> <span class="n">currentLighting</span><span class="o">-&gt;</span><span class="n">ambient</span><span class="p">);</span>
<span class="n">glLightfv</span><span class="p">(</span><span class="n">GL_LIGHT0</span><span class="p">,</span> <span class="n">GL_DIFFUSE</span><span class="p">,</span> <span class="n">currentLighting</span><span class="o">-&gt;</span><span class="n">diffuse</span><span class="p">);</span>
<span class="n">glLightfv</span><span class="p">(</span><span class="n">GL_LIGHT0</span><span class="p">,</span> <span class="n">GL_SPECULAR</span><span class="p">,</span> <span class="n">currentLighting</span><span class="o">-&gt;</span><span class="n">specular</span><span class="p">);</span>
<span class="n">glLightfv</span><span class="p">(</span><span class="n">GL_LIGHT0</span><span class="p">,</span> <span class="n">GL_POSITION</span><span class="p">,</span> <span class="n">light0_pos</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="controlling-the-shading-calculation">
<h3><a class="toc-backref" href="#id15">Controlling the Shading Calculation</a><a class="headerlink" href="#controlling-the-shading-calculation" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">照光処理は大量のリソースを必要とする。ゆえに、通常は前面だけを処理させるように
<tt class="docutils literal"><span class="pre">glLightModel</span></tt> を介して設定する。</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">glLightModel(param,</span> <span class="pre">value)</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">param:</th><td class="field-body"><tt class="docutils literal"><span class="pre">GL_LIGHT_MODEL_(AMBIENT|LOCAL_VIEWER|TWO_SIDE)</span></tt></td>
</tr>
</tbody>
</table>
<p>どうしても両面でシェーディングをしたければ <tt class="docutils literal"><span class="pre">TWO_SIDE</span></tt> を <tt class="docutils literal"><span class="pre">GL_TRUE</span></tt> にセット。</p>
</li>
<li><p class="first">オブジェクトが視点から相当距離離れている場合、照光計算を簡略化するべく
<tt class="docutils literal"><span class="pre">LOCAL_VIEWER</span></tt> を <tt class="docutils literal"><span class="pre">GL_TRUE</span></tt> にセットすることができる。</p>
</li>
<li><p class="first">すべての光源がオフであっても、少量の環境光が存在するように指示できる。
<tt class="docutils literal"><span class="pre">AMBIENT</span></tt> にグローバルな環境光の RGBA 値を指示すればよい。</p>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="smooth-shading">
<h3><a class="toc-backref" href="#id16">Smooth Shading</a><a class="headerlink" href="#smooth-shading" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">GL_SMOOTH</span></tt> がデフォルトの照光処理。</li>
<li>巨大なポリゴンをシェーディングすると、中央部が妙に暗くなる。
これを回避するには、ポリゴンを細分化する。</li>
</ul>
</div>
<div class="section" id="working-with-normals">
<h3><a class="toc-backref" href="#id17">Working with Normals</a><a class="headerlink" href="#working-with-normals" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">&lt;the quality of our shading depends on the normals&gt; (p. 138)</p>
</li>
<li><p class="first">&lt;Smooth shading is sometimes called Gouraud shading&gt; (p. 138) グーローシェーディング。</p>
</li>
<li><p class="first">&lt;The lighting calculations require that the normal vector have unit length&gt; (p. 138)</p>
</li>
<li><p class="first">効率が落ちるのを覚悟で、OpenGL に法線の長さを 1 になるようにお願いすることができる。</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_NORMALIZE</span><span class="p">);</span>
</pre></div>
</div>
<p>しかし、何と言っても最大の注意点は、
&lt;Scaling changes the lengths of normals&gt; (p. 139)
ということだ。</p>
</li>
</ul>
</div>
<div class="section" id="transparancy">
<h3><a class="toc-backref" href="#id18">Transparancy</a><a class="headerlink" href="#transparancy" title="Permalink to this headline">¶</a></h3>
<p>シェーディングのことをいったん忘れて、ブレンディングの話題になる。</p>
<ul>
<li><p class="first">OpenGL は RGBA 値の A の値の指定は通常無視するが、ブレンディングを
明示的に有効にすれば意味を持つようになる。</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_BLEND</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p class="first">アルファ値は、通常 opacity を表現する。透明度の逆の概念。
&lt;the usual use is to use this value to determine the degree of opacity
of a color or material&gt; (p. 139)</p>
</li>
<li><p class="first">半透明オブジェクトの描画に関しては、忘れてはならない重大なポイントがある。
オブジェクトの描画順によって、結果が違ってくるということだ。</p>
</li>
<li><p class="first">&lt;OpenGL provides a variety of constants that determine how to
blend colors and alpha values&gt; (p. 140)</p>
</li>
<li><p class="first">source 色と destination 色という考え方。塗り絵みたいなもんだ。
&lt;When blending is disabled, the source color simply replaces
the destination color&gt; (p. 140)</p>
<p>結果色 := X * source + Y * destination</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">glBlendFunc(source,</span> <span class="pre">destination)</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">source:</th><td class="field-body">source 側のブレンディング係数。e.g. <tt class="docutils literal"><span class="pre">GL_SRC_ALPHA</span></tt></td>
</tr>
<tr class="field-even field"><th class="field-name">destination:</th><td class="field-body">destination 側のブレンディング係数。e.g. <tt class="docutils literal"><span class="pre">GL_ONE_MINUS_SRC_ALPHA</span></tt></td>
</tr>
</tbody>
</table>
<p>よく使う係数はこれ：
&lt;When we draw polygonal surfaces, the most common choices for the
source factor and destination factors are <tt class="docutils literal"><span class="pre">GL_SRC_ALPHA</span></tt> and
<tt class="docutils literal"><span class="pre">ONE_MINUS_SRC_ALPHA</span></tt>, respectively&gt; (p. 140)</p>
<p>つまり、ソースのアルファ値のみをブレンド率としている。</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_BLEND</span><span class="p">);</span>
<span class="n">glBlendFunc</span><span class="p">(</span><span class="n">GL_SRC_ALPHA</span><span class="p">,</span> <span class="n">GL_ONE_MINUS_SRC_ALPHA</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p class="first">ブレンド率をいいかげんに指定すると、最終的な値が [0, 1] の外にいってしまうことがある。
デプスバッファがここでも活躍する。
&lt;We can use the depth buffer to keep track of whether or not a
polygon is in front of all polygons that have been rendered so far&gt;
(p. 141)</p>
<p>&lt;OpenGL provides a function <tt class="docutils literal"><span class="pre">glDepthMask()</span></tt>, which can make the depth
buffer read-only (<tt class="docutils literal"><span class="pre">GL_FALSE</span></tt>) or writeable (<tt class="docutils literal"><span class="pre">GL_TRUE</span></tt>)&gt; (p. 141)</p>
</li>
<li><p class="first">アルファ値 (opacity) が 1.0 であるオブジェクトを描く前にデプスマスクを
有効にし、半透明なオブジェクトを描く前には read-only にすればよい。</p>
</li>
</ul>
</div>
</div>
<div class="section" id="images">
<h2><a class="toc-backref" href="#id19">Images</a><a class="headerlink" href="#images" title="Permalink to this headline">¶</a></h2>
<p>この章ではフレームバッファとピクセルの概念を頭に叩き込む。</p>
<div class="section" id="pixels-and-bitmaps">
<h3><a class="toc-backref" href="#id20">Pixels and Bitmaps</a><a class="headerlink" href="#pixels-and-bitmaps" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">&lt;The frame buffer is really a collection of buffers.  For each x, y value
in screen space, there is a corresponding group of bits that can be thought
of as a generalized picture element or <strong>pixel</strong>&gt; (p. 143)</p>
</li>
<li><p class="first">明らかに註が重要。用語の意味の汲み方を間違えぬこと。
ピクセルという用語に与える意味は、OpenGL のほうが一般の CG の
教科書より優れている気がする。
&lt;OpenGL uses <em>color buffer</em> to refer to these bits and the <em>frame buffer</em>
(or framebuffer) is the collection of all the buffers, including the
color buffer(s) and the depth buffer&gt; (p. 143)</p>
</li>
<li><p class="first">&lt;we need the ability to read and write rectangular arrays of pixels&gt; (p. 143)</p>
</li>
<li><p class="first">Figure 7.1 の &lt;n x m frame buffer shown with k parallel bit planes&gt; を憶える。</p>
</li>
<li><p class="first">&lt;we shall use the term pixel to denote a group of bits&gt; (p.144)</p>
</li>
<li><p class="first">ピクセルを直にいじる操作のことを <strong>bit block transfer</strong> という。
これを縮めて <strong>bitblt</strong> というのだ。</p>
</li>
<li><p class="first">Figure 7.2. Vertices パイプラインと Pixels パイプラインがラスタライズステージで合流する。</p>
<div class="highlight-python"><div class="highlight"><pre>Vertices --&gt; Geometric Processing --&gt; Rasterization --&gt; Display
                                        |
  Pixels --&gt; Pixel Operations ----------|
</pre></div>
</div>
</li>
<li><p class="first">&lt;We have to warry about the differences in how pixels are formatted in
the application program&gt; (p. 145)</p>
</li>
<li><p class="first">&lt;a pixel might represent an RGB color, an RGBA color, a luminance value,
or a depth value&gt; (p. 145)</p>
</li>
</ul>
</div>
<div class="section" id="bitmaps">
<h3><a class="toc-backref" href="#id21">Bitmaps</a><a class="headerlink" href="#bitmaps" title="Permalink to this headline">¶</a></h3>
<div class="section" id="displaying-a-bitmap">
<h4><a class="toc-backref" href="#id22">Displaying a Bitmap</a><a class="headerlink" href="#displaying-a-bitmap" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">glBitmap</span></tt> 関数の説明。ラスタポジションの状態を変更することに言及している。</li>
</ul>
</div>
<div class="section" id="mixing-bitmaps-and-geometry">
<h4><a class="toc-backref" href="#id23">Mixing Bitmaps and Geometry</a><a class="headerlink" href="#mixing-bitmaps-and-geometry" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">gluOrtho2D</span></tt> と <tt class="docutils literal"><span class="pre">glRasterPos2i</span></tt> のコンビ技について説明している。
二次元的に描画するときの基本的な考え方。</li>
<li>&lt;One solution to this problem is to use two sets of viewing conditions,
one for the geometry and the other for the bitmaps&gt; (p. 148)</li>
</ul>
</div>
<div class="section" id="colors-and-masks">
<h4><a class="toc-backref" href="#id24">Colors and Masks</a><a class="headerlink" href="#colors-and-masks" title="Permalink to this headline">¶</a></h4>
<p>ビットマップをマスクという観点で説明する。
<tt class="docutils literal"><span class="pre">glColor</span></tt> と <tt class="docutils literal"><span class="pre">glClearColor</span></tt> のチェッカーボードの例を挙げている。</p>
<ul>
<li><p class="first">ここは理解しにくい：
&lt;OpenGL stores both a present drawing color and a present raster color&gt;
(p. 149)</p>
<p>&lt;The checkerboard is drawn in red because the raster color is the color
that was in effect the last time that the function <tt class="docutils literal"><span class="pre">glRasterPos2i()</span></tt> was
executed&gt; (p. 149)</p>
</li>
</ul>
</div>
</div>
<div class="section" id="drawing-modes">
<h3><a class="toc-backref" href="#id25">Drawing Modes</a><a class="headerlink" href="#drawing-modes" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Figure 7.6 の模式を憶えること。Logic Op の回路。</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">glLogicOp(op)</span></tt> を利用するには、
<tt class="docutils literal"><span class="pre">glEnable</span></tt> で有効にする必要がある。</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_COLOR_LOGIC_OP</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p class="first">&lt;If we use XOR, wesimply draw the same object a second time at the same
place that we drew it the first time.  The second draw undoes the first&gt;
(p. 151)</p>
</li>
<li><p class="first">&lt;Applications of this simple idea include moving a cursor around the
screen, rubberbanding lines and rectangles&gt; (p.152)</p>
</li>
</ul>
</div>
<div class="section" id="reading-and-writing-pixels">
<h3><a class="toc-backref" href="#id26">Reading and Writing Pixels</a><a class="headerlink" href="#reading-and-writing-pixels" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Figure 7.7 Pixel pipeline を意識する。</p>
<div class="highlight-python"><div class="highlight"><pre>Processor                   Pixel        Pixel       Pixel       Frame
Memory    --&gt; Unpacking --&gt; Transfer --&gt; Mapping --&gt; Testing --&gt; Buffer
   |                                                                |
   |&lt;--------------------------- Packing &lt;--------------------------|
</pre></div>
</div>
</li>
</ul>
<div class="section" id="writing-pixels">
<h4><a class="toc-backref" href="#id27">Writing Pixels</a><a class="headerlink" href="#writing-pixels" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">glDrawPixels(w,</span> <span class="pre">h,</span> <span class="pre">format,</span> <span class="pre">type,</span> <span class="pre">array)</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">w, h:</th><td class="field-body">ピクセル矩形のサイズ</td>
</tr>
<tr class="field-even field"><th class="field-name">format:</th><td class="field-body"><tt class="docutils literal"><span class="pre">GL_UNSIGNED_BYTE</span></tt> とか</td>
</tr>
<tr class="field-odd field"><th class="field-name">type:</th><td class="field-body"><tt class="docutils literal"><span class="pre">GL_UNSIGNED_BYTE_3_3_2</span></tt> とか</td>
</tr>
<tr class="field-even field"><th class="field-name">array:</th><td class="field-body">描画したいデータ</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
<div class="section" id="reading-pixels">
<h4><a class="toc-backref" href="#id28">Reading Pixels</a><a class="headerlink" href="#reading-pixels" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">glReadPixels(x,</span> <span class="pre">y,</span> <span class="pre">w,</span> <span class="pre">h,</span> <span class="pre">format,</span> <span class="pre">type,</span> <span class="pre">array)</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">x, y:</th><td class="field-body">フレームバッファのどの位置からデータを読み込むのかを指示</td>
</tr>
</tbody>
</table>
</li>
<li><p class="first">dithering について言及しているが、よくわからなかった。</p>
</li>
</ul>
</div>
<div class="section" id="copying-pixels">
<h4><a class="toc-backref" href="#id29">Copying Pixels</a><a class="headerlink" href="#copying-pixels" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">glCopyPixels</span></tt> はフレームバッファ内でピクセルをコピーするというのがポイント。
<tt class="docutils literal"><span class="pre">glCopyPixels</span></tt> はデータをシステムメモリに運ばないので、
<tt class="docutils literal"><span class="pre">glReadPixels</span></tt> と <tt class="docutils literal"><span class="pre">glDrawPixels</span></tt> を組み合わせてコピーをするよりも、パフォーマンスが優れている。</li>
</ul>
</div>
</div>
<div class="section" id="selecting-buffers">
<h3><a class="toc-backref" href="#id30">Selecting Buffers</a><a class="headerlink" href="#selecting-buffers" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>シングルバッファモードで読み書きが起こるのは front color buffer で、
ダブルバッファモードでは back color buffer で起こる。</li>
<li>OpenGL は実装によってはさらなる color buffer をサポートしている。
どのバッファを用いるのかを選択するのには、
<tt class="docutils literal"><span class="pre">glReadBuffer</span></tt> と <tt class="docutils literal"><span class="pre">glDrawBuffer</span></tt>
関数を利用する。</li>
</ul>
</div>
<div class="section" id="pixel-store-modes">
<h3><a class="toc-backref" href="#id31">Pixel Store Modes</a><a class="headerlink" href="#pixel-store-modes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>どのようにしてプロセッサーメモリにバイトが配列されているのかを
OpenGL に教えてやる必要があるとする。この場合、
<tt class="docutils literal"><span class="pre">glPixelStore</span></tt> を利用する。</li>
<li>バイトオーダーの話題か。</li>
</ul>
</div>
<div class="section" id="displaying-a-ppm-image">
<h3><a class="toc-backref" href="#id32">Displaying a PPM Image</a><a class="headerlink" href="#displaying-a-ppm-image" title="Permalink to this headline">¶</a></h3>
<p>いまさら PPM を扱うことはあるまい。</p>
</div>
<div class="section" id="using-luminace">
<h3><a class="toc-backref" href="#id33">Using Luminace</a><a class="headerlink" href="#using-luminace" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first"><strong>Luminance</strong> とは &lt;images that consist only of shades of gray&gt; (p. 163) のこと。
モノクロ画像だ。</p>
</li>
<li><p class="first">RGB 値から luminance の値を計算する式は次で与えられるらしい。</p>
<div class="highlight-python"><div class="highlight"><pre>L = .30R + .59G + .11B
</pre></div>
</div>
<p>明らかに G 成分が支配的。</p>
</li>
</ul>
</div>
<div class="section" id="pixel-mapping">
<h3><a class="toc-backref" href="#id34">Pixel Mapping</a><a class="headerlink" href="#pixel-mapping" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">カラーバッファの RGB ピクセルの値を補正することができる。</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">glPixelTransfer(name,</span> <span class="pre">value)</span></tt> - pixel transfer mode を指定する。</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">glPixelMap(map,</span> <span class="pre">size,</span> <span class="pre">array)</span></tt> - 補正テーブルをセットする。</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">map:</th><td class="field-body"><tt class="docutils literal"><span class="pre">GL_PIXEL_MAP_I_TO_R</span></tt> など。</td>
</tr>
<tr class="field-even field"><th class="field-name">size:</th><td class="field-body">2 のベキ乗でなければならない。</td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
<div class="section" id="pixel-zoom">
<h3><a class="toc-backref" href="#id35">Pixel Zoom</a><a class="headerlink" href="#pixel-zoom" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">ピクセルブロックのスケーリングには <tt class="docutils literal"><span class="pre">glPixelZoom</span></tt> を用いる。</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">glPixelZoom(sx,</span> <span class="pre">sy)</span></tt></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">sx, sy:</th><td class="field-body">スケール係数。負数も許す。負数の場合はピクセルの並び順が逆転する。</td>
</tr>
</tbody>
</table>
</li>
</ul>
</li>
<li><p class="first">そしていまいち使い方がわからない <tt class="docutils literal"><span class="pre">gluScaleImage</span></tt> 関数。
イメージをトリムするのかストレッチするのかがわからない。</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">gluScaleImage(format,</span> <span class="pre">win,</span> <span class="pre">hin,</span> <span class="pre">typein,</span> <span class="pre">imagein,</span> <span class="pre">wout,</span> <span class="pre">hout,</span> <span class="pre">typeout,</span> <span class="pre">imageout)</span></tt></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="image-processing-in-opengl">
<h3><a class="toc-backref" href="#id36">Image Processing in OpenGL</a><a class="headerlink" href="#image-processing-in-opengl" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">ヒストグラムやフィルタリング。高度な内容らしい。</p>
</li>
<li><p class="first">Convolution という単語がフィルタに関連する理由が、次の文のおかげでわかった。
&lt;Convolution or filtering that replaces a pixel value by a linear function
of the surrounding pixel values&gt; (p. 167)</p>
</li>
<li><p class="first">Imaging Pipeline</p>
<div class="highlight-python"><div class="highlight"><pre>Pixels   Color                      Color      Color      Color                 Pixels
    --&gt;  Lookup --&gt; Convolution --&gt; Lookup --&gt; Matrix --&gt; Lookup --&gt; Histogram --&gt;
         Table                      Table                 Table
</pre></div>
</div>
</li>
</ul>
<hr class="docutils" />
<p><a class="reference internal" href="angel05-note4.html"><em>OpenGL: A Primer Second Edition 読書ノート 4/4</em></a> へ。</p>
</div>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="index.html">読書ノート v1.2.1</a> &raquo;</li>
          <li><a href="angel05.html" >OpenGL: A Primer Second Edition 読書ノート</a> &raquo;</li> 
      </ul>
    </div>
    <div id="footer">
      <div id="footer_logo">
        <a class="imga" href="https://showa-yojyo.github.io/" title="プレハブ小屋 Since 1999"><img src="_static/logos.png" width="88" height="31" /></a>
      </div>
      <div id="footer_share">
        <a href="https://twitter.com/share" class="twitter-share-button" data-size="large">Tweet</a>
        <script type="text/javascript">render_twitter_button(document, 'script', 'twitter-wjs')</script>
      </div>
      <div id="footer_copyright">
        Since 1999<br />
        Copyright &copy; 1999-2014, プレハブ小屋 All rights reserved.
      </div>
      <div id="footer_spacer">
        <p>
          Last updated at 2014/11/07 (Fri) 22:31:11.
        </p>
      </div>
    </div>
  </body>
</html>