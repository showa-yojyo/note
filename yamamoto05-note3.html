<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>入門 xyzzy 読書ノート 3/3 &mdash; 読書ノート v1.4.0dev</title>
    
    <link rel="stylesheet" href="_static/prefab.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.4.0dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/twitter-button.js"></script>
    <link rel="top" title="読書ノート v1.4.0dev" href="index.html" />
    <link rel="up" title="入門 xyzzy 読書ノート" href="yamamoto05.html" />
    <link rel="next" title="入門 bash 読書ノート" href="newham05.html" />
    <link rel="prev" title="入門 xyzzy 読書ノート 2/3" href="yamamoto05-note2.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="index.html">読書ノート v1.4.0dev</a> &raquo;</li>
          <li><a href="yamamoto05.html" accesskey="U">入門 xyzzy 読書ノート</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body">
            
  <div class="section" id="xyzzy-3-3">
<h1><a class="toc-backref" href="#id12">入門 xyzzy 読書ノート 3/3</a><a class="headerlink" href="#xyzzy-3-3" title="Permalink to this headline">¶</a></h1>
<p><a class="reference internal" href="yamamoto05-note2.html"><em>入門 xyzzy 読書ノート 2/3</em></a> からの続き。</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">著者:</th><td class="field-body">山本泰三・日枝政弘・稲川知久・佐野匡俊</td>
</tr>
<tr class="field-even field"><th class="field-name">出版社:</th><td class="field-body">株式会社オーム社</td>
</tr>
<tr class="field-odd field"><th class="field-name">ISBN:</th><td class="field-body">ISBN4-274-06600-2</td>
</tr>
</tbody>
</table>
<div class="contents topic" id="id1">
<p class="topic-title first">ノート目次</p>
<ul class="simple">
<li><a class="reference internal" href="#xyzzy-3-3" id="id12">入門 xyzzy 読書ノート 3/3</a><ul>
<li><a class="reference internal" href="#aa-xyzzy-lisp" id="id13">Aa xyzzy Lisp 導入編</a><ul>
<li><a class="reference internal" href="#aa-1" id="id14">Aa.1 定型の文字列の挿入</a></li>
<li><a class="reference internal" href="#aa-2" id="id15">Aa.2 日付の挿入</a></li>
<li><a class="reference internal" href="#aa-3" id="id16">Aa.3 タグの挿入</a></li>
<li><a class="reference internal" href="#aa-4" id="id17">Aa.4 一括置換</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ab-xyzzy-lisp" id="id18">Ab xyzzy Lisp 言語編</a><ul>
<li><a class="reference internal" href="#ab-1" id="id19">Ab.1 実行例について</a></li>
<li><a class="reference internal" href="#ab-2-xyzzy" id="id20">Ab.2 xyzzy の構成</a></li>
<li><a class="reference internal" href="#ab-4-xyzzy-lisp" id="id21">Ab.4 xyzzy Lisp の言語仕様</a><ul>
<li><a class="reference internal" href="#id2" id="id22">コメント</a></li>
<li><a class="reference internal" href="#id3" id="id23">データ型</a></li>
<li><a class="reference internal" href="#id4" id="id24">キーワード引数の指定</a></li>
<li><a class="reference internal" href="#id5" id="id25">文字列のマッチ・置換</a></li>
<li><a class="reference internal" href="#id6" id="id26">制御構造</a></li>
<li><a class="reference internal" href="#id7" id="id27">関数の定義</a></li>
<li><a class="reference internal" href="#id8" id="id28">マクロの定義</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#ac-xyzzy-lisp" id="id29">Ac xyzzy Lisp 基本編</a><ul>
<li><a class="reference internal" href="#ac-1" id="id30">Ac.1 テキスト</a></li>
<li><a class="reference internal" href="#ac-3" id="id31">Ac.3 ファイル</a></li>
<li><a class="reference internal" href="#ac-4" id="id32">Ac.4 バッファ</a></li>
<li><a class="reference internal" href="#ac-6" id="id33">Ac.6 キーマップ</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ad-xyzzy-lisp" id="id34">Ad xyzzy Lisp 応用編</a><ul>
<li><a class="reference internal" href="#ad-1" id="id35">Ad.1 メニューを作成する</a><ul>
<li><a class="reference internal" href="#id9" id="id36">メニューの静的な作成</a></li>
<li><a class="reference internal" href="#id10" id="id37">メニューの動的な作成</a></li>
<li><a class="reference internal" href="#id11" id="id38">メニューの挿入</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ad-2" id="id39">Ad.2 ツールバーを作成する</a></li>
<li><a class="reference internal" href="#ad-3" id="id40">Ad.3 メジャーモードを作成する</a></li>
</ul>
</li>
<li><a class="reference internal" href="#b" id="id41">B その他の情報</a><ul>
<li><a class="reference internal" href="#b-1-faq" id="id42">B.1 FAQ</a><ul>
<li><a class="reference internal" href="#emacs" id="id43">Emacs 風設定</a></li>
</ul>
</li>
<li><a class="reference internal" href="#b-4" id="id44">B.4 共通設定ダイアログ</a></li>
<li><a class="reference internal" href="#b-5" id="id45">B.5 ローカル設定ダイアログ</a></li>
<li><a class="reference internal" href="#b-6" id="id46">B.6 正規表現</a></li>
<li><a class="reference internal" href="#b-8" id="id47">B.8 標準キーバインド一覧</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="aa-xyzzy-lisp">
<h2><a class="toc-backref" href="#id13">Aa xyzzy Lisp 導入編</a><a class="headerlink" href="#aa-xyzzy-lisp" title="Permalink to this headline">¶</a></h2>
<p>.xyzzy やスクラッチバッファに記述するだけで使える Lisp コードを挙げていくコーナー。</p>
<div class="section" id="aa-1">
<h3><a class="toc-backref" href="#id14">Aa.1 定型の文字列の挿入</a><a class="headerlink" href="#aa-1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>insert 関数でキャレット位置に指定文字列を挿入する。</li>
<li>関数定義の最初に <tt class="docutils literal"><span class="pre">(interactive</span> <span class="pre">&quot;*&quot;)</span></tt> がある。</li>
<li>global-set-key 関数で関数とキーバインドを関連付ける。<ul>
<li>文字列とキーバインドを関連付けることもできる。</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="aa-2">
<h3><a class="toc-backref" href="#id15">Aa.2 日付の挿入</a><a class="headerlink" href="#aa-2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>format-date-string 関数で現在時刻の取得と書式整形を同時に行う。</li>
</ul>
</div>
<div class="section" id="aa-3">
<h3><a class="toc-backref" href="#id16">Aa.3 タグの挿入</a><a class="headerlink" href="#aa-3" title="Permalink to this headline">¶</a></h3>
<p>「キャレット位置を一時的に移動してから insert する」例を挙げている。</p>
<div class="highlight-python"><div class="highlight"><pre>(save-excursion
  (何かキャレット位置を変更する関数)
  ...)
; ここでキャレット位置が復帰する
</pre></div>
</div>
</div>
<div class="section" id="aa-4">
<h3><a class="toc-backref" href="#id17">Aa.4 一括置換</a><a class="headerlink" href="#aa-4" title="Permalink to this headline">¶</a></h3>
<p>異なるパターンのテキスト置換を一度に行う例を挙げている。</p>
<div class="highlight-python"><div class="highlight"><pre>(save-excursion
  (beginning-of-buffer)
  (replace-string &quot;《&quot; &quot;【&quot; t)
  (beginning-of-buffer)
  (replace-string &quot;》&quot; &quot;】&quot; t))
</pre></div>
</div>
</div>
</div>
<div class="section" id="ab-xyzzy-lisp">
<h2><a class="toc-backref" href="#id18">Ab xyzzy Lisp 言語編</a><a class="headerlink" href="#ab-xyzzy-lisp" title="Permalink to this headline">¶</a></h2>
<div class="section" id="ab-1">
<h3><a class="toc-backref" href="#id19">Ab.1 実行例について</a><a class="headerlink" href="#ab-1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>&lt;実行例は場面に応じて <tt class="docutils literal"><span class="pre">*scratch*</span></tt> バッファとミニバッファで評価します&gt;
(p. 305)</li>
<li>&lt;ミニバッファで式を評価するには、Esc キーを 2 度オスとミニバッファにカーソルが移動するので、
式を入力してください&gt; (p. 306)</li>
<li>特殊な理由により、キャレットやバッファを移動するような式は、ミニバッファで評価する。</li>
</ul>
</div>
<div class="section" id="ab-2-xyzzy">
<h3><a class="toc-backref" href="#id20">Ab.2 xyzzy の構成</a><a class="headerlink" href="#ab-2-xyzzy" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>&lt;xyzzy が機能性や拡張性に優れているのは、
標準 Lisp ファイルが使用しているさらに低レベルに位置する関数を、
ユーザも同じように使うことができるからです&gt; (p. 306)</li>
</ul>
</div>
<div class="section" id="ab-4-xyzzy-lisp">
<h3><a class="toc-backref" href="#id21">Ab.4 xyzzy Lisp の言語仕様</a><a class="headerlink" href="#ab-4-xyzzy-lisp" title="Permalink to this headline">¶</a></h3>
<p>すべてを習得する必要はないので（いざとなったら外部アプリ呼び出しができる）、
テキトーにノートをとる。</p>
<div class="section" id="id2">
<h4><a class="toc-backref" href="#id22">コメント</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>&lt;慣習的に、行頭ならば <tt class="docutils literal"><span class="pre">;;;</span></tt> 、
行頭でない場合には <tt class="docutils literal"><span class="pre">;;</span></tt> 、
コメントに先立って何か入力があれば <tt class="docutils literal"><span class="pre">;</span></tt> 、と使い分けられているようです&gt;
(p. 309)</li>
</ul>
</div>
<div class="section" id="id3">
<h4><a class="toc-backref" href="#id23">データ型</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>シンボルがちょっとわかりにくい。
&lt;他のプログラミング言語でいうところの関数名、変数名に相当します&gt;
(p. 311) とある。C/C++ でいうところの識別子という解釈でよろしいか。</li>
<li>&lt;シンボルを式中に記述する場合には、 <tt class="docutils literal"><span class="pre">'シンボル</span></tt> という形式で記述します&gt;
(p. 311)</li>
</ul>
</div>
<div class="section" id="id4">
<h4><a class="toc-backref" href="#id24">キーワード引数の指定</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><div class="highlight"><pre>;;; 文字列の比較 (p. 316)
(string= &quot;other&quot; &quot;other&quot;) =&gt; t
(string= &quot;other&quot; &quot;mother&quot;) =&gt; nil
(string= &quot;other&quot; &quot;mother&quot; :start2 1) =&gt; t
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h4><a class="toc-backref" href="#id25">文字列のマッチ・置換</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>foo とか bar とかいう変な名前を多用するのは勘弁して。</p>
<ul class="simple">
<li>string-match と match-string をペアで利用する。</li>
</ul>
</div>
<div class="section" id="id6">
<h4><a class="toc-backref" href="#id26">制御構造</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><div class="highlight"><pre>;;; 複数の式を評価する。if で頻繁に使うらしい。
(progn 式1 ... 式N)

;;; let のスコープで有効な変数を扱える
(let (変数名1 ... 変数名N) 式1 ... 式M)

;;; if
(if 条件式 式1 [式2])

;;; when - if と似ている
;;; unless - if not の意
(when 条件式 式1 ... 式N)
(unless 条件式 式1 ... 式N)

;;; cond - C 言語の switch に相当する
(cond (条件式1 式11 ... 式1N1)
      (条件式2 式21 ... 式2N2)
      ...
      (条件式M 式M1 ... 式MNM))

;;; dolist - リストの走査
(dolist (変数 リスト) 式1 ... 式N)

;;; dotimes - カウンターを使ったループ
(dotimes (変数 回数) 式1 ... 式N)

;;; while
(while 条件式 式1 ... 式N)

;;; loop - endless loop
(loop 式1 ... 式N)

;;; return - ループを break する
(return [式])
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h4><a class="toc-backref" href="#id27">関数の定義</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><div class="highlight"><pre>(defun 関数名 (引数1 ... 引数N)
   式1 ... 式M)
</pre></div>
</div>
<ul class="simple">
<li>デフォルト引数は <tt class="docutils literal"><span class="pre">&amp;optional</span></tt></li>
<li>キーワード引数は <tt class="docutils literal"><span class="pre">&amp;key</span></tt><ul>
<li>値の指定方法は <tt class="docutils literal"><span class="pre">:仮引数名</span> <span class="pre">値</span></tt> と書く。</li>
</ul>
</li>
<li>可変個引数は <tt class="docutils literal"><span class="pre">&amp;rest</span></tt></li>
</ul>
</div>
<div class="section" id="id8">
<h4><a class="toc-backref" href="#id28">マクロの定義</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p>Lisp はマクロが強力だと聞いたことがある。</p>
<ul class="simple">
<li>&lt;xyzzy Lisp では実行時の情報を参照しつつマクロ展開を動的に行うことができる&gt;
(p. 333)</li>
</ul>
</div>
</div>
</div>
<div class="section" id="ac-xyzzy-lisp">
<h2><a class="toc-backref" href="#id29">Ac xyzzy Lisp 基本編</a><a class="headerlink" href="#ac-xyzzy-lisp" title="Permalink to this headline">¶</a></h2>
<p>大雑把にノートをとるので、後で確かめるときには既存の Lisp ファイルに当たること。</p>
<div class="section" id="ac-1">
<h3><a class="toc-backref" href="#id30">Ac.1 テキスト</a><a class="headerlink" href="#ac-1" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">M-x</span></tt> から入力して実行できる関数は <tt class="docutils literal"><span class="pre">(interactive)</span></tt> なモノに限る。</p>
</li>
<li><p class="first">各行について処理を行うコードは次のようになる。</p>
<div class="highlight-python"><div class="highlight"><pre>;;; 各行について処理を行うコード
(loop 処理 (unless (next-line) (return)))
</pre></div>
</div>
</li>
<li><p class="first">スキップ系の関数を使い分ける。
<tt class="docutils literal"><span class="pre">skip-chars-forward</span></tt>, <tt class="docutils literal"><span class="pre">skip-white-forward</span></tt>, skip-syntax-spec-forward`` 等がある。</p>
</li>
<li><p class="first">テキストの挿入は <tt class="docutils literal"><span class="pre">insert</span></tt> が基本。キャレット位置に文字列をねじ込む。</p>
</li>
<li><p class="first">テキストの取得は <tt class="docutils literal"><span class="pre">buffer-substring</span></tt> を使う。</p>
<div class="highlight-python"><div class="highlight"><pre>;;; カーソルのある行を取得 (p. 342)
(buffer-substring (progn (goto-bol) (point))
                  (progn (goto-eol) (point)))
</pre></div>
</div>
</li>
<li><p class="first">テキストの削除は <tt class="docutils literal"><span class="pre">delete-region</span></tt> を使う。</p>
</li>
<li><p class="first">テキストの検索は &lt;<tt class="docutils literal"><span class="pre">scan-buffer</span></tt> を使うことをおすすめします&gt; (p. 342)</p>
<ul class="simple">
<li>しばしば <tt class="docutils literal"><span class="pre">match-string</span></tt>, <tt class="docutils literal"><span class="pre">match-beginning</span></tt>, <tt class="docutils literal"><span class="pre">match-end</span></tt> を併用する。</li>
<li><tt class="docutils literal"><span class="pre">scan-buffer</span></tt> のキーワード引数を使いこなせるように。</li>
</ul>
</li>
<li><p class="first">テキストの置換は <tt class="docutils literal"><span class="pre">replace-buffer</span></tt> を使う。
こちらもキーワード引数がある。</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">save-excursion</span></tt> と <tt class="docutils literal"><span class="pre">save-restriction</span></tt> を同時に利用するならば、
この順序で入れ子にするべし。さもないと、キャレット位置が元に戻らない場合がある。</p>
</li>
<li><p class="first">正規表現のコンパイルは <tt class="docutils literal"><span class="pre">compile-regexp</span></tt> を用いる。</p>
<ul class="simple">
<li>正規表現はバックスラッシュが面倒。</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="ac-3">
<h3><a class="toc-backref" href="#id31">Ac.3 ファイル</a><a class="headerlink" href="#ac-3" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">意味のあるフォルダ各種を取得する関数がいくつか存在する。</p>
<div class="highlight-python"><div class="highlight"><pre>(default-directory) ; バッファに関係する作業フォルダを返す

(si:system-root) ; $XYZZY を返す
(etc-path) ; $XYZZY/etc を返す
(user-homedir-pathname) ; ホームディレクトリ ~ を返す

(get-special-folder-location :start-menu) ; スタートメニューのパスを返す
</pre></div>
</div>
</li>
<li><p class="first">パス名を表す文字列を操作するための関数がある。</p>
<ul class="simple">
<li>パスを連結するには <tt class="docutils literal"><span class="pre">merge-pathnames</span></tt> を用いる。Python での sys.path.join に相当する？</li>
<li>フォルダセパレーターは <tt class="docutils literal"><span class="pre">/</span></tt> でも <tt class="docutils literal"><span class="pre">\</span></tt> でも構わない。</li>
</ul>
</li>
<li><p class="first">パス名を表す文字列を与えて、それが実在するか、
属性はどうなっているのか、といったことをテストする関数が存在する。</p>
</li>
<li><p class="first">ファイルのコピーや削除といった、シェル的な操作をする関数も提供する。</p>
</li>
<li><p class="first">関数 <tt class="docutils literal"><span class="pre">directory</span></tt> を使うと、UNIX の ls みたいなことができる。
本関数はリストを返すので、これを <tt class="docutils literal"><span class="pre">dolist</span></tt> で走査するのが基本的な利用法。</p>
</li>
</ul>
</div>
<div class="section" id="ac-4">
<h3><a class="toc-backref" href="#id32">Ac.4 バッファ</a><a class="headerlink" href="#ac-4" title="Permalink to this headline">¶</a></h3>
<p>バッファは、ファイルに関連付けられた「オブジェクト」だと解釈すればよさそうだ。</p>
<ul>
<li><p class="first">xyzzy では、常にバッファが一つだけ選択されている（カレントバッファ）。
<tt class="docutils literal"><span class="pre">selected-buffer</span></tt> で得られる。</p>
</li>
<li><p class="first">ファイル名、パス名からバッファを得ることが可能
(<tt class="docutils literal"><span class="pre">find-buffer</span></tt>, <tt class="docutils literal"><span class="pre">get-file-buffer</span></tt>)</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">buffer-list</span></tt> 関数で、その名前が示すものが得られる。</p>
</li>
<li><p class="first">すべてのバッファを対象とする処理は、次のように書くことになる。</p>
<div class="highlight-python"><div class="highlight"><pre>(save-excursion
  (dolist (buf (buffer-list))
     (set-buffer buf)
     (バッファを対象とする処理)))
</pre></div>
</div>
</li>
<li><p class="first">エンコーディング</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">buffer-fileio-encoding</span></tt>, <tt class="docutils literal"><span class="pre">set-buffer-fileio-encoding</span></tt></li>
<li>&lt;文字エンコーディングに使用する定数は <tt class="docutils literal"><span class="pre">$XYZZY/lisp/encoding.l</span></tt> で定義されています&gt; (p. 357)</li>
</ul>
</li>
<li><p class="first">改行コードを <tt class="docutils literal"><span class="pre">buffer-eol-code</span></tt>, <tt class="docutils literal"><span class="pre">set-buffer-eol-code</span></tt> でアクセスできる。</p>
</li>
<li><p class="first">メジャーモードを変数 <tt class="docutils literal"><span class="pre">buffer-mode</span></tt> で参照できる。</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">need-not-save</span></tt> 変数で、バッファの内容を保存する必要性を操作できる。
変数名に not が入っているので、意味を逆に取り違えそうで怖い。</p>
</li>
</ul>
</div>
<div class="section" id="ac-6">
<h3><a class="toc-backref" href="#id33">Ac.6 キーマップ</a><a class="headerlink" href="#ac-6" title="Permalink to this headline">¶</a></h3>
<p>キーバインドと、それに関連付けられたコマンドの対応をまとめた表をキーマップと呼ぶ。</p>
<p>キーマップは 3 つに分類して理解するとよさそうだ。</p>
<ol class="arabic simple">
<li>グローバルキーマップ。優先度が最も低い。
変数 <tt class="docutils literal"><span class="pre">*global-keymap*</span></tt> で管理されている。</li>
<li>ローカルキーマップ。メジャーモードのキーマップ。
例えばテキストモード (text-mode) のキーマップは <em>text-mode-map</em> で管理されている。</li>
<li>マイナーモードマップ。マイナーモードのキーマップであり、優先度が最も高い。</li>
</ol>
<ul class="simple">
<li>既存のキーマップに、キーバインドを追加することと、
キーマップに指定するキーバインドがあるか否かをテストする方法だけ押さえておけばよさそうだ。<ul>
<li><tt class="docutils literal"><span class="pre">(define-key</span> <span class="pre">キーマップ</span> <span class="pre">キー</span> <span class="pre">コマンド)</span></tt> で追加。</li>
<li><tt class="docutils literal"><span class="pre">(lookup-keymap</span> <span class="pre">キーマップ</span> <span class="pre">キー)</span></tt> でコマンドまたは <tt class="docutils literal"><span class="pre">nil</span></tt> が返る。</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="ad-xyzzy-lisp">
<h2><a class="toc-backref" href="#id34">Ad xyzzy Lisp 応用編</a><a class="headerlink" href="#ad-xyzzy-lisp" title="Permalink to this headline">¶</a></h2>
<div class="section" id="ad-1">
<h3><a class="toc-backref" href="#id35">Ad.1 メニューを作成する</a><a class="headerlink" href="#ad-1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>メニューは Lisp で定義されている。ユーザーがカスタマイズすることが可能。</li>
<li>メニューには、メニューバー (<tt class="docutils literal"><span class="pre">*app-menu*</span></tt>) とポップアップ (<tt class="docutils literal"><span class="pre">*app-popup-menu*</span></tt>) の二種類がある。</li>
<li>メニューは、xyzzy の起動時に作成されている。</li>
</ul>
<div class="section" id="id9">
<h4><a class="toc-backref" href="#id36">メニューの静的な作成</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><div class="highlight"><pre>(define-menu 項目1 ... 項目N)
(define-popup-menu 項目1 ... 項目N)
</pre></div>
</div>
<ul>
<li><p class="first">項目は次のどれかの式になる。</p>
<div class="highlight-python"><div class="highlight"><pre>:sep
:separator
(:sep タグ)
(:separator タグ)
(:item タグ 項目名)
(:item タグ 項目名 コマンド)
(:item タグ 項目名 コマンド 表示形式)
(:popup タグ 項目名 項目1 ... 項目N)
</pre></div>
</div>
<ul class="simple">
<li>タグがよくわからない。
<tt class="docutils literal"><span class="pre">nil</span></tt> でよいようだ。</li>
<li>項目名は文字列。</li>
<li>コマンドは選択時の処理を記述するわけだが、
&lt;対話的な関数を指定しないと、メニュー項目を選択した時点でエラーが発生する&gt; (p. 373)</li>
<li>表示形式はメニュー項目のグレーアウトの条件を決める。
<tt class="docutils literal"><span class="pre">:modified</span></tt>, <tt class="docutils literal"><span class="pre">:undo</span></tt>, <tt class="docutils literal"><span class="pre">:clipboard</span></tt> 等がある。</li>
<li><tt class="docutils literal"><span class="pre">$XYZZY/lisp/app-menu.l</span></tt> が参考になる。</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id10">
<h4><a class="toc-backref" href="#id37">メニューの動的な作成</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><div class="highlight"><pre>;;; メニューをゼロから作成する
(create-pop-menu) =&gt; メニューを作る
(create-popup-menu) =&gt; ポップアップメニューを作る

;;; メニューにセパレーターを入れるには次のいずれかを用いる
(add-menu-separator メニュー)
(add-menu-separator メニュー タグ)

;;; メニューアイテムの追加は次のいずれか
(add-menu-item メニュー タグ 項目名)
(add-menu-item メニュー タグ 項目名 コマンド)
(add-menu-item メニュー タグ 項目名 コマンド 表示形式)

;;; ポップアップメニューの追加はこれ
(add-popup-menu メニュー ポップアップメニュー 項目名)
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h4><a class="toc-backref" href="#id38">メニューの挿入</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">pipe-command</span></tt> と <tt class="docutils literal"><span class="pre">filter-buffer</span></tt> を呼び出す例は、いいヒントになりそう。</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>(insert-popup-menu *app-menu* 6 自作メニュー &quot;外部コマンド(&amp;O)&quot;)
</pre></div>
</div>
<ul class="simple">
<li>&lt;このように位置を直接指定してもよいのですが、
タグを指定したほうが他の拡張 Lisp との兼ね合い上安全です&gt; (p. 377)</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>;;; 修正後
(insert-popup-menu *app-menu*
  (get-menu-position *app-menu* &#39;ed::help)
  自作メニュー &quot;外部コマンド(&amp;O)&quot;)
</pre></div>
</div>
<ul>
<li><p class="first">&lt;<tt class="docutils literal"><span class="pre">use-local-menu</span></tt> を使うとバッファだけに有効なメニューバーを設定できます&gt; (p. 378)</p>
</li>
<li><p class="first">初期設定ファイルで <tt class="docutils literal"><span class="pre">*app-menu*</span></tt> を直接変更してはならない。
&lt;初期設定ファイルでメニューのカスタマイズを行う際には必ず次のように記述してください。
（略）メニューバーが画面から消えてしまう場合があります&gt; (p. 379)</p>
<div class="highlight-python"><div class="highlight"><pre>(add-hook &#39;*init-app-menus-hook* メニューのカスタマイズを記述)
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="ad-2">
<h3><a class="toc-backref" href="#id39">Ad.2 ツールバーを作成する</a><a class="headerlink" href="#ad-2" title="Permalink to this headline">¶</a></h3>
<p>普通の意味でのツールバーと、タブバーをまとめて説明している。</p>
</div>
<div class="section" id="ad-3">
<h3><a class="toc-backref" href="#id40">Ad.3 メジャーモードを作成する</a><a class="headerlink" href="#ad-3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>&lt;基本的にファイル名から拡張子をとったものをモジュール名とします。
モジュールを宣言すると、ロード済みモジュールを管理しているリスト
<tt class="docutils literal"><span class="pre">*modules*</span></tt> にモジュール名が追加されます&gt; (p. 391)</li>
<li>&lt;<tt class="docutils literal"><span class="pre">*scratch*</span></tt> などのバッファで評価する場合には <tt class="docutils literal"><span class="pre">user</span></tt> パッケージが選択されています&gt; (p. 391)</li>
<li>&lt;キーワードファイルは <tt class="docutils literal"><span class="pre">*keyword-load-path*</span></tt> から検索されます&gt; (p. 393)</li>
<li>シンタックステーブルとは、&lt;文字の構文上の扱いの違いを表現する&gt; (p. 394) もの。
構文クラスという考え方があり、空白文字、シンボル構成文字、コメント開始・終了文字などがある。<ul>
<li>&lt;正規表現で検索する場合には、単語の開始位置、
シンボルの開始位置はシンタックステーブルを参照して判断されます&gt; (p. 395)</li>
</ul>
</li>
<li><tt class="docutils literal"><span class="pre">mode-specific-なんとか</span></tt> 変数群は面白そうだ。</li>
</ul>
</div>
</div>
<div class="section" id="b">
<h2><a class="toc-backref" href="#id41">B その他の情報</a><a class="headerlink" href="#b" title="Permalink to this headline">¶</a></h2>
<div class="section" id="b-1-faq">
<h3><a class="toc-backref" href="#id42">B.1 FAQ</a><a class="headerlink" href="#b-1-faq" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">C-q</span> <span class="pre">TAB</span></tt> (<tt class="docutils literal"><span class="pre">M-x</span> <span class="pre">quote-char</span></tt>) で、どんなときでもタブ文字をキャレット位置に挿入できる。</li>
<li>フック関数にて、仕込んであるキーバインドを <tt class="docutils literal"><span class="pre">undefine-key</span></tt> 関数で削除できる。</li>
<li>USB メモリ上で使用するやり方。今ならもうちょっといい方法がありそう。</li>
</ul>
<div class="section" id="emacs">
<h4><a class="toc-backref" href="#id43">Emacs 風設定</a><a class="headerlink" href="#emacs" title="Permalink to this headline">¶</a></h4>
<p>個人的に必須だと判断したものを抜書きしておく。</p>
<div class="highlight-python"><div class="highlight"><pre>;;; pp. 410-412

;;; インクリメンタルサーチ
;;; C-s でダイアログが出なくなる
(require &quot;isearch&quot;)

;;; M-% を確認アリ置換にする
(define-key esc-map #\% &#39;query-replace)
(define-key esc-map #\C-% &#39;query-replace-regexp)

;;; C 言語系編集時にはこれがないと話にならない
(define-key esc-map #\C-\\ &#39;indent-region)

;;; 矩形処理各種のうち、次の三つはキーバインド必須
(define-key ctl-x-map &#39;(#\r #\k) &#39;kill-rectangle)
(define-key ctl-x-map &#39;(#\r #\t) &#39;string-rectangle)
(define-key ctl-x-map &#39;(#\r #\y) &#39;yank-rectangle)

;;; M-/ で動的補完
(require &quot;dabbrev&quot;)
(define-key esc-map #\/ &#39;dabbrev-expand)
</pre></div>
</div>
</div>
</div>
<div class="section" id="b-4">
<h3><a class="toc-backref" href="#id44">B.4 共通設定ダイアログ</a><a class="headerlink" href="#b-4" title="Permalink to this headline">¶</a></h3>
<p>確認したい項目だけノート。</p>
<ul class="simple">
<li>フォントタブ<ul>
<li>フォント (Terminal)</li>
<li>サイズ (10)</li>
<li>をバックスラッシュに変換 (ON)</li>
</ul>
</li>
<li>表示タブ<ul>
<li>表示する？<ul>
<li>改行 (ON)</li>
<li>TAB (ON)</li>
<li>全角スペース (ON)</li>
<li>行番号 (ON)</li>
<li>EOF (ON)</li>
<li>ルーラ (ON)</li>
</ul>
</li>
<li>テキストの折り返し (OFF)</li>
<li>タブの幅 (4)</li>
<li>キャレットを点滅 (OFF)</li>
<li>タブバーを横書きにする (ON)</li>
</ul>
</li>
<li>バックアップファイルタブ<ul>
<li>バックアップファイルをつくる (OFF)</li>
</ul>
</li>
<li>自動セーブタブ<ul>
<li>自動セーブする (OFF)</li>
</ul>
</li>
<li>さまざま<ul>
<li>音を鳴らす系のオプションを無効にする。</li>
<li>ウィンドウの位置・サイズに関するオプションを有効にする。</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="b-5">
<h3><a class="toc-backref" href="#id45">B.5 ローカル設定ダイアログ</a><a class="headerlink" href="#b-5" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>&lt;ローカル設定は共通設定よりも優先され、現在のバッファのみに適用されます&gt;
(p. 436)</li>
</ul>
</div>
<div class="section" id="b-6">
<h3><a class="toc-backref" href="#id46">B.6 正規表現</a><a class="headerlink" href="#b-6" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>日本語が扱える</li>
<li><tt class="docutils literal"><span class="pre">()|{}</span></tt> は通常の文字として扱われる。エスケープが必要。</li>
<li>文字クラスや等価クラスといったものには対応していない。</li>
<li>メタキャラクター<ul>
<li><tt class="docutils literal"><span class="pre">\s</span></tt>, <tt class="docutils literal"><span class="pre">\S</span></tt> は構文クラス文字マッチ。</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="b-8">
<h3><a class="toc-backref" href="#id47">B.8 標準キーバインド一覧</a><a class="headerlink" href="#b-8" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>「標準のまま利用するもの」「別のキーバインドに置き換えるもの」「無効化するもの」に分類して整理したい。<ul>
<li>Emacs と同じ意味を持つキーバインドは「標準のまま利用」する。</li>
<li>Emacs と違う意味を持つものは、Emacs 風にキーバインドを定義しなおす。</li>
<li>自分が絶対に利用しないコマンドのキーバインドは、すべて <tt class="docutils literal"><span class="pre">undefine-key</span></tt> する。</li>
</ul>
</li>
</ul>
</div>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="index.html">読書ノート v1.4.0dev</a> &raquo;</li>
          <li><a href="yamamoto05.html" >入門 xyzzy 読書ノート</a> &raquo;</li> 
      </ul>
    </div>
    <div id="footer">
      <div id="footer_logo">
        <a class="imga" href="https://showa-yojyo.github.io/" title="プレハブ小屋 Since 1999"><img src="_static/logos.png" width="88" height="31" /></a>
      </div>
      <div id="footer_share">
        <a href="https://twitter.com/share" class="twitter-share-button" data-size="large">Tweet</a>
        <script type="text/javascript">render_twitter_button(document, 'script', 'twitter-wjs')</script>
      </div>
      <div id="footer_copyright">
        Since 1999<br />
        Copyright &copy; 1999-2014, プレハブ小屋 All rights reserved.
      </div>
      <div id="footer_spacer">
        <p>
          Last updated at 2014/11/29 (Sat) 02:35:26.
        </p>
      </div>
    </div>
  </body>
</html>