<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Python Twitter Tools 利用ノート &mdash; 読書ノート v1.2.0</title>
    
    <link rel="stylesheet" href="_static/prefab.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/twitter-button.js"></script>
    <link rel="top" title="読書ノート v1.2.0" href="index.html" />
    <link rel="next" title="PyOpenGL 3.x 利用ノート" href="python-pyopengl.html" />
    <link rel="prev" title="Pygments 利用ノート" href="python-pygments.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="index.html">読書ノート v1.2.0</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body">
            
  <div class="section" id="python-twitter-tools">
<h1><a class="toc-backref" href="#id22">Python Twitter Tools 利用ノート</a><a class="headerlink" href="#python-twitter-tools" title="Permalink to this headline">¶</a></h1>
<p>Twitter をたしなむ Python プログラマーならば、Twitter API を Python で操ろうと考えるのは当然なことだ。
ここでは Mike Verdone 氏開発による <a class="reference external" href="http://mike.verdone.ca/twitter/">Python Twitter Tools</a> (hereafter PTT) パッケージを利用した Twitter 操作を色々と見ていく。</p>
<div class="contents topic" id="id1">
<p class="topic-title first">ノート目次</p>
<ul class="simple">
<li><a class="reference internal" href="#python-twitter-tools" id="id22">Python Twitter Tools 利用ノート</a><ul>
<li><a class="reference internal" href="#id2" id="id23">関連リンク</a></li>
<li><a class="reference internal" href="#id3" id="id24">前準備</a><ul>
<li><a class="reference internal" href="#id4" id="id25">インストール</a></li>
<li><a class="reference internal" href="#id5" id="id26">ドキュメント</a></li>
<li><a class="reference internal" href="#id6" id="id27">認証トークン入手</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id7" id="id28">コード例</a><ul>
<li><a class="reference internal" href="#id8" id="id29">共通処理コード</a></li>
<li><a class="reference internal" href="#id9" id="id30">ページング処理</a><ul>
<li><a class="reference internal" href="#id10" id="id31">ツイート日時の新しいものから、順次古い方向へ取得していくケース</a></li>
<li><a class="reference internal" href="#id11" id="id32">取得済みのツイートの「上」に、最新のツイートを取得するケース</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id12" id="id33">カーソル処理</a></li>
<li><a class="reference internal" href="#id13" id="id34">タイムライン関連</a><ul>
<li><a class="reference internal" href="#get-statuses-mentions-timeline" id="id35">GET statuses/mentions_timeline</a></li>
<li><a class="reference internal" href="#get-statuses-user-timeline" id="id36">GET statuses/user_timeline</a></li>
<li><a class="reference internal" href="#get-statuses-home-timeline" id="id37">GET statuses/home_timeline</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id14" id="id38">ツイート関連</a><ul>
<li><a class="reference internal" href="#post-statuses-update" id="id39">POST statuses/update</a></li>
<li><a class="reference internal" href="#post-statuses-update-with-media" id="id40">POST statuses/update_with_media</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id15" id="id41">検索関連</a><ul>
<li><a class="reference internal" href="#get-search-tweets" id="id42">GET search/tweets</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id16" id="id43">フォロワー関連</a><ul>
<li><a class="reference internal" href="#get-friends-list" id="id44">GET friends/list</a></li>
<li><a class="reference internal" href="#get-followers-list" id="id45">GET followers/list</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id17" id="id46">ユーザーアカウント関連</a><ul>
<li><a class="reference internal" href="#get-users-show" id="id47">GET users/show</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id18" id="id48">お気に入り関連</a><ul>
<li><a class="reference internal" href="#get-favorites-list" id="id49">GET favorites/list</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id19" id="id50">リスト関連</a><ul>
<li><a class="reference internal" href="#get-lists-list" id="id51">GET lists/list</a></li>
<li><a class="reference internal" href="#get-lists-statuses" id="id52">GET lists/statuses</a></li>
<li><a class="reference internal" href="#post-lists-members-destroy" id="id53">POST lists/members/destroy</a></li>
<li><a class="reference internal" href="#get-lists-memberships" id="id54">GET lists/memberships</a></li>
<li><a class="reference internal" href="#post-lists-members-create-all" id="id55">POST lists/members/create_all</a></li>
<li><a class="reference internal" href="#get-lists-members-show" id="id56">GET lists/members/show</a></li>
<li><a class="reference internal" href="#get-lists-members" id="id57">GET lists/members</a></li>
<li><a class="reference internal" href="#post-lists-members-create" id="id58">POST lists/members/create</a></li>
<li><a class="reference internal" href="#post-lists-destroy" id="id59">POST lists/destroy</a></li>
<li><a class="reference internal" href="#post-lists-create" id="id60">POST lists/create</a></li>
<li><a class="reference internal" href="#get-lists-ownerships" id="id61">GET lists/ownerships</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id20" id="id62">検索履歴関連</a><ul>
<li><a class="reference internal" href="#get-saved-searches-list" id="id63">GET saved_searches/list</a></li>
<li><a class="reference internal" href="#get-saved-searches-create" id="id64">GET saved_searches/create</a></li>
</ul>
</li>
<li><a class="reference internal" href="#twitterstream" id="id65">TwitterStream</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>OS<ul>
<li>Windows XP Home Edition SP 3</li>
<li>Windows 7 Home Premium SP 1</li>
</ul>
</li>
<li>本稿において、利用した各パッケージのバージョンは次のとおり。<ul>
<li><a class="reference external" href="http://www.python.org/">Python</a>: 2.6.6, 2.7.3, 3.4.1</li>
<li><a class="reference external" href="http://mike.verdone.ca/twitter/">Python Twitter Tools</a>: 1.7.2, 1.8.0, 1.9.0, 1.14.3</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id23">関連リンク</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt><a class="reference external" href="http://mike.verdone.ca/twitter/">Python Twitter Tools</a></dt>
<dd>著者ウェブページ。開発ページは別にある。</dd>
<dt><a class="reference external" href="https://dev.twitter.com/docs/api/1.1">REST API v1.1 Resources</a></dt>
<dd>Twitter 本家ドキュメント。</dd>
</dl>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id24">前準備</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id25">インストール</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>PTT のインストールはいつものように pip で構わない。</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> pip install twitter
</pre></div>
</div>
<p>本パッケージ配布版には単体テストコードのようなものはない。
インストールが無事に終わったことを知りたいのならば、
<tt class="docutils literal"><span class="pre">import</span> <span class="pre">twitter</span></tt> の確認で我慢する。</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> python34 -c <span class="s1">&#39;import twitter; help(twitter)&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3><a class="toc-backref" href="#id26">ドキュメント</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>PTT のドキュメントよりも重要なのは Twitter API 自身のドキュメントであるので、
<a class="reference external" href="https://dev.twitter.com/docs/api/1.1">REST API v1.1 Resources</a> 等のウェブページを見ながら Python コードを書くことになる。</p>
</div>
<div class="section" id="id6">
<h3><a class="toc-backref" href="#id27">認証トークン入手</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Twitter API は OAuth という認証を利用している。
このため、API key および API secret と呼ばれる文字列が必要となる。
API v1.0 では一部 GET 系は認証なしで利用できる API もあったが、v1.1 からはすべての API で要認証となった。<ul>
<li>これらの文字列を入手するには、
<a class="reference external" href="https://dev.twitter.com/apps">https://dev.twitter.com/apps</a> 以降のページ群であらかじめ手続きを済ませる。<ul>
<li>ウェブブラウザーと Twitter アカウントを持っていることが必要である。</li>
<li>Create an application というページに入力フォームがある。
入力後、画面下部のボタンを押せば多分出てくるだろう。</li>
</ul>
</li>
</ul>
</li>
<li>次に Access token および Access token secret という、別の一対の文字列が必要だ。<ul>
<li>これらの文字列を得るために、先ほどの文字列が必要となる。</li>
<li>Google で <tt class="docutils literal"><span class="pre">get_access_token</span></tt> 等検索してヒットする、
ネットに落ちているスクリプトを一部改変して実行する。
コードを見れば手を入れる箇所は理解できるハズ。</li>
</ul>
</li>
<li>上記 4 つの文字列を入手できて初めて Twitter API v1.1 が利用可能となる。</li>
</ul>
</div>
</div>
<div class="section" id="id7">
<h2><a class="toc-backref" href="#id28">コード例</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p>以下、個人的に動作確認が取れた状況でのコードのみをノートしておく。
細かい説明を重ねるよりは、動作したコードを淡々と列挙して、
見返したときにすぐに思い出せるようにする。</p>
<div class="section" id="id8">
<h3><a class="toc-backref" href="#id29">共通処理コード</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>PTT を利用するプログラムに共通して書く必要のあるコードは次のようなものである。
認証と Twitter 本体とのインターフェイスとなるインスタンスのセットアップからなる。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c"># PTT 利用プログラムに共通して書くことになる処理</span>
<span class="kn">from</span> <span class="nn">twitter</span> <span class="k">import</span> <span class="o">*</span>

<span class="c"># Comment 1</span>
<span class="n">CONSUMER_KEY</span> <span class="o">=</span> <span class="s">&#39;**********************&#39;</span>  <span class="c"># API key</span>
<span class="n">CONSUMER_SECRET</span> <span class="o">=</span> <span class="s">&#39;******************************************&#39;</span> <span class="c"># API secret; 人に見せてはいけない。</span>

<span class="c"># Comment 2</span>
<span class="n">MY_TWITTER_CREDS</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">&#39;~/.my_app_credentials&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">MY_TWITTER_CREDS</span><span class="p">):</span>
    <span class="n">oauth_dance</span><span class="p">(</span><span class="s">&quot;My App Name&quot;</span><span class="p">,</span> <span class="n">CONSUMER_KEY</span><span class="p">,</span> <span class="n">CONSUMER_SECRET</span><span class="p">,</span> <span class="n">MY_TWITTER_CREDS</span><span class="p">)</span>

<span class="n">oauth_token</span><span class="p">,</span> <span class="n">oauth_secret</span> <span class="o">=</span> <span class="n">read_token_file</span><span class="p">(</span><span class="n">MY_TWITTER_CREDS</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Twitter</span><span class="p">(</span><span class="n">auth</span><span class="o">=</span><span class="n">OAuth</span><span class="p">(</span>
    <span class="n">oauth_token</span><span class="p">,</span> <span class="n">oauth_secret</span><span class="p">,</span> <span class="n">CONSUMER_KEY</span><span class="p">,</span> <span class="n">CONSUMER_SECRET</span><span class="p">))</span>

<span class="c"># ... t を介した Twitter 操作コード ...</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Comment 1</dt>
<dd>Twitter の開発者ページで入手した、実際の API key と API secret の文字列をそれぞれに定義する。
ここでは説明用にハードコードしている。</dd>
<dt>Comment 2</dt>
<dd>唐突に <tt class="file docutils literal"><span class="pre">$HOME/.my_app_credentials</span></tt> なるファイルが登場する。
このファイルは内容が Access token と Access token secret の実際の文字列 2 行からなる設定ファイルである。
この設定ファイルは一度だけ自分で用意すればよい。</dd>
</dl>
<p>さて、使い捨てのスクリプトで毎回上のようなコードをコピーアンドペーストするのはプログラマーの美学に反する。
そこで、一連の手順をモジュール化して <tt class="docutils literal"><span class="pre">PYTHONPATH</span></tt> のパスリストのどこかに安置しておくことを勧める。
私の例を示す。</p>
<ol class="arabic">
<li><p class="first">まず、下記コードを <tt class="file docutils literal"><span class="pre">secret.py</span></tt> として <tt class="file docutils literal"><span class="pre">$HOME/my-python-modules</span></tt> 保存する。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">twitter</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">CONSUMER_KEY</span> <span class="o">=</span> <span class="s">&#39;**********************&#39;</span>
<span class="n">CONSUMER_SECRET</span> <span class="o">=</span> <span class="s">&#39;******************************************&#39;</span>
<span class="n">USER_KEY</span> <span class="o">=</span> <span class="s">&#39;*********-****************************************&#39;</span>
<span class="n">USER_SECRET</span> <span class="o">=</span> <span class="s">&#39;*****************************************&#39;</span>

<span class="n">MY_TWITTER_CREDS</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">&#39;~/.my_app_credentials&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">twitter_instance</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Setup an instance of class Twitter.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">MY_TWITTER_CREDS</span><span class="p">):</span>
        <span class="n">oauth_dance</span><span class="p">(</span><span class="s">&quot;My App Name&quot;</span><span class="p">,</span> <span class="n">CONSUMER_KEY</span><span class="p">,</span> <span class="n">CONSUMER_SECRET</span><span class="p">,</span> <span class="n">MY_TWITTER_CREDS</span><span class="p">)</span>

    <span class="n">oauth_token</span><span class="p">,</span> <span class="n">oauth_secret</span> <span class="o">=</span> <span class="n">read_token_file</span><span class="p">(</span><span class="n">MY_TWITTER_CREDS</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Twitter</span><span class="p">(</span><span class="n">auth</span><span class="o">=</span><span class="n">OAuth</span><span class="p">(</span>
        <span class="n">oauth_token</span><span class="p">,</span> <span class="n">oauth_secret</span><span class="p">,</span> <span class="n">CONSUMER_KEY</span><span class="p">,</span> <span class="n">CONSUMER_SECRET</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p class="first">Windows のユーザー環境変数設定で <tt class="docutils literal"><span class="pre">PYTHONPATH</span></tt> の値に <tt class="docutils literal"><span class="pre">%%HOME%%\my-python-modules</span></tt> を含める。</p>
</li>
<li><p class="first">PTT を利用する使い捨てのスクリプトの構造を次のようにする。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">secret</span> <span class="k">import</span> <span class="n">twitter_instance</span>

<span class="n">tw</span> <span class="o">=</span> <span class="n">twitter_instance</span><span class="p">()</span>
<span class="o">...</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="id9">
<h3><a class="toc-backref" href="#id30">ページング処理</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>ここからは PTT のメソッドを利用して Twitter の自分のアカウントを対象とするの操作を試していく。
本稿のサンプルコードは前述の共通処理をカットしているので、読者は注意して欲しい。</p>
<p>さっそくタイムラインの取得処理から見ていこう。
まずは、コードを書く前に Twitter 本家ドキュメントの <a class="reference external" href="https://dev.twitter.com/docs/working-with-timelines">Working with Timelines</a> を一読して、
API がツイートのデータ構造をどのように定義しているのかをおおまかに理解しておこう。</p>
<p>特徴的なのは、 <tt class="docutils literal"><span class="pre">statuses/user_timeline</span></tt> や <tt class="docutils literal"><span class="pre">lists/statuses</span></tt> 等の「大量のツイートを返す」ような API を利用する場合には、
一度のリクエストでデータを一括取得するのではなく、リクエストを複数回に分けて行い、
その際に <tt class="docutils literal"><span class="pre">max_id</span></tt> や <tt class="docutils literal"><span class="pre">since_id</span></tt> 引数を適宜指定して利用するという技法が一般的らしいということが理解できる。
パターンとしては次の二通りしかないので、レスポンスの処理技法を習得するのは容易い。</p>
<div class="section" id="id10">
<h4><a class="toc-backref" href="#id31">ツイート日時の新しいものから、順次古い方向へ取得していくケース</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<p>一般的な Twitter クライアントでは、タイムラインはツイートが上から下に新しい順に並んでいる。
この画面を下方向にスクロールしたときに、より古いツイートを動的にリクエストするようになっている。
実質的には次に説明するようなことを行なっているハズだ。</p>
<ul class="simple">
<li>初回リクエスト。レスポンス中のツイート群の <tt class="docutils literal"><span class="pre">id</span></tt> の最小値をプログラム側で記憶する。</li>
<li>次回リクエスト。このとき引数の <tt class="docutils literal"><span class="pre">max_id</span></tt> を明示的に指示する。</li>
</ul>
<p>コードを示す。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">screen_name</span><span class="o">=</span><span class="s">&#39;showa_yojyo&#39;</span><span class="p">,</span>
    <span class="n">count</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">page</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">include_entities</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">include_rts</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">exclude_replies</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">tw</span><span class="o">.</span><span class="n">statuses</span><span class="o">.</span><span class="n">user_timeline</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="c"># ... response を処理 ...</span>

<span class="n">min_id</span> <span class="o">=</span> <span class="k">None</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
    <span class="n">min_id</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">]</span>

<span class="c"># 2 回目のリクエスト</span>
<span class="k">if</span> <span class="n">min_id</span><span class="p">:</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;max_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_id</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">statuses</span><span class="o">.</span><span class="n">user_timeline</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="c"># ... response を処理 ...</span>
</pre></div>
</div>
<p>レスポンス中のツイートは <tt class="docutils literal"><span class="pre">id</span></tt> という値を保持しており、
ツイートは <tt class="docutils literal"><span class="pre">id</span></tt> が降順になるように配列された状態で戻ってきている（と思う）。
その事実を利用すれば <tt class="docutils literal"><span class="pre">id</span></tt> の最大・最小が得られる。
配列の先頭ツイートの <tt class="docutils literal"><span class="pre">id</span></tt> が最大であり、
末尾ツイートのそれが最小であるはずだ。</p>
<p>3 回目以降のリクエストも同様に繰り返す。</p>
</div>
<div class="section" id="id11">
<h4><a class="toc-backref" href="#id32">取得済みのツイートの「上」に、最新のツイートを取得するケース</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<p>一般的な Twitter クライアントでは、ビューにタイマーが仕込んであり、
例えば 60 秒毎に最新のツイートをリクエストしてタイムラインを更新するものが多い。</p>
<p>おそらく、次のようなアルゴリズムを実行している。</p>
<ul class="simple">
<li>初回リクエスト。レスポンス中のツイート群の <tt class="docutils literal"><span class="pre">id</span></tt> の最大値をプログラム側で記憶する。</li>
<li>次回リクエスト。このとき引数の <tt class="docutils literal"><span class="pre">since_id</span></tt> を明示的に指示する。</li>
</ul>
<p>前項コードとの差分だけを示そう。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c"># 最大 id の記憶</span>
<span class="n">max_id</span> <span class="o">=</span> <span class="k">None</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
    <span class="n">max_id</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># 2 回目のリクエスト</span>
<span class="k">if</span> <span class="n">max_id</span><span class="p">:</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;since_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_id</span>
</pre></div>
</div>
<p>なお、実際に Twitter アプリケーションを作成するのであれば、
本項と前項の処理を同時に実装するのが効率的だし自然だ。</p>
</div>
</div>
<div class="section" id="id12">
<h3><a class="toc-backref" href="#id33">カーソル処理</a><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">cursor</span></tt> という名前の optional 引数がある API については、
次のような手順でページング処理と同等のことを実現する。</p>
<ul>
<li><p class="first">初回取得では <tt class="docutils literal"><span class="pre">cursor</span></tt> 引数を <tt class="docutils literal"><span class="pre">-1</span></tt> に指示すること。</p>
</li>
<li><p class="first">二回目以降取得では、
<tt class="docutils literal"><span class="pre">cursor</span></tt> の値として前回レスポンス中の <tt class="docutils literal"><span class="pre">next_cursor</span></tt> または
<tt class="docutils literal"><span class="pre">previous_cursor</span></tt> を指示する。</p>
<p>その際、値がゼロでないことを確認する必要がある。
ゼロは取得するべきデータは Twitter に存在しないということを示唆している。</p>
</li>
</ul>
</div>
<div class="section" id="id13">
<h3><a class="toc-backref" href="#id34">タイムライン関連</a><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<div class="section" id="get-statuses-mentions-timeline">
<h4><a class="toc-backref" href="#id35">GET statuses/mentions_timeline</a><a class="headerlink" href="#get-statuses-mentions-timeline" title="Permalink to this headline">¶</a></h4>
<p>いわゆるリプを取得する例を挙げる。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># GET statuses/mentions_timeline</span>
<span class="c"># See https://dev.twitter.com/docs/api/1.1/get/statuses/mentions_timeline</span>

<span class="kn">from</span> <span class="nn">secret</span> <span class="k">import</span> <span class="n">twitter_instance</span>

<span class="n">tw</span> <span class="o">=</span> <span class="n">twitter_instance</span><span class="p">()</span>

<span class="c"># Comment 1</span>
<span class="n">statuses</span> <span class="o">=</span> <span class="n">tw</span><span class="o">.</span><span class="n">statuses</span><span class="o">.</span><span class="n">mentions_timeline</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">include_entities</span><span class="o">=</span><span class="s">&#39;true&#39;</span><span class="p">)</span>

<span class="c"># Comment 2</span>
<span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">statuses</span><span class="p">:</span>
    <span class="n">entities</span> <span class="o">=</span> <span class="n">stat</span><span class="p">[</span><span class="s">&#39;entities&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s">&#39;{created_at} {text}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">entities</span><span class="p">))</span>
</pre></div>
</div>
<ul>
<li><p class="first">Comment 1: 認証ユーザーに関する mentions を最新のものから 50 件取得する。</p>
<p><a class="reference external" href="https://dev.twitter.com/docs/api/1.1/get/statuses/mentions_timeline">https://dev.twitter.com/docs/api/1.1/get/statuses/mentions_timeline</a> 参照。</p>
</li>
<li><p class="first">Comment 2: ここでは mention の日時とツイート本文を新しい順にコンソールに出力している。</p>
</li>
</ul>
</div>
<div class="section" id="get-statuses-user-timeline">
<h4><a class="toc-backref" href="#id36">GET statuses/user_timeline</a><a class="headerlink" href="#get-statuses-user-timeline" title="Permalink to this headline">¶</a></h4>
<p>ユーザー名を指定してタイムラインを 40 件取得し、
ツイート時刻と投稿内容をコンソールに出力するコードである。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># GET statuses/mentions_timeline</span>
<span class="c"># See https://dev.twitter.com/docs/api/1.1/get/statuses/mentions_timeline</span>

<span class="kn">from</span> <span class="nn">secret</span> <span class="k">import</span> <span class="n">twitter_instance</span>

<span class="n">tw</span> <span class="o">=</span> <span class="n">twitter_instance</span><span class="p">()</span>

<span class="c"># Comment 1</span>
<span class="n">statuses</span> <span class="o">=</span> <span class="n">tw</span><span class="o">.</span><span class="n">statuses</span><span class="o">.</span><span class="n">mentions_timeline</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">include_entities</span><span class="o">=</span><span class="s">&#39;true&#39;</span><span class="p">)</span>

<span class="c"># Comment 2</span>
<span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">statuses</span><span class="p">:</span>
    <span class="n">entities</span> <span class="o">=</span> <span class="n">stat</span><span class="p">[</span><span class="s">&#39;entities&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s">&#39;{created_at} {text}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">entities</span><span class="p">))</span>
</pre></div>
</div>
<p>引数仕様は <a class="reference external" href="https://dev.twitter.com/docs/api/1.1/get/statuses/user_timeline">https://dev.twitter.com/docs/api/1.1/get/statuses/user_timeline</a> を参照。</p>
<p>ちなみに、ドキュメント上は <tt class="docutils literal"><span class="pre">screen_name</span></tt> か <tt class="docutils literal"><span class="pre">user_id</span></tt> が
optional パラメーターとなっている API について注意が必要だ。
むしろ「そのうちのどちらかが required パラメーターである」という意味だろう。</p>
</div>
<div class="section" id="get-statuses-home-timeline">
<h4><a class="toc-backref" href="#id37">GET statuses/home_timeline</a><a class="headerlink" href="#get-statuses-home-timeline" title="Permalink to this headline">¶</a></h4>
<p>ユーザーのタイムラインを取得する例を示す。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># GET statuses/home_timeline</span>
<span class="c"># See https://dev.twitter.com/docs/api/1.1/get/statuses/home_timeline</span>

<span class="kn">from</span> <span class="nn">secret</span> <span class="k">import</span> <span class="n">twitter_instance</span>

<span class="n">tw</span> <span class="o">=</span> <span class="n">twitter_instance</span><span class="p">()</span>

<span class="n">statuses</span> <span class="o">=</span> <span class="n">tw</span><span class="o">.</span><span class="n">statuses</span><span class="o">.</span><span class="n">home_timeline</span><span class="p">(</span>
    <span class="n">count</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">include_rts</span><span class="o">=</span><span class="s">&#39;true&#39;</span><span class="p">,</span>
    <span class="n">include_entities</span><span class="o">=</span><span class="s">&#39;true&#39;</span><span class="p">,</span>
    <span class="n">exclude_replies</span><span class="o">=</span><span class="s">&#39;false&#39;</span><span class="p">,)</span>

<span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">statuses</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s">&#39;{created_at} {text}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">stat</span><span class="p">))</span>
</pre></div>
</div>
<ul>
<li><p class="first">Comment 1: 自作モジュールのメソッドを呼び出している。前述のとおり。</p>
</li>
<li><p class="first">Comment 2: 認証ユーザーのタイムラインを最新のものから 10 件取得する。
主に自分のツイート、フォローしているユーザーのツイート、返信各種からなるものと思われる。</p>
<p>キーワード引数の意味や、戻り値のデータ構造については
<a class="reference external" href="https://dev.twitter.com/docs/api/1.1/get/statuses/home_timeline">https://dev.twitter.com/docs/api/1.1/get/statuses/home_timeline</a> 参照。</p>
</li>
<li><p class="first">Comment 3: ツイートの日時と本文を新しい順にコンソールに出力している。</p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">Python 3.4 に移行した直後に起動したら、コンソール上のテキストが文字化けして読めなかった。
結局、環境変数 PYTHONIOENCODING を新規設定して、値を utf-8 と定義したら正常に読めるようになった。</p>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="id14">
<h3><a class="toc-backref" href="#id38">ツイート関連</a><a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<div class="section" id="post-statuses-update">
<h4><a class="toc-backref" href="#id39">POST statuses/update</a><a class="headerlink" href="#post-statuses-update" title="Permalink to this headline">¶</a></h4>
<p>スクリプト等からツイートするときには本 API を使用することになる。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># Demonstration POST statuses/update</span>
<span class="c"># See https://dev.twitter.com/docs/api/1.1/post/statuses/update</span>

<span class="kn">from</span> <span class="nn">secret</span> <span class="k">import</span> <span class="n">twitter_instance</span>

<span class="n">tw</span> <span class="o">=</span> <span class="n">twitter_instance</span><span class="p">()</span>

<span class="c"># Comment 1</span>
<span class="n">mytext</span> <span class="o">=</span> <span class="s">&#39;PTT を利用したツイートのデモ。明示的 URL エンコード処理なし&#39;</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mytext</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">140</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s">&#39;mytext exceeds 140 characters.&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c"># Comment 2</span>
        <span class="n">tw</span><span class="o">.</span><span class="n">statuses</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">mytext</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">twitter</span><span class="o">.</span><span class="n">TwitterHTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
<ul>
<li><p class="first">Comment 1: tweet 内容を文字列として定義してみる。</p>
</li>
<li><p class="first">Comment 2: 関数 <tt class="docutils literal"><span class="pre">statuses.update</span></tt> をキーワード引数 <tt class="docutils literal"><span class="pre">status</span></tt> を指示して呼び出す。</p>
<p><a class="reference external" href="https://dev.twitter.com/docs/api/1.1/post/statuses/update">https://dev.twitter.com/docs/api/1.1/post/statuses/update</a> 参照。</p>
</li>
</ul>
</div>
<div class="section" id="post-statuses-update-with-media">
<h4><a class="toc-backref" href="#id40">POST statuses/update_with_media</a><a class="headerlink" href="#post-statuses-update-with-media" title="Permalink to this headline">¶</a></h4>
<p>稼働実績なし。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># Demonstration POST statuses/update_with_media</span>
<span class="c"># See https://dev.twitter.com/docs/api/1.1/post/statuses/update_with_media</span>

<span class="kn">from</span> <span class="nn">secret</span> <span class="k">import</span> <span class="n">twitter_instance</span>
<span class="kn">import</span> <span class="nn">base64</span>

<span class="n">tw</span> <span class="o">=</span> <span class="n">twitter_instance</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;illvelo.png&quot;</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">imagefile</span><span class="p">:</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;status&quot;</span><span class="p">:</span><span class="s">&quot;Test uploading an image file by using Python Twitter Tools.&quot;</span><span class="p">,</span>
        <span class="s">&quot;media[]&quot;</span><span class="p">:</span><span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">imagefile</span><span class="o">.</span><span class="n">read</span><span class="p">()),</span> <span class="s">&quot;_base64&quot;</span><span class="p">:</span><span class="k">True</span><span class="p">,</span>
        <span class="c">#&quot;media[]&quot;:imagefile.read(),</span>
        <span class="p">}</span>
    <span class="n">tw</span><span class="o">.</span><span class="n">statuses</span><span class="o">.</span><span class="n">update_with_media</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id15">
<h3><a class="toc-backref" href="#id41">検索関連</a><a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<div class="section" id="get-search-tweets">
<h4><a class="toc-backref" href="#id42">GET search/tweets</a><a class="headerlink" href="#get-search-tweets" title="Permalink to this headline">¶</a></h4>
<p>単純な検索を行うには <tt class="docutils literal"><span class="pre">search/tweets</span></tt> を利用する。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># Demonstration GET search/tweets</span>
<span class="c"># See https://dev.twitter.com/docs/api/1.1/get/search/tweets</span>

<span class="kn">from</span> <span class="nn">secret</span> <span class="k">import</span> <span class="n">twitter_instance</span>

<span class="n">tw</span> <span class="o">=</span> <span class="n">twitter_instance</span><span class="p">()</span>

<span class="c"># Comment 1</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">tw</span><span class="o">.</span><span class="n">search</span><span class="o">.</span><span class="n">tweets</span><span class="p">(</span>
    <span class="n">q</span><span class="o">=</span><span class="s">&#39;ネシカ OR nesica&#39;</span><span class="p">,</span>
    <span class="n">rpp</span><span class="o">=</span><span class="mi">33</span><span class="p">)</span>

<span class="c"># Comment 2</span>
<span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s">&#39;statuses&#39;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s">&#39;{created_at} {user[screen_name]} {text}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">result</span><span class="p">))</span>
</pre></div>
</div>
<ul>
<li><p class="first">Comment 1: <tt class="docutils literal"><span class="pre">ネシカ</span></tt> または <tt class="docutils literal"><span class="pre">nesica</span></tt> という単語を含むツイートを
33 件検索させようとしている（厳密には不正確なやり方だが）。</p>
<p>検索したい単語等をメソッド <tt class="docutils literal"><span class="pre">search.tweets</span></tt> に与える。
キーワード引数の指定方法にコツがあるようだが、詳しくは
<a class="reference external" href="https://dev.twitter.com/docs/api/1.1/get/search/tweets">https://dev.twitter.com/docs/api/1.1/get/search/tweets</a> 参照。</p>
</li>
<li><p class="first">Comment 2: 検索結果の本体は、関数戻り値からこのように得られる。
この例ではツイートのタイムスタンプ、ユーザー名、本文だけをコンソールに出力する。</p>
<ul class="simple">
<li>日付は標準時 (<tt class="docutils literal"><span class="pre">+0000</span></tt>) で得られる？</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="id16">
<h3><a class="toc-backref" href="#id43">フォロワー関連</a><a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<div class="section" id="get-friends-list">
<h4><a class="toc-backref" href="#id44">GET friends/list</a><a class="headerlink" href="#get-friends-list" title="Permalink to this headline">¶</a></h4>
<p>特定のユーザーがフォローしている全ユーザーの情報を得るのには GET friends/list を利用できる。
一度のリクエストでは返しきれないほどの多数のユーザーをフォローしていることを想定してのカーソル処理となる。
次に示すコード例のように、1 ページずつデータをリクエストすることになる。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># Demonstration GET friends/list</span>
<span class="c"># See https://dev.twitter.com/docs/api/1.1/friends/list</span>

<span class="kn">from</span> <span class="nn">secret</span> <span class="k">import</span> <span class="n">twitter_instance</span>

<span class="n">tw</span> <span class="o">=</span> <span class="n">twitter_instance</span><span class="p">()</span>
<span class="n">next_cursor</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

<span class="k">while</span> <span class="n">next_cursor</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">tw</span><span class="o">.</span><span class="n">friends</span><span class="o">.</span><span class="n">list</span><span class="p">(</span>
        <span class="n">screen_name</span><span class="o">=</span><span class="s">&#39;showa_yojyo&#39;</span><span class="p">,</span>
        <span class="n">cursor</span><span class="o">=</span><span class="n">next_cursor</span><span class="p">,</span>
        <span class="n">count</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
        <span class="n">skip_status</span><span class="o">=</span><span class="k">True</span><span class="p">,</span>
        <span class="n">include_user_entities</span><span class="o">=</span><span class="k">False</span><span class="p">,)</span>

    <span class="k">for</span> <span class="n">follower</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s">&#39;users&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s">&#39;&#39;&#39;</span>
<span class="s">{screen_name} / {name}</span>
<span class="s">{description}</span>
<span class="s">{url}</span>
<span class="s">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">follower</span><span class="p">))</span>

    <span class="n">next_cursor</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s">&#39;next_cursor&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="get-followers-list">
<h4><a class="toc-backref" href="#id45">GET followers/list</a><a class="headerlink" href="#get-followers-list" title="Permalink to this headline">¶</a></h4>
<p>特定のユーザーをフォローしている全ユーザーの情報を得るのには GET followers/list を利用できる。
サンプルコードは先のコードをテキストエディターで <tt class="docutils literal"><span class="pre">s/friends/followers/</span></tt> すれば得られる。</p>
</div>
</div>
<div class="section" id="id17">
<h3><a class="toc-backref" href="#id46">ユーザーアカウント関連</a><a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<div class="section" id="get-users-show">
<h4><a class="toc-backref" href="#id47">GET users/show</a><a class="headerlink" href="#get-users-show" title="Permalink to this headline">¶</a></h4>
<p>特定のユーザーの詳細情報を得るのに <tt class="docutils literal"><span class="pre">users/show</span></tt> を利用する。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># Demonstration GET users/show</span>
<span class="c"># See https://dev.twitter.com/docs/api/1.1/get/users/show</span>

<span class="kn">from</span> <span class="nn">secret</span> <span class="k">import</span> <span class="n">twitter_instance</span>

<span class="n">tw</span> <span class="o">=</span> <span class="n">twitter_instance</span><span class="p">()</span>

<span class="c"># Comment 1</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">tw</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">screen_name</span><span class="o">=</span><span class="s">&#39;showa_yojyo&#39;</span><span class="p">,</span> <span class="n">entities</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># Comment 2</span>
<span class="nb">print</span><span class="p">(</span><span class="s">&#39;&#39;&#39;</span>
<span class="s">{screen_name} | {name}</span>
<span class="s">{location}</span>
<span class="s">{url}</span>
<span class="s">{description}</span>

<span class="s">ツイート数 {statuses_count}</span>
<span class="s">フォロー {friends_count} 人</span>
<span class="s">フォロワー {followers_count} 人</span>
<span class="s">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">response</span><span class="p">))</span>
</pre></div>
</div>
<ul class="simple">
<li>Comment 1: 基本的に指定する引数はこれだけで構わない。</li>
<li>Comment 2: ユーザーの Twitter 情報を出力してみる。</li>
<li><a class="reference external" href="https://dev.twitter.com/docs/api/1.1/get/users/show">https://dev.twitter.com/docs/api/1.1/get/users/show</a> 参照。</li>
</ul>
</div>
</div>
<div class="section" id="id18">
<h3><a class="toc-backref" href="#id48">お気に入り関連</a><a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<div class="section" id="get-favorites-list">
<h4><a class="toc-backref" href="#id49">GET favorites/list</a><a class="headerlink" href="#get-favorites-list" title="Permalink to this headline">¶</a></h4>
<p>特定のユーザーが星マークを付けたツイート群を取得する。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># Demonstration GET favorites</span>
<span class="c"># See https://dev.twitter.com/docs/api/1.1/get/favorites/list</span>

<span class="kn">from</span> <span class="nn">secret</span> <span class="k">import</span> <span class="n">twitter_instance</span>

<span class="n">tw</span> <span class="o">=</span> <span class="n">twitter_instance</span><span class="p">()</span>

<span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">screen_name</span><span class="o">=</span><span class="s">&#39;showa_yojyo&#39;</span><span class="p">,</span>
    <span class="n">count</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">page</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">include_entities</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">tw</span><span class="o">.</span><span class="n">favorites</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s">&#39;@{user[screen_name]}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">status</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s">&#39;{text}</span><span class="se">\n</span><span class="s">{created_at} %{source}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">status</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>
</pre></div>
</div>
<p>だんだん解説がワンパターン化してきたので、以降は目立つポイントのみ解説をする。</p>
</div>
</div>
<div class="section" id="id19">
<h3><a class="toc-backref" href="#id50">リスト関連</a><a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h3>
<div class="section" id="get-lists-list">
<h4><a class="toc-backref" href="#id51">GET lists/list</a><a class="headerlink" href="#get-lists-list" title="Permalink to this headline">¶</a></h4>
<p>全リスト取得に用いる API だ。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># Demonstration GET lists/list</span>
<span class="c"># See https://dev.twitter.com/docs/api/1.1/get/lists/list</span>

<span class="kn">from</span> <span class="nn">secret</span> <span class="k">import</span> <span class="n">twitter_instance</span>

<span class="n">tw</span> <span class="o">=</span> <span class="n">twitter_instance</span><span class="p">()</span>

<span class="c"># Comment 1</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">tw</span><span class="o">.</span><span class="n">lists</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="n">screen_name</span><span class="o">=</span><span class="s">&#39;showa_yojyo&#39;</span><span class="p">)</span>

<span class="c"># Comment 2</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s">&#39;{mode} {full_name} {description}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">item</span><span class="p">))</span>
</pre></div>
</div>
<ul>
<li><p class="first">Comment 1: メソッド <tt class="docutils literal"><span class="pre">lists.list</span></tt> に <tt class="docutils literal"><span class="pre">screen_name</span></tt> キーワード引数を与えて、
そのユーザーの持っているリストを全部取得する。
ユーザーが作成したリストに加え、もしあれば、購読している他ユーザーが作成したリストを含む。</p>
<p><a class="reference external" href="https://dev.twitter.com/docs/api/1.1/get/lists/list">https://dev.twitter.com/docs/api/1.1/get/lists/list</a> 参照。</p>
</li>
<li><p class="first">Comment 2: 各リストの mode, full_name, description 各属性をコンソールに出力する。</p>
</li>
</ul>
</div>
<div class="section" id="get-lists-statuses">
<h4><a class="toc-backref" href="#id52">GET lists/statuses</a><a class="headerlink" href="#get-lists-statuses" title="Permalink to this headline">¶</a></h4>
<p>既存のリストのタイムラインを閲覧するための API だ。
例えば <tt class="docutils literal"><span class="pre">screen_name</span></tt> が <tt class="docutils literal"><span class="pre">showa_yojyo</span></tt> のユーザーの、
<tt class="docutils literal"><span class="pre">news</span></tt> という公開リストがあるという前提で、そのタイムラインを見てみよう。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># Demonstration GET lists/statuses</span>
<span class="c"># See https://dev.twitter.com/docs/api/1.1/get/lists/statuses</span>

<span class="kn">from</span> <span class="nn">secret</span> <span class="k">import</span> <span class="n">twitter_instance</span>

<span class="n">tw</span> <span class="o">=</span> <span class="n">twitter_instance</span><span class="p">()</span>

<span class="c"># Comment 1</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">owner_screen_name</span><span class="o">=</span><span class="s">&#39;showa_yojyo&#39;</span><span class="p">,</span>
    <span class="n">slug</span><span class="o">=</span><span class="s">&#39;news&#39;</span><span class="p">,</span>
    <span class="n">per_page</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">page</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">include_entities</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">include_rts</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">tw</span><span class="o">.</span><span class="n">lists</span><span class="o">.</span><span class="n">statuses</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
    <span class="c"># Comment 2</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s">&#39;user&#39;</span><span class="p">][</span><span class="s">&#39;screen_name&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s">&#39;{text}</span><span class="se">\n</span><span class="s">{created_at} {source}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">item</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li>Comment 1<ul>
<li>メソッド <tt class="docutils literal"><span class="pre">lists.statuses</span></tt> に与える引数を準備する。
リストを特定する手段は一つではないのだが、
分かりやすさを優先して <tt class="docutils literal"><span class="pre">slug</span></tt> および <tt class="docutils literal"><span class="pre">owner_screen_name</span></tt> を同時に指示する。</li>
<li>その他は <a class="reference external" href="https://dev.twitter.com/docs/api/1.1/get/lists/statuses">https://dev.twitter.com/docs/api/1.1/get/lists/statuses</a> 参照。</li>
</ul>
</li>
<li>Comment 2<ul>
<li>文字列をコンソールに出力する。
ツイート内容、改行、ツイート時刻、ツイートに利用したアプリ名が確認できる。</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="post-lists-members-destroy">
<h4><a class="toc-backref" href="#id53">POST lists/members/destroy</a><a class="headerlink" href="#post-lists-members-destroy" title="Permalink to this headline">¶</a></h4>
<p>リストから指定したユーザーを削除するための API だ。
しかし、これを利用するくらいならばブラウザーで Twitter を利用するほうが早いやもしれない。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># Demonstration POST lists/members/destroy</span>
<span class="c"># https://dev.twitter.com/docs/api/1.1/post/lists/members/destroy</span>

<span class="kn">from</span> <span class="nn">secret</span> <span class="k">import</span> <span class="n">twitter_instance</span>

<span class="n">tw</span> <span class="o">=</span> <span class="n">twitter_instance</span><span class="p">()</span>

<span class="n">tw</span><span class="o">.</span><span class="n">lists</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">destroy</span><span class="p">(</span>
    <span class="n">owner_screen_name</span><span class="o">=</span><span class="s">&#39;showa_yojyo&#39;</span><span class="p">,</span>
    <span class="n">slug</span><span class="o">=</span><span class="s">&#39;listname&#39;</span><span class="p">,</span>
    <span class="n">screen_name</span><span class="o">=</span><span class="s">&#39;showa_yojyo&#39;</span><span class="p">)</span> <span class="c"># デモコードなので自分自身決め打ち</span>
</pre></div>
</div>
</div>
<div class="section" id="get-lists-memberships">
<h4><a class="toc-backref" href="#id54">GET lists/memberships</a><a class="headerlink" href="#get-lists-memberships" title="Permalink to this headline">¶</a></h4>
<p><tt class="docutils literal"><span class="pre">lists/memberships</span></tt> リクエストは、
あるユーザーが他のユーザーが管理しているリストに含まれているとき、
そのようなリストを列挙するのに利用する。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># Demonstration GET lists/memberships</span>
<span class="c"># https://dev.twitter.com/docs/api/1.1/get/lists/memberships</span>

<span class="kn">from</span> <span class="nn">secret</span> <span class="k">import</span> <span class="n">twitter_instance</span>

<span class="n">tw</span> <span class="o">=</span> <span class="n">twitter_instance</span><span class="p">()</span>

<span class="c"># Comment 1</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">screen_name</span><span class="o">=</span><span class="s">&#39;showa_yojyo&#39;</span><span class="p">,</span> <span class="n">cursor</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">tw</span><span class="o">.</span><span class="n">lists</span><span class="o">.</span><span class="n">memberships</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="c"># Comment 2</span>
<span class="n">lists</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s">&#39;lists&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">lists</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s">&#39;{full_name}, {description}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">item</span><span class="p">))</span>
</pre></div>
</div>
<ul class="simple">
<li>Comment 1: ユーザー <tt class="docutils literal"><span class="pre">showa_yojyo</span></tt> を含むリストをリクエストする。
<tt class="docutils literal"><span class="pre">cursor</span></tt> については別項で詳しく解説する。</li>
<li>Comment 2: 各リストの名前と説明文をコンソールに出力する。
<tt class="docutils literal"><span class="pre">full_name</span></tt> の先頭にはリストの作者の <tt class="docutils literal"><span class="pre">screen_name</span></tt> が見えると思う。</li>
<li><a class="reference external" href="https://dev.twitter.com/docs/api/1.1/get/lists/memberships">https://dev.twitter.com/docs/api/1.1/get/lists/memberships</a> 参照。</li>
</ul>
</div>
<div class="section" id="post-lists-members-create-all">
<h4><a class="toc-backref" href="#id55">POST lists/members/create_all</a><a class="headerlink" href="#post-lists-members-create-all" title="Permalink to this headline">¶</a></h4>
<p>ブラウザー上の操作ではできないと思われる、一括でユーザーを複数指定して指定のリストに登録する処理を実現するための API だ。
次のサンプルコードの <tt class="docutils literal"><span class="pre">screen_names</span></tt> はスクリーンネームの tuple インスタンスを意味する。
この API はリストを多用する筆者が利用する頻度がもっとも高い。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># Demonstration POST lists/members/create_all</span>
<span class="c"># https://dev.twitter.com/docs/api/1.1/post/lists/members/create_all</span>

<span class="kn">from</span> <span class="nn">secret</span> <span class="k">import</span> <span class="n">twitter_instance</span>

<span class="n">tw</span> <span class="o">=</span> <span class="n">twitter_instance</span><span class="p">()</span>

<span class="n">screen_names</span><span class="o">=</span><span class="p">(</span>
    <span class="c"># ...</span>
    <span class="p">)</span>

<span class="n">tw</span><span class="o">.</span><span class="n">lists</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span>
    <span class="n">owner_screen_name</span><span class="o">=</span><span class="s">&#39;showa_yojyo&#39;</span><span class="p">,</span>
    <span class="n">slug</span><span class="o">=</span><span class="s">&#39;listname&#39;</span><span class="p">,</span>
    <span class="n">screen_name</span><span class="o">=</span><span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">screen_names</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="get-lists-members-show">
<h4><a class="toc-backref" href="#id56">GET lists/members/show</a><a class="headerlink" href="#get-lists-members-show" title="Permalink to this headline">¶</a></h4>
<p>指定ユーザーが指定リストに登録されているかを調べる API だ。
使い途が少々思いつかない。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># Demonstration GET lists/members/show</span>
<span class="c"># https://dev.twitter.com/docs/api/1.1/get/lists/members/show</span>

<span class="kn">from</span> <span class="nn">secret</span> <span class="k">import</span> <span class="n">twitter_instance</span>

<span class="n">tw</span> <span class="o">=</span> <span class="n">twitter_instance</span><span class="p">()</span>

<span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">owner_screen_name</span><span class="o">=</span><span class="s">&#39;showa_yojyo&#39;</span><span class="p">,</span>
    <span class="n">slug</span><span class="o">=</span><span class="s">&#39;news&#39;</span><span class="p">,</span>
    <span class="n">screen_name</span><span class="o">=</span><span class="s">&#39;asahi&#39;</span><span class="p">,</span>
    <span class="n">include_entities</span><span class="o">=</span><span class="k">False</span><span class="p">,</span>
    <span class="n">skip_status</span><span class="o">=</span><span class="k">False</span><span class="p">,)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">tw</span><span class="o">.</span><span class="n">lists</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s">&#39;{screen_name} / {name} {description}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">response</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="get-lists-members">
<h4><a class="toc-backref" href="#id57">GET lists/members</a><a class="headerlink" href="#get-lists-members" title="Permalink to this headline">¶</a></h4>
<p>指定リストに登録されているユーザーをすべて得ることができる API だ。
登録ユーザー数が多いリストに対しては、次のように「カーソル処理」で複数回のリクエストをすることになるだろう。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># Demonstration GET lists/members</span>
<span class="c"># https://dev.twitter.com/docs/api/1.1/get/lists/members</span>

<span class="kn">from</span> <span class="nn">secret</span> <span class="k">import</span> <span class="n">twitter_instance</span>

<span class="n">OWNER_SCREEN_NAME</span><span class="o">=</span><span class="s">&#39;showa_yojyo&#39;</span>
<span class="n">SLUG</span><span class="o">=</span><span class="s">&#39;news&#39;</span>

<span class="n">tw</span> <span class="o">=</span> <span class="n">twitter_instance</span><span class="p">()</span>
<span class="n">next_cursor</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">screen_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

<span class="k">while</span> <span class="n">next_cursor</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="c"># GET lists/members</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">tw</span><span class="o">.</span><span class="n">lists</span><span class="o">.</span><span class="n">members</span><span class="p">(</span>
        <span class="n">owner_screen_name</span><span class="o">=</span><span class="n">OWNER_SCREEN_NAME</span><span class="p">,</span>
        <span class="n">cursor</span><span class="o">=</span><span class="n">next_cursor</span><span class="p">,</span>
        <span class="n">slug</span><span class="o">=</span><span class="n">SLUG</span><span class="p">)</span>

    <span class="n">screen_names</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">user</span><span class="p">[</span><span class="s">&#39;screen_name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s">&#39;users&#39;</span><span class="p">]])</span>

    <span class="n">next_cursor</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s">&#39;next_cursor&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">screen_name</span> <span class="ow">in</span> <span class="n">screen_names</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">screen_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="post-lists-members-create">
<h4><a class="toc-backref" href="#id58">POST lists/members/create</a><a class="headerlink" href="#post-lists-members-create" title="Permalink to this headline">¶</a></h4>
<p>自分の所有するリストに指定ユーザーを一人分登録する API だ。
今では上述の lists/members/create_all で完全に置き換えてしまって構わなそうだ。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># Demonstration POST lists/members/create</span>
<span class="c"># https://dev.twitter.com/docs/api/1.1/post/lists/members/create</span>

<span class="kn">from</span> <span class="nn">secret</span> <span class="k">import</span> <span class="n">twitter_instance</span>

<span class="n">tw</span> <span class="o">=</span> <span class="n">twitter_instance</span><span class="p">()</span>

<span class="n">tw</span><span class="o">.</span><span class="n">lists</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">owner_screen_name</span><span class="o">=</span><span class="s">&#39;showa_yojyo&#39;</span><span class="p">,</span>
    <span class="n">slug</span><span class="o">=</span><span class="s">&#39;listname&#39;</span><span class="p">,</span>
    <span class="n">screen_name</span><span class="o">=</span><span class="n">screen_name</span><span class="p">)</span> <span class="c"># デモコードなので自分自身決め打ち</span>
</pre></div>
</div>
</div>
<div class="section" id="post-lists-destroy">
<h4><a class="toc-backref" href="#id59">POST lists/destroy</a><a class="headerlink" href="#post-lists-destroy" title="Permalink to this headline">¶</a></h4>
<p>自分の所有するリストを一つ指定して、それを削除する API だ。
使用頻度はテスト用に作成したダミーリストをまた削除するときに使うくらいだ。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># Demonstration POST lists/destroy</span>
<span class="c"># https://dev.twitter.com/docs/api/1.1/post/lists/destroy</span>
<span class="kn">from</span> <span class="nn">secret</span> <span class="k">import</span> <span class="n">twitter_instance</span>

<span class="n">tw</span> <span class="o">=</span> <span class="n">twitter_instance</span><span class="p">()</span>
<span class="n">tw</span><span class="o">.</span><span class="n">lists</span><span class="o">.</span><span class="n">destroy</span><span class="p">(</span>
    <span class="n">owner_screen_name</span><span class="o">=</span><span class="s">&#39;showa_yojyo&#39;</span><span class="p">,</span>
    <span class="n">slug</span><span class="o">=</span><span class="s">&#39;listname&#39;</span><span class="p">,)</span>
</pre></div>
</div>
</div>
<div class="section" id="post-lists-create">
<h4><a class="toc-backref" href="#id60">POST lists/create</a><a class="headerlink" href="#post-lists-create" title="Permalink to this headline">¶</a></h4>
<p>リストを新しく作成するための API だ。Twitter Web Client で作業するほうが早い。
<a class="reference external" href="https://dev.twitter.com/docs/api/1.1/post/lists/create">https://dev.twitter.com/docs/api/1.1/post/lists/create</a> 参照。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># Demonstration POST lists/create</span>
<span class="c"># See https://dev.twitter.com/docs/api/1.1/post/lists/create</span>

<span class="kn">from</span> <span class="nn">secret</span> <span class="k">import</span> <span class="n">twitter_instance</span>

<span class="n">tw</span> <span class="o">=</span> <span class="n">twitter_instance</span><span class="p">()</span>
<span class="n">tw</span><span class="o">.</span><span class="n">lists</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;listname&#39;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">&#39;This is a temporary list&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="get-lists-ownerships">
<h4><a class="toc-backref" href="#id61">GET lists/ownerships</a><a class="headerlink" href="#get-lists-ownerships" title="Permalink to this headline">¶</a></h4>
<p><tt class="docutils literal"><span class="pre">lists/ownerships</span></tt> は特定のユーザーが管理しているリストを列挙するのに利用する。
ツイートというよりは、リストのプロパティーを得るのに利用する。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># Demonstration POST lists/ownerships</span>
<span class="c"># https://dev.twitter.com/docs/api/1.1/post/lists/ownerships</span>

<span class="kn">from</span> <span class="nn">secret</span> <span class="k">import</span> <span class="n">twitter_instance</span>

<span class="n">tw</span> <span class="o">=</span> <span class="n">twitter_instance</span><span class="p">()</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">tw</span><span class="o">.</span><span class="n">lists</span><span class="o">.</span><span class="n">ownerships</span><span class="p">(</span><span class="n">screen_name</span><span class="o">=</span><span class="s">&#39;showa_yojyo&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s">&#39;lists&#39;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s">&#39;{mode} {full_name} {description}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">item</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id20">
<h3><a class="toc-backref" href="#id62">検索履歴関連</a><a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<div class="section" id="get-saved-searches-list">
<h4><a class="toc-backref" href="#id63">GET saved_searches/list</a><a class="headerlink" href="#get-saved-searches-list" title="Permalink to this headline">¶</a></h4>
<p>Twitter ログイン時に当該アカウントで検索したクエリーの一覧を取得する。
実行してみれば理解できる。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># Demonstration POST saved_searches/list</span>
<span class="c"># See https://dev.twitter.com/docs/api/1.1/post/saved_searches/list</span>

<span class="kn">from</span> <span class="nn">secret</span> <span class="k">import</span> <span class="n">twitter_instance</span>

<span class="n">tw</span> <span class="o">=</span> <span class="n">twitter_instance</span><span class="p">()</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">tw</span><span class="o">.</span><span class="n">saved_searches</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s">&#39;{query}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">item</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="get-saved-searches-create">
<h4><a class="toc-backref" href="#id64">GET saved_searches/create</a><a class="headerlink" href="#get-saved-searches-create" title="Permalink to this headline">¶</a></h4>
<p>わかりにくい言い方をすると「保存した検索」項目を一つ新しく作成するための API だ。
個人的には今となっては使い途がなくなってしまった API のひとつ。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># Demonstration POST saved_searches/create</span>
<span class="c"># See https://dev.twitter.com/docs/api/1.1/post/saved_searches/create</span>

<span class="kn">from</span> <span class="nn">secret</span> <span class="k">import</span> <span class="n">twitter_instance</span>

<span class="n">tw</span> <span class="o">=</span> <span class="n">twitter_instance</span><span class="p">()</span>

<span class="c"># ちなみに OR は多用しないほうがよい。</span>
<span class="n">tw</span><span class="o">.</span><span class="n">saved_searches</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="s">&#39;イルベロ OR イルマティックエンベロープ&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="twitterstream">
<h3><a class="toc-backref" href="#id65">TwitterStream</a><a class="headerlink" href="#twitterstream" title="Permalink to this headline">¶</a></h3>
<p>TBW</p>
</div>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="index.html">読書ノート v1.2.0</a> &raquo;</li> 
      </ul>
    </div>
    <div id="footer">
      <div id="footer_logo">
        <a class="imga" href="https://showa-yojyo.github.io/" title="プレハブ小屋 Since 1999"><img src="_static/logos.png" width="88" height="31" /></a>
      </div>
      <div id="footer_share">
        <a href="https://twitter.com/share" class="twitter-share-button" data-size="large">Tweet</a>
        <script type="text/javascript">render_twitter_button(document, 'script', 'twitter-wjs')</script>
      </div>
      <div id="footer_copyright">
        Since 1999<br />
        Copyright &copy; 1999-2014, プレハブ小屋 All rights reserved.
      </div>
      <div id="footer_spacer">
        <p>
          Last updated at 2014/11/06 (Thu) 23:22:09.
        </p>
      </div>
    </div>
  </body>
</html>