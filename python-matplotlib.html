<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Matplotlib 利用ノート &mdash; 読書ノート v1.4.0dev</title>
    
    <link rel="stylesheet" href="_static/prefab.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.4.0dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/twitter-button.js"></script>
    <link rel="top" title="読書ノート v1.4.0dev" href="index.html" />
    <link rel="next" title="NetworkX 利用ノート" href="python-networkx.html" />
    <link rel="prev" title="Pillow 利用ノート" href="python-pillow.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="index.html">読書ノート v1.4.0dev</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body">
            
  <div class="section" id="matplotlib">
<h1><a class="toc-backref" href="#id24">Matplotlib 利用ノート</a><a class="headerlink" href="#matplotlib" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="id1">
<p class="topic-title first">ノート目次</p>
<ul class="simple">
<li><a class="reference internal" href="#matplotlib" id="id24">Matplotlib 利用ノート</a><ul>
<li><a class="reference internal" href="#id2" id="id25">関連リンク</a></li>
<li><a class="reference internal" href="#id3" id="id26">関連ノート</a></li>
<li><a class="reference internal" href="#id4" id="id27">目的</a></li>
<li><a class="reference internal" href="#id5" id="id28">環境構築</a><ul>
<li><a class="reference internal" href="#id6" id="id29">Matplotlib の依存パッケージをインストール</a></li>
<li><a class="reference internal" href="#id7" id="id30">Matplotlib 本体をインストール</a></li>
<li><a class="reference internal" href="#pyparsing" id="id31">PyParsing をインストール</a></li>
<li><a class="reference internal" href="#id8" id="id32">オフラインでも勉強できるようにドキュメントを確保</a></li>
<li><a class="reference internal" href="#id9" id="id33">動作確認</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id10" id="id34">Matplotlib の基本的なコードの書き方を習得する</a><ul>
<li><a class="reference internal" href="#id11" id="id35">基本的な関数・メソッドを押さえる</a></li>
<li><a class="reference internal" href="#figure-axes" id="id36">Figure と Axes の概念を理解する</a></li>
<li><a class="reference internal" href="#id12" id="id37">テキストを使ってみる</a><ul>
<li><a class="reference internal" href="#id13" id="id38">テキストプロパティ</a></li>
<li><a class="reference internal" href="#id14" id="id39">日本語のテキストを描画するには？</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#artists" id="id40">Artists 関連</a><ul>
<li><a class="reference internal" href="#figure-matplotlib-figure-figure" id="id41">Figure (<tt class="docutils literal"><span class="pre">matplotlib.figure.Figure</span></tt>)</a></li>
<li><a class="reference internal" href="#axes-matplotlib-axes-axes" id="id42">Axes (<tt class="docutils literal"><span class="pre">matplotlib.axes.Axes</span></tt>)</a></li>
<li><a class="reference internal" href="#axis-matplotlib-axis-axis" id="id43">Axis (<tt class="docutils literal"><span class="pre">matplotlib.axis.Axis</span></tt>)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id15" id="id44">バックエンド</a><ul>
<li><a class="reference internal" href="#id16" id="id45">ユーザーインターフェイスバックエンド</a></li>
<li><a class="reference internal" href="#id17" id="id46">ハードコピーバックエンド</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id18" id="id47">ヒストグラムを描く</a></li>
<li><a class="reference internal" href="#id19" id="id48">曲線を描く</a><ul>
<li><a class="reference internal" href="#id20" id="id49">多項式</a></li>
<li><a class="reference internal" href="#bezier" id="id50">Bézier 曲線</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tex" id="id51">TeX 表現</a></li>
<li><a class="reference internal" href="#id21" id="id52">続・環境構築</a><ul>
<li><a class="reference internal" href="#home-matplotlib-matplotlibrc" id="id53"><tt class="file docutils literal"><span class="pre">$HOME/.matplotlib/matplotlibrc</span></tt></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>OS<ul>
<li>Windows XP Home Edition SP 3</li>
<li>Windows 7 Home Premium SP 1</li>
</ul>
</li>
<li>本稿において、利用した各パッケージのバージョンは次のとおり。<ul>
<li><a class="reference external" href="http://www.python.org/">Python</a> 2.6.6, 2.7.3, 3.4.1</li>
<li><a class="reference external" href="http://peak.telecommunity.com/DevCenter/setuptools">Setuptools</a> 0.6c11</li>
<li><a class="reference external" href="http://matplotlib.sourceforge.net/">Matplotlib</a> 1.1.0, 1.1.1, 1.3.1</li>
<li><a class="reference external" href="http://scipy.org/NumPy/">NumPy</a> 1.6.0, 1.6.2, 1.8.2</li>
<li><a class="reference external" href="https://pypi.python.org/pypi/pyparsing">PyParsing</a> 2.0.2</li>
<li><a class="reference external" href="http://www.riverbankcomputing.com/software/pyqt/intro">PyQt</a> 4.8.4, XXXXX</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id25">関連リンク</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt><a class="reference external" href="http://matplotlib.sourceforge.net/">Matplotlib</a></dt>
<dd>パッケージ配布元。</dd>
</dl>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id26">関連ノート</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="python-pil.html"><em>PIL 利用ノート [obsolete]</em></a></li>
<li><a class="reference internal" href="python-numpy.html"><em>NumPy 利用ノート</em></a></li>
<li><a class="reference internal" href="python-scipy.html"><em>SciPy 利用ノート</em></a></li>
</ul>
</div>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id27">目的</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://matplotlib.sourceforge.net/">Matplotlib</a> パッケージはとても奥が深い。
手足のように使いこなせるようになるには、相当時間を要すると見た。
Python では遊びたいことが他にもたくさんあるので
Matplotlib で目的を拡大し過ぎないように、ここまでできればいいという目的を決めておく。</p>
<p>個人的には次の 3 点で十分だ。</p>
<ul class="simple">
<li>数学の教科書にありがちな曲線グラフを描画する。
特に xy 平面上に n 次多項式やスプライン曲線が描画できればいい。</li>
<li>数学の教科書にありがちな数式を描画する。
つまり TeX 環境の簡易版として利用したい。</li>
<li>それらを PNG 画像または PDF ファイルとして出力したい。
できれば SVG ファイルをも得たい。</li>
</ul>
</div>
<div class="section" id="id5">
<h2><a class="toc-backref" href="#id28">環境構築</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id6">
<h3><a class="toc-backref" href="#id29">Matplotlib の依存パッケージをインストール</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>Matplotlib は <a class="reference external" href="http://scipy.org/NumPy/">NumPy</a> を多用しているので、当然これを先にインストールしておく。
→ <a class="reference internal" href="python-numpy.html"><em>NumPy 利用ノート</em></a></p>
<p>あとは特に必要ない。本体のインストールへ進もう。</p>
</div>
<div class="section" id="id7">
<h3><a class="toc-backref" href="#id30">Matplotlib 本体をインストール</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>Python 2.7.3 環境設定時は公式インストーラーのモジュール群が動作しなかった。
具体的に言うと、簡単なプロットを定義した後に <tt class="docutils literal"><span class="pre">matplotlib.pyplot.show()</span></tt> すると、
単に白いウィンドウが出て CPU 使用率が 100% になるという挙動だった。</p>
<p>ものの試しに <a class="reference external" href="http://www.lfd.uci.edu/~gohlke/pythonlibs/">Python Extension Packages for Windows - Christoph Gohlke</a> で配布している
インストーラーに差し替えてみたら、期待通りの動作をした。</p>
<p>Python 3.4 でも、どうぜ公式サイトでは 64 ビット版のビルドなどしないので、こちらのインストーラーを利用する。</p>
</div>
<div class="section" id="pyparsing">
<h3><a class="toc-backref" href="#id31">PyParsing をインストール</a><a class="headerlink" href="#pyparsing" title="Permalink to this headline">¶</a></h3>
<p>必要に応じて <a class="reference external" href="https://pypi.python.org/pypi/pyparsing">PyParsing</a> をインストールする。</p>
</div>
<div class="section" id="id8">
<h3><a class="toc-backref" href="#id32">オフラインでも勉強できるようにドキュメントを確保</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>公式サイトから PDF をダウンロードして、ローカルディスクに保存する。
最初のページに &#8220;Matplotlib Release 1.0.0&#8221; というタイトルと、著者の連名
&#8220;Darren Dale, Michael Droettboom, Eric Firing, John Hunter&#8221; が書かれてある。
PDF ファイル全体は 900 ページに及ぶ大著だ。</p>
<p>なお、ソースコード一式を入手して、そこにある <a class="reference external" href="http://sphinx.pocoo.org/">Sphinx</a> によるドキュメントビルドを試みたが、
同じ処理をぐるぐるループして結局モノができなかったことがある。</p>
</div>
<div class="section" id="id9">
<h3><a class="toc-backref" href="#id33">動作確認</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>次のようなコードを実行してみて、それらしいイメージを目視で確認できたら OK でいい。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>最後の行の <tt class="docutils literal"><span class="pre">plt.show()</span></tt> の呼び出し開始直後に、
<a class="reference external" href="http://www.pythonware.com/products/pil">PIL</a> の <tt class="docutils literal"><span class="pre">Image.show()</span></tt> のようにビューワーが出現する。これがなかなか面白い。</p>
<a class="reference internal image-reference" href="_images/mpl-tkagg.png"><img alt="_images/mpl-tkagg.png" src="_images/mpl-tkagg.png" style="width: 330.0px; height: 276.5px;" /></a>
</div>
</div>
<div class="section" id="id10">
<h2><a class="toc-backref" href="#id34">Matplotlib の基本的なコードの書き方を習得する</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>ここから先の文中の <tt class="docutils literal"><span class="pre">plt</span></tt> は
<tt class="docutils literal"><span class="pre">import</span> <span class="pre">matplotlib.pyplot</span> <span class="pre">as</span> <span class="pre">plt</span></tt> と別名定義したものとする。</li>
<li>同様に <tt class="docutils literal"><span class="pre">mpl</span></tt> は
<tt class="docutils literal"><span class="pre">import</span> <span class="pre">matplotlib</span> <span class="pre">as</span> <span class="pre">mpl</span></tt> と別名定義したものとする。</li>
</ul>
<div class="section" id="id11">
<h3><a class="toc-backref" href="#id35">基本的な関数・メソッドを押さえる</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>下の表を見てからヘルプを当たる。</p>
<p>後で見るように、モジュール <tt class="docutils literal"><span class="pre">matplotlib.pyplot</span></tt> の関数の仕事は、
ある種の「アクティブな」オブジェクトのメソッド呼び出しをするだけに過ぎない。</p>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">関数（引数省略）</th>
<th class="head">仕事</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">plt.plot()</span></tt></td>
<td>グラフを描く</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">plt.hist()</span></tt></td>
<td>ヒストグラムを描く</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">plt.show()</span></tt></td>
<td>イメージを一気に表示</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">plt.savefig()</span></tt></td>
<td>イメージをファイルに保存</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">plt.setp()</span></tt></td>
<td>プロット線の属性等、描画パラメーターの取得・指定</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">plt.axis()</span></tt></td>
<td>ビューポート範囲指定</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">plt.grid()</span></tt></td>
<td>グリッド描画をするかしないか指定</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="figure-axes">
<h3><a class="toc-backref" href="#id36">Figure と Axes の概念を理解する</a><a class="headerlink" href="#figure-axes" title="Permalink to this headline">¶</a></h3>
<p>Matplotlib には current figure と current axes という概念がある。
これを利用して、複数個のグラフをワンシーンに定義できるようだ。</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">関数</th>
<th class="head">仕事</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">plt.figure()</span></tt></td>
<td>指定の figure をカレントにする</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">plt.subplot()</span></tt></td>
<td>指定の axes をカレントにする</td>
</tr>
</tbody>
</table>
<ul>
<li><p class="first">大抵の本にはいくつかの図がしばしばキャプション付きで載っている。
Figure という語は、それに対応するクラスだと解釈したい。
図の一つ一つが Figure のオブジェクトになると思えば、個人的にはコードが理解できる。</p>
</li>
<li><p class="first">普通は一つの図にグラフ一つを載せるわけだが、
同じようなグラフを並べたものを一つの図としたい場合もある。
Axes という語が意味するのが、そのグラフだと解釈すればよいか。</p>
<a class="reference internal image-reference" href="_images/mpl-axes.png"><img alt="_images/mpl-axes.png" src="_images/mpl-axes.png" style="width: 407.5px; height: 307.5px;" /></a>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">plt.figure(n)</span></tt> で current figure を指定する。</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">plt.subplot(n0n1n2)</span></tt> で current axes を指定する。
<tt class="docutils literal"><span class="pre">n0</span></tt>, <tt class="docutils literal"><span class="pre">n1</span></tt>, <tt class="docutils literal"><span class="pre">n2</span></tt> がそれぞれ縦方向の区画数、横方向の区画数、
「どの区画か」を意味する。</p>
<p><tt class="docutils literal"><span class="pre">n2</span></tt> は 1 以上 <tt class="docutils literal"><span class="pre">n1</span> <span class="pre">*</span> <span class="pre">n2</span></tt> 以下の値でなければならない。</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">plt</span></tt> のプロットコマンドはすべて current axes に作用する。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c"># current figure: 1 とする。</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span> <span class="c"># 縦 2 横 1 分割で current axes: 1 になる。</span>

<span class="c"># ... ここに来る plt. で始まるプロット命令はすべて</span>
<span class="c"># 二分割された上の axes に適用される。</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span> <span class="c"># 縦 2 横 1 分割で current axes: 2 になる。</span>

<span class="c"># ... ここに来る plt. で始まるプロット命令はすべて</span>
<span class="c"># 二分割された下の axes に適用される。</span>
</pre></div>
</div>
</li>
<li><p class="first">Matplotlib は figure/axes を扱うスタイルを二つ提供している。</p>
<ul>
<li><p class="first">古典的なステートマシンを操作するイメージのやり方。</p>
<p>ユーザーコードがカレントな figure/axes が何であるかを常に意識して、プロットコマンドを呼び出す。
コマンドはカレントな figure/axes に対して適用されることになる。</p>
</li>
<li><p class="first">状態とオブジェクトとを結びつけて取り扱う典型的なオブジェクト指向プログラミングのやり方。</p>
<p>figure/axes がオブジェクトになっていて、メソッドでプロットコマンドを呼び出す。
コマンドは対象となるオブジェクトの管理する figure/axes に対して適用されることになる。</p>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id12">
<h3><a class="toc-backref" href="#id37">テキストを使ってみる</a><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>当ノートの目的には数式を含むテキストを表示することを含むが、
その前にシンプルなテキスト描画法を学習する必要があるだろう。</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">関数（引数省略）</th>
<th class="head">仕事</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">plt.text()</span></tt></td>
<td>ビューポート内にテキストを描く</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">plt.xlabel()</span></tt></td>
<td>X 軸用キャプション</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">plt.ylabel()</span></tt></td>
<td>Y 軸用キャプション</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">plt.title()</span></tt></td>
<td>グラフ全体のキャプション</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">plt.text()</span></tt> は指定位置にテキストを描画するコマンドと考える。</li>
</ul>
<div class="section" id="id13">
<h4><a class="toc-backref" href="#id38">テキストプロパティ</a><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<p>個人的によく使うテキストプロパティを表にまとめておく。
各種テキストコマンド関数・メソッドのキーワード引数として指定するのが一つのやり方。</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">キーワード</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">color</span></tt></td>
<td>テキストの色。</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">family</span></tt></td>
<td>テキストのフォント名。
フォント名を直接指定するか
<tt class="docutils literal"><span class="pre">&quot;sans-serif&quot;</span></tt> 等の予約名を指定する。</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">rotation</span></tt></td>
<td>テキストの流し込む角度。
度単位で直接指定するのがいい。</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">size</span></tt></td>
<td>フォントサイズをポイントで指定するか
<tt class="docutils literal"><span class="pre">&quot;x-large&quot;</span></tt> 等の予約名を指定する。</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">stretch</span></tt></td>
<td>0 から 1000 までの値を指定するか
<tt class="docutils literal"><span class="pre">&quot;condensed&quot;</span></tt> 等の予約名を指定する。</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">style</span></tt></td>
<td><tt class="docutils literal"><span class="pre">&quot;normal&quot;</span></tt>, <tt class="docutils literal"><span class="pre">&quot;italic&quot;</span></tt>, <tt class="docutils literal"><span class="pre">&quot;oblique&quot;</span></tt> から選択。</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">weight</span></tt></td>
<td>0 から 1000 までの値を指定するか
<tt class="docutils literal"><span class="pre">&quot;bold&quot;</span></tt> 等の予約名を指定する。</td>
</tr>
</tbody>
</table>
<ul>
<li><p class="first">テキストの基準位置は <tt class="docutils literal"><span class="pre">horizontalalignment</span></tt>, <tt class="docutils literal"><span class="pre">verticalalignment</span></tt> キーワード引数で指示できる。
例えば x, y 引数をテキストの右下位置としたい場合には次のようにする。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;aaaa&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s">&#39;right&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">複数行テキストの左揃え・中央揃え・右寄せを指定する場合は <tt class="docutils literal"><span class="pre">multialignment</span></tt> キーワードを使用する。</p>
</li>
</ul>
</div>
<div class="section" id="id14">
<h4><a class="toc-backref" href="#id39">日本語のテキストを描画するには？</a><a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<p><tt class="docutils literal"><span class="pre">matplotlib.font_manager.FontProperties</span></tt> を明示的に利用する手段を見つけた。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.font_manager</span> <span class="k">import</span> <span class="n">FontProperties</span>

<span class="n">fp</span> <span class="o">=</span> <span class="n">FontProperties</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="s">r&#39;C:\WINDOWS\Fonts\HGRME.ttc&#39;</span><span class="p">)</span> <span class="c"># HG 明朝系</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;御無礼</span><span class="se">\n</span><span class="s">一発です&#39;</span><span class="p">,</span> <span class="n">fontproperties</span><span class="o">=</span><span class="n">fp</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>結果のスクリーンショットは次のようなものだ。</p>
<a class="reference internal image-reference" href="_images/mpl-fontprop.png"><img alt="_images/mpl-fontprop.png" src="_images/mpl-fontprop.png" style="width: 407.5px; height: 307.5px;" /></a>
</div>
</div>
</div>
<div class="section" id="artists">
<h2><a class="toc-backref" href="#id40">Artists 関連</a><a class="headerlink" href="#artists" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>primitives: <tt class="docutils literal"><span class="pre">Line2D</span></tt>, <tt class="docutils literal"><span class="pre">Rectangle</span></tt>, <tt class="docutils literal"><span class="pre">Text</span></tt>, <tt class="docutils literal"><span class="pre">AxesImage</span></tt>, etc.</li>
<li>containers: <tt class="docutils literal"><span class="pre">Axis</span></tt>, <tt class="docutils literal"><span class="pre">Axes</span></tt>, <tt class="docutils literal"><span class="pre">Figure</span></tt>, etc.</li>
</ul>
<p>コンテナを攻略していく。</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">Axes</span></tt> はプロッティングエリア。</li>
<li><tt class="docutils literal"><span class="pre">Subplot</span></tt> は <tt class="docutils literal"><span class="pre">Axes</span></tt> の特別なもの。コード的にもサブクラスで表現されている。</li>
<li><tt class="docutils literal"><span class="pre">Patch</span></tt> というクラス名は MATLAB から受け継いだ。</li>
<li>プロパティー一覧は <tt class="docutils literal"><span class="pre">matplotlib.artist.getp</span></tt> 関数で確認できる。</li>
</ul>
<div class="section" id="figure-matplotlib-figure-figure">
<h3><a class="toc-backref" href="#id41">Figure (<tt class="docutils literal"><span class="pre">matplotlib.figure.Figure</span></tt>)</a><a class="headerlink" href="#figure-matplotlib-figure-figure" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">Figure</span></tt> オブジェクトが &#8220;current axes&#8221; を管理している。</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">Figure</span></tt> は（グラフのものではない）自身の座標系を持っていて、
矩形の左下と右上がそれぞれ (0, 0), (1, 1) となっている。</p>
<p>変な例だが、画像全体に対角線を一本引くにはこうする。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>

<span class="n">l1</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">transform</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">transFigure</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">l1</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>結果は次のスクリーンショットのようなものとなる。</p>
<a class="reference internal image-reference" href="_images/mpl-figcs.png"><img alt="_images/mpl-figcs.png" src="_images/mpl-figcs.png" style="width: 407.5px; height: 307.5px;" /></a>
</li>
</ul>
</div>
<div class="section" id="axes-matplotlib-axes-axes">
<h3><a class="toc-backref" href="#id42">Axes (<tt class="docutils literal"><span class="pre">matplotlib.axes.Axes</span></tt>)</a><a class="headerlink" href="#axes-matplotlib-axes-axes" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">Axes</span></tt> オブジェクトが図形・テキスト・目盛・グリッド・ラベル各オブジェクトを管理する。
まずコンテナーメンバーのうち、馴染みのあるものだけ表にまとめておく。</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">メンバー名</th>
<th class="head">コンテナーの内容</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">lines</span></tt></td>
<td><tt class="docutils literal"><span class="pre">plot</span></tt> 等で作成した <tt class="docutils literal"><span class="pre">Line2D</span></tt> オブジェクト。</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">patches</span></tt></td>
<td>各種 <tt class="docutils literal"><span class="pre">Patch</span></tt> オブジェクト。
<tt class="docutils literal"><span class="pre">Ellipse</span></tt>, <tt class="docutils literal"><span class="pre">Polygon</span></tt>, etc.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">texts</span></tt></td>
<td><tt class="docutils literal"><span class="pre">text</span></tt> や <tt class="docutils literal"><span class="pre">annotate</span></tt> で作成した各種テキスト。</td>
</tr>
</tbody>
</table>
<p>非コンテナーメンバーも少しだけ押さえておく。</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">メンバー名</th>
<th class="head">コンテナーの内容</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">patch</span></tt></td>
<td><tt class="docutils literal"><span class="pre">Axes</span></tt> の背景用 <tt class="docutils literal"><span class="pre">Rectangle</span></tt> オブジェクト。</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">xaxis</span></tt></td>
<td><tt class="docutils literal"><span class="pre">XAxis</span></tt> オブジェクト。</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">yaxis</span></tt></td>
<td><tt class="docutils literal"><span class="pre">YAxis</span></tt> オブジェクト。</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="axis-matplotlib-axis-axis">
<h3><a class="toc-backref" href="#id43">Axis (<tt class="docutils literal"><span class="pre">matplotlib.axis.Axis</span></tt>)</a><a class="headerlink" href="#axis-matplotlib-axis-axis" title="Permalink to this headline">¶</a></h3>
<p>グラフの目盛、グリッド、目盛に付けるラベル等を管理する。
<tt class="docutils literal"><span class="pre">Axes</span></tt> オブジェクトの <tt class="docutils literal"><span class="pre">xaxis</span></tt> および <tt class="docutils literal"><span class="pre">yaxis</span></tt> メンバーでアクセスできる。</p>
<p>使用頻度の高いものだけ表にしておく。</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">メソッド名</th>
<th class="head">機能</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">get_major_ticks</span></tt></td>
<td>目盛 (<tt class="docutils literal"><span class="pre">matplotlib.ticker.Ticker</span></tt>)
オブジェクトを返す。</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">grid</span></tt></td>
<td>グリッド線を描画するしないを指示。</td>
</tr>
</tbody>
</table>
<div class="highlight-python3"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

<span class="c"># Y 軸方向の全目盛をいじる。</span>
<span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">():</span>
    <span class="n">tick</span><span class="o">.</span><span class="n">tick1On</span> <span class="o">=</span> <span class="k">False</span>   <span class="c"># 左側の目盛を隠す。</span>
    <span class="n">tick</span><span class="o">.</span><span class="n">tick2On</span> <span class="o">=</span> <span class="k">True</span>    <span class="c"># 右側の目盛を表示する。</span>
    <span class="n">tick</span><span class="o">.</span><span class="n">label1On</span> <span class="o">=</span> <span class="k">False</span>  <span class="c"># 左側の目盛ラベルを隠す。</span>
    <span class="n">tick</span><span class="o">.</span><span class="n">label2On</span> <span class="o">=</span> <span class="k">True</span>   <span class="c"># 右側の目盛ラベルを表示する。</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id15">
<h2><a class="toc-backref" href="#id44">バックエンド</a><a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<p>「プロッティングの出力先」と解釈していいか。</p>
<p>ユーザーインターフェイスバックエンドとハードコピーバックエンドの二種類がある。
前者はウィンドウ、後者はファイルと考えていいか。
それぞれ <tt class="docutils literal"><span class="pre">plt.show()</span></tt> と <tt class="docutils literal"><span class="pre">plt.savefig()</span></tt> の振る舞いに影響する。</p>
<div class="section" id="id16">
<h3><a class="toc-backref" href="#id45">ユーザーインターフェイスバックエンド</a><a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<p>rc パラメーターでバックエンドを指定する。
<tt class="file docutils literal"><span class="pre">matplotlibrc</span></tt> に記述するのであれば、こんな感じになる：</p>
<div class="highlight-cfg"><div class="highlight"><pre># PyQt4 によるウィンドウでグラフを描く。
# もちろん、PyQt4 が別途インストール済みであることが前提。
# ちなみに Qt5Agg は Matplotlib 1.3.x 時点では実装されていない。
backend : Qt4Agg
</pre></div>
</div>
<p>コードで動的に（実行時に）指定するのならばこうする。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s">&#39;Qt4Agg&#39;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/mpl-qt4agg.png"><img alt="_images/mpl-qt4agg.png" src="_images/mpl-qt4agg.png" style="width: 324.0px; height: 279.5px;" /></a>
<p>なお <tt class="docutils literal"><span class="pre">mpl.use</span></tt> 関数を呼び出すタイミングは、最初の <tt class="docutils literal"><span class="pre">import</span> <span class="pre">matplotlib</span></tt>
の直後がベストのようだ。</p>
<p>個人的にはユーザーインターフェイスバックエンドをカスタマイズすることはない。
デフォルトの <tt class="docutils literal"><span class="pre">TkAgg</span></tt> のままで十分だ。</p>
</div>
<div class="section" id="id17">
<h3><a class="toc-backref" href="#id46">ハードコピーバックエンド</a><a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<p>ハードコピーバックエンドのカスタマイズはこのノートの目的の一つ。</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">backend</span></tt> の値を <tt class="docutils literal"><span class="pre">PS</span></tt>, <tt class="docutils literal"><span class="pre">PDF</span></tt>, <tt class="docutils literal"><span class="pre">PNG</span></tt>, <tt class="docutils literal"><span class="pre">SVG</span></tt> のどれかにしておくと、
その名前の形式のファイルを作成することができる。</p>
<p>コードで実現するには、次のような手順にしておけばよい。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s">&#39;PDF&#39;</span><span class="p">)</span>  <span class="c"># PDF でイメージが欲しい。</span>

<span class="c"># ... プロッティングコマンド群がここに来る。</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;output&#39;</span><span class="p">)</span>  <span class="c"># ファイル output.pdf ができる。</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="id18">
<h2><a class="toc-backref" href="#id47">ヒストグラムを描く</a><a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h2>
<p>ノートを整理していたら未使用のスクリプトを発見したので、説明なしにここにコードを記す。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">rects</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span> <span class="mi">50</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;yellow&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_minor_ticks</span><span class="p">():</span>
    <span class="n">tick</span><span class="o">.</span><span class="n">tick1On</span> <span class="o">=</span> <span class="k">True</span>

<span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">():</span>
    <span class="n">tick</span><span class="o">.</span><span class="n">gridOn</span> <span class="o">=</span> <span class="k">True</span>
    <span class="n">tick</span><span class="o">.</span><span class="n">tick1On</span> <span class="o">=</span> <span class="k">False</span>
    <span class="n">tick</span><span class="o">.</span><span class="n">tick2On</span> <span class="o">=</span> <span class="k">True</span>
    <span class="n">tick</span><span class="o">.</span><span class="n">label1On</span> <span class="o">=</span> <span class="k">False</span>
    <span class="n">tick</span><span class="o">.</span><span class="n">label2On</span> <span class="o">=</span> <span class="k">True</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>最終的な描画結果は次のようなものとなる。乱数次第で分布が変化するので注意。</p>
<a class="reference internal image-reference" href="_images/mpl-histogram.png"><img alt="_images/mpl-histogram.png" src="_images/mpl-histogram.png" style="width: 407.5px; height: 307.5px;" /></a>
</div>
<div class="section" id="id19">
<h2><a class="toc-backref" href="#id48">曲線を描く</a><a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id20">
<h3><a class="toc-backref" href="#id49">多項式</a><a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<p>実数 x の多項式 f(x) について y = f(x) のグラフを描きたい。
次の容量で曲線を定義する。</p>
<ol class="arabic">
<li><p class="first">プロットする <tt class="docutils literal"><span class="pre">x</span></tt> のサンプル点を関数 <tt class="docutils literal"><span class="pre">numpy.arange</span></tt> で適宜準備する。
やり方を忘れていたら <a class="reference internal" href="python-numpy.html"><em>NumPy 利用ノート</em></a> を参照。</p>
</li>
<li><p class="first">多項式 <tt class="docutils literal"><span class="pre">f</span></tt> を関数 <tt class="docutils literal"><span class="pre">numpy.poly1d</span></tt> の戻り値で表現する。</p>
</li>
<li><p class="first">プロットする <tt class="docutils literal"><span class="pre">y</span></tt> を <tt class="docutils literal"><span class="pre">list</span></tt> の内包表現を利用して一気に得る。</p>
</li>
<li><p class="first">最後に <tt class="docutils literal"><span class="pre">plot(x,</span> <span class="pre">y)</span></tt> で曲線を描画する。</p>
<p>なお、サンプルコードではさらに曲線に対して接線を引いた。
<tt class="docutils literal"><span class="pre">f</span></tt> の一次導関数を <tt class="docutils literal"><span class="pre">f.deriv()</span></tt> で得られることを利用する。</p>
</li>
</ol>
<div class="highlight-python3"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="c"># x = 0, 1, 3 を根に持つ 3 次多項式。</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span> <span class="c"># x in [-2, 4] を 0.1 刻みでプロット。</span>
<span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span> <span class="c"># xs と対になる ys</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>

<span class="c"># x = [-1, 3] から 1 間隔に接線を引く。</span>
<span class="n">slope</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">deriv</span><span class="p">()</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">ys1</span> <span class="o">=</span> <span class="p">[</span><span class="n">slope</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>描画結果は次のようなものとなる。</p>
<a class="reference internal image-reference" href="_images/mpl-polynomial.png"><img alt="_images/mpl-polynomial.png" src="_images/mpl-polynomial.png" style="width: 407.5px; height: 307.5px;" /></a>
</div>
<div class="section" id="bezier">
<h3><a class="toc-backref" href="#id50">Bézier 曲線</a><a class="headerlink" href="#bezier" title="Permalink to this headline">¶</a></h3>
<p>本当は B-Spline 曲線を描画したいのだが、
調べてみると Matplotlib では Bézier 曲線が限界のようだ。</p>
<p>手順はこういう感じのようだ：</p>
<ol class="arabic simple">
<li>クラス <tt class="docutils literal"><span class="pre">matplotlib.path.Path</span></tt> のオブジェクトを作成する。
この引数として、Bézier 曲線の制御点リストと「打点命令」のリストを渡す。</li>
<li>そのパスオブジェクトを引数として、クラス
<tt class="docutils literal"><span class="pre">matplotlib.patches.PathPatch</span></tt> のオブジェクトを作成する。</li>
<li>そのパッチオブジェクトを対象の <tt class="docutils literal"><span class="pre">axes</span></tt> オブジェクトに <tt class="docutils literal"><span class="pre">add_patch</span></tt> する。</li>
</ol>
<p>Matplotlib は制御点列を与えて Bézier 曲線を定義する流儀のようだ。</p>
<p>まずは簡単な例を。最小の手間で 2 次の Bézier 曲線（単なる放物線）を定義することを考える。
<tt class="docutils literal"><span class="pre">CURVE3</span></tt> というタイプの曲線は、制御点を 3 つ与えることで 2 次の Bézier 曲線を表現できる。
<tt class="docutils literal"><span class="pre">CURVE3</span></tt> ベースの Bézier 曲線の特徴は次の通り。</p>
<ul class="simple">
<li>最初と最後の制御点は、放物線の始点と終点にそれぞれ一致する。</li>
<li>中間の制御点は、放物線の両端点それぞれの接線の交点と一致する。</li>
<li>よって、出来上がりの曲線形状が把握できる。</li>
</ul>
<p><tt class="docutils literal"><span class="pre">Path</span></tt> オブジェクト構築は次のようになる。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.path</span> <span class="k">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c"># Unset the face color.</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;patch.facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;none&#39;</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="c"># Define a quadric Bezier curve as path1.</span>
<span class="n">verts1</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">),</span> <span class="p">(</span><span class="mf">4.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)]</span>
<span class="n">codes1</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">]</span>

<span class="n">path1</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">verts1</span><span class="p">,</span> <span class="n">codes1</span><span class="p">)</span>
<span class="n">patch1</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">path1</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patch1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">verts1</span><span class="p">],</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">verts1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<p>もうひとつ例を。ドロー系アプリでもよく見かける 3 次の Bézier 曲線を定義する。</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">CURVE4</span></tt> 命令で制御点を指示する。</li>
<li>最初と最後の制御点は、曲線の始点と終点にそれぞれ一致する。</li>
<li>最初の制御点とその次の制御点を結ぶ直線が、曲線の始点での接線に一致する。
また、最後の制御点とその前の制御点を結ぶ直線が、曲線の終点での接線に一致する。</li>
<li>曲線全体は、制御点列からなる多角形の内部に位置する。</li>
</ul>
<p><tt class="docutils literal"><span class="pre">Path</span></tt> オブジェクト構築は次のようになる。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c"># Define a cubic Bezier curve as path2.</span>
<span class="n">verts2</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">),</span> <span class="p">(</span><span class="mf">4.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)]</span>
<span class="n">codes2</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE4</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE4</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE4</span><span class="p">,]</span>

<span class="n">path2</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">verts2</span><span class="p">,</span> <span class="n">codes2</span><span class="p">)</span>
<span class="n">patch2</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">PathPatch</span><span class="p">(</span><span class="n">path2</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patch2</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">verts2</span><span class="p">],</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">verts2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>最終的な描画結果は次のようなものとなる。</p>
<a class="reference internal image-reference" href="_images/mpl-bezier.png"><img alt="_images/mpl-bezier.png" src="_images/mpl-bezier.png" style="width: 407.5px; height: 307.5px;" /></a>
</div>
</div>
<div class="section" id="tex">
<h2><a class="toc-backref" href="#id51">TeX 表現</a><a class="headerlink" href="#tex" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">このノートにある外部実行ファイルを利用する機能各種の動作はほとんど確認していない。
MiKTeX をインストールしたら即実験する。</p>
</div>
<ul>
<li><p class="first">Matplotlib のすべてのテキスト API は TeX の数式を受け付けてくれる。
<tt class="docutils literal"><span class="pre">$</span></tt> で囲まれた部分が TeX 表現と認識されるようだ。
文字列はバックスラッシュの嵐になることが予想できるので、
raw string 形式で指定するのが吉。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="o">.</span><span class="mi">025</span><span class="p">,</span> <span class="s">r&#39;$\mu=100,\ \sigma=15$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">TeX 部分のテキストに適用するデフォルトのフォントを
rc 設定の <tt class="docutils literal"><span class="pre">mathtext.default</span></tt> パラメーターで指定できる。</p>
</li>
<li><p class="first">TeX テキストのレイアウトは通常 Matplotlib が内部で自前で持っているエンジンが行うが、
rc 設定を変更することで、外部の LaTeX エンジンを利用することもできる。</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">text.usetex</span></tt> が <tt class="docutils literal"><span class="pre">True</span></tt> になっていることが必要。</li>
<li>LaTeX, dvipng, GhostScript がシステムにインストールされていることが必要。</li>
<li>それらの実行ファイルのパスが環境変数 <tt class="docutils literal"><span class="pre">PATH</span></tt> に含まれていることが必要。</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id21">
<h2><a class="toc-backref" href="#id52">続・環境構築</a><a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h2>
<p>Matplotlib を利用するための環境をもっと細かく整備してみよう。</p>
<div class="section" id="home-matplotlib-matplotlibrc">
<h3><a class="toc-backref" href="#id53"><tt class="file docutils literal"><span class="pre">$HOME/.matplotlib/matplotlibrc</span></tt></a><a class="headerlink" href="#home-matplotlib-matplotlibrc" title="Permalink to this headline">¶</a></h3>
<p>ファイル名からわかるように、Matplotlib 環境のユーザー設定ファイルだ。
ドキュメントのセクション 5.1 &#8220;The matplotlibrc file&#8221; に詳しく記述がある。</p>
<ul>
<li><p class="first">Windows 環境でもユーザーがわざわざ環境変数 <tt class="docutils literal"><span class="pre">HOME</span></tt> を設定している場合は、
Matplotlib はきちんとそのパスを参照してくれる。</p>
</li>
<li><p class="first">一度でも Matplotlib を利用すると、
<tt class="docutils literal"><span class="pre">$HOME</span></tt> にフォルダー <tt class="file docutils literal"><span class="pre">.matplotlib</span></tt> ができている。
そこにテキストファイル <tt class="file docutils literal"><span class="pre">matplotlibrc</span></tt> を作成する。</p>
</li>
<li><p class="first">テンプレは <tt class="file docutils literal"><span class="pre">$PYTHONHOME/lib/site-packages/matplotlib/mpl-data/matplotlibrc</span></tt> を使う。</p>
<p>テンプレは基本的に設定コマンド？のコメントアウトで埋め尽くされている。
ここを眺めていればカスタマイズの方法は直感できる仕組みになっている。</p>
</li>
<li><p class="first"><tt class="file docutils literal"><span class="pre">matplotlibrc</span></tt> は python-mode で編集するのが吉。</p>
</li>
</ul>
</div>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="index.html">読書ノート v1.4.0dev</a> &raquo;</li> 
      </ul>
    </div>
    <div id="footer">
      <div id="footer_logo">
        <a class="imga" href="https://showa-yojyo.github.io/" title="プレハブ小屋 Since 1999"><img src="_static/logos.png" width="88" height="31" /></a>
      </div>
      <div id="footer_share">
        <a href="https://twitter.com/share" class="twitter-share-button" data-size="large">Tweet</a>
        <script type="text/javascript">render_twitter_button(document, 'script', 'twitter-wjs')</script>
      </div>
      <div id="footer_copyright">
        Since 1999<br />
        Copyright &copy; 1999-2014, プレハブ小屋 All rights reserved.
      </div>
      <div id="footer_spacer">
        <p>
          Last updated at 2014/11/29 (Sat) 02:35:26.
        </p>
      </div>
    </div>
  </body>
</html>