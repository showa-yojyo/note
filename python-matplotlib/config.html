<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>環境設定 &#8212; 読書ノート 1.6dev documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=1a9a5cd9" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=5a6f99c4"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/mermaid.js?v=578dbed1"></script>
    <link rel="next" title="NetworkX 利用ノート" href="../python-networkx/index.html" />
    <link rel="prev" title="見本コードを研究する" href="study.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
    <div class="related top">
      &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="study.html" title="Previous">見本コードを研究する</a>
        </li>
      
        <li>
          &uarr;
          <a href="index.html" title="Parent">Matplotlib 利用ノート</a>
        </li>
        <li>
          <a href="../python-networkx/index.html" title="Next">NetworkX 利用ノート</a>
          &rarr;
        </li>
    </ul>
  </nav>
    </div>


          <div class="body" role="main">
            
  <section id="id1">
<h1>環境設定<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h1>
<p><a class="reference external" href="https://matplotlib.org/">Matplotlib</a> を利用するための環境をもっと細かく整備してみよう。</p>
<nav class="contents local" id="id2">
<p class="topic-title">見出し一覧</p>
<ul class="simple">
<li><p><a class="reference internal" href="#matplotlibrc" id="id4">設定ファイル <code class="file docutils literal notranslate"><span class="pre">matplotlibrc</span></code> 概要</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id5">カスタマイズする</a></p></li>
</ul>
</nav>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>このページの一部に関しては次の動作環境を使用：</p>
<dl class="field-list simple">
<dt class="field-odd">OS<span class="colon">:</span></dt>
<dd class="field-odd"><p>Windows 10 Home x64 上の WSL2</p>
</dd>
<dt class="field-even">Python<span class="colon">:</span></dt>
<dd class="field-even"><p>3.12.3</p>
</dd>
<dt class="field-odd">Matplotlib<span class="colon">:</span></dt>
<dd class="field-odd"><p>3.8.4</p>
</dd>
</dl>
</div>
<section id="matplotlibrc">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">設定ファイル <code class="file docutils literal notranslate"><span class="pre">matplotlibrc</span></code> 概要</a><a class="headerlink" href="#matplotlibrc" title="Permalink to this heading">¶</a></h2>
<p>Matplotlib 環境のユーザー設定ファイルについて記す。</p>
<ul>
<li><p>Matplotlib が扱う、図式の寸法や図形の色といった、性質のほとんどを指定するために設定ファイルというものを利用することができる。</p></li>
<li><p>設定ファイル名は <code class="file docutils literal notranslate"><span class="pre">matplotlibrc</span></code> だ。</p></li>
<li><p>この設定ファイルによる設定のことを <strong>rc settings</strong> とか <strong>rc parameters</strong> とかと呼ぶ。</p></li>
<li><p>その設定ファイルのあるディレクトリーは次の優先度で決まる。</p>
<ol class="arabic">
<li><p>作業ディレクトリー。</p></li>
<li><p>ユーザーの環境依存のディレクトリー。</p>
<ul>
<li><p>Windows 環境でもユーザーがわざわざ環境変数 <code class="docutils literal notranslate"><span class="pre">HOME</span></code> を設定している場合は
Matplotlib はきちんとそのパスを参照してくれる。</p></li>
<li><p>一度でも Matplotlib を利用すると、<code class="file docutils literal notranslate"><span class="pre">$HOME</span></code> にフォルダー
<code class="file docutils literal notranslate"><span class="pre">.matplotlib</span></code> ができている。そこにテキストファイル
<code class="file docutils literal notranslate"><span class="pre">matplotlibrc</span></code> を自分で作成する。</p>
<p>WSL2 などの Linux 系環境では XDG 環境変数を利用するのが定石となっている。
Matplotlib の場合はこのようにしたい：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># E.g. in .bashrc:</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">MATPLOTLIBRC</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$XDG_CONFIG_HOME</span><span class="s2">/matplotlib&quot;</span>
</pre></div>
</div>
<p>次の状態にしたい：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;import matplotlib as mpl; print(mpl.get_configdir())&#39;</span>
<span class="go">/home/USERNAME/.config/matplotlib</span>
</pre></div>
</div>
<p>この運用では環境変数 <code class="docutils literal notranslate"><span class="pre">MATPLOTLIBRC</span></code> の定義を明示的に与える必要はないが、コンソールで <strong class="command">cd</strong> するときに便利だ。</p>
<p>既定の設定ファイルをそこへ移す：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$MATPLOTLIBRC</span>
<span class="gp">$ </span>mv<span class="w"> </span>~/.matplotlib/*<span class="w"> </span><span class="nv">$MATPLOTLIBRC</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../xdg.html"><span class="doc">XDG Base Directory 利用ノート</span></a></p>
</div>
</li>
</ul>
</li>
<li><p>Matplotlib インストール場所から決まるディレクトリー。</p>
<p>Matplotlib のアップグレードの度に上書きされると思っていたほうがよい。したがって、この設定ファイルを編集するような状況はまれだと思う。</p>
</li>
</ol>
</li>
<li><p>実際に参照される設定ファイルは、関数 <code class="docutils literal notranslate"><span class="pre">mpl.matplotlib_fname</span></code> の呼び出しで確認可能。</p></li>
<li><p>インストール場所から決まるディレクトリーに置いてある設定ファイルをコピー、編集して使う。</p>
<p>テンプレは基本的に設定コマンド？のコメントアウトで埋め尽くされている。ここを眺めていればカスタマイズの方法は直感できる仕組みになっている。</p>
</li>
<li><p>設定ファイル <code class="file docutils literal notranslate"><span class="pre">matplotlibrc</span></code> をテキストエディターで編集するときには、もし
python-mode 的な機能をサポートするエディターを使うのならば、それを ON にする。コードの見通しがよくなる（コメント文字列がコメント色になるだけだが）。</p></li>
</ul>
</section>
<section id="id3">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">カスタマイズする</a><a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h2>
<p>先述の方法でユーザー設定ファイルを生成し、次のように編集して手持ちのプロットの表示がどのように変化するのかを検証した。</p>
<ul>
<li><p>PyQt5 が使用可能な環境では試しに <code class="docutils literal notranslate"><span class="pre">backend</span> <span class="pre">:</span> <span class="pre">Qt5Agg</span></code> としてみる。</p>
<ul class="simple">
<li><p>経験則だが <code class="docutils literal notranslate"><span class="pre">backend</span></code> の項目だけは他の項目とは異なり、コメントアウトによるデフォルト値適用の解釈がなされないようだ。何らかのバックエンドを明示的に指定する必要があるもよう。</p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://docs.conda.io/en/latest/miniconda.html">Miniconda</a> 管理下における Python 3.5.2 環境では既定のバックエンドである TkAgg
が指定されたままであると、私の環境では実行時に Segmentation fault を引き起こす。そのため、唯一動作確認できたバックエンドである <code class="docutils literal notranslate"><span class="pre">backend</span> <span class="pre">:</span> <span class="pre">Qt4Agg``を、PyQt5</span>
<span class="pre">を利用可能な環境にあれば</span> <span class="pre">``backend</span> <span class="pre">:</span> <span class="pre">Qt5Agg</span></code> を設定してしのぎたい。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">plt.plot</span></code> の線の色は <code class="docutils literal notranslate"><span class="pre">axes.prop_cycle</span></code> で指定する。</p>
<ul>
<li><p>カンマ区切りで数色を一度に指定する。プロットを <code class="docutils literal notranslate"><span class="pre">plt.plot</span></code> 呼び出しで追加するたびに、カンマで区切られた色が cyclic に適用されるのだろう。これを確認するには <a class="reference internal" href="basic.html"><span class="doc">基本テク</span></a> で示したポリライン複数本描画スクリプトを利用できる。下記のリスト内の内容を修正すると、それにつれて曲線の色が変わることがわかる：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>axes.prop_cycle: cycler(&#39;color&#39;, [&#39;deeppink&#39;, &#39;pink&#39;, &#39;b&#39;, &#39;g&#39;, &#39;r&#39;, &#39;c&#39;, &#39;m&#39;, &#39;y&#39;, &#39;k&#39;])
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>LaTeX 周りの設定は要研究。特にフォントの指定は大切そうだ。</p></li>
<li><p>ハードコピーバックエンドのデフォルト値を <code class="docutils literal notranslate"><span class="pre">savefig.format</span></code> で設定できる。</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>savefig.format: png # png, ps, pdf, svg
</pre></div>
</div>
</li>
</ul>
</section>
</section>


          </div>
    <div class="related bottom">
      &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="study.html" title="Previous">見本コードを研究する</a>
        </li>
      
        <li>
          &uarr;
          <a href="index.html" title="Parent">Matplotlib 利用ノート</a>
        </li>
        <li>
          <a href="../python-networkx/index.html" title="Next">NetworkX 利用ノート</a>
          &rarr;
        </li>
    </ul>
  </nav>
    </div>

      </div>
      <div class="clearer"></div>
    </div>
<div class="footer">
  <ul>
    <li id="footer_logo">
      <a class="image-reference" href="../index.html" title="読書ノート Home"><img src="../_images/logo.svg"/></a>
    </li>
    <li id="footer_copyright">
      Copyright &copy; 1999-2024, プレハブ小屋 All rights reserved.
    </li>
  </ul>
</div>
  </body>
</html>