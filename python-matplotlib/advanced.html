
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>応用テク &#8212; 読書ノート v1.5dev</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/prefab.css" />
    
    <script src="../_static/mathjax-v3.js"></script>
    <script src="../_static/mermaid.js"></script>
    
    <link rel="next" title="見本コードを研究する" href="study.html" />
    <link rel="prev" title="基本テク" href="basic.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="study.html" title="見本コードを研究する"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="basic.html" title="基本テク"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">読書ノート</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Matplotlib 利用ノート</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">応用テク</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <section id="id1">
<h1><a class="toc-backref" href="#id4">応用テク</a><a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h1>
<p>本稿では LaTeX 表記の実現や 3D プロット等、比較的高度な <a class="reference external" href="https://matplotlib.org/">Matplotlib</a> の機能を利用する。</p>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#id1" id="id4">応用テク</a></p>
<ul>
<li><p><a class="reference internal" href="#latex" id="id5">LaTeX 表現</a></p></li>
<li><p><a class="reference internal" href="#id2" id="id6">3 次元プロット</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="latex">
<h2><a class="toc-backref" href="#id5">LaTeX 表現</a><a class="headerlink" href="#latex" title="Permalink to this heading">¶</a></h2>
<p>Matplotlib のプロットに LaTeX 書式の画像化を埋め込む方法を説明する。</p>
<p>Matplotlib のすべてのテキスト API は LaTeX の数式を受け付けてくれる。文字列内の <code class="docutils literal notranslate"><span class="pre">$</span></code> で囲まれた部分が LaTeX 表現と認識されるようだ。何も工夫しないでいると文字列がバックスラッシュの嵐になるので、
Python のコードで raw string 形式で数式を含む文字列を定義するのが吉だろう。</p>
<p>次のスクリプトは Matplotlib のサンプルコードを一部改変したものである。
<a class="reference external" href="https://ipython.org/">IPython</a> を起動していれば、下記コードをクリップボードにコピーして、コンソールで <code class="code docutils literal notranslate"><span class="pre">%paste</span></code> すれば結果が見られる。</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="sd">&quot;&quot;&quot;tex.py: Demonstrate how to use TeX notation in Matplotlib.</span>

<span class="sd">You can obtain the original script file from:</span>
<span class="sd">From http://matplotlib.org/mpl_examples/statistics/histogram_demo_features.py</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">randn</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># pylint: disable=invalid-name</span>

<span class="n">NPDF_TEX</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">$\frac</span><span class="si">{1}</span><span class="s1">{\sqrt{2 \pi}\sigma} \exp\left(-\frac{(x - \mu)^</span><span class="si">{2}</span><span class="s1">}{2 \sigma ^</span><span class="si">{2}</span><span class="s1">}\right)$</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="c1"># example data</span>
<span class="n">MU</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># mean of distribution</span>
<span class="n">SIGMA</span> <span class="o">=</span> <span class="mi">15</span> <span class="c1"># standard deviation of distribution</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">MU</span> <span class="o">+</span> <span class="n">SIGMA</span> <span class="o">*</span> <span class="n">randn</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>

<span class="n">NUM_BINS</span> <span class="o">=</span> <span class="mi">50</span>
<span class="c1"># the histogram of the data</span>
<span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">NUM_BINS</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;deeppink&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;random&#39;</span><span class="p">)</span>

<span class="c1"># add a &#39;best fit&#39; line</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">MU</span><span class="p">,</span> <span class="n">SIGMA</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">NPDF_TEX</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Smarts&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probability&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;Histogram of IQ: $\mu=</span><span class="si">{</span><span class="n">MU</span><span class="si">}</span><span class="s1">$, $\sigma=</span><span class="si">{</span><span class="n">SIGMA</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Tweak spacing to prevent clipping of ylabel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>実行結果は次のような画像の表示となる（良いグラフとはとても言えない）。乱数を利用しているヒストグラム部分は毎回絵が変わる。図の凡例およびキャプション後半に注意して欲しい。ギリシア文字を含む数式が見える。</p>
<ul class="simple">
<li><p>凡例内の数式は関数 <code class="code docutils literal notranslate"><span class="pre">plt.plot</span></code> のキーワード引数 <code class="docutils literal notranslate"><span class="pre">label</span></code> の値の LaTeX と対応している。</p></li>
<li><p>図のキャプションのギリシア文字は、関数 <code class="code docutils literal notranslate"><span class="pre">plt.title</span></code> に渡す値の LaTeX と対応している。</p></li>
</ul>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/mpl-tex.png"><img alt="LaTeX 数式" src="../_images/mpl-tex.png" style="width: 407.5px; height: 307.5px;" /></a>
</figure>
</section>
<section id="id2">
<h2><a class="toc-backref" href="#id6">3 次元プロット</a><a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h2>
<p>曲面を描画することもあるのでプロットという表現が微妙なのだが、とにかく空間的に 3 次元のデータを図にすることができる。</p>
<figure class="align-center" id="id3">
<span id="scipy-spline-3d"></span><a class="reference internal image-reference" href="../_images/scipy-spline-3d.png"><img alt="空間曲線のプロット" src="../_images/scipy-spline-3d.png" style="width: 320.0px; height: 240.0px;" /></a>
<figcaption>
<p><span class="caption-text">空間曲線のプロット</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>パッケージ <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> と同じ階層に <code class="docutils literal notranslate"><span class="pre">mpl_toolkits</span></code> という別のパッケージがある。ここにある機能を利用すると、3 次元プロットをウィンドウに描画することができる。これはマウス操作によるビューのズームおよび回転を実現している優れものである。</p>
<p>ノート <a class="reference internal" href="../python-scipy/interpolate.html"><span class="doc">補間</span></a> で示した例を再掲する。</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="sd">&quot;&quot;&quot;interp_spline_3d.py: Demonstrate spline interpolation.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">splprep</span><span class="p">,</span> <span class="n">splev</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="c1"># pylint: disable=unused-import</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>

<span class="c1"># pylint: disable=invalid-name, bad-whitespace</span>

<span class="c1"># Set 3D points.</span>
<span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span>   <span class="mi">0</span><span class="p">],</span>  <span class="c1"># x</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>  <span class="c1"># y</span>
     <span class="p">[</span><span class="mi">0</span><span class="p">,</span>  <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">]])</span> <span class="c1"># z</span>

<span class="c1"># Interpolate points by a 3D curve.</span>
<span class="n">tck</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">splprep</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

<span class="c1"># Print the spline curve.</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">formatter</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;float&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">},</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;knot vector:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">tck</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;control points:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tck</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;degree:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">tck</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;parameter values: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>

<span class="c1"># Evaluate the curve at each parameter i in u.</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">xyz</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">splev</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">tck</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;f(</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">) = </span><span class="si">{</span><span class="n">xyz</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Plot points and the curve.</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xs</span><span class="o">=</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ys</span><span class="o">=</span><span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">zs</span><span class="o">=</span><span class="n">points</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;target points&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="o">=</span><span class="n">tck</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ys</span><span class="o">=</span><span class="n">tck</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">zs</span><span class="o">=</span><span class="n">tck</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;pink&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;control points&#39;</span><span class="p">)</span>

<span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">u</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">tck</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ys</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">zs</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;deeppink&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;cubic spline&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">points</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
    <span class="n">ptlabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">pt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ptlabel</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Matplotlib 関連の処理の説明を補足する（曲線データに関しての説明は先のページを参照）。</p>
<ul class="simple">
<li><p>関数 <code class="code docutils literal notranslate"><span class="pre">gca</span></code> の呼び出しでカレントの Axes を指定する際に、キーワード引数 <code class="docutils literal notranslate"><span class="pre">projection</span></code> を <code class="docutils literal notranslate"><span class="pre">3d</span></code> とすることで 3D プロット専用の Axes を生成し、同時にカレントにセットする。</p>
<ul>
<li><p>このメソッド呼び出しが成功するには Axes3D のインポートが必要。
Pylint に警告されても必要。</p></li>
</ul>
</li>
<li><p>メソッド <code class="code docutils literal notranslate"><span class="pre">cur_axes.scatter</span></code> と <code class="code docutils literal notranslate"><span class="pre">cur_axes.plot</span></code> を用いて次の形状をプロットする。</p>
<ol class="arabic simple">
<li><p>入力データである通過点 (black)</p></li>
<li><p><a class="reference external" href="https://www.scipy.org/">SciPy</a> で計算した、出力データである 3 次元スプライン曲線の制御点列 (pink)</p></li>
<li><p>出力データである 3 次元スプライン曲線 (deeppink)</p></li>
</ol>
</li>
<li><p>メソッド <code class="code docutils literal notranslate"><span class="pre">cur_axes.text</span></code> で通過点のプロットにその xyz 座標をテキストとして表示する。</p></li>
<li><p>各種メソッドでラベルや凡例を図に添える。</p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="study.html" title="見本コードを研究する"
             >next</a></li>
        <li class="right" >
          <a href="basic.html" title="基本テク"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">読書ノート</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Matplotlib 利用ノート</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">応用テク</a></li> 
      </ul>
    </div>
    <div id="footer">
      <div id="footer_logo">
        <a class="imga" href="https://showa-yojyo.github.io/" title="プレハブ小屋 Since 1999"><img src="../_static/logos.png" width="88" height="31" /></a>
      </div>
      <div id="footer_copyright">
        Since 1999<br />
        Copyright &copy; 1999-2022, プレハブ小屋 All rights reserved.
      </div>
    </div>
  </body>
</html>