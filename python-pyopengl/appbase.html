<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>クラス AppBase の実装 &#8212; 読書ノート 1.5dev documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=1a9a5cd9" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=20d9222b"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/mermaid.js?v=578dbed1"></script>
    <link rel="next" title="クラス DeprecatedApp の実装" href="deprecatedapp.html" />
    <link rel="prev" title="PyOpenGL プログラムに頻出する技法・注意点" href="tips.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="tips.html" title="Previous document">PyOpenGL プログラムに頻出する技法・注意点</a>
        </li>
        <li>
          <a href="deprecatedapp.html" title="Next document">クラス <code class="docutils literal notranslate"><span class="pre">DeprecatedApp</span></code> の実装</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <section id="appbase">
<h1><a class="toc-backref" href="#id4" role="doc-backlink">クラス <code class="docutils literal notranslate"><span class="pre">AppBase</span></code> の実装</a><a class="headerlink" href="#appbase" title="Permalink to this heading">¶</a></h1>
<p>単純な PyOpenGL のプログラムは、どれも構造と手続きが似通ったものになる。このノートではサンプルプログラムを多数書くつもりでいるので、それらに共通しているプログラミング要素を、オブジェクト指向プログラミング的着想によってクラスとしてカプセル化しておく。</p>
<p>ただし、歴史的な事情によりそのようなクラスを単一のクラスで表現し切ることは無理があるようだ。 OpenGL 3.0 以前と以後とで、プログラミングの方法論がまるで別物なので、以前、以後に対応するベースクラスをそれぞれ設計することになる。</p>
<p>本稿では、それらのベースクラスのベースクラス <code class="docutils literal notranslate"><span class="pre">AppBase</span></code> を設計する。</p>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#appbase" id="id4">クラス <code class="docutils literal notranslate"><span class="pre">AppBase</span></code> の実装</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id5">クラス <code class="docutils literal notranslate"><span class="pre">AppBase</span></code></a></p>
<ul>
<li><p><a class="reference internal" href="#id2" id="id6">機能概要</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id7">利用方法</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<section id="id1">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">クラス <code class="docutils literal notranslate"><span class="pre">AppBase</span></code></a><a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h2>
<p>先にクラス全景を次に示す。</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="sd">&quot;&quot;&quot;appbase.py: Define class AppBase.</span>

<span class="sd">Reference:</span>
<span class="sd">  * rndblnch / opengl-programmable &lt;bitbucket.org/rndblnch/opengl-programmable&gt;</span>
<span class="sd">  * Simple Demo for GLSL &lt;www.lighthouse3d.com&gt;</span>
<span class="sd">  * OpenGLBook.com &lt;openglbook.com&gt;</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># pylint: disable=unused-argument, no-self-use, invalid-name</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="p">(</span><span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">OpenGL.GL</span> <span class="k">as</span> <span class="nn">GL</span>
<span class="kn">import</span> <span class="nn">OpenGL.GLUT</span> <span class="k">as</span> <span class="nn">GLUT</span>
<span class="kn">from</span> <span class="nn">Quaternion</span> <span class="kn">import</span> <span class="n">Quat</span>
<span class="kn">from</span> <span class="nn">viewnavigation</span> <span class="kn">import</span> <span class="p">(</span><span class="n">ViewRotate</span><span class="p">,</span> <span class="n">ViewZoom</span><span class="p">)</span>

<span class="n">CONTEXT_VERSION</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">WINDOW_TITLE</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;PyOpenGL Demo&quot;</span>
<span class="n">WINDOW_SX</span><span class="p">,</span> <span class="n">WINDOW_SY</span> <span class="o">=</span> <span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">240</span><span class="p">)</span>
<span class="n">WINDOW_X</span><span class="p">,</span> <span class="n">WINDOW_Y</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">PERSPECTIVE_FOVY</span> <span class="o">=</span> <span class="mf">45.0</span>
<span class="n">PERSPECTIVE_NEAR</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">PERSPECTIVE_FAR</span> <span class="o">=</span> <span class="mf">100.0</span>
<span class="n">CAMERA_EYE</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
<span class="n">CAMERA_CENTER</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
<span class="n">CAMERA_UP</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>

<span class="c1"># pylint: disable=too-many-instance-attributes</span>
<span class="k">class</span> <span class="nc">AppBase</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class represents skeleton of OpenGL programs.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize an instance of class AppBase.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame_count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># parameters for GLUT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_version</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;context_version&#39;</span><span class="p">,</span> <span class="n">CONTEXT_VERSION</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window_title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;window_title&#39;</span><span class="p">,</span> <span class="n">WINDOW_TITLE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;window_size&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">WINDOW_SX</span><span class="p">,</span> <span class="n">WINDOW_SY</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window_position</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;window_position&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">WINDOW_X</span><span class="p">,</span> <span class="n">WINDOW_Y</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mouse_event_handlers</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># paramters for gluPerspective/perspective</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fovy</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;perspective_fovy&#39;</span><span class="p">,</span> <span class="n">PERSPECTIVE_FOVY</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">znear</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;perspective_near&#39;</span><span class="p">,</span> <span class="n">PERSPECTIVE_NEAR</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zfar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;perspective_far&#39;</span><span class="p">,</span> <span class="n">PERSPECTIVE_FAR</span><span class="p">)</span>

        <span class="c1"># parameters for gluLookAt/lookat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera_eye</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;camera_eye&#39;</span><span class="p">,</span> <span class="n">CAMERA_EYE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera_center</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;camera_center&#39;</span><span class="p">,</span> <span class="n">CAMERA_CENTER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera_up</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;camera_up&#39;</span><span class="p">,</span> <span class="n">CAMERA_UP</span><span class="p">)</span>

        <span class="c1"># parameters for glMultMatrix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quat</span> <span class="o">=</span> <span class="n">Quat</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">program_manager</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run a program.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_glut</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_program</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_gl</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_mouse_event_handlers</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_texture</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_object</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_transform</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">GLUT</span><span class="o">.</span><span class="n">glutMainLoop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">init_glut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the GLUT state.&quot;&quot;&quot;</span>

        <span class="c1"># Initialize GLUT.</span>
        <span class="n">GLUT</span><span class="o">.</span><span class="n">glutInit</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

        <span class="n">GLUT</span><span class="o">.</span><span class="n">glutInitContextVersion</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context_version</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_version</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">GLUT</span><span class="o">.</span><span class="n">glutInitContextFlags</span><span class="p">(</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_FORWARD_COMPATIBLE</span><span class="p">)</span>
        <span class="n">GLUT</span><span class="o">.</span><span class="n">glutInitContextProfile</span><span class="p">(</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_CORE_PROFILE</span><span class="p">)</span>

        <span class="n">GLUT</span><span class="o">.</span><span class="n">glutSetOption</span><span class="p">(</span>
            <span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_ACTION_ON_WINDOW_CLOSE</span><span class="p">,</span>
            <span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_ACTION_GLUTMAINLOOP_RETURNS</span><span class="p">)</span>

        <span class="c1"># Initialize and create the main window.</span>
        <span class="n">GLUT</span><span class="o">.</span><span class="n">glutInitDisplayMode</span><span class="p">(</span>
            <span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_DOUBLE</span> <span class="o">|</span> <span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_RGBA</span> <span class="o">|</span> <span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_DEPTH</span><span class="p">)</span>
        <span class="n">GLUT</span><span class="o">.</span><span class="n">glutInitWindowSize</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">GLUT</span><span class="o">.</span><span class="n">glutInitWindowPosition</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">window_position</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">GLUT</span><span class="o">.</span><span class="n">glutCreateWindow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_title</span><span class="p">)</span>

        <span class="n">GLUT</span><span class="o">.</span><span class="n">glutDisplayFunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">)</span>
        <span class="n">GLUT</span><span class="o">.</span><span class="n">glutIdleFunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idle</span><span class="p">)</span>
        <span class="n">GLUT</span><span class="o">.</span><span class="n">glutReshapeFunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resize</span><span class="p">)</span>
        <span class="n">GLUT</span><span class="o">.</span><span class="n">glutKeyboardFunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span><span class="p">)</span>
        <span class="n">GLUT</span><span class="o">.</span><span class="n">glutTimerFunc</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">GLUT</span><span class="o">.</span><span class="n">glutMouseFunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mouse</span><span class="p">)</span>
        <span class="n">GLUT</span><span class="o">.</span><span class="n">glutMotionFunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">motion</span><span class="p">)</span>
        <span class="n">GLUT</span><span class="o">.</span><span class="n">glutCloseFunc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span><span class="p">)</span>

        <span class="n">aspects</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Vendor&#39;</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_VENDOR</span><span class="p">),</span>
                   <span class="p">(</span><span class="s1">&#39;Renderer&#39;</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_RENDERER</span><span class="p">),</span>
                   <span class="p">(</span><span class="s1">&#39;Version&#39;</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_VERSION</span><span class="p">),]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_version</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">aspects</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;GLSL&#39;</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_SHADING_LANGUAGE_VERSION</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">aspects</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                  <span class="n">GL</span><span class="o">.</span><span class="n">glGetString</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">()),</span>
                  <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">init_program</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup shaders.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_shader_sources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return shader sources.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">init_mouse_event_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize view nagivation&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mouse_event_handlers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ViewRotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_LEFT_BUTTON</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouse_event_handlers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ViewZoom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_RIGHT_BUTTON</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">init_gl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the OpenGL state.&quot;&quot;&quot;</span>

        <span class="n">GL</span><span class="o">.</span><span class="n">glEnable</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_DEPTH_TEST</span><span class="p">)</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glClearColor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">init_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Override this method.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">init_texture</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize textures.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">init_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize VM transforms.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The reshape callback function.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">GL</span><span class="o">.</span><span class="n">glViewport</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_projection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fovy</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_projection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fovy</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the projection matrix.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">update_rotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quat</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the model transform.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The display callback function.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glClear</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">GL_COLOR_BUFFER_BIT</span> <span class="o">|</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_DEPTH_BUFFER_BIT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_render</span><span class="p">()</span>
        <span class="n">GLUT</span><span class="o">.</span><span class="n">glutSwapBuffers</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">timer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The timer callback function.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">caption</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1"> frames per secound @ </span><span class="si">{}</span><span class="s1"> x </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">window_title</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frame_count</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
                <span class="n">GLUT</span><span class="o">.</span><span class="n">glutGet</span><span class="p">(</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_WINDOW_WIDTH</span><span class="p">),</span>
                <span class="n">GLUT</span><span class="o">.</span><span class="n">glutGet</span><span class="p">(</span><span class="n">GLUT</span><span class="o">.</span><span class="n">GLUT_WINDOW_HEIGHT</span><span class="p">))</span>

            <span class="n">GLUT</span><span class="o">.</span><span class="n">glutSetWindowTitle</span><span class="p">(</span><span class="n">caption</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frame_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">GLUT</span><span class="o">.</span><span class="n">glutTimerFunc</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># a quarter of a second</span>

    <span class="k">def</span> <span class="nf">idle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The idle callback function.&quot;&quot;&quot;</span>
        <span class="n">GLUT</span><span class="o">.</span><span class="n">glutPostRedisplay</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">keyboard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The new keyboard callback function.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">ord</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="mo">0o33</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Exit&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

        <span class="n">GLUT</span><span class="o">.</span><span class="n">glutPostRedisplay</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">mouse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The mouse callback function.&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_event_handlers</span><span class="p">:</span>
            <span class="n">handler</span><span class="o">.</span><span class="n">mouse</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">motion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The motion callback function.&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_event_handlers</span><span class="p">:</span>
            <span class="n">handler</span><span class="o">.</span><span class="n">motion</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The clean up callback function.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">do_render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Override this method.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>このクラスの目的は次のとおりだ：</p>
<ul class="simple">
<li><p>新しいサンプルコードを書くときは、このクラスのサブクラスを定義する形にすることで、コードの重複を積極的に少なくする。特にメソッドのオーバーライドにより、描画や操作の「差分」の実装だけで済むようにする。</p></li>
<li><p>サブクラスでコンテキストバージョンを指定することで、そのアプリケーションが
deprecated features を採用するかどうかを明示する。</p></li>
<li><p>コンテキスト情報の出力や FPS の表示等、全サンプルコードが利用しがちな機能を提供する。</p></li>
</ul>
<p>このクラスの利用方法は後述のページで見ていくことになるので、このページの残りでは、このクラス自体のポイントを記す。</p>
<section id="id2">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">機能概要</a><a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h3>
<p>クラス <code class="docutils literal notranslate"><span class="pre">AppBase</span></code> で実装する機能を述べる。</p>
<dl>
<dt>コンテキストバージョン指定機能</dt><dd><p>OpenGL のコンテキストバージョンをコンストラクターで指定できる。サブクラスから指定することになる。</p>
</dd>
<dt>ウィンドウタイトル設定機能</dt><dd><p>ウィンドウタイトルバーに表示するタイトル文字列を指定できる。ただし、アスキー文字のみのもよう。</p>
</dd>
<dt>FPS リアルタイム表示機能</dt><dd><p>ウィンドウタイトルバーに FPS を表示する。0.25 秒ごとに更新。</p>
</dd>
<dt>ウィンドウサイズ・位置の指定機能</dt><dd><p>ウィンドウの初期サイズ、初期表示位置をクラスのコンストラクターで指定できる。</p>
</dd>
<dt>OpenGL サポートバージョン情報表示機能</dt><dd><p>ウィンドウ表示までに、次のような情報をコンソールに出力する。最後の GLSL に関する情報については、プログラムが利用する OpenGL のバージョンが 2.0 以上のときしか表示しないし、することができない。</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Vendor: Intel
Renderer: Intel(R) HD Graphics
Version: 3.1.0 - Build 9.17.10.4101
GLSL: 1.40 - Intel Build 9.17.10.4101
</pre></div>
</div>
</dd>
<dt>ウィンドウサイズ変更時ビューポート自動更新機能</dt><dd><p>ウィンドウサイズ変更時に可能な限り OpenGL のビューポートをウィンドウの全クライアント領域に更新する。</p>
</dd>
<dt>マウスドラッグによるズーム・回転機能</dt><dd><p>左ボタンドラッグで描画モデルの回転、右ボタンドラッグでモデルにズームする。
<a class="reference internal" href="view-navigation.html"><span class="doc">回転とズーム</span></a> も参照。</p>
</dd>
<dt>透視射影パラメーターの設定機能</dt><dd><p>関数 <code class="docutils literal notranslate"><span class="pre">gluPerspective</span></code> またはそれと同等のパラメーターを任意に設定可能。</p>
</dd>
<dt>カメラパラメーターの設定機能</dt><dd><p>関数 <code class="docutils literal notranslate"><span class="pre">gluLookAt</span></code> またはそれと同等のパラメーターを任意に設定可能。</p>
</dd>
<dt>GLSL オブジェクトの管理機能</dt><dd><p>プログラムオブジェクトをシェーダーオブジェクトの生成、破棄処理を管理する。詳細は <a class="reference internal" href="program-manager.html"><span class="doc">シェーダープログラム管理クラス</span></a> を参照。</p>
</dd>
<dt>アプリケーション終了機能</dt><dd><p><kbd class="kbd docutils literal notranslate">Esc</kbd> キーを押すと、アプリケーションを終了する。</p>
</dd>
</dl>
</section>
<section id="id3">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">利用方法</a><a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h3>
<p>本クラスはオブジェクト化して利用するのではなく、ベースクラスとして利用する。サブクラスとしてアプリケーションを実装するサンプルのときに記す。</p>
</section>
</section>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="tips.html" title="Previous document">PyOpenGL プログラムに頻出する技法・注意点</a>
        </li>
        <li>
          <a href="deprecatedapp.html" title="Next document">クラス <code class="docutils literal notranslate"><span class="pre">DeprecatedApp</span></code> の実装</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
      </div>
      <div class="clearer"></div>
    </div>
<div class="footer">
  <ul>
    <li id="footer_logo">
      <a class="image-reference" href="https://showa-yojyo.github.io/" title="プレハブ小屋 Since 1999"><img src="../_static/logos.png"/></a>
    </li>
    <li id="footer_copyright">
      Copyright &copy; 1999-2023, プレハブ小屋 All rights reserved.
    </li>
  </ul>
</div>
  </body>
</html>