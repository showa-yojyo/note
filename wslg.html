<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Windows Subsystem for Linux GUI 利用ノート &#8212; 読書ノート 1.6dev documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=c9b0a06a" />
    <script src="_static/documentation_options.js?v=4354bf25"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/mermaid.js?v=578dbed1"></script>
    <link rel="next" title="Visual Studio Code 利用ノート" href="vscode/index.html" />
    <link rel="prev" title="Windows Subsystem for Linux 利用ノート" href="wsl.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
    <div class="related top">
      &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="wsl.html" title="Previous">Windows Subsystem for Linux 利用ノート</a>
        </li>
      
        <li>
          <a href="vscode/index.html" title="Next">Visual Studio Code 利用ノート</a>
          &rarr;
        </li>
    </ul>
  </nav>
    </div>


          <div class="body" role="main">
            
  <section id="windows-subsystem-for-linux-gui">
<h1><a class="toc-backref" href="#id8" role="doc-backlink">Windows Subsystem for Linux GUI 利用ノート</a><a class="headerlink" href="#windows-subsystem-for-linux-gui" title="Link to this heading">¶</a></h1>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#windows-subsystem-for-linux-gui" id="id8">Windows Subsystem for Linux GUI 利用ノート</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id9">目的</a></p></li>
<li><p><a class="reference internal" href="#wslg" id="id10">WSLg をインストール・更新する</a></p>
<ul>
<li><p><a class="reference internal" href="#wsl" id="id11">WSL のインストールがされていない場合</a></p></li>
<li><p><a class="reference internal" href="#id2" id="id12">WSLg 稼働実績がない場合</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id13">WSLg を更新する</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id4" id="id14">WSLg をアンインストールする</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id15">動作確認</a></p>
<ul>
<li><p><a class="reference internal" href="#windows" id="id16">Windows から</a></p></li>
<li><p><a class="reference internal" href="#ubuntu" id="id17">Ubuntu から</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id6" id="id18">実践例</a></p></li>
<li><p><a class="reference internal" href="#id7" id="id19">文献</a></p></li>
</ul>
</li>
</ul>
</nav>
<p>WSLg に関する利用ノートをつづる。次の課題を解決したい：</p>
<ul class="simple">
<li><p>インストールおよびアップグレードの方法を会得する。</p></li>
<li><p>WSLg を管理する方法を会得する。</p></li>
<li><p>Linux GUI アプリケーションを起動する方法を会得する。</p></li>
<li><p>起動不能問題を解決する方法を知る。</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>本稿でも引き続き WSL と単に言う場合でも WSL 2 を指す。ただし、インストールは現在完了していて正常に稼働しているとする。</p>
<p>WSL の distribution は Ubuntu しかインストールしていないので、以下の記述で
Ubuntu とある部分すべてを他の distribution に置換して読んでも、機能として成立するはずだ。</p>
<p>WSLg に関する作業に限った話ではないが、Ubuntu パッケージを新しくインストールする前には必ず <code class="docutils literal notranslate"><span class="pre">apt</span> <span class="pre">update</span></code> を実行しておくものとする。</p>
<p>本稿執筆時の環境情報は次のとおり：</p>
<dl class="field-list simple">
<dt class="field-odd">Windows<span class="colon">:</span></dt>
<dd class="field-odd"><p>Home version 22H2 Build 19045.2908</p>
</dd>
<dt class="field-even">GPU<span class="colon">:</span></dt>
<dd class="field-even"><p>Intel HD Graphics 4600</p>
</dd>
<dt class="field-odd">WSL 2<span class="colon">:</span></dt>
<dd class="field-odd"><p>5.15.90.1</p>
</dd>
<dt class="field-even">WSLg<span class="colon">:</span></dt>
<dd class="field-even"><p>1.0.50</p>
</dd>
<dt class="field-odd">Ubuntu<span class="colon">:</span></dt>
<dd class="field-odd"><p>22.04.2 LTS</p>
</dd>
</dl>
</div>
<section id="id1">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">目的</a><a class="headerlink" href="#id1" title="Link to this heading">¶</a></h2>
<p>画像を表示したり、音声を再生したりする Linux プログラムを正常に実行したい。ここでいう Linux プログラムは、結果としてそうなるものも含む。例えば、Matplotlib プロットを出力する Python スクリプトなども含まれる。</p>
<p>メディアファイルの内容を確認するだけならば Windows 側のアプリケーションを呼び出せば十分だが、どうしても WSL 側でウィンドウを生成したい場合がある：</p>
<ul class="simple">
<li><p>Pillow の <code class="docutils literal notranslate"><span class="pre">show</span></code> またはそれを間接的に利用するアプリケーション</p></li>
<li><p>FFmpeg の <code class="docutils literal notranslate"><span class="pre">ffplay</span></code></p></li>
</ul>
<p>幸い、最近になって WSLg というものが Windows 10 の WSL でも動作するようになってくれた。WSLg とは何か、開発陣の言葉から引用するとこうだ：</p>
<blockquote>
<div><p>WSLg is short for Windows Subsystem for Linux GUI and the purpose of the
project is to enable support for running Linux GUI applications (X11 and
Wayland) on Windows in a fully integrated desktop experience.</p>
</div></blockquote>
<p>コマンドラインから GUI を起動できるのはひじょうに便利なので、環境構築を確実にしたい。</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p><a class="reference internal" href="python-pillow.html"><span class="doc">Pillow 利用ノート</span></a></p></li>
<li><p><a class="reference internal" href="python-matplotlib/index.html"><span class="doc">Matplotlib 利用ノート</span></a></p></li>
<li><p><a class="reference internal" href="ffmpeg/index.html"><span class="doc">FFmpeg 利用ノート</span></a></p></li>
</ul>
</div>
</section>
<section id="wslg">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">WSLg をインストール・更新する</a><a class="headerlink" href="#wslg" title="Link to this heading">¶</a></h2>
<p>私の環境は前述のとおり WSL が稼働している。ここでは WSL のインストールについては述べず、WSLg のインストール、更新、状態確認に集中して記述する。</p>
<section id="wsl">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">WSL のインストールがされていない場合</a><a class="headerlink" href="#wsl" title="Link to this heading">¶</a></h3>
<blockquote>
<div><p>From a command prompt with administrator privileges, run the command <code class="docutils literal notranslate"><span class="pre">wsl</span>
<span class="pre">--install</span> <span class="pre">-d</span> <span class="pre">Ubuntu</span></code>, then reboot if prompted.
（中略）
Voilà! WSL and WSLg are installed and ready to be used!</p>
</div></blockquote>
<p>WSL すらインストールされていない場合、それをインストールすれば WSLg も同時にインストールされると開発陣の文書に述べられている。そちらのほうが話が早いので、このノートは不要かもしれない。</p>
<p>したがって、Windows PC を新調する場合には、難しいことを気にせずに済みそうだ。</p>
</section>
<section id="id2">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">WSLg 稼働実績がない場合</a><a class="headerlink" href="#id2" title="Link to this heading">¶</a></h3>
<p>WSLg を一度も動作したことがない場合には Windows 側のコンソールで次のコマンドを実行しておく必要があるはずだ：</p>
<div class="highlight-posh notranslate"><div class="highlight"><pre><span></span><span class="p">&gt;</span> <span class="n">wsl</span> <span class="p">-</span><span class="n">-update</span>
<span class="p">&gt;</span> <span class="n">wsl</span> <span class="p">-</span><span class="n">-shutdown</span>
</pre></div>
</div>
<p>コツをまとめる：</p>
<ul class="simple">
<li><p>すべての <strong class="command">wsl</strong> コマンドは管理者として実行する。</p></li>
<li><p>コマンド <strong class="command">wsl --update</strong> は WSL と WSLg の両方を最新に更新すると覚えておいて間違いない。</p></li>
<li><p>変更を有効にするには WSL の再起動が要る。そのための <strong class="command">wsl --shutdown</strong>
だ。このコマンドはいつもならメモリー確保目的で実行しているものだ。</p></li>
</ul>
<p>あとは GUI パッケージを Ubuntu 端末から <strong class="command">apt</strong> を実行することで得る。これで WSLg が有効になっていて欲しい。</p>
</section>
<section id="id3">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">WSLg を更新する</a><a class="headerlink" href="#id3" title="Link to this heading">¶</a></h3>
<blockquote>
<div><p>To update to the latest version of WSL and WSLg released for preview, simply
run <code class="docutils literal notranslate"><span class="pre">wsl</span> <span class="pre">--update</span></code> from an elevated command prompt or powershell.</p>
</div></blockquote>
<p>WSLg 稼働実績がない場合の手順と実質的に同じということになる。WSL を再起動することを忘れてはいけない。</p>
</section>
</section>
<section id="id4">
<h2><a class="toc-backref" href="#id14" role="doc-backlink">WSLg をアンインストールする</a><a class="headerlink" href="#id4" title="Link to this heading">¶</a></h2>
<p>WSLg をアンインストールする方法はない。WSL をインストールすると WSLg も一緒に付いてくるのだから。ただし、無効にする方法はある：</p>
<blockquote>
<div><p>Users wanting to use different servers than the one provided by WSLg can
change these environment variables. User can also choose to turn off the
system distro entirely by adding the following entry in their .wslconfig
file (located at <code class="file docutils literal notranslate"><span class="pre">c:\users\MyUser\.wslconfig</span></code>). This will turn off
support for GUI applications in WSL.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[wsl2]</span>
<span class="na">guiApplications</span><span class="o">=</span><span class="s">false</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="id5">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">動作確認</a><a class="headerlink" href="#id5" title="Link to this heading">¶</a></h2>
<p>WSLg のおかげで動作するアプリケーションは、Windows からでも Ubuntu からでも起動可能だ。</p>
<p>WSLg インストール初期状態では、おそらく Linux GUI アプリケーションもいくつかインストールされている。まずはそれが正しく起動することを確認する。Windows にわざわざ入れていないもの、例えば ImageMagick 辺りが良い。</p>
<section id="windows">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Windows から</a><a class="headerlink" href="#windows" title="Link to this heading">¶</a></h3>
<p>Windows メニューの Ubuntu フォルダー以下にある項目を何か選択すると、そのウィンドウが起動する。本稿執筆時点での私の Windows スタートメニューのショートカットの宛先をチェックするとこうだ：</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Application</p></th>
<th class="head"><p>Command</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Caffeine (Ubuntu)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">wslg.exe</span> <span class="pre">-d</span> <span class="pre">Ubuntu</span> <span class="pre">--cd</span> <span class="pre">&quot;~&quot;</span> <span class="pre">--</span> <span class="pre">/usr/bin/caffeine</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>ImageMagick (color depth=q16) (Ubuntu)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">wslg.exe</span> <span class="pre">-d</span> <span class="pre">Ubuntu</span> <span class="pre">--cd</span> <span class="pre">&quot;~&quot;</span> <span class="pre">--</span> <span class="pre">/usr/bin/display-im6.q16</span> <span class="pre">-nostdin</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Tilix (Ubuntu)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">wslg.exe</span> <span class="pre">-d</span> <span class="pre">Ubuntu</span> <span class="pre">--cd</span> <span class="pre">&quot;~&quot;</span> <span class="pre">--</span> <span class="pre">/usr/bin/tilix</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>WSLView (Ubuntu)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">wslg.exe</span> <span class="pre">-d</span> <span class="pre">Ubuntu</span> <span class="pre">--cd</span> <span class="pre">&quot;~&quot;</span> <span class="pre">--</span> <span class="pre">/usr/bin/wslview</span></code></p></td>
</tr>
</tbody>
</table>
<p>このことから、他の Ubuntu GUI アプリケーションも同じ要領で Windows 側から実行可能だと思われる。</p>
</section>
<section id="ubuntu">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Ubuntu から</a><a class="headerlink" href="#ubuntu" title="Link to this heading">¶</a></h3>
<p>まず、上記のアプリケーションをコマンドラインから直接実行して、ウィンドウが正常に出現することを確認したい。万が一 GUI アプリケーションが何もインストールされていない場合には、Ubuntu 端末からパッケージマネージャーで適当なものをまずインストールする。</p>
<blockquote>
<div><p>If you want to get started with some GUI apps, you can run the following
commands from your Linux terminal to download and install some popular
applications. If you are using a different distribution than Ubuntu, it may
be using a different package manager.</p>
</div></blockquote>
<p>ImageMagick ならばこう：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bash$ sudo apt update</span>
<span class="go">bash$ sudo apt install imagemagick</span>
</pre></div>
</div>
<p>インストールが完了すると、Ubuntu からコマンドライン実行でアプリケーションが起動する。起動を確認したらいったん終了し、今度は Windows スタートメニューの Ubuntu
フォルダーを確認する。当該アプリケーションの起動ショートカットが新しく現れているはずだ。このリンク追加処理は WSLg が行うものだ。</p>
</section>
</section>
<section id="id6">
<h2><a class="toc-backref" href="#id18" role="doc-backlink">実践例</a><a class="headerlink" href="#id6" title="Link to this heading">¶</a></h2>
<p>画像ファイル、音声ファイル、映像ファイルを好きなプログラムで表示、視聴したい。
FFmpeg をインストールすれば <strong class="command">ffplay</strong> でそれらすべてを再生できる：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bash$ ffplay speaking-cat.mp4</span>
</pre></div>
</div>
<p>ImageMagick をインストールすれば、コマンド <strong class="command">display</strong> で画像を専用ウィンドウに出力できる：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bash$ display funny-cat.jpg</span>
</pre></div>
</div>
<p>また、Pillow, PyQt など、ウィンドウを開く Python スクリプトも使い物になる。</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p><a class="reference internal" href="python-pillow.html"><span class="doc">Pillow 利用ノート</span></a></p></li>
<li><p><a class="reference internal" href="python-pyqt5.html"><span class="doc">PyQt5 利用ノート</span></a></p></li>
</ul>
</div>
</section>
<section id="id7">
<h2><a class="toc-backref" href="#id19" role="doc-backlink">文献</a><a class="headerlink" href="#id7" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt><a class="reference external" href="https://github.com/microsoft/wslg">Enabling the Windows Subsystem for Linux to include support for Wayland and X server related scenarios</a></dt><dd><p>GitHub にある当開発サイトの README に目を通しておけば、少なくとも正常動作時に欲しい情報は十分得られる。異常時には Wiki の関連項目を当たること。</p>
</dd>
</dl>
</section>
</section>


          </div>
    <div class="related bottom">
      &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="wsl.html" title="Previous">Windows Subsystem for Linux 利用ノート</a>
        </li>
      
        <li>
          <a href="vscode/index.html" title="Next">Visual Studio Code 利用ノート</a>
          &rarr;
        </li>
    </ul>
  </nav>
    </div>

      </div>
      <div class="clearer"></div>
    </div>
<div class="footer">
  <ul>
    <li id="footer_logo">
      <a class="image-reference" href="index.html" title="読書ノート Home"><img src="_images/logo.svg"/></a>
    </li>
    <li id="footer_copyright">
      Copyright &copy; 1999-2024, プレハブ小屋 All rights reserved.
    </li>
  </ul>
</div>
  </body>
</html>