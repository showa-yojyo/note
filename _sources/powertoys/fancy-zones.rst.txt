======================================================================
FancyZones
======================================================================

.. |arrows| replace:: (:kbd:`↑` | :kbd:`↓` | :kbd:`←` | :kbd:`→`)

.. |numkeys| replace:: (:kbd:`1` ... :kbd:`9`)

FancyZones はデスクトップ上のウィンドウ群を対象とするレイアウトマネージャーだ。
設定画面でデスクトップを何らかの区画群に分割しておき、マウスまたはキーボード操作
でアクティブウィンドウを任意の区間にフィットさせるものだ。
FancyZones の説明文では、この区画一つのことを zone と称している。

.. attention::

   :doc:`./index` 冒頭の前提条件に留意すること。

.. contents::

.. note::

   撮影が面倒なのでここには載せないが、スクリーンショットを見ると理解しやすい。

マウスでゾーン一つにスナップする
======================================================================

まず、適当なウィンドウ（のタイトルバー）をドラッグする。既定では :kbd:`Shift`
キーを押し続ける必要もある。すると、画面上にゾーンがオーバーレイ描画される。マウ
スを動かしながらゾーンをホバーしていると、そのゾーンが強調される。

キーボードゾーン一つにスナップする
======================================================================

FancyZones 設定で :guilabel:`Windows Snap のオーバーライド` を有効にしてあると、
:kbd:`Win` + (:kbd:`↑` | :kbd:`↓` | :kbd:`←` | :kbd:`→`) のいずれかでウィンドウ
を複数のゾーンに拡張することができる。

.. admonition:: 利用者ノート

   どの矢印キーが有効なのかはゾーンレイアウトに依存する。

複数ゾーンにスナップ
======================================================================

以下に述べる方法でウィンドウを複数のゾーンにスナップすることが可能だ。

共有辺めがけてスナップ
----------------------------------------------------------------------

ゾーン二つが隣接している場合、それらの和ゾーンにウィンドウをスナップさせることが
できる。マウスカーソルがゾーン二つの共有辺の近くにある場合、ゾーンの双方が同時に
アクティブになり、ウィンドウを両方に落とすことができる。

マウスとキーボードで複数ゾーンにスナップ
----------------------------------------------------------------------

いずれかのゾーンがアクティブになるまでウィンドウをドラッグし、:kbd:`Ctrl` キーを
押しながらウィンドウをドラッグすると、ゾーン複数を選択可能だ。

.. admonition:: 利用者ノート

   どうやらゾーンを追加的にアクティブとさせるには、何らかの条件があるようだ。

キーボードだけで複数ゾーンにスナップ
----------------------------------------------------------------------

:kbd:`Win` + :kbd:`Ctrl` + :kbd:`Alt` + |arrows| でウィンドウを複数ゾーンに拡張
することが可能だ。それにはまず FancyZones 設定で
:guilabel:`Windows スナップのオーバーライド` を有効にし、
:guilabel:`次に基づいてウィンドウを移動` を項目 :guilabel:`相対位置` に選択する
ことだ。

.. admonition:: 利用者ノート

   :guilabel:`相対位置` でないときは、画面上にオーバーレイされる番号順に移動する。

同一ゾーン内でのウィンドウ切り替え
----------------------------------------------------------------------

同じゾーンにウィンドウが複数スナップされている場合、ショートカットキー
:kbd:`Win` + (:kbd:`PgUp` | :kbd:`PgDn`) を押すとそのゾーンにスナップされたウィ
ンドウを次々にアクティブにできる。

キーバインド
----------------------------------------------------------------------

:kbd:`Win` + :kbd:`Shift` + :kbd:`@` でレイアウトエディターを起動する。

:kbd:`Win` + (:kbd:`←` | :kbd:`→`) を押すと
:guilabel:`Windows スナップのオーバーライド` がオンになっている場合に限り、
フォーカスウィンドウをゾーン間で移動する。一方、:kbd:`Win` + (:kbd:`↑` |
:kbd:`↓`) は通常通り動作する。

FancyZones は :kbd:`Win` + :kbd:`Shift` + (:kbd:`←` | :kbd:`→`) の動作を変更する
ものではない。

特権プロセスのウィンドウをスナップする
----------------------------------------------------------------------

特権アプリケーションがあり、このウィンドウを FancyZones でスナップしたい場合は
PowerToys を管理者モードで実行する。

レイアウトエディター
======================================================================

FancyZones には PowerToys の設定画面からもアクセスできるレイアウトエディターが含
まれる。このエディターでゾーン配置を細かく制御するのだ。

エディターを開く
----------------------------------------------------------------------

FancyZones 機能が有効であれば、:kbd:`Win` + :kbd:`Shift` + :kbd:`@` を押すとレイ
アウト編集画面が開く。テンプレートを基にゾーンを細分してカスタマイズしておき、そ
れを有効化しておくのがより一般的な設定様式だ。

レイアウトを選ぶ
----------------------------------------------------------------------

初回起動時、ゾーンエディターはレイアウトの一覧を示す。これは画面内に配置できる
ウィンドウの個数で調整可能なものからなる。レイアウトを選択すると、そのレイアウト
のプレビューが画面上に描画される。選択されたレイアウトが自動的に適用される。レイ
アウトをダブルクリックすると、そのレイアウトが適用され、エディターが自動的に閉じ
る。

複数のディスプレイを使用しているときには、エディターは使用可能なものを検出し、選
択できる UI を表示する。選択されたディスプレイが指定したレイアウトの対象となる。

ゾーン周縁部の空き
----------------------------------------------------------------------

設定項目 :guilabel:`ゾーンの周りのスペース` は FancyZone ウィンドウそれぞれの周
囲にどのような余白を設けるかを決定する。スイッチを切り替えることで、余白を生じさ
せるか否かを指定可能。スライダーで余白の太さをドット数単位で指定可能。CSS の
margin と同様の意味があるだろう。値を編集中に設定がどう適用されるかを確認できる。

:guilabel:`強調する距離` では、ゾーン間の空きの量をカスタム値で設定する。
ゾーン同士が密着するまでの間、つまり両者が強調されて連結されるまでの空きだ。

カスタムレイアウトを作成する
----------------------------------------------------------------------

ゾーンエディターはカスタムレイアウトの作成に対応している。右下にある
:guilabel:`新規レイアウト作成` ボタンをクリックする。

カスタムレイアウトを作成する方法は二つある。グリッドレイアウトとキャンバスレイア
ウトだ。

グリッドモデルは、三列の格子から始まって、ゾーンの分割、統合、ゾーン間の溝のサイ
ズ変更によってゾーンを作成することができる。これは相対的レイアウトであり、異なる
画面サイズに応じてサイズは変わる。

* ゾーンを分割する場合にはマウスをクリックする。
* 区切り線を回転させるには :kbd:`Shift` キーを押しながらする。
* ゾーンをマージ・削除するには、ゾーンを選択し、マウスの左ボタンを押したまま、複
  数のゾーンが選択されるまでマウスをドラッグし、ボタンを離す。すると、ポップアッ
  プメニューが出現する。:menuselection:`ゾーンのマージ` をクリックすると、一つの
  大きなゾーンになる。このように、ゾーンを他にマージすることで削除することができ
  る。

キャンバスモデルは、空白のレイアウトから始まって、ウィンドウと同様にドラッグやサ
イズ変更が可能なゾーンの追加をできるようにしている。キャンバスレイアウトは、モニ
ターの DPIと解像度に直接関連付けられる。

キャンバスレイアウトではキーボードを使った編集機能もある。

* 矢印キーを修飾キーなしで押してゾーンを 10 ドットずつ移動するか、
* :kbd:`Ctrl` + |arrows| キーで 1 ドットずつ、
* :kbd:`Shift` + |arrows| キーで 10 ピクセル（各辺 5 ドット）、
* :kbd:`Ctrl` + :kbd:`Shift` + |arrows| キーで 2 ドット（各辺 1 ドット）ずつ

ゾーンをリサイズすることができる。エディターとダイアログを切り替えるには、
:kbd:`Ctrl` + :kbd:`Tab` キーを押す。

カスタムレイアウトを急速に変更する
----------------------------------------------------------------------

カスタムレイアウトは、ユーザー定義キーバインドを設定することで、目的の配置に素早
く適用することができる。これは編集メニューで設定することができる。いったん設定す
ると、:kbd:`Win` + :kbd:`Ctrl` + :kbd:`Alt` + |numkeys| を押すことでカスタムレイア
ウトを適用することができる。また、ウィンドウをドラッグする際にこれらのキーを押す
ことでも適用できる。

.. admonition:: 利用者ノート

   編集メニューはレイアウトサムネイル右上の鉛筆アイコンをクリックすると出現する。

カスタムゾーンのレイアウトの設定は JSON ファイル

.. code:: text

   %LocalAppData%\Microsoft\PowerToys\FancyZones\custom-layouts.json

に保存される。このファイルを手動で編集してゾーンを調整したり、エクスポートして複
数のデバイス間でレイアウトを共有することができる。同じディレクトリーにある他の
JSON ファイルはモニターやレイアウトのキーバインドなどの設定を変更するために編集
することができる。

設定
======================================================================

項目がとにかく多い。

エディター
----------------------------------------------------------------------

翻訳が英語と日本語の語順の違いを考慮していないので、本稿では勝手に修正しておく。

:guilabel:`レイアウトエディターの起動`
    下記キーバインドを押さずとも、当設定画面が表示されているならばこのアイコンク
    リックでエディターを開くことが可能だ。
:guilabel:`アクティブ化のショートカット`
    既定は :kbd:`Win` + :kbd:`Shift` + :kbd:`@` だが、変更可能だ。
:guilabel:`エディターを起動するディスプレイ`
    複数ディスプレイを利用するならば、FancyZones を起動する画面を選択する余地がある：

    * :guilabel:`マウスポインターの位置`
    * :guilabel:`アクティブなフォーカスあり`

ゾーン
----------------------------------------------------------------------

設定項目がべらぼうに多い。試行錯誤している余裕はない。

ゾーンの動作
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

:guilabel:`ドラッグ中に Shift キーを長押ししてゾーンをアクティブにする`
    :kbd:`Shift` キーによる自動スナップモード（ドラッグ中のスナップを無効にする）
    と、ドラッグ中に :kbd:`Shift` キーを押してスナップを有効にする手動スナップ
    モードを切り換える。
:guilabel:`プライマリ以外のマウスボタンを使用してゾーンのアクティブ化を切り替える`
    左マウスボタン以外のクリックでゾーン稼働を切り替える。
:guilabel:`ウィンドウのドラッグ中にすべてのモニターでゾーンを表示する`
    FancyZones は現在のディスプレイで利用可能なゾーンしか表示しないのが既定動作だ。
    この機能をオンにすると、性能に影響を及ぼす可能性がある。
:guilabel:`ゾーンがモニターにまたがることを許可する`
    接続されているディスプレイすべてを一つの大きな画面として扱うことができる。正
    しく動作させるためには、すべてのモニターの DPI 拡縮因数が同じであることを必
    要とする。ディスプレイの向きを変えて使用した場合、予期せぬ影響が生じる可能性
    がある。

項目 :guilabel:`複数のゾーンが重なり合っている場合` では、ゾーン同士が重なってい
る場合の対処方法を選択する。選択肢は次のとおり：

   * :guilabel:`領域ごとに最小のゾーンをアクティブにする`
   * :guilabel:`領域ごとに最大のゾーンをアクティブにする`
   * :guilabel:`重複する領域を複数のアクティブターゲットに分割する`
   * :guilabel:`中心がカーソルに最も近いゾーンをアクティブにする`

ゾーンの外観
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. csv-table::
   :delim: @
   :header: 値,主旨

   :guilabel:`ユーザー設定の色` @ レイアウトに対する色味を指定および適用する
   :guilabel:`Windows の既定値` @ Windows ユーザー設定の色味を適用する

:guilabel:`ゾーン番号の表示` をオンにすると、オーバーレイのゾーンに番号が描画される。

:guilabel:`不透明度` スライダーでオーバーレイのアルファブレンド値を指定する。

:guilabel:`ユーザー設定の色` を適用するときに指定できる色は次のとおり：

.. csv-table::
   :delim: @
   :header: 項目,主旨

   :guilabel:`強調表示の色` @ ウィンドウのドラッグ中にアクティブなドロップ対象である場合のゾーンの色
   :guilabel:`非アクティブの色` @ ウィンドウのドラッグ中にアクティブドロップでない場合のゾーンの色
   :guilabel:`罫線の色` @ アクティブゾーンと非アクティブゾーンの境界の色
   :guilabel:`数字の色` @ ゾーン番号の色

ウィンドウの動作
----------------------------------------------------------------------

:guilabel:`画面の解像度が変更されたときにウインドウをゾーンに保持する`
    画面の解像度を変更した後、ウィンドウのサイズを変更し、以前いたゾーンに配置し
    直す。
:guilabel:`ゾーンレイアウトの変更時に、ゾーンに割り当てられているウィンドウを新しいサイズまたは位置に合わせる`
    各ウィンドウの以前のゾーン番号の位置を維持しながら、新しいゾーンレイアウトに
    ウィンドウのサイズと位置を変更する。
:guilabel:`新しく作成されたウィンドウを最後の既知のゾーンに移動する`
    新しく開いたウィンドウを、そのアプリケーションが最後にいたゾーンの位置に自動
    的に移動する。
:guilabel:`新しく作成したウィンドウを現在アクティブなモニターに移動する`
    このオプションをオンにし、上記項目をオフにするか、アプリケーションに最終既知
    のゾーンがない場合、アプリケーションを現在のアクティブなモニター上に維持する。
:guilabel:`スナップ解除する場合にウィンドウの元のサイズを復元する`
    ウィンドウのスナップを解除すると、以前のサイズに戻る。
:guilabel:`ドラッグしたウィンドウを透明にする`
    ゾーンを有効にすると、ドラッグ中のウィンドウが透明になり、ゾーンの視認性が向
    上する。
:guilabel:`ポップアップウィンドウのスナップを許可する`
    通知を含むすべてのポップアップウィンドウに対してスナップを有効にする。
:guilabel:`子ウィンドウのスナップを許可する`
    同上。

:guilabel:`ウィンドウの切替`
   同じゾーンにウィンドウが複数スナップされている場合、次で設定するショートカッ
   トキーを押すことでそのゾーンにスナップされたウィンドウを順番にアクティブにす
   るように変える。

   * :guilabel:`次のウィンドウ`: 既定キーバインドは :kbd:`Win` + :kbd:`PgDn`.
   * :guilabel:`前のウィンドウ`: 既定キーバインドは :kbd:`Win` + :kbd:`PgUp`.

:guilabel:`Windows スナップのオーバーライド`
    先述のように、オンにすると :kbd:`Win` + (:kbd:`←` | :kbd:`→`) の動作を
    FancyZones が上書きする。

:guilabel:`次に基づいてウィンドウを移動`
    ゾーンレイアウトに対する相対的な位置に基づいて、:kbd:`Win` + |arrows| でウィ
    ンドウをスナップできるようにする。

:guilabel:`すべてのモニターのゾーン間でウィンドウを移動する`
    オンにするとすべてのモニターのすべてのゾーンにまたがってウィンドウが循環す
    る。オフの場合は :kbd:`Win` + |arrows| でスナップすると、現在のモニターの
    ゾーン間でウィンドウが循環する。

レイアウト
----------------------------------------------------------------------

:guilabel:`クイックレイアウトスイッチを有効にする` をオンにすると、レイアウトを
素早く変更するキーバインドを有効にする。

:guilabel:`レイアウトを切り替えるときにゾーンを点減させる` をオンにすると、
ショートカットでレイアウトを選択するときにゾーンが点滅するようになる。

除外するアプリ
----------------------------------------------------------------------

:doc:`./always-on-top` の同名設定項目と同様。
