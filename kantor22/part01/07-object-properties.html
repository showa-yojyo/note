<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Object properties configuration &#8212; 読書ノート 1.6dev documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=1a9a5cd9" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=5a6f99c4"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/mermaid.js?v=578dbed1"></script>
    <link rel="next" title="Prototypes, inheritance" href="08-prototypes.html" />
    <link rel="prev" title="Advanced working with functions" href="06-advanced-functions.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="06-advanced-functions.html" title="Previous document">Advanced working with functions</a>
        </li>
        <li>
          <a href="08-prototypes.html" title="Next document">Prototypes, inheritance</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <section id="object-properties-configuration">
<h1><a class="toc-backref" href="#id2" role="doc-backlink">Object properties configuration</a><a class="headerlink" href="#object-properties-configuration" title="Permalink to this heading">¶</a></h1>
<p>オブジェクトの特性をさらに深く研究する。</p>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#object-properties-configuration" id="id2">Object properties configuration</a></p>
<ul>
<li><p><a class="reference internal" href="#property-flags-and-descriptors" id="id3">Property flags and descriptors</a></p></li>
<li><p><a class="reference internal" href="#property-getters-and-setters" id="id4">Property getters and setters</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="property-flags-and-descriptors">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Property flags and descriptors</a><a class="headerlink" href="#property-flags-and-descriptors" title="Permalink to this heading">¶</a></h2>
<p>&lt;<a class="reference external" href="https://javascript.info/property-descriptors">https://javascript.info/property-descriptors</a>&gt; のノート。</p>
<section id="property-flags">
<h3>Property flags<a class="headerlink" href="#property-flags" title="Permalink to this heading">¶</a></h3>
<p>オブジェクトプロパティーには値のほかに三つの特別な属性がある。それらは次のフラグだ：</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">writable</span></code></dt><dd><p>このプロパティーの値を変更できるか否か。</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">enumerable</span></code></dt><dd><p><code class="docutils literal notranslate"><span class="pre">for</span></code> … <code class="docutils literal notranslate"><span class="pre">in</span></code> ループでオブジェクトプロパティーを反復させると、このプロパティーが現れるか否か。</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">configurable</span></code></dt><dd><p>このプロパティーが削除可能であり、ここに書いた特別な属性を更新できるか否か。</p>
</dd>
</dl>
<p>通常の方法でプロパティーを作成すると、これらは <code class="docutils literal notranslate"><span class="pre">true</span></code> だ。</p>
<p><code class="docutils literal notranslate"><span class="pre">Object.getOwnPropertyDescriptor(obj,</span> <span class="pre">propertyName)</span></code> は上述のプロパティーの情報すべてを返す。</p>
<p><code class="docutils literal notranslate"><span class="pre">Object.defineProperty(obj,</span> <span class="pre">propertyName,</span> <span class="pre">descriptor)</span></code> は上述のフラグを変更する。このメソッドで新規プロパティーを値だけを割り当てるように定義すると、特別なフラグはすべて <code class="docutils literal notranslate"><span class="pre">false</span></code> となる。</p>
<ul class="simple">
<li><p>Non-configurable というのは <code class="docutils literal notranslate"><span class="pre">defineProperty</span></code> できないということ。</p></li>
</ul>
</section>
<section id="non-writable">
<h3>Non-writable<a class="headerlink" href="#non-writable" title="Permalink to this heading">¶</a></h3>
<p>次のようにすると <code class="docutils literal notranslate"><span class="pre">user.name</span></code> への代入が無効化される：</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;John&quot;</span>
<span class="p">};</span>

<span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">writable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span>
<span class="p">});</span>

<span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;John&quot;</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>“use strict” モードがオフの場合にはエラーが発生せずに、代入は静かに失敗する。この振る舞いは他のフラグに対する <code class="docutils literal notranslate"><span class="pre">defineProperty</span></code> でも同様だ。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> がまだプロパティーではない場合には、無効を明示的に指定する必要はない。</p></li>
</ul>
</section>
<section id="non-enumerable">
<h3>Non-enumerable<a class="headerlink" href="#non-enumerable" title="Permalink to this heading">¶</a></h3>
<p>まず、オブジェクト <code class="docutils literal notranslate"><span class="pre">user</span></code> にメソッド <code class="docutils literal notranslate"><span class="pre">toString</span></code> を普通に定義する。それから
<code class="docutils literal notranslate"><span class="pre">user</span></code> に対して <code class="docutils literal notranslate"><span class="pre">for</span></code> … <code class="docutils literal notranslate"><span class="pre">in</span></code> ループを書くと、このメソッドがプロパティーとして拾われる。それを避けるときには、前項の要領で <code class="docutils literal notranslate"><span class="pre">enumerable:</span> <span class="pre">false</span></code> を指定する。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Object.keys(user)</span></code> の出力でも <code class="docutils literal notranslate"><span class="pre">toString</span></code> を除外する。</p></li>
</ul>
</section>
<section id="non-configurable">
<h3>Non-configurable<a class="headerlink" href="#non-configurable" title="Permalink to this heading">¶</a></h3>
<p>組み込みオブジェクトやプロパティーには、フラグ <code class="docutils literal notranslate"><span class="pre">configurable:</span> <span class="pre">false</span></code> が設定されているものもある。例えば <code class="docutils literal notranslate"><span class="pre">Math.PI</span></code> を上書きしようとしても失敗する。さらに
<code class="docutils literal notranslate"><span class="pre">writable:</span> <span class="pre">true</span></code> を指定しても失敗する。</p>
<ul class="simple">
<li><p>いったん <code class="docutils literal notranslate"><span class="pre">configurable:</span> <span class="pre">false</span></code> にすると、<code class="docutils literal notranslate"><span class="pre">configurable:</span> <span class="pre">true</span></code> に変えることはできない。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">configurable:</span> <span class="pre">false</span></code> であっても、なぜか <code class="docutils literal notranslate"><span class="pre">writable:</span> <span class="pre">false</span></code> への変更は成功する。</p></li>
</ul>
</section>
<section id="object-defineproperties">
<h3><code class="docutils literal notranslate"><span class="pre">Object.defineProperties</span></code><a class="headerlink" href="#object-defineproperties" title="Permalink to this heading">¶</a></h3>
<p>このメソッドは一度にプロパティー複数を定義する。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperties</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;John&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">writable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="nx">surname</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Smith&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">writable</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">},</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">});</span>
</pre></div>
</div>
</section>
<section id="object-getownpropertydescriptors">
<h3><code class="docutils literal notranslate"><span class="pre">Object.getOwnPropertyDescriptors</span></code><a class="headerlink" href="#object-getownpropertydescriptors" title="Permalink to this heading">¶</a></h3>
<p>このメソッドはオブジェクトのプロパティーと特別フラグをすべて返す。</p>
<p>これと前項のメソッドを利用して、オブジェクトを精密に複製することができる。</p>
</section>
<section id="sealing-an-object-globally">
<h3>Sealing an object globally<a class="headerlink" href="#sealing-an-object-globally" title="Permalink to this heading">¶</a></h3>
<p>以上の機能はオブジェクトプロパティー単位で動作する。オブジェクト全体へのアクセスを制限する次のようなメソッドもある：</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Object.preventExtensions(obj)</span></code></p></td>
<td><p>新しいプロパティーを追加するのを禁じる</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Object.seal(obj)</span></code></p></td>
<td><p>プロパティーを追加したり削除したりするのを禁じる</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Object.freeze(obj)</span></code></p></td>
<td><p>さらに変更も禁じる</p></td>
</tr>
</tbody>
</table>
<p>テストするメソッドはめったに使われないが、次のとおり：</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Object.isExtensible(obj)</span></code></p></td>
<td><p>プロパティーの追加が禁じられているか</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Object.isSealed(obj)</span></code></p></td>
<td><p>プロパティーの追加か削除が禁じられているか</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Object.isFrozen(obj)</span></code></p></td>
<td><p>プロパティーの追加か削除か変更が禁じられているか</p></td>
</tr>
</tbody>
</table>
<p>上のメソッド群で seal と freeze 系は特別な属性 <code class="docutils literal notranslate"><span class="pre">configurable:</span> <span class="pre">false</span></code> もセットしたりチェックしたりする。</p>
</section>
</section>
<section id="property-getters-and-setters">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Property getters and setters</a><a class="headerlink" href="#property-getters-and-setters" title="Permalink to this heading">¶</a></h2>
<p>&lt;<a class="reference external" href="https://javascript.info/property-accessors">https://javascript.info/property-accessors</a>&gt; のノート。</p>
<p>オブジェクトのプロパティーは二種類ある。</p>
<ul class="simple">
<li><p>データプロパティー。今まで見てきたプロパティーはすべてこの分類だ。</p></li>
<li><p>アクセッサープロパティー。値の取得や設定を実行するメソッドだ。</p></li>
</ul>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>これを図式化してもいいか。</p>
</div>
<section id="getters-and-setters">
<h3>Getters and setters<a class="headerlink" href="#getters-and-setters" title="Permalink to this heading">¶</a></h3>
<p>オブジェクトリテラルに対する「値の取得や設定を実行するメソッド」を定義する方法。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">get</span><span class="w"> </span><span class="nx">propName</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// getter, the code executed on getting obj.propName</span>
<span class="w">    </span><span class="p">},</span>

<span class="w">    </span><span class="nx">set</span><span class="w"> </span><span class="nx">propName</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// setter, the code executed on setting obj.propName = value</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>上の定義のあと、標準的な記法 <code class="docutils literal notranslate"><span class="pre">obj.propName</span></code> で左辺値でも右辺値でもアクセスできる。仮に <code class="docutils literal notranslate"><span class="pre">set</span></code> 側メソッドの定義を与えないと、右辺値としてしかアクセスできない。</p>
</section>
<section id="accessor-descriptors">
<h3>Accessor descriptors<a class="headerlink" href="#accessor-descriptors" title="Permalink to this heading">¶</a></h3>
<p>既存のオブジェクトに <code class="docutils literal notranslate"><span class="pre">Object.defineProperty()</span></code> 系メソッドで「値の取得や設定を実行するメソッド」を定義する方法。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;propName&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">get</span><span class="w"> </span><span class="nx">propName</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// getter, the code executed on getting obj.propName</span>
<span class="w">    </span><span class="p">},</span>

<span class="w">    </span><span class="nx">set</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// setter, the code executed on setting obj.propName = value</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<ul class="simple">
<li><p>アクセッサープロパティーを定義するときには <code class="docutils literal notranslate"><span class="pre">get</span></code>, <code class="docutils literal notranslate"><span class="pre">set</span></code>, <code class="docutils literal notranslate"><span class="pre">enumerable</span></code>,
<code class="docutils literal notranslate"><span class="pre">configurable</span></code> の組み合わせのみが許される。</p></li>
<li><p>データプロパティー定義の特別属性の組み合わせと、アクセッサープロパティー定義のそれとを混ぜることは許されていない。失敗する。</p></li>
</ul>
</section>
<section id="smarter-getters-setters">
<h3>Smarter getters/setters<a class="headerlink" href="#smarter-getters-setters" title="Permalink to this heading">¶</a></h3>
<p>ひじょうに典型的な <code class="docutils literal notranslate"><span class="pre">get</span></code>, <code class="docutils literal notranslate"><span class="pre">set</span></code> メソッドの定義例。</p>
</section>
<section id="using-for-compatibility">
<h3>Using for compatibility<a class="headerlink" href="#using-for-compatibility" title="Permalink to this heading">¶</a></h3>
<p>こちらもひじょうに典型的な実装例。</p>
</section>
</section>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="06-advanced-functions.html" title="Previous document">Advanced working with functions</a>
        </li>
        <li>
          <a href="08-prototypes.html" title="Next document">Prototypes, inheritance</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
      </div>
      <div class="clearer"></div>
    </div>
<div class="footer">
  <ul>
    <li id="footer_logo">
      <a class="image-reference" href="https://showa-yojyo.github.io/" title="プレハブ小屋 Since 1999"><img src="../../_static/logos.png"/></a>
    </li>
    <li id="footer_copyright">
      Copyright &copy; 1999-2024, プレハブ小屋 All rights reserved.
    </li>
  </ul>
</div>
  </body>
</html>