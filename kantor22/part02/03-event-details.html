
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>UI Events &#8212; 読書ノート v1.5dev</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/prefab.css" />
    
    <script src="../../_static/mathjax-v3.js"></script>
    <script src="../../_static/mermaid.js"></script>
    
    <link rel="next" title="Forms, controls" href="04-forms-controls.html" />
    <link rel="prev" title="Introduction to Events" href="02-events.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="04-forms-controls.html" title="Forms, controls"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="02-events.html" title="Introduction to Events"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">読書ノート</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >The Modern JavaScript Tutorial 読書ノート</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Part 2 Browser: Document, Events, Interfaces</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">UI Events</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <section id="ui-events">
<h1><a class="toc-backref" href="#id5">UI Events</a><a class="headerlink" href="#ui-events" title="Permalink to this heading">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#ui-events" id="id5">UI Events</a></p>
<ul>
<li><p><a class="reference internal" href="#mouse-events" id="id6">Mouse events</a></p></li>
<li><p><a class="reference internal" href="#moving-the-mouse-mouseover-out-mouseenter-leave" id="id7">Moving the mouse: mouseover/out, mouseenter/leave</a></p></li>
<li><p><a class="reference internal" href="#drag-n-drop-with-mouse-events" id="id8">Drag’n’Drop with mouse events</a></p></li>
<li><p><a class="reference internal" href="#pointer-events" id="id9">Pointer events</a></p></li>
<li><p><a class="reference internal" href="#keyboard-keydown-and-keyup" id="id10">Keyboard: keydown and keyup</a></p></li>
<li><p><a class="reference internal" href="#scrolling" id="id11">Scrolling</a></p></li>
</ul>
</li>
</ul>
</div>
<p>重要なユーザーインターフェースイベントとその扱い方を見ていく。</p>
<section id="mouse-events">
<h2><a class="toc-backref" href="#id6">Mouse events</a><a class="headerlink" href="#mouse-events" title="Permalink to this heading">¶</a></h2>
<p>&lt;<a class="reference external" href="https://javascript.info/mouse-events-basics">https://javascript.info/mouse-events-basics</a>&gt; のノート。</p>
<p>マウスイベントは物理的なマウスから以外にも起こる可能性がある。PC だけとは限らない。</p>
<section id="mouse-event-types">
<h3>Mouse event types<a class="headerlink" href="#mouse-event-types" title="Permalink to this heading">¶</a></h3>
<p>主なマウスイベント：</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Event</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mousedown</span></code></p></td>
<td><p>要素上でマウスボタンが押されたときに起こる。</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">mouseup</span></code></p></td>
<td><p>要素上でマウスボタンが離されたときに起こる。</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mouseover</span></code></p></td>
<td><p>マウスポインターが要素に来たときに起こる。</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">mouseout</span></code></p></td>
<td><p>マウスポインターが要素から離れたときに起こる。</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mousemove</span></code></p></td>
<td><p>マウスが要素上を動くたびに起こる。</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">click</span></code></p></td>
<td><p>左ボタンにより、要素上から <code class="docutils literal notranslate"><span class="pre">mousedown</span></code> の後に
<code class="docutils literal notranslate"><span class="pre">mouseup</span></code> が出ると起こる。</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">dblclick</span></code></p></td>
<td><p>短時間に同一要素上で二度の <code class="docutils literal notranslate"><span class="pre">click</span></code>
の後に起こる。</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">contextmenu</span></code></p></td>
<td><p>右ボタンを押すと起こる。</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>コンテキストメニューはキーからも表示される。右手側の ALT と CTRL の間にあるキーだ。</p></li>
<li><p>右ボタンの場合には、メニューが表示されるのはボタンを離した瞬間だ。</p></li>
</ul>
</section>
<section id="events-order">
<h3>Events order<a class="headerlink" href="#events-order" title="Permalink to this heading">¶</a></h3>
<p>上にもあるように、一つのマウスアクションから複数のマウスイベントが起こることがある。</p>
<ul class="simple">
<li><p>例えば、左ボタンをクリックすると、まずボタンが押されたときに <code class="docutils literal notranslate"><span class="pre">mousedown</span></code>
が起こり、それからボタンが離されたときに <code class="docutils literal notranslate"><span class="pre">mouseup</span></code> と <code class="docutils literal notranslate"><span class="pre">click</span></code> が起こる。</p></li>
<li><p>単一のアクションが複数のイベントを引き起こす場合、その順序は一定だ。</p></li>
</ul>
</section>
<section id="mouse-button">
<h3>Mouse button<a class="headerlink" href="#mouse-button" title="Permalink to this heading">¶</a></h3>
<p>マウスイベント処理中における <code class="docutils literal notranslate"><span class="pre">event.button</span></code> の値とボタンの対応を覚える。</p>
<ul class="simple">
<li><p>普通は 0 か 2 と比較する。</p></li>
<li><p>ビットセットの <code class="docutils literal notranslate"><span class="pre">event.buttons</span></code> というのもある。</p></li>
</ul>
</section>
<section id="modifiers-shift-alt-ctrl-and-meta">
<h3>Modifiers: shift, alt, ctrl and meta<a class="headerlink" href="#modifiers-shift-alt-ctrl-and-meta" title="Permalink to this heading">¶</a></h3>
<p>マウスイベント処理中にユーザーが押している修飾キーを参照することもできる。押されていれば値は <code class="docutils literal notranslate"><span class="pre">true</span></code> だ：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">event.shiftKey</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">event.altKey</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">event.ctrlKey</span></code>: Mac ユーザーに便宜を図るため、ふつうは
<code class="docutils literal notranslate"><span class="pre">event.ctrlKey</span> <span class="pre">||</span> <span class="pre">event.metaKey</span></code> をテストする。</p></li>
</ul>
</section>
<section id="coordinates-clientx-y-pagex-y">
<h3>Coordinates: clientX/Y, pageX/Y<a class="headerlink" href="#coordinates-clientx-y-pagex-y" title="Permalink to this heading">¶</a></h3>
<p>マウスイベントはカーソル位置を保持している。以前の章で見た二つの座標系に対応している。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">event.clientX</span></code>, <code class="docutils literal notranslate"><span class="pre">event.clientY</span></code>: ウィンドウ座標系</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">event.pageX</span></code>, <code class="docutils literal notranslate"><span class="pre">event.pageY</span></code>: ドキュメント座標系</p></li>
</ul>
</section>
<section id="preventing-selection-on-mousedown">
<h3>Preventing selection on mousedown<a class="headerlink" href="#preventing-selection-on-mousedown" title="Permalink to this heading">¶</a></h3>
<p>マウスイベントを握りつぶすには、一般のイベントと同様にハンドラーが <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">false</span></code>
すればいい。ここでは <code class="docutils literal notranslate"><span class="pre">dblclick</span></code> でテキスト選択が発生しないようにする例を挙げている。</p>
<p>囲み記事。テキスト選択そのものを処理するには <code class="docutils literal notranslate"><span class="pre">copy</span></code> イベントハンドラーを対応する。</p>
</section>
<section id="tasks">
<h3>Tasks<a class="headerlink" href="#tasks" title="Permalink to this heading">¶</a></h3>
<section id="selectable-list">
<h4>Selectable list<a class="headerlink" href="#selectable-list" title="Permalink to this heading">¶</a></h4>
<p>まず、修飾キーの要件を無視して <code class="docutils literal notranslate"><span class="pre">click</span></code> を実装する。
CSS クラスを変更するメソッド各種には、これまでの演習で慣れている前提だ。この状態で選択解除とテキスト選択が解決できていない。</p>
<ul class="simple">
<li><p>テキスト選択は囲み記事にある手法でも解決するが、これは場合によっては許されない。本当にマウスによる選択しか禁止しないのであれば、 <code class="docutils literal notranslate"><span class="pre">mousedown</span></code> を潰す方法を採る。</p></li>
<li><p>Ctrl キーを押しているときの振る舞いのほうが実装は容易だ。他の項目の状態を考慮しなくていい。</p></li>
<li><p>模範解答では <code class="docutils literal notranslate"><span class="pre">event.preventDefault()</span></code> を呼んでいない。</p></li>
</ul>
</section>
</section>
</section>
<section id="moving-the-mouse-mouseover-out-mouseenter-leave">
<h2><a class="toc-backref" href="#id7">Moving the mouse: mouseover/out, mouseenter/leave</a><a class="headerlink" href="#moving-the-mouse-mouseover-out-mouseenter-leave" title="Permalink to this heading">¶</a></h2>
<p>&lt;<a class="reference external" href="https://javascript.info/mousemove-mouseover-mouseout-mouseenter-mouseleave">https://javascript.info/mousemove-mouseover-mouseout-mouseenter-mouseleave</a>&gt; のノート。</p>
<p>マウスが要素間を移動するときに発生するイベントについて。</p>
<section id="events-mouseover-mouseout-relatedtarget">
<h3>Events mouseover/mouseout, relatedTarget<a class="headerlink" href="#events-mouseover-mouseout-relatedtarget" title="Permalink to this heading">¶</a></h3>
<p>まず <code class="docutils literal notranslate"><span class="pre">mouseover</span></code>, <code class="docutils literal notranslate"><span class="pre">mouseout</span></code> を見る。これらをペアで押さえる。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">event.target</span></code> と <code class="docutils literal notranslate"><span class="pre">event.relatedTarget</span></code> が相互補完的な要素となる。マウスカーソルが要素間を移動するときに、これらの要素を値に取る。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">mouseover</span></code>: <code class="docutils literal notranslate"><span class="pre">relatedTarget</span></code> → <code class="docutils literal notranslate"><span class="pre">target</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mouseout</span></code>: <code class="docutils literal notranslate"><span class="pre">target</span></code> → <code class="docutils literal notranslate"><span class="pre">relatedTarget</span></code></p></li>
</ul>
</li>
</ul>
<p>顔のデモ。 <code class="docutils literal notranslate"><span class="pre">onmouseover</span></code> と <code class="docutils literal notranslate"><span class="pre">onmouseout</span></code> に同じハンドラーを割り当てている。ついでに <code class="docutils literal notranslate"><span class="pre">event.type</span></code> について説明して欲しい。有用そう。</p>
<p><code class="docutils literal notranslate"><span class="pre">event.relatedTarget</span></code> は <code class="docutils literal notranslate"><span class="pre">null</span></code> であり得る。</p>
</section>
<section id="skipping-elements">
<h3>Skipping elements<a class="headerlink" href="#skipping-elements" title="Permalink to this heading">¶</a></h3>
<p>要素が複数配置されているところをマウスが比較的高速に移動する場合、開始要素から終了要素の間にある要素の上でこれらのイベントハンドラーが反応しないことが普通にある。それでも、 <code class="docutils literal notranslate"><span class="pre">mouseover</span></code> が発生した場合には、対になる <code class="docutils literal notranslate"><span class="pre">mouseout</span></code> も必ず発生する。</p>
</section>
<section id="mouseout-when-leaving-for-a-child">
<h3>Mouseout when leaving for a child<a class="headerlink" href="#mouseout-when-leaving-for-a-child" title="Permalink to this heading">¶</a></h3>
<p>親子関係にある要素間では注意点が二つある：</p>
<ul class="simple">
<li><p>親から子にマウスを移動させると、カーソルを親が含むにも関わらず、親に対する
<code class="docutils literal notranslate"><span class="pre">mouseout</span></code> が発生する。</p></li>
<li><p>イベントの bubbling が適用されるので、親から子に移動させると、親から出てまたすぐに戻ってきたようにも見えるかもしれない。</p></li>
</ul>
<p>サンプルデモにおいて、ハンドラーは親要素にある。</p>
<p>勘違いしないように <code class="docutils literal notranslate"><span class="pre">event.target</span></code> と <code class="docutils literal notranslate"><span class="pre">event.relatedTarget</span></code> をチェックすること。あるいは、次に述べるイベントペアを対応すること。</p>
</section>
<section id="events-mouseenter-and-mouseleave">
<h3>Events mouseenter and mouseleave<a class="headerlink" href="#events-mouseenter-and-mouseleave" title="Permalink to this heading">¶</a></h3>
<p>次に <code class="docutils literal notranslate"><span class="pre">mouseenter</span></code>, <code class="docutils literal notranslate"><span class="pre">mouseleave</span></code> を見る。これらもペアで押さえる。先述のイベントハンドラーペアと似たものだが、親子関係の注意点二つが成り立たない。</p>
<ul class="simple">
<li><p>要素内の移動、子孫への移動は考慮されない。</p></li>
<li><p>イベントの bubbling がない。</p>
<ul>
<li><p>ということは、イベントハンドラーを親要素にだけ置いて、子要素すべての面倒を見る手法は採用できないということだ。</p></li>
</ul>
</li>
</ul>
</section>
<section id="event-delegation">
<h3>Event delegation<a class="headerlink" href="#event-delegation" title="Permalink to this heading">¶</a></h3>
<p>こちらのサンプルデモにも、ハンドラーは親要素にある。</p>
<p>八卦図のデモ二つ。前者はマウスの運動によってはセルというよりも中身のテキストだけがハイライトされてしまう。後者はその不具合を解決してセルしかハイライトされないようになっている。コードをよく分析すること。</p>
<ul class="simple">
<li><p>共通点</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">TABLE</span></code> に <code class="docutils literal notranslate"><span class="pre">onmouseover</span></code>, <code class="docutils literal notranslate"><span class="pre">onmouseout</span></code> 各ハンドラーを実装する。</p></li>
</ul>
</li>
<li><p>改良点</p>
<ul>
<li><p>現在ハイライト中の <code class="docutils literal notranslate"><span class="pre">TD</span></code> を保存しておく変数を設ける。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">onmouseover</span></code> を、 <code class="docutils literal notranslate"><span class="pre">event.target</span></code> がその現在ハイライト中のセルと変わっていなければ何も処理しないようにする。変わっていれば変数を更新し、改良前と同様の処理をする。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">onmouseout</span></code> はもう少し面倒になる。 <code class="docutils literal notranslate"><span class="pre">event.relatedTarget</span></code> をチェックし、さらにその親方向へチェックする。
<code class="docutils literal notranslate"><span class="pre">TD</span></code> を離れていくことが確定したら、ハイライト中セル変数を <code class="docutils literal notranslate"><span class="pre">null</span></code> とする。</p></li>
</ul>
</li>
</ul>
</section>
<section id="id1">
<h3>Tasks<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h3>
<section id="improved-tooltip-behavior">
<h4>Improved tooltip behavior<a class="headerlink" href="#improved-tooltip-behavior" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>現在表示中のツールチップ DOM 要素を保存しておく変数を設ける。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mouseover</span></code>, <code class="docutils literal notranslate"><span class="pre">mouseout</span></code> ハンドラーをそれぞれ <code class="docutils literal notranslate"><span class="pre">document</span></code> に対して定義する。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mouseover</span></code> では、まずツールチップ対応部分にマウスがいるかどうかを判定する。</p>
<ul>
<li><p>判定は以前のときのように <code class="docutils literal notranslate"><span class="pre">closest()</span></code> を利用する。引数はクラス名になる。</p></li>
<li><p>ツールチップ要素を <code class="docutils literal notranslate"><span class="pre">DIV</span></code> として作成する方法は以前と同じ。生成後の要素には
CSS クラス、中身、位置を指定するが、今回も位置が大事だ。</p></li>
<li><p>ツールチップ要素の位置はマウスカーソル位置と対象要素の寸法から適当に決めていい。後から要件に従うように調整できる。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">mouseout</span></code> では現在のツールチップ要素を存在すれば <code class="docutils literal notranslate"><span class="pre">remove()</span></code> する。そして、現在ツールチップ変数をリセットする。</p></li>
</ul>
</section>
<section id="smart-tooltip">
<h4>“Smart” tooltip<a class="headerlink" href="#smart-tooltip" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>さっきの例でマウスを高速で動かすと、この問題の意図が理解できる。</p></li>
<li><p>丁寧にもサンドボックスに単体テストが付属している。全部がパスするまでコードを書く。サンドボックスにコードが途中まで書かれているが、埋める場所は実は指定されているところだけではダメだ。</p></li>
<li><p>メソッド <code class="docutils literal notranslate"><span class="pre">trackSpeed()</span></code> を実装する。これがけっこう手が込んでいる。</p></li>
<li><p>メソッド <code class="docutils literal notranslate"><span class="pre">onMouseOver()</span></code> および <code class="docutils literal notranslate"><span class="pre">onMouseOut()</span></code> 内で対象要素に
<code class="docutils literal notranslate"><span class="pre">mousemove</span></code> のイベントハンドラー <code class="docutils literal notranslate"><span class="pre">this.onMouseMove</span></code> を着脱する。</p></li>
<li><p>メソッド <code class="docutils literal notranslate"><span class="pre">onMouseMove()</span></code> はシンプルにマウスカーソル位置と時刻を更新する。座標はドキュメント座標系で持たせるのがコツのようだ。すなわち <code class="docutils literal notranslate"><span class="pre">pageX</span></code>,
<code class="docutils literal notranslate"><span class="pre">pageY</span></code> を採用する。</p></li>
<li><p>難しいと思ったのが速度の更新だ。タイマーで速度を計算するメソッドを仕込む。速度を更新する頻度を適切に決める方法が問われている。模範解答ではピクセルパーミリ秒という単位で速度と比較し、タイマーをクリアするようにしている。速度の算出方法はバカ正直に（ピタゴラスの定理で）移動距離を計算して、時間の差で除算する。</p>
<ul>
<li><p>このタイマークリア直後の <code class="docutils literal notranslate"><span class="pre">this.call.over(this.elem)</span></code> により、コンストラクターで指定したツールチップ表示コードが発動する。</p></li>
</ul>
</li>
</ul>
</section>
</section>
</section>
<section id="drag-n-drop-with-mouse-events">
<h2><a class="toc-backref" href="#id8">Drag’n’Drop with mouse events</a><a class="headerlink" href="#drag-n-drop-with-mouse-events" title="Permalink to this heading">¶</a></h2>
<p>&lt;<a class="reference external" href="https://javascript.info/mouse-drag-and-drop">https://javascript.info/mouse-drag-and-drop</a>&gt; のノート。</p>
<p>仕様上は <code class="docutils literal notranslate"><span class="pre">dragstart</span></code>, <code class="docutils literal notranslate"><span class="pre">dragend</span></code> などのドラッグ＆ドロップ用のイベントがある。しかし、それらは制限があったり、機能が弱かったりする。そこで、本章では
<code class="docutils literal notranslate"><span class="pre">mousedown</span></code>, <code class="docutils literal notranslate"><span class="pre">mousemove</span></code>, <code class="docutils literal notranslate"><span class="pre">mouseup</span></code> でドラッグ＆ドロップを実装する。</p>
<section id="drag-n-drop-algorithm">
<h3>Drag’n’Drop algorithm<a class="headerlink" href="#drag-n-drop-algorithm" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>ブラウザー既定の挙動を取り除くため <code class="docutils literal notranslate"><span class="pre">dragstart</span></code> からイベント通知が拡がらないようにする。つまり <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">false</span></code> とする。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mousedown</span></code> でドラッグの準備をする。</p>
<ul>
<li><p>ドラッグ対象要素の属性を変える。CSS が <code class="docutils literal notranslate"><span class="pre">position:</span> <span class="pre">absolute</span></code> と
<code class="docutils literal notranslate"><span class="pre">z-index:</span> <span class="pre">1000</span></code> になるようにする。</p>
<ul>
<li><p>それに関係して対象要素をいったん <code class="docutils literal notranslate"><span class="pre">body</span></code> の子になるように移す。</p></li>
<li><p>対象要素の座標を文書座標系で指定する。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mousemove</span></code> と <code class="docutils literal notranslate"><span class="pre">mouseup</span></code> 両ハンドラーを指定する。</p></li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">mousemove</span></code> ハンドラーは座標更新処理しかしない。</p>
<ul>
<li><p>座標をきめ細かく取る。開始直後のマウスカーソル位置から対象要素がズレないように工夫する。本文では、対象要素座標系の原点とカーソル位置の変位を意識して位置を更新している。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">mouseup</span></code> ハンドラーでドロップ処理およびクリナップをする。</p>
<ul>
<li><p>仕込んだ両ハンドラーを解除する。</p></li>
</ul>
</li>
<li><p>これらのマウスイベントハンドラーを <code class="docutils literal notranslate"><span class="pre">document</span></code> に対して仕込むのが急所だ。</p></li>
</ul>
</section>
<section id="correct-positioning">
<h3>Correct positioning<a class="headerlink" href="#correct-positioning" title="Permalink to this heading">¶</a></h3>
<p>ドラッグ開始時点のマウスポインターの座標を要素座標系に変換する。そして、ドラッグ中の要素の座標を、現在のマウス座標から上記座標の変位を加味して決める。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// mousedown</span>
<span class="kd">const</span> <span class="nx">rc</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">shiftX</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">-</span> <span class="nx">rc</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">shiftY</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">-</span> <span class="nx">rc</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>

<span class="c1">// mousemove</span>
<span class="nx">elem</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">pageX</span> <span class="o">-</span> <span class="nx">shiftX</span><span class="si">}</span><span class="sb">px`</span><span class="p">;</span>
<span class="nx">elem</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">pageY</span> <span class="o">-</span> <span class="nx">shiftY</span><span class="si">}</span><span class="sb">px`</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="potential-drop-targets-droppables">
<h3>Potential drop targets (droppables)<a class="headerlink" href="#potential-drop-targets-droppables" title="Permalink to this heading">¶</a></h3>
<p>今度はドロップ先の要素を特定することを考える。</p>
<ul class="simple">
<li><p>ドラッグ中の要素がいちばん手前にあるため、一時的に <code class="docutils literal notranslate"><span class="pre">hidden</span> <span class="pre">=</span> <span class="pre">true</span></code> する。すると、絶好の <code class="docutils literal notranslate"><span class="pre">elementFromPoint(clientX,</span> <span class="pre">clientY)</span></code> の応用状況となる。</p></li>
<li><p>ドロップを受け入れることが可能な要素であるかどうかは、要素に CSS クラスを与えるなりなんなりすればいい。その上で <code class="docutils literal notranslate"><span class="pre">elem.closest()</span></code> により検索する。</p></li>
</ul>
</section>
<section id="id2">
<h3>Tasks<a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h3>
<section id="slider">
<h4>Slider<a class="headerlink" href="#slider" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>サッカーボールのコードをそのままパクるだけだと、スライダーが自由にドラッグしてしまう。これに拘束をかければ良い。とくに、y 座標の処理は不要。</p></li>
<li><p>与えられたサンドボックスコードは、すでに <code class="docutils literal notranslate"><span class="pre">DIV</span></code> が <code class="docutils literal notranslate"><span class="pre">position:</span> <span class="pre">relative</span></code> になっているので、サッカーボールのコードの配置関連コードは不要となる。</p></li>
</ul>
</section>
<section id="drag-superheroes-around-the-field">
<h4>Drag superheroes around the field<a class="headerlink" href="#drag-superheroes-around-the-field" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>要件 1 の急所は <code class="docutils literal notranslate"><span class="pre">document</span></code> に <code class="docutils literal notranslate"><span class="pre">mousedown</span></code> ハンドラーを実装することと、マウスカーソル位置から <code class="docutils literal notranslate"><span class="pre">closest('.draggable')</span></code> で得られる要素をドラッグすることの二つ。</p></li>
<li><p>要件 2 の縦スクロールが大きい場合の処理。次のものを利用する：</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">document.documentElement.clientHeight</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dragElement.offsetHeight</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">window.scrollBy(0,</span> <span class="pre">scrollY)</span></code></p></li>
</ul>
</li>
<li><p>要件 3 の横スクロール禁止。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">document.documentElement.clientWidth</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dragElement.offsetWidth</span></code></p></li>
</ul>
</li>
<li><p>要件 4 は要件 2, 3 と一緒に実装する。</p></li>
<li><p>このデモではドラッグ可能要素の <code class="docutils literal notranslate"><span class="pre">position</span></code> をドラッグ中の間だけ <code class="docutils literal notranslate"><span class="pre">fixed</span></code> にする。座標計算をより容易にする意味がある。</p></li>
</ul>
</section>
<section id="comments">
<h4>Comments<a class="headerlink" href="#comments" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>変位 <code class="docutils literal notranslate"><span class="pre">shiftX</span></code> を自分で計算するのではなく <code class="docutils literal notranslate"><span class="pre">event.offsetX</span></code> を代わりに使うといいようだ。</p></li>
<li><p>携帯電話で動かないという指摘が当然あるが、マウスではなく <code class="docutils literal notranslate"><span class="pre">pointerxxxx</span></code>
イベントを使えばいいだろう。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">elem.elementFromPoint()</span></code> の仕様は MDN と本書とで違うように見えるが、矛盾していない。</p></li>
</ul>
</section>
</section>
</section>
<section id="pointer-events">
<h2><a class="toc-backref" href="#id9">Pointer events</a><a class="headerlink" href="#pointer-events" title="Permalink to this heading">¶</a></h2>
<p>&lt;<a class="reference external" href="https://javascript.info/pointer-events">https://javascript.info/pointer-events</a>&gt; のノート。</p>
<p>マウスだけでなく、ペン、スタイラス、タッチスクリーンなど、ポインティングデバイス一般からの入力を処理する方法を見ていく。</p>
<section id="the-brief-history">
<h3>The brief history<a class="headerlink" href="#the-brief-history" title="Permalink to this heading">¶</a></h3>
<p>歴史的には、まずタッチスクリーンを対応する必要が生じたので、次のようなタッチイベントが導入された：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">touchstart</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">touchend</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">touchmove</span></code></p></li>
</ul>
<p>しかし、さらなるデバイスが登場したり、それらのイベントハンドラーを個別に書くのが面倒になったりしてくる。そこで本章で見ていく一連のイベントが導入された。これから書くスクリプトでは、マウスやタッチ固有のハンドラーではなく、ポインターハンドラーを書けばいい。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.w3.org/TR/pointerevents2/">Pointer Events Level 2</a></p></li>
<li><p><a class="reference external" href="https://w3c.github.io/pointerevents/">Pointer Events Level 3</a></p></li>
</ul>
</section>
<section id="pointer-event-types">
<h3>Pointer event types<a class="headerlink" href="#pointer-event-types" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>ポインターイベントは、 <code class="docutils literal notranslate"><span class="pre">mousemove</span></code> に対応する <code class="docutils literal notranslate"><span class="pre">pointermove</span></code> といった具合に、マウスイベントと同様の名前が付けられている。それらに加え、ポインターイベントには三つの固有イベントが定義されている。</p></li>
<li><p>基本的には既存コードの <code class="docutils literal notranslate"><span class="pre">mousexxxx</span></code> を <code class="docutils literal notranslate"><span class="pre">pointerxxxx</span></code> に置換することでマウスもタッチなども動作すると期待してよい。ただし、CSS のいくつかの場所で
<code class="docutils literal notranslate"><span class="pre">touch-action:</span> <span class="pre">none</span></code> を追加する必要があるかもしれない。</p></li>
</ul>
</section>
<section id="pointer-event-properties">
<h3>Pointer event properties<a class="headerlink" href="#pointer-event-properties" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>マウスイベントプロパティーと同じもの。 <code class="docutils literal notranslate"><span class="pre">clientX</span></code>, <code class="docutils literal notranslate"><span class="pre">target</span></code>, etc.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pointerId</span></code>: イベントを発生させるポインターの ID</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pointerType</span></code>: “mouse”, “pen”, “touch” のいずれかの文字列。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">isPrimary</span></code>: マルチタッチの場合の、優先的なポインターであるかどうか？</p></li>
<li><p>デバイスによってはさらなるプロパティーが仕様で定められているが、ほとんどのデバイスがこれらを対応していない。したがって、めったに使われないプロパティーということだ。</p></li>
</ul>
</section>
<section id="multi-touch">
<h3>Multi-touch<a class="headerlink" href="#multi-touch" title="Permalink to this heading">¶</a></h3>
<p>ユーザーがタッチスクリーンのある場所に触れた後、別の指をタッチスクリーンのどこかに置くと、次のようなことが起こる：</p>
<ul class="simple">
<li><p>最初の指のタッチでは <code class="docutils literal notranslate"><span class="pre">isPrimary=true</span></code> である <code class="docutils literal notranslate"><span class="pre">pointerdown</span></code> と、何らかの
<code class="docutils literal notranslate"><span class="pre">pointerId</span></code></p></li>
<li><p>次以降の指（最初の指がまだ触れていると仮定）では <code class="docutils literal notranslate"><span class="pre">isPrimary=false</span></code> である
<code class="docutils literal notranslate"><span class="pre">pointerdown</span></code> と各指に対して異なる <code class="docutils literal notranslate"><span class="pre">pointerId</span></code></p></li>
</ul>
<p>タッチしている複数の指を、それぞれの <code class="docutils literal notranslate"><span class="pre">pointerId</span></code> を使って追跡することになる。ユーザーが指を動かしてから離すと、 <code class="docutils literal notranslate"><span class="pre">pointerdown</span></code> で得たのと同じ <code class="docutils literal notranslate"><span class="pre">pointerId</span></code>
を持つ <code class="docutils literal notranslate"><span class="pre">pointermove</span></code> と <code class="docutils literal notranslate"><span class="pre">pointerup</span></code> イベントが起こる。</p>
<ul class="simple">
<li><p>このデモを PC とマウスで試しても面白くないことに注意。</p></li>
</ul>
</section>
<section id="event-pointercancel">
<h3>Event: pointercancel<a class="headerlink" href="#event-pointercancel" title="Permalink to this heading">¶</a></h3>
<p>イベント <code class="docutils literal notranslate"><span class="pre">pointercancel</span></code> は、ポインターのやりとりが続いているときに発生するもので、その後、何かが起きてそれが中断され、さらなるポインターイベントが発生しないようにする。</p>
<p>例えばドラッグ＆ドロップをポインターイベントで実装するなどすると、ブラウザーの既定の挙動が <code class="docutils literal notranslate"><span class="pre">pointercancel</span></code> を発生させて妨害される。ここではその回避策を述べている。</p>
<ul class="simple">
<li><p>まず、前章のマウスによるドラッグ＆ドロップで述べた仕組みがポインターイベントでも成り立つことから、ドラッグ要素の <code class="docutils literal notranslate"><span class="pre">dragstart</span></code> ハンドラーに <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">false</span></code>
させる。</p></li>
<li><p>タッチデバイスの場合を考慮する。タッチ関連のブラウザーアクションはドラッグ＆ドロップ以外にある。それらについても問題を回避するには、ドラッグ要素に対して
CSS で <code class="docutils literal notranslate"><span class="pre">touch-action:</span> <span class="pre">none</span></code> と設定する。</p></li>
</ul>
<p>改良版サッカーデモでは、ボールをドラッグしようとすると、ブラウザーが余計なことをしなくなることしかまだ確認できない。</p>
</section>
<section id="pointer-capturing">
<h3>Pointer capturing<a class="headerlink" href="#pointer-capturing" title="Permalink to this heading">¶</a></h3>
<p>ここでは <code class="docutils literal notranslate"><span class="pre">elem.setPointerCapture(pointerId)</span></code> と <code class="docutils literal notranslate"><span class="pre">elem.releasePointerCapture(pointerId)</span></code>
を述べている。Win32 API の <code class="docutils literal notranslate"><span class="pre">SetCapture(hWnd)</span></code>, <code class="docutils literal notranslate"><span class="pre">ReleaseCapture()</span></code> のポインター版と解釈できる。</p>
<p>前章のスライダーバーの実装では <code class="docutils literal notranslate"><span class="pre">document</span></code> に対してイベントハンドラーを定義していたが、これらの捕捉用メソッドをスライダーに対して利用すればスマートだ：</p>
<ul class="simple">
<li><p>文書全体に対してハンドラーを追加・削除する必要がなくなり、コードがすっきりする。</p></li>
<li><p>文書内に他のポインターイベントハンドラーがある場合、ユーザーがスライダーをドラッグしている間にポインターがよその要素に行っても、そのイベントハンドラーが引き起こされることがなくなる。</p></li>
</ul>
<section id="pointer-capturing-events">
<h4>Pointer capturing events<a class="headerlink" href="#pointer-capturing-events" title="Permalink to this heading">¶</a></h4>
<p>万全を期すために、残りの二つのポインター固有のイベントについても述べられている。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gotpointercapture</span></code>: <code class="docutils literal notranslate"><span class="pre">elem.setPointerCapture()</span></code> が呼び出されたときに発生する。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lostpointercapture</span></code>: <code class="docutils literal notranslate"><span class="pre">elem.releasePointerCapture()</span></code> が明示的に呼び出されたときか、 <code class="docutils literal notranslate"><span class="pre">pointerup</span></code> や <code class="docutils literal notranslate"><span class="pre">pointercancel</span></code> イベントにより自動的にポインター捕捉が解除されたときに発生する。</p></li>
</ul>
</section>
</section>
</section>
<section id="keyboard-keydown-and-keyup">
<h2><a class="toc-backref" href="#id10">Keyboard: keydown and keyup</a><a class="headerlink" href="#keyboard-keydown-and-keyup" title="Permalink to this heading">¶</a></h2>
<p>&lt;<a class="reference external" href="https://javascript.info/keyboard-events">https://javascript.info/keyboard-events</a>&gt; のノート。</p>
<p>冒頭にいい警告がある。やりたいことは、キーボードを使うことが本当に必要であるのかと。</p>
<section id="teststand">
<h3>Teststand<a class="headerlink" href="#teststand" title="Permalink to this heading">¶</a></h3>
<p>このデモは <code class="docutils literal notranslate"><span class="pre">keydown</span></code>, <code class="docutils literal notranslate"><span class="pre">keyup</span></code> イベントの概要と <code class="docutils literal notranslate"><span class="pre">event.preventDefault()</span></code> のおさらい。既定の挙動を妨害すると、テキストボックスに文字が打ち出されなくなる。</p>
</section>
<section id="keydown-and-keyup">
<h3>Keydown and keyup<a class="headerlink" href="#keydown-and-keyup" title="Permalink to this heading">¶</a></h3>
<p>まずは <code class="docutils literal notranslate"><span class="pre">event.key</span></code> と <code class="docutils literal notranslate"><span class="pre">event.code</span></code> の違いを理解する。ひとまず前者を文字、後者を物理的キー（言い換えるとキーの位置）を表すものと解釈しておく。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">event.key</span></code> は実際の文字（列）を値に取るか、文字がなければ特別な値を取る。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">event.code</span></code> は “KeyA”, “Digit8”, “Enter”, “Tab” などの文字列を値に取る。</p></li>
</ul>
<p>本文では両者の違いについて細かく解説している。国によってキー配置が異なるから、
<code class="docutils literal notranslate"><span class="pre">event.key</span></code> を採るか <code class="docutils literal notranslate"><span class="pre">event.code</span></code> を採るかは、アプリケーションの目的による。</p>
</section>
<section id="auto-repeat">
<h3>Auto-repeat<a class="headerlink" href="#auto-repeat" title="Permalink to this heading">¶</a></h3>
<p>同じキーを長時間押し続けていると <code class="docutils literal notranslate"><span class="pre">keydown</span></code> イベントが何度も繰り返し発生し、最後に
<code class="docutils literal notranslate"><span class="pre">keydown</span></code> が一度発生する。これを自動繰り返しという。自動繰り返しイベントでは
<code class="docutils literal notranslate"><span class="pre">event.repeat</span></code> の値は <code class="docutils literal notranslate"><span class="pre">true</span></code> となっている。</p>
</section>
<section id="default-actions">
<h3>Default actions<a class="headerlink" href="#default-actions" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>OS あるいはそれ以下のレベルで定められているショートカットキーによるコマンド起動以外は、JavaScript のいつもの方法で既定の挙動を妨害できる。</p></li>
<li><p>電話番号用に <code class="docutils literal notranslate"><span class="pre">INPUT</span></code> タグの <code class="docutils literal notranslate"><span class="pre">keydown</span></code> イベントハンドラーを書く例はわかりやすい。しかし、普通は別のイベントハンドラーを書くこと。</p></li>
</ul>
</section>
<section id="legacy">
<h3>Legacy<a class="headerlink" href="#legacy" title="Permalink to this heading">¶</a></h3>
<p>この節に書いてあるイベントもプロパティーも旧式のものだ。今から書くコードでは採用しない。</p>
</section>
<section id="mobile-keyboards">
<h3>Mobile Keyboards<a class="headerlink" href="#mobile-keyboards" title="Permalink to this heading">¶</a></h3>
<p>仮想キーボードを使用する場合、 <code class="docutils literal notranslate"><span class="pre">e.key</span></code> は “Unindentified” となるはずだ。</p>
</section>
<section id="id3">
<h3>Tasks<a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h3>
<section id="extended-hotkeys">
<h4>Extended hotkeys<a class="headerlink" href="#extended-hotkeys" title="Permalink to this heading">¶</a></h4>
<p>キー同時押しを判定するときには <code class="docutils literal notranslate"><span class="pre">keydown</span></code> だけでなく <code class="docutils literal notranslate"><span class="pre">keyup</span></code> の処理も必要となる。</p>
<ul class="simple">
<li><p>可変個引数を取る関数の書き方を思い出す。</p></li>
<li><p>JavaScript の <code class="docutils literal notranslate"><span class="pre">Set</span></code> は扱いづらい。</p></li>
</ul>
</section>
</section>
</section>
<section id="scrolling">
<h2><a class="toc-backref" href="#id11">Scrolling</a><a class="headerlink" href="#scrolling" title="Permalink to this heading">¶</a></h2>
<p>&lt;<a class="reference external" href="https://javascript.info/onscroll">https://javascript.info/onscroll</a>&gt; のノート。</p>
<ul class="simple">
<li><p>スクロールを監視するには <code class="docutils literal notranslate"><span class="pre">scroll</span></code> イベントを処理する。</p></li>
<li><p>イベント <code class="docutils literal notranslate"><span class="pre">scroll</span></code> は <code class="docutils literal notranslate"><span class="pre">window</span></code> とスクロール可能要素の両方で処理される。</p></li>
</ul>
<section id="prevent-scrolling">
<h3>Prevent scrolling<a class="headerlink" href="#prevent-scrolling" title="Permalink to this heading">¶</a></h3>
<p>今まで見てきた UI イベントとは異なり、 <code class="docutils literal notranslate"><span class="pre">scroll</span></code> ハンドラーで
<code class="docutils literal notranslate"><span class="pre">event.preventDefault()</span></code> を使っても、スクロールを妨害することはできない。このイベントはすでにスクロールが起こった後に発生するものだ。したがって、妨害するにはスクロールの原因となるイベント、たとえば PGUP や PGDN キーを押されたのを感知して
<code class="docutils literal notranslate"><span class="pre">event.preventDefault()</span></code> を呼び出すなど、工夫する必要がある。</p>
<p>スクロールを許す方法はいろいろあるので、CSS の <code class="docutils literal notranslate"><span class="pre">overflow:</span></code> プロパティーを利用するのが確実だ。</p>
</section>
<section id="id4">
<h3>Tasks<a class="headerlink" href="#id4" title="Permalink to this heading">¶</a></h3>
<section id="endless-page">
<h4>Endless page<a class="headerlink" href="#endless-page" title="Permalink to this heading">¶</a></h4>
<ul>
<li><p>最後までスクロールするというのは、実際には閲覧者が文書の末端から何ピクセルか以上離れていないくらいの意味に解釈すること。</p></li>
<li><p>この例題はナンセンスなものではなく、現実にはよく使われるパターンだ（商品リストなど）。</p></li>
<li><p>イベントハンドラーは <code class="docutils literal notranslate"><span class="pre">window</span></code> に付与する。</p></li>
<li><p>今回はスクロールすると <code class="docutils literal notranslate"><span class="pre">document.documentElement.getBoundingClientRect()</span></code> の
<code class="docutils literal notranslate"><span class="pre">top</span></code> と <code class="docutils literal notranslate"><span class="pre">bottom</span></code> が変動する。</p></li>
<li><p>ウィンドウの高さは <code class="docutils literal notranslate"><span class="pre">document.documentElement.clientHeight</span></code> を見る。</p></li>
<li><p>今はドキュメントの下部がそこから何ピクセルか以上離れていないときを知る必要がある。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span>
<span class="k">while</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">clientHeight</span> <span class="o">+</span> <span class="mf">100</span> <span class="o">&lt;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">().</span><span class="nx">bottom</span><span class="p">){</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">now</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="up-down-button">
<h4>Up/down button<a class="headerlink" href="#up-down-button" title="Permalink to this heading">¶</a></h4>
<p>ページのスクロールを助ける「トップへ」ボタンを作成する。</p>
<p>ページがウィンドウの高さ以上にスクロールされているときは、左上に「上へ」の矢印を表示する。この矢印をクリックすると、ページが一番上にスクロールする。</p>
<ul class="simple">
<li><p>これも現実的な例だ。</p></li>
<li><p>サンドボックスコードではすでに与えられているが、矢印を <code class="docutils literal notranslate"><span class="pre">hidden</span></code> な <code class="docutils literal notranslate"><span class="pre">DIV</span></code>
要素として最初から文書内に置く。</p>
<ul>
<li><p>CSS で <code class="docutils literal notranslate"><span class="pre">position:</span> <span class="pre">fixed</span></code> とし、 <code class="docutils literal notranslate"><span class="pre">left</span></code>, <code class="docutils literal notranslate"><span class="pre">top</span></code> をページの左上になるように決める。</p></li>
<li><p>矢印のイベント <code class="docutils literal notranslate"><span class="pre">click</span></code> でページを天井までスクロールさせる。
<code class="docutils literal notranslate"><span class="pre">window.scrollTo(pageXOffset,</span> <span class="pre">0)</span></code> を使う。</p></li>
</ul>
</li>
<li><p>ページのイベント <code class="docutils literal notranslate"><span class="pre">scroll</span></code> でスクロール量をチェックし、必要に応じて矢印要素を表示・非表示する。</p></li>
<li><p>模範解答の <code class="docutils literal notranslate"><span class="pre">pageXOffset</span></code> などは <code class="docutils literal notranslate"><span class="pre">window.pageXOffset</span></code> などと同じ。</p></li>
</ul>
</section>
<section id="load-visible-images">
<h4>Load visible images<a class="headerlink" href="#load-visible-images" title="Permalink to this heading">¶</a></h4>
<p>ページが所定の位置にスクロールされてから画像などをロードする問題だ。</p>
<p>本問では関数 <code class="docutils literal notranslate"><span class="pre">isVisible(elem)</span></code> を埋めるだけでいい。これは <code class="docutils literal notranslate"><span class="pre">IMG</span></code> 要素のクライアント領域の上下端の座標と <code class="docutils literal notranslate"><span class="pre">document.documentElement.clientHeight</span></code> とを比較すればいい。</p>
<p>この比較の数値をオフセットするとプリロードの効果が得られる。</p>
</section>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="04-forms-controls.html" title="Forms, controls"
             >next</a></li>
        <li class="right" >
          <a href="02-events.html" title="Introduction to Events"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">読書ノート</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >The Modern JavaScript Tutorial 読書ノート</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Part 2 Browser: Document, Events, Interfaces</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">UI Events</a></li> 
      </ul>
    </div>
    <div id="footer">
      <div id="footer_logo">
        <a class="imga" href="https://showa-yojyo.github.io/" title="プレハブ小屋 Since 1999"><img src="../../_static/logos.png" width="88" height="31" /></a>
      </div>
      <div id="footer_copyright">
        Since 1999<br />
        Copyright &copy; 1999-2022, プレハブ小屋 All rights reserved.
      </div>
    </div>
  </body>
</html>