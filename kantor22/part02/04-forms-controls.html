<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Forms, controls &#8212; 読書ノート 1.5dev documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=1a9a5cd9" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=91898170"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/mermaid.js?v=578dbed1"></script>
    <link rel="next" title="Document and resource loading" href="05-loading.html" />
    <link rel="prev" title="UI Events" href="03-event-details.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="03-event-details.html" title="Previous document">UI Events</a>
        </li>
        <li>
          <a href="05-loading.html" title="Next document">Document and resource loading</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <section id="forms-controls">
<h1><a class="toc-backref" href="#id4" role="doc-backlink">Forms, controls</a><a class="headerlink" href="#forms-controls" title="Permalink to this heading">¶</a></h1>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#forms-controls" id="id4">Forms, controls</a></p>
<ul>
<li><p><a class="reference internal" href="#form-properties-and-methods" id="id5">Form properties and methods</a></p></li>
<li><p><a class="reference internal" href="#focusing-focus-blur" id="id6">Focusing: <code class="docutils literal notranslate"><span class="pre">focus</span></code>/<code class="docutils literal notranslate"><span class="pre">blur</span></code></a></p></li>
<li><p><a class="reference internal" href="#events-change-input-cut-copy-paste" id="id7">Events: <code class="docutils literal notranslate"><span class="pre">change</span></code>, <code class="docutils literal notranslate"><span class="pre">input</span></code>, <code class="docutils literal notranslate"><span class="pre">cut</span></code>, <code class="docutils literal notranslate"><span class="pre">copy</span></code>, <code class="docutils literal notranslate"><span class="pre">paste</span></code></a></p></li>
<li><p><a class="reference internal" href="#forms-event-and-method-submit" id="id8">Forms: event and method <code class="docutils literal notranslate"><span class="pre">submit</span></code></a></p></li>
</ul>
</li>
</ul>
</nav>
<p>HTML の <code class="docutils literal notranslate"><span class="pre">FORM</span></code>, <code class="docutils literal notranslate"><span class="pre">INPUT</span></code>, <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> 各要素に関係するイベントを習う。</p>
<section id="form-properties-and-methods">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Form properties and methods</a><a class="headerlink" href="#form-properties-and-methods" title="Permalink to this heading">¶</a></h2>
<p>&lt;<a class="reference external" href="https://javascript.info/form-elements">https://javascript.info/form-elements</a>&gt; のノート。</p>
<p>これらの要素にある特別な性質を理解することで、フォーム作業を便利にする。</p>
<section id="navigation-form-and-elements">
<h3>Navigation: <code class="docutils literal notranslate"><span class="pre">form</span></code> and <code class="docutils literal notranslate"><span class="pre">elements</span></code><a class="headerlink" href="#navigation-form-and-elements" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">document.forms</span></code> でページ内のフォームを参照できる。プロパティー <code class="docutils literal notranslate"><span class="pre">name</span></code> もしくはインデックスで個別のフォームを参照する。</p></li>
<li><p>フォーム <code class="docutils literal notranslate"><span class="pre">form</span></code> 内の構成要素を <code class="docutils literal notranslate"><span class="pre">form.elements</span></code> で参照できる。プロパティー
<code class="docutils literal notranslate"><span class="pre">name</span></code> もしくはインデックスで個別の要素を参照する。</p></li>
<li><p>チェックボックスやラジオボタンなど、同じ <code class="docutils literal notranslate"><span class="pre">name</span></code> の構成要素が複数存在する場合がある。このとき <code class="docutils literal notranslate"><span class="pre">form.elements[name]</span></code> もまたコレクションだ。</p></li>
<li><p>この参照方法は、フォームの DOM 木構造に依存していない。木構造がどれだけ入り組んでいようが使いやすい。</p></li>
<li><p>フォーム <code class="docutils literal notranslate"><span class="pre">form</span></code> が <code class="docutils literal notranslate"><span class="pre">FIELDSET</span></code> を含んでいて、それが <code class="docutils literal notranslate"><span class="pre">name=loginId</span></code> であるフォーム要素を含んでいるとする。この場合にも <code class="docutils literal notranslate"><span class="pre">form.elements.loginId</span></code> で参照できるし、<code class="docutils literal notranslate"><span class="pre">FIELDSET</span></code> の <code class="docutils literal notranslate"><span class="pre">elements</span></code> から参照できる。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.elements</span></code> を略記する参照方法もある。</p></li>
</ul>
</section>
<section id="backreference-element-form">
<h3>Backreference: <code class="docutils literal notranslate"><span class="pre">element.form</span></code><a class="headerlink" href="#backreference-element-form" title="Permalink to this heading">¶</a></h3>
<p>フォーム構成要素 <code class="docutils literal notranslate"><span class="pre">element</span></code> は親 <code class="docutils literal notranslate"><span class="pre">FORM</span></code> を <code class="docutils literal notranslate"><span class="pre">element.form</span></code> で参照できる。</p>
</section>
<section id="form-elements">
<h3>Form elements<a class="headerlink" href="#form-elements" title="Permalink to this heading">¶</a></h3>
<section id="input-and-textarea">
<h4><code class="docutils literal notranslate"><span class="pre">input</span></code> and <code class="docutils literal notranslate"><span class="pre">textarea</span></code><a class="headerlink" href="#input-and-textarea" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>テキストボックスやテキストエリア中の文字列ならば <code class="docutils literal notranslate"><span class="pre">input.value</span></code> を、チェックボックスやラジオボタンの選択ならば <code class="docutils literal notranslate"><span class="pre">input.checked</span></code> をそれぞれ参照する。</p></li>
<li><p>テキストエリアの <code class="docutils literal notranslate"><span class="pre">innerHTML</span></code> を使ってはならない。現在の値が格納されているわけではない。</p></li>
</ul>
</section>
<section id="select-and-option">
<h4><code class="docutils literal notranslate"><span class="pre">select</span></code> and <code class="docutils literal notranslate"><span class="pre">option</span></code><a class="headerlink" href="#select-and-option" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SELECT</span></code> 要素のプロパティー</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">select.options</span></code>: 選択肢のコレクション。つまり子 <code class="docutils literal notranslate"><span class="pre">OPTION</span></code> 要素全部。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">select.value</span></code>: 現在選択されている <code class="docutils literal notranslate"><span class="pre">OPTION</span></code> の値。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">select.selectedIndex</span></code>: 現在選択されている <code class="docutils literal notranslate"><span class="pre">OPTION</span></code> のインデックス。</p></li>
</ul>
</li>
<li><p>現在の選択肢をスクリプトからセットするには、次のどの方法でもいい：</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">select.options[2].selected</span> <span class="pre">=</span> <span class="pre">true;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">select.value</span> <span class="pre">=</span> <span class="pre">XXXX;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">select.selectedIndex</span> <span class="pre">=</span> <span class="pre">2;</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">SELECT</span></code> 要素が複数の選択を許すモードの場合、つまり属性 <code class="docutils literal notranslate"><span class="pre">multiple</span></code> があるとき、スクリプトからは <code class="docutils literal notranslate"><span class="pre">select.options</span></code> を反復して対象選択肢を参照することになる。</p></li>
</ul>
</section>
<section id="new-option">
<h4><code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">Option</span></code><a class="headerlink" href="#new-option" title="Permalink to this heading">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">OPTION</span></code> 要素をスクリプトから生成する場合、
<code class="docutils literal notranslate"><span class="pre">document.createElement('option')</span></code> でもいいかもしれないが、便利なクラスがある。</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">option</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Option</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">defaultSelected</span><span class="p">,</span><span class="w"> </span><span class="nx">selected</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">defaultSelected</span></code> が少しわかりにくい。この値を <code class="docutils literal notranslate"><span class="pre">true</span></code> とすると <code class="docutils literal notranslate"><span class="pre">OPTION</span></code>
タグの属性 <code class="docutils literal notranslate"><span class="pre">selected</span></code> が生成される。</p></li>
</ul>
</section>
</section>
<section id="tasks">
<h3>Tasks<a class="headerlink" href="#tasks" title="Permalink to this heading">¶</a></h3>
<section id="add-an-option-to-select">
<h4>Add an option to select<a class="headerlink" href="#add-an-option-to-select" title="Permalink to this heading">¶</a></h4>
<p>現在選択されている選択肢を参照するコードが、実は少し長くなるということがわかる。
<code class="docutils literal notranslate"><span class="pre">SELECT</span></code> 要素のプロパティーへの参照が二つあるからだ。</p>
</section>
</section>
</section>
<section id="focusing-focus-blur">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Focusing: <code class="docutils literal notranslate"><span class="pre">focus</span></code>/<code class="docutils literal notranslate"><span class="pre">blur</span></code></a><a class="headerlink" href="#focusing-focus-blur" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>ユーザーがクリックしたり <kbd class="kbd docutils literal notranslate">Tab</kbd> キーを押したりすると、フォーム構成要素が
focus される。</p></li>
<li><p>HTML から見ると構成要素には <code class="docutils literal notranslate"><span class="pre">autofocus</span></code> という属性もある。フォームがロードされた直後に focus されている要素であることを示すものだ。</p></li>
<li><p>構成要素の focus が外れることを blur という。こちらのほうが重要かもしれない。データの入力が完了したことを示唆するからだ。</p></li>
</ul>
<section id="events-focus-blur">
<h3>Events <code class="docutils literal notranslate"><span class="pre">focus</span></code>/<code class="docutils literal notranslate"><span class="pre">blur</span></code><a class="headerlink" href="#events-focus-blur" title="Permalink to this heading">¶</a></h3>
<p>&lt;<a class="reference external" href="https://javascript.info/focus-blur">https://javascript.info/focus-blur</a>&gt; のノート。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">focus</span></code>, <code class="docutils literal notranslate"><span class="pre">blur</span></code> イベントを入力検査に利用することをメールアドレスのデモを作って考える。このコードはこれまでの学習内容で理解できる。</p></li>
<li><p>現代の HTML では <code class="docutils literal notranslate"><span class="pre">required</span></code> や <code class="docutils literal notranslate"><span class="pre">pattern</span></code> などの属性が用意されている。このメールアドレスの検証デモのような場合には、これらの属性で事足りることがある。</p></li>
</ul>
</section>
<section id="methods-focus-blur">
<h3>Methods <code class="docutils literal notranslate"><span class="pre">focus</span></code>/<code class="docutils literal notranslate"><span class="pre">blur</span></code><a class="headerlink" href="#methods-focus-blur" title="Permalink to this heading">¶</a></h3>
<p>フォーム構成要素にはメソッド <code class="docutils literal notranslate"><span class="pre">focus</span></code>, <code class="docutils literal notranslate"><span class="pre">blur</span></code> がある。これらをスクリプトから呼び出すと、それぞれに対応するユーザーの対話的操作を実現できる。</p>
<p><code class="docutils literal notranslate"><span class="pre">blur</span></code> ハンドラーは focus を失った後で動作するので、このハンドラーで
<code class="docutils literal notranslate"><span class="pre">event.preventDefault()</span></code> を呼び出して focus を失うのを妨害することはできない。</p>
</section>
<section id="allow-focusing-on-any-element-tabindex">
<h3>Allow focusing on any element: <code class="docutils literal notranslate"><span class="pre">tabindex</span></code><a class="headerlink" href="#allow-focusing-on-any-element-tabindex" title="Permalink to this heading">¶</a></h3>
<p>元々 focus 機能を有する HTML 要素は限定されている。上述のフォーム関連要素と
<code class="docutils literal notranslate"><span class="pre">A``などだ。対応されていない要素に</span> <span class="pre">``elem.focus()</span></code> などを呼び出してもハンドラーは反応しない。ただし、HTML の要素に属性 <code class="docutils literal notranslate"><span class="pre">tabindex</span></code> を付与すると、focus を受けるように変えられる。</p>
<ul class="simple">
<li><p>どんな HTML 要素に対しても <code class="docutils literal notranslate"><span class="pre">tabindex</span></code> を持たせることができる。</p></li>
<li><p>この属性値は <kbd class="kbd docutils literal notranslate">Tab</kbd> キーを押すと focus が当たる順序だ。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">tabindex</span></code> が明示されていない要素は、ページ内で登場する順序が考慮されてこの値が決まる。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tabindex=&quot;0&quot;</span></code> である要素は、<code class="docutils literal notranslate"><span class="pre">tabindex</span></code> 値が 1 以上の要素すべての後に「来る」。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tabindex=&quot;-1&quot;</span></code> である要素は <kbd class="kbd docutils literal notranslate">Tab</kbd> キーを無視するが focus を当てることはできる。</p></li>
</ul>
</li>
<li><p>JavaScript からは <code class="docutils literal notranslate"><span class="pre">elem.tabIndex</span></code> で参照する。</p></li>
<li><p>CSS の <code class="docutils literal notranslate"><span class="pre">:focus</span></code> も覚えておくこと。</p></li>
</ul>
</section>
<section id="delegation-focusin-focusout">
<h3>Delegation: <code class="docutils literal notranslate"><span class="pre">focusin</span></code>/<code class="docutils literal notranslate"><span class="pre">focusout</span></code><a class="headerlink" href="#delegation-focusin-focusout" title="Permalink to this heading">¶</a></h3>
<p>一般的な UI イベントとは異なり、<code class="docutils literal notranslate"><span class="pre">focus</span></code> も <code class="docutils literal notranslate"><span class="pre">blur</span></code> も bubbling をしない。したがって、親フォームに子要素のためのイベントハンドラーを書くことができない。</p>
<p>解決策は次のいずれか：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">form.addEventListerer()</span></code> のオプションで capturing を有効にする。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">focusin</span></code>, <code class="docutils literal notranslate"><span class="pre">focusout</span></code> イベントを採用する。これらは <code class="docutils literal notranslate"><span class="pre">focus</span></code>, <code class="docutils literal notranslate"><span class="pre">blur</span></code> の
bubbling 版のようなものだ。</p></li>
</ul>
</section>
<section id="id1">
<h3>Tasks<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h3>
<section id="editable-div">
<h4>Editable <code class="docutils literal notranslate"><span class="pre">div</span></code><a class="headerlink" href="#editable-div" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>模範解答を見ると思った以上に単純で驚く。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">blur</span></code> ハンドラーを仕込むのは <code class="docutils literal notranslate"><span class="pre">focus</span></code> ハンドラー中となる。これはマウスやポインターのときと同じ考え方が良いということだ。</p></li>
<li><p>メソッド <code class="docutils literal notranslate"><span class="pre">replaceWith()</span></code> の存在を忘れていた。</p></li>
</ul>
</section>
<section id="edit-td-on-click">
<h4>Edit <code class="docutils literal notranslate"><span class="pre">TD</span></code> on click<a class="headerlink" href="#edit-td-on-click" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>これをきっちりと実装するのは難しい。</p></li>
<li><p>親要素である <code class="docutils literal notranslate"><span class="pre">TABLE</span></code> に取り付けるハンドラーは <code class="docutils literal notranslate"><span class="pre">click</span></code> イベントのものだ。</p></li>
<li><p>対象 <code class="docutils literal notranslate"><span class="pre">TD</span></code> と同じ幾何の <code class="docutils literal notranslate"><span class="pre">TEXTAREA</span></code> を生成する。</p></li>
<li><p>編集終了コマンド用ボタンは即席で追加する。
<code class="docutils literal notranslate"><span class="pre">td.insertAdjacentHTML(&quot;beforeend&quot;,</span> <span class="pre">code)</span></code> が適任だ。</p></li>
<li><p>OK 終了と Cancel 終了とで、<code class="docutils literal notranslate"><span class="pre">TD</span></code> に載せる内容が最終的に異なる。</p></li>
</ul>
</section>
<section id="keyboard-driven-mouse">
<h4>Keyboard-driven mouse<a class="headerlink" href="#keyboard-driven-mouse" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>ねずみの <code class="docutils literal notranslate"><span class="pre">PRE</span></code> がキーイベントを拾うように手を入れる。この要素の <code class="docutils literal notranslate"><span class="pre">tabindex</span></code>
を特殊な値でセットすればいい。</p></li>
<li><p>この間、ねずみ要素の CSS を <code class="docutils literal notranslate"><span class="pre">position:</span> <span class="pre">fixed</span></code> にする。</p></li>
</ul>
<p>コメント欄のコードも試すのが良さそうだ。</p>
</section>
</section>
</section>
<section id="events-change-input-cut-copy-paste">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Events: <code class="docutils literal notranslate"><span class="pre">change</span></code>, <code class="docutils literal notranslate"><span class="pre">input</span></code>, <code class="docutils literal notranslate"><span class="pre">cut</span></code>, <code class="docutils literal notranslate"><span class="pre">copy</span></code>, <code class="docutils literal notranslate"><span class="pre">paste</span></code></a><a class="headerlink" href="#events-change-input-cut-copy-paste" title="Permalink to this heading">¶</a></h2>
<p>&lt;<a class="reference external" href="https://javascript.info/events-change-input">https://javascript.info/events-change-input</a>&gt; のノート。</p>
<section id="event-change">
<h3>Event: <code class="docutils literal notranslate"><span class="pre">change</span></code><a class="headerlink" href="#event-change" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">change</span></code> イベントが発生するのは、要素が変化するのを完了するときだ。</p>
<ul>
<li><p>テキスト入力の場合は focus が外れたときに <code class="docutils literal notranslate"><span class="pre">change</span></code> イベントが発生する。</p>
<ul>
<li><p>コードをいじって試したところ、<code class="docutils literal notranslate"><span class="pre">change</span></code>, <code class="docutils literal notranslate"><span class="pre">blur</span></code> の順に発生する。</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">SELECT</span></code> とチェックボックスやラジオボタンの <code class="docutils literal notranslate"><span class="pre">INPUT</span></code> 要素の場合は選択肢が変化したときに <code class="docutils literal notranslate"><span class="pre">change</span></code> イベントが発生する。</p></li>
</ul>
</li>
</ul>
</section>
<section id="event-input">
<h3>Event: <code class="docutils literal notranslate"><span class="pre">input</span></code><a class="headerlink" href="#event-input" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">input</span></code> イベントは、ユーザーによって値が変更された後に毎回発生する。</p></li>
<li><p>マウスによる貼り付けや音声認識によるテキスト入力など、キーボード操作を伴わない値の変更でも発生する。</p></li>
<li><p>その性質上、<code class="docutils literal notranslate"><span class="pre">input</span></code> ハンドラーで <code class="docutils literal notranslate"><span class="pre">event.preventDefault()</span></code> は無意味となる。イベントはすでに終了している。</p></li>
</ul>
</section>
<section id="events-cut-copy-paste">
<h3>Events: <code class="docutils literal notranslate"><span class="pre">cut</span></code>, <code class="docutils literal notranslate"><span class="pre">copy</span></code>, <code class="docutils literal notranslate"><span class="pre">paste</span></code><a class="headerlink" href="#events-cut-copy-paste" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cut</span></code>, <code class="docutils literal notranslate"><span class="pre">copy</span></code>, <code class="docutils literal notranslate"><span class="pre">paste</span></code> イベントは、それぞれに対応する操作がなされるときに発生する。</p></li>
<li><p>ここにあるデモを動かせばわかるが、これらのハンドラーでは
<code class="docutils literal notranslate"><span class="pre">event.preventDefault()</span></code> が効く。JavaScript でクリップボードの内容をある程度は操作できることを意味する。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cut</span></code>, <code class="docutils literal notranslate"><span class="pre">copy</span></code> ハンドラーでは <code class="docutils literal notranslate"><span class="pre">event.clipboardData.getData(...)</span></code> でクリップボードの内容を取得できない。代わりに <code class="docutils literal notranslate"><span class="pre">document.getSelection()</span></code> を呼ぶ。</p></li>
</ul>
<section id="safety-restrictions">
<h4>Safety restrictions<a class="headerlink" href="#safety-restrictions" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>クリップボードイベントを <code class="docutils literal notranslate"><span class="pre">dispatchEvent()</span></code> を用いて生成することは禁止されている。</p></li>
<li><p>クリップボードに関しては、現代的な <code class="docutils literal notranslate"><span class="pre">navigator.clipboard</span></code> という API が用意されている。</p></li>
</ul>
</section>
</section>
<section id="id2">
<h3>Tasks<a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h3>
<section id="deposit-calculator">
<h4>Deposit calculator<a class="headerlink" href="#deposit-calculator" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p>私の環境だとイベントハンドラーを割り当てる処理は
<code class="docutils literal notranslate"><span class="pre">form.addEventListener(&quot;input&quot;,</span> <span class="pre">calculate)</span></code> だけで十分動作する。</p></li>
<li><p>その他</p></li>
<li><p>複利計算の公式は与えられている。</p>
<ul>
<li><p>細かいことを言えば、入力をチェックする必要がある。主題ではないからだろうが、模範解答ではチェックが甘い。</p></li>
<li><p>画面の金利はパーセント表示であることに注意。</p></li>
<li><p>バーの高さを、初期預金残高の高さが固定であることから決める。</p></li>
</ul>
</li>
</ul>
</section>
</section>
</section>
<section id="forms-event-and-method-submit">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Forms: event and method <code class="docutils literal notranslate"><span class="pre">submit</span></code></a><a class="headerlink" href="#forms-event-and-method-submit" title="Permalink to this heading">¶</a></h2>
<p>&lt;<a class="reference external" href="https://javascript.info/forms-submit">https://javascript.info/forms-submit</a>&gt; のノート。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">submit</span></code> イベントはフォームが投稿されたときに発生する。このイベントを使用する理由は、サーバーに送信する前に検証したり、送信を中止して何か処理したいからだ。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">form.submit()</span></code> メソッドを使うと、JavaScript からフォームの送信を開始することができる。これを応用することで、独自のフォームを動的に作成し、サーバーに送信することもできる。</p></li>
</ul>
<section id="event-submit">
<h3>Event: <code class="docutils literal notranslate"><span class="pre">submit</span></code><a class="headerlink" href="#event-submit" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">submit</span></code> イベントが発生する場合は二通りある。</p>
<ul>
<li><p>タグ属性 <code class="docutils literal notranslate"><span class="pre">type</span></code> の値が “submit” または “image” である <code class="docutils literal notranslate"><span class="pre">INPUT</span></code> 要素がクリックされた</p></li>
<li><p>入力フィールドで <kbd class="kbd docutils literal notranslate">Enter</kbd> キーが押された</p>
<ul>
<li><p>この場合になぜか <code class="docutils literal notranslate"><span class="pre">click</span></code> イベントも発生する。</p></li>
</ul>
</li>
</ul>
</li>
<li><p>他のほとんどの UI イベントと同様に、<code class="docutils literal notranslate"><span class="pre">event.preventDefault()</span></code> や <code class="docutils literal notranslate"><span class="pre">return</span>
<span class="pre">false</span></code> パターンで <code class="docutils literal notranslate"><span class="pre">submit</span></code> イベントの既定の振る舞い、つまり送信を妨害できる。</p></li>
</ul>
</section>
<section id="method-submit">
<h3>Method: <code class="docutils literal notranslate"><span class="pre">submit</span></code><a class="headerlink" href="#method-submit" title="Permalink to this heading">¶</a></h3>
<p>フォームをプログラムから送信するには <code class="docutils literal notranslate"><span class="pre">form.submit()</span></code> を呼び出す。このときは
<code class="docutils literal notranslate"><span class="pre">submit</span></code> イベントは生成されない。</p>
</section>
<section id="id3">
<h3>Tasks<a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h3>
<section id="modal-form">
<h4>Modal form<a class="headerlink" href="#modal-form" title="Permalink to this heading">¶</a></h4>
<p>次の関数 <code class="docutils literal notranslate"><span class="pre">showPrompt(html,</span> <span class="pre">callback)</span></code> を作成する：</p>
<ul class="simple">
<li><p>構成要素</p>
<ul>
<li><p>メッセージを構成する <code class="docutils literal notranslate"><span class="pre">html</span></code></p></li>
<li><p>入力フィールド</p></li>
<li><p><span class="guilabel">OK</span> ボタン</p></li>
<li><p><span class="guilabel">CANCEL</span> ボタン</p></li>
</ul>
</li>
<li><p>ユーザーがテキストフィールドに何かを入力して <kbd class="kbd docutils literal notranslate">Enter</kbd> キーまたは
<span class="guilabel">OK</span> ボタンを押すと、入力された値 <code class="docutils literal notranslate"><span class="pre">value</span></code> で <code class="docutils literal notranslate"><span class="pre">callback(value)</span></code>
が呼び出される。</p></li>
<li><p>ユーザーが <kbd class="kbd docutils literal notranslate">Esc</kbd> キーまたは <span class="guilabel">CANCEL</span> を 押すと
<code class="docutils literal notranslate"><span class="pre">callback(null)</span></code> が呼ばれる。</p></li>
<li><p>結果によらず、入力処理が終了したらフォームを削除する。</p></li>
<li><p>要件</p>
<ul>
<li><p>フォームはウィンドウの中央に表示する。</p></li>
<li><p>フォームは、ユーザーがフォームを閉じるまで、ページの他の部分との操作を許さない。</p></li>
<li><p>フォームを表示したとき、ユーザーにとっての focus は <code class="docutils literal notranslate"><span class="pre">INPUT</span></code> の中にある。</p></li>
<li><p><kbd class="kbd docutils literal notranslate">Tab</kbd> / <kbd class="kbd docutils literal notranslate">Shift</kbd> + <kbd class="kbd docutils literal notranslate">Tab</kbd> キーは、このフォームフィールド間しか移動させない。</p></li>
</ul>
</li>
</ul>
<p>手順</p>
<ul class="simple">
<li><p><span class="guilabel">Click the button below</span> の見出しと直後のボタンのガワを HTML にハードコードする。</p></li>
<li><p>サンドボックスのコードにもうフォームのガワ <code class="docutils literal notranslate"><span class="pre">div#prompt-form-container</span></code> だけできている。初期状態でこれを非表示にするために CSS を少しいじる。これが終わるまでは、ボタンをクリックできない。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">INPUT#show-button</span></code> の <code class="docutils literal notranslate"><span class="pre">click</span></code> ハンドラーを書く。中身は usage example のコードとする。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">showPrompt(html,</span> <span class="pre">callback)</span></code> を実装する。</p>
<ul>
<li><p>「ページの他の部分との操作を許さない」ためだけの巨大な <code class="docutils literal notranslate"><span class="pre">DIV</span></code> 要素を生成する。</p>
<ul>
<li><p>CSS 定義を別途済ませておく。模範解答のプロパティーすべてが意味を持つ。</p></li>
</ul>
</li>
<li><p>フォーム部分の初期化をする。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">html</span></code> を <code class="docutils literal notranslate"><span class="pre">DIV#prompt-form-message</span></code> の <code class="docutils literal notranslate"><span class="pre">innerHTML</span></code> にセットする。</p></li>
<li><p>テキストボックスの中身を空にする。</p></li>
</ul>
</li>
<li><p><kbd class="kbd docutils literal notranslate">Enter</kbd>/<span class="guilabel">OK</span> 用の処理を実装する。これがフォームの <code class="docutils literal notranslate"><span class="pre">submit</span></code>
イベントハンドラーだ。</p></li>
<li><p><kbd class="kbd docutils literal notranslate">Esc</kbd>/<span class="guilabel">CANCEL</span> 用の処理を実装する。</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">keydown</span></code> イベントハンドラーで <code class="docutils literal notranslate"><span class="pre">event.key</span> <span class="pre">==</span> <span class="pre">Escape</span></code> のときの処理を仕様どおりに実装する。</p></li>
<li><p><span class="guilabel">CANCEL</span> ボタンに対して <code class="docutils literal notranslate"><span class="pre">click</span></code> イベントハンドラーを仕様どおりに実装する。</p></li>
</ul>
</li>
<li><p>入力処理終了後の後始末をする。</p>
<ul>
<li><p>巨大な <code class="docutils literal notranslate"><span class="pre">DIV</span></code> 要素を削除する。</p></li>
<li><p>フォームを非表示にする。</p></li>
<li><p>入力値 <code class="docutils literal notranslate"><span class="pre">value</span></code> を実引数にして <code class="docutils literal notranslate"><span class="pre">callback(value)</span></code> を呼び出す。</p></li>
</ul>
</li>
<li><p><kbd class="kbd docutils literal notranslate">Tab</kbd> キーの処理はよくわからない。</p></li>
</ul>
</li>
</ul>
</section>
</section>
</section>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="03-event-details.html" title="Previous document">UI Events</a>
        </li>
        <li>
          <a href="05-loading.html" title="Next document">Document and resource loading</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
      </div>
      <div class="clearer"></div>
    </div>
<div class="footer">
  <ul>
    <li id="footer_logo">
      <a class="image-reference" href="https://showa-yojyo.github.io/" title="プレハブ小屋 Since 1999"><img src="../../_static/logos.png"/></a>
    </li>
    <li id="footer_copyright">
      Copyright &copy; 1999-2023, プレハブ小屋 All rights reserved.
    </li>
  </ul>
</div>
  </body>
</html>