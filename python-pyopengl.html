<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>PyOpenGL 3.x 利用ノート</title>
    
    <link rel="stylesheet" href="_static/prefab.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="top" title="読書ノート" href="index.html" />
    <link rel="next" title="PyQt4 利用ノート" href="python-pyqt4.html" />
    <link rel="prev" title="Python Twitter Tools 利用ノート" href="python-twitter-tools.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="index.html">読書ノート</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body">
            
  <div class="section" id="pyopengl-3-x">
<h1><a class="toc-backref" href="#id12">PyOpenGL 3.x 利用ノート</a><a class="headerlink" href="#pyopengl-3-x" title="Permalink to this headline">¶</a></h1>
<p>筆者が昔 OpenGL をやる必要に迫られたときに、当時所持していた PC のスペックでは C/C++ の環境をまともに構築できず、研究ができない状態になって一瞬困った。
そこで、困ったときの Python 頼みということで、パッケージを探したところ、簡単に <a class="reference external" href="http://pyopengl.sourceforge.net">PyOpenGL</a> に突き当たった。
早速 PyOpenGL の環境を構築し、学習を始めた。
始めるとすぐに、これが他の <a class="reference external" href="http://scipy.org/NumPy/">NumPy</a> 等の有力パッケージとの強力なコンビ技で、むしろ Python のほうが学習環境に向いているということに気付いた。
OpenGL の勉強には Python を使う。これはなかなかよいコツかもしれない。</p>
<p>本稿は、筆者の個人的な PyOpenGL の環境構築方法および、コードの記述方法等の覚え書きである。</p>
<div class="contents topic" id="id1">
<p class="topic-title first">ノート目次</p>
<ul class="simple">
<li><a class="reference internal" href="#pyopengl-3-x" id="id12">PyOpenGL 3.x 利用ノート</a><ul>
<li><a class="reference internal" href="#id2" id="id13">関連リンク</a></li>
<li><a class="reference internal" href="#id3" id="id14">関連ノート</a></li>
<li><a class="reference internal" href="#id4" id="id15">インストール</a></li>
<li><a class="reference internal" href="#id5" id="id16">ドキュメント</a></li>
<li><a class="reference internal" href="#id6" id="id17">コード</a><ul>
<li><a class="reference internal" href="#glut" id="id18">GLUT ベースのスケルトンを自作しておく</a></li>
<li><a class="reference internal" href="#c" id="id19">C 言語で配列に相当する型の実引数を与える</a></li>
<li><a class="reference internal" href="#png" id="id20">PNG ファイルからテクスチャーを生成する</a><ul>
<li><a class="reference internal" href="#def-init" id="id21">def init</a></li>
<li><a class="reference internal" href="#def-display" id="id22">def display</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id7" id="id23">日本語テキストを描画する</a><ul>
<li><a class="reference internal" href="#id8" id="id24">def init</a></li>
<li><a class="reference internal" href="#def-drawtext" id="id25">def drawtext</a></li>
<li><a class="reference internal" href="#id9" id="id26">def display</a></li>
<li><a class="reference internal" href="#def-reshape" id="id27">def reshape</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pil-glreadpixels" id="id28">PIL + glReadPixels によるスクリーンショット取得</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>OS<ul>
<li>Windows XP Home Edition SP 3</li>
<li>Windows 7 Home Premium SP 1</li>
</ul>
</li>
<li>本稿執筆にあたり利用した各パッケージのバージョンは次のとおり。<ul>
<li><a class="reference external" href="http://www.python.org/">Python</a>: 2.6.6, 2.7.3, 3.4.1</li>
<li><a class="reference external" href="http://pyopengl.sourceforge.net">PyOpenGL</a>: 3.0.2a5, 3.1.0</li>
<li><a class="reference external" href="http://scipy.org/NumPy/">NumPy</a>: 1.6.1, 1.6.2, 1.8.2</li>
<li><a class="reference external" href="http://www.pythonware.com/products/pil">PIL</a>: 1.1.7 (unofficial) 現在は Pillow に取って代わられた。</li>
<li><a class="reference external" href="https://pillow.readthedocs.org/en/latest/">Pillow</a>: 2.5.1</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id13">関連リンク</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt><a class="reference external" href="http://pyopengl.sourceforge.net">PyOpenGL</a> (The Python OpenGL Binding)</dt>
<dd>本パッケージ総本山サイト。インストール方法やドキュメント等。</dd>
<dt><a class="reference external" href="http://www.lfd.uci.edu/~gohlke/pythonlibs/">Python Extension Packages for Windows - Christoph Gohlke</a></dt>
<dd>非公式インストーラー配布元。</dd>
<dt><a class="reference external" href="http://user.xmission.com/~nate/glut.html">GLUT</a> (Nate Robins - OpenGL - GLUT for Win32)</dt>
<dd>OpenGL Utility Toolkit (GLUT) の Windows 版バイナリーを配布しているウェブページ。
XP までのバージョンでないと使えないので、残念ながらもはや価値がない。</dd>
</dl>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id14">関連ノート</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="python-numpy.html"><em>NumPy 利用ノート</em></a></li>
<li><a class="reference internal" href="python-pil.html"><em>PIL 利用ノート [obsolete]</em></a></li>
<li><a class="reference internal" href="python-pillow.html"><em>Pillow 利用ノート</em></a></li>
</ul>
</div>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id15">インストール</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>経験則として NumPy 等、PyOpenGL の依存パッケージ的なものを先にインストールしておくのがコツ。
もちろん本来の意味では PyOpenGL が依存するパッケージというものはない。
しかし、グラフィックのプログラムを書くのならば、
普通はインストールしていないとマズいというものは存在する。
まずは次の 2 つのパッケージを挙げたい。<ul>
<li>基礎的なベクトル演算のために <a class="reference external" href="http://scipy.org/NumPy/">NumPy</a> を利用したいので、インストールしておく。関連ノート参照。</li>
<li>画像ファイルからテクスチャーを読み込むために <a class="reference external" href="https://pillow.readthedocs.org/en/latest/">Pillow</a> をインストールしておく。これも関連ノート参照。</li>
</ul>
</li>
<li>PyOpenGL 本体のインストールは上記関連リンクの非公式インストーラーを利用する。
著者の現在の環境は Windows7 64bit なので、選択は次の 2 つとなる。<ul>
<li><tt class="file docutils literal"><span class="pre">PyOpenGL-3.1.0.win-amd64-py3.4.exe</span></tt></li>
<li><tt class="file docutils literal"><span class="pre">PyOpenGL-accelerate-3.1.0.win-amd64-py3.4.exe</span></tt></li>
</ul>
</li>
<li>GLUT は考慮しないでよくなったもよう。</li>
</ul>
</div>
<div class="section" id="id5">
<h2><a class="toc-backref" href="#id16">ドキュメント</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>PyOpenGL は Python のラッパーに過ぎない。
OpenGL が一通り使える技術があれば、
必要な勉強は C 言語でのプログラミングと Python でのそれとの差分を確認するだけということになる。</p>
<ul>
<li><p class="first">公式サイトの &#8220;PyOpenGL for OpenGL Programmers&#8221; という章を読む。</p>
<ul>
<li><p class="first">PyOpenGL は実行速度については期待できない。</p>
<p>そもそも速度が欲しいならば肚をくくって C/C++ 環境を検討するし、ここでは学習目的が主なので速度は二の次だ。</p>
<ul class="simple">
<li>プログラミングの柔軟性、利便性、堅牢性を重視しているらしい。</li>
<li>頂点毎の各種演算はアホみたいに遅い。
よって、最低でも配列ベースの演算でコードを書くようにする。</li>
</ul>
</li>
<li><p class="first">PyOpenGL は SIWG ではなく ctypes を利用して実装されている。</p>
</li>
<li><p class="first">一部関数シグニチャーが C 言語版と PyOpenGL 版とで異なる。
といっても、配列モノの API が Python 風に表現されているだけだ。</p>
</li>
<li><p class="first">PyOpenGL は OpenGL 操作中でのエラー発生時に例外を送出する。
プログラマーが手で <tt class="docutils literal"><span class="pre">glCheckError</span></tt> を書かずにすむというわけだ。</p>
<ul class="simple">
<li>デバッグが終わったら <tt class="docutils literal"><span class="pre">OpenGL.ERROR_CHECKING</span> <span class="pre">=</span> <span class="pre">False</span></tt> すればよい。</li>
</ul>
</li>
<li><p class="first">PyOpenGL はエラーをログ出力する。
<tt class="docutils literal"><span class="pre">OpenGL.ERROR_LOGING</span> <span class="pre">=</span> <span class="pre">False</span></tt> で無効化。</p>
</li>
<li><p class="first">PyOpenGL では、関数の型別サフィックスが省略できる。
例えば <tt class="docutils literal"><span class="pre">glDrawElements{ub|us|ui}</span></tt> はいずれも <tt class="docutils literal"><span class="pre">glDrawElements</span></tt> とできる。</p>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id6">
<h2><a class="toc-backref" href="#id17">コード</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>C ではなく Python を利用して OpenGL プログラムを書く利点は、
<a class="reference external" href="http://pyopengl.sourceforge.net">PyOpenGL</a> の API を <a class="reference external" href="http://scipy.org/NumPy/">NumPy</a> や <a class="reference external" href="https://pillow.readthedocs.org/en/latest/">Pillow</a> といった、高品質なサードパーティ製パッケージの
部品と簡単に組み合わせて利用できる点に尽きる。</p>
<p>欠点は何度も言うように実行が遅いことだ。悲しいくらい遅い。
しかし、グラフィックの初学者には遅い方が学習の上ではむしろ好都合ということもあるだろう。</p>
<div class="section" id="glut">
<h3><a class="toc-backref" href="#id18">GLUT ベースのスケルトンを自作しておく</a><a class="headerlink" href="#glut" title="Permalink to this headline">¶</a></h3>
<p>簡単な PyOpenGL プログラムの構造は次のようなものになる。
次のようなテキストファイルをテンプレートとして保存しておき、
新しいスクリプトを作成する際には、このテンプレートからコードを「増築」していくようにする。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>
<span class="c"># OpenGL の演習スクリプト用テンプレ</span>
<span class="sd">&quot;&quot;&quot;%prog</span>
<span class="sd">A study program of OpenGL</span>
<span class="sd">Example: %prog&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c"># 三角関数等を利用するならばコメントアウトを解除する。</span>
<span class="c">#import math</span>
<span class="kn">from</span> <span class="nn">optparse</span> <span class="k">import</span> <span class="n">OptionParser</span>

<span class="kn">from</span> <span class="nn">OpenGL.GL</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">OpenGL.GLU</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">OpenGL.GLUT</span> <span class="k">import</span> <span class="o">*</span>

<span class="c"># NumPy</span>
<span class="c">#from numpy import array</span>

<span class="c"># Pillow</span>
<span class="c">#from PIL import Image</span>

<span class="c"># main 等で使う変数</span>
<span class="n">window_title</span><span class="o">=</span><span class="n">b</span><span class="s">&quot;OpenGL Study&quot;</span>
<span class="n">window_sx</span><span class="p">,</span><span class="n">window_sy</span> <span class="o">=</span> <span class="mi">320</span><span class="p">,</span><span class="mi">240</span>
<span class="n">window_x</span><span class="p">,</span><span class="n">window_y</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span><span class="mi">100</span>

<span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;OpenGL ステートを初期化する&quot;&quot;&quot;</span>

    <span class="n">glClearColor</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
    <span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEPTH_TEST</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">display</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;シーンレンダリング&quot;&quot;&quot;</span>

    <span class="n">glClear</span><span class="p">(</span><span class="n">GL_COLOR_BUFFER_BIT</span> <span class="o">|</span> <span class="n">GL_DEPTH_BUFFER_BIT</span><span class="p">)</span>

    <span class="n">glMatrixMode</span><span class="p">(</span><span class="n">GL_MODELVIEW</span><span class="p">)</span>
    <span class="n">glPushMatrix</span><span class="p">()</span>
    <span class="n">glLoadIdentity</span><span class="p">()</span>

    <span class="c"># プリミティブを描画する。</span>
    <span class="n">glPushAttrib</span><span class="p">(</span><span class="n">GL_CURRENT_BIT</span><span class="p">)</span>

    <span class="n">glColor3f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">glBegin</span><span class="p">(</span><span class="n">GL_POLYGON</span><span class="p">)</span>
    <span class="n">glVertex3f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">glVertex3f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">glVertex3f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">glEnd</span><span class="p">()</span>

    <span class="n">glPopAttrib</span><span class="p">()</span>
    <span class="n">glPopMatrix</span><span class="p">()</span>

    <span class="c"># バッファスワップ</span>
    <span class="n">glutSwapBuffers</span><span class="p">()</span>

<span class="c">################################################################################</span>
<span class="c"># callback</span>

<span class="k">def</span> <span class="nf">reshape</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;ウィンドウリサイズイベントをハンドルする。&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">glViewport</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
    <span class="n">glMatrixMode</span><span class="p">(</span><span class="n">GL_PROJECTION</span><span class="p">)</span>
    <span class="n">glLoadIdentity</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">width</span> <span class="o">&lt;=</span> <span class="n">height</span><span class="p">:</span>
        <span class="c"># 縦長ビューポートのケース</span>
        <span class="n">aspect</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">height</span><span class="p">)</span> <span class="o">/</span> <span class="n">width</span>
        <span class="n">glOrtho</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">aspect</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">aspect</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># 横長ビューポートのケース</span>
        <span class="n">aspect</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">width</span><span class="p">)</span> <span class="o">/</span> <span class="n">height</span>
        <span class="n">glOrtho</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">aspect</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">aspect</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span>
    <span class="c"># もしくは</span>
    <span class="c">#gluPerspective(45.0, float(width)/height, 1.0, 100.0)</span>

    <span class="n">glMatrixMode</span><span class="p">(</span><span class="n">GL_MODELVIEW</span><span class="p">)</span>
    <span class="n">glLoadIdentity</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">keyboard</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;キーボードイベントをハンドルする。&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">ord</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="mo">0o33</span><span class="p">:</span>
        <span class="c"># ESC</span>
        <span class="nb">print</span><span class="p">(</span><span class="s">&#39;ESC pressed&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">mouse</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;マウスのクリックイベントをハンドルする。&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">motion</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;マウスのモーションイベントをハンドルする。&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="c">################################################################################</span>
<span class="c"># main</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="c"># GLUT を初期化する。</span>
    <span class="n">glutInit</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>

    <span class="c"># ウィンドウを設定する。</span>
    <span class="n">glutInitDisplayMode</span><span class="p">(</span><span class="n">GLUT_DOUBLE</span> <span class="o">|</span> <span class="n">GLUT_RGB</span> <span class="o">|</span> <span class="n">GLUT_DEPTH</span><span class="p">)</span>
    <span class="n">glutInitWindowSize</span><span class="p">(</span><span class="n">window_sx</span><span class="p">,</span> <span class="n">window_sy</span><span class="p">)</span>
    <span class="n">glutInitWindowPosition</span><span class="p">(</span><span class="n">window_x</span><span class="p">,</span> <span class="n">window_y</span><span class="p">)</span>
    <span class="n">glutCreateWindow</span><span class="p">(</span><span class="n">window_title</span><span class="p">)</span>

    <span class="c"># OpenGL ステートを初期化する。</span>
    <span class="n">init</span><span class="p">()</span>

    <span class="c"># コールバック関数を登録する。</span>
    <span class="n">glutDisplayFunc</span><span class="p">(</span><span class="n">display</span><span class="p">)</span>
    <span class="n">glutKeyboardFunc</span><span class="p">(</span><span class="n">keyboard</span><span class="p">)</span>
    <span class="n">glutReshapeFunc</span><span class="p">(</span><span class="n">reshape</span><span class="p">)</span>
    <span class="n">glutMouseFunc</span><span class="p">(</span><span class="n">mouse</span><span class="p">)</span>
    <span class="c">#glutMotionFunc(motion)</span>

    <span class="n">glutMainLoop</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">OptionParser</span><span class="p">(</span><span class="n">__doc__</span><span class="p">)</span>

    <span class="n">options</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="c">#if len(args) &lt; 1:</span>
    <span class="c">#    print(parser.print_help(), file=sys.stderr)</span>
    <span class="c">#    sys.exit(1)</span>

    <span class="n">main</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<p>仮に実行すると、黒い画面に赤い三角形が描画されているのが確認できるはずだ。
以降の各デモコードでは、このスケルトンの差分部分・修正部分を記述する。</p>
<p>一点、注意がある。
<tt class="docutils literal"><span class="pre">glutCreateWindow</span></tt> の実引数となる文字列 <tt class="docutils literal"><span class="pre">window_title</span></tt> の型に注意して欲しい。
素の文字列ではエラーが起こるのを避けるべく、接頭辞 b を付けている。</p>
</div>
<div class="section" id="c">
<h3><a class="toc-backref" href="#id19">C 言語で配列に相当する型の実引数を与える</a><a class="headerlink" href="#c" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>何度も言うが型を示すサフィックスが省略できる。
例えば <tt class="docutils literal"><span class="pre">glLightfv</span></tt> ではなく <tt class="docutils literal"><span class="pre">glLight</span></tt> でよい。</li>
<li>値の与え方もかなり柔軟になっている。
<tt class="docutils literal"><span class="pre">list</span></tt>, <tt class="docutils literal"><span class="pre">tuple</span></tt>, <tt class="docutils literal"><span class="pre">numpy.ndarray</span></tt>, etc. を直接与えることが許される。</li>
</ul>
<div class="highlight-python3"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">OpenGL.GL</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">OpenGL.GLU</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">OpenGL.GLUT</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">SPECULAR_VALUE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">DIFFUSE_VALUE</span> <span class="o">=</span> <span class="n">SPECULAR_VALUE</span> <span class="o">*</span> <span class="o">.</span><span class="mi">9</span>
<span class="n">DIFFUSE_VALUE</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">AMBIENT_VALUE</span> <span class="o">=</span> <span class="n">SPECULAR_VALUE</span> <span class="o">*</span> <span class="o">.</span><span class="mi">1</span>
<span class="n">AMBIENT_VALUE</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="k">def</span> <span class="nf">init_lighting</span><span class="p">():</span>
    <span class="n">glEnable</span><span class="p">(</span><span class="n">GL_LIGHTING</span><span class="p">)</span>
    <span class="n">glEnable</span><span class="p">(</span><span class="n">GL_LIGHT0</span><span class="p">)</span>
    <span class="n">glLight</span><span class="p">(</span><span class="n">GL_LIGHT0</span><span class="p">,</span> <span class="n">GL_POSITION</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
    <span class="n">glLight</span><span class="p">(</span><span class="n">GL_LIGHT0</span><span class="p">,</span> <span class="n">GL_AMBIENT</span><span class="p">,</span> <span class="n">AMBIENT_VALUE</span><span class="p">)</span>
    <span class="n">glLight</span><span class="p">(</span><span class="n">GL_LIGHT0</span><span class="p">,</span> <span class="n">GL_DIFFUSE</span><span class="p">,</span> <span class="n">DIFFUSE_VALUE</span><span class="p">)</span>
    <span class="n">glLight</span><span class="p">(</span><span class="n">GL_LIGHT0</span><span class="p">,</span> <span class="n">GL_SPECULAR</span><span class="p">,</span> <span class="n">SPECULAR_VALUE</span><span class="p">)</span>

    <span class="n">glEnable</span><span class="p">(</span><span class="n">GL_COLOR_MATERIAL</span><span class="p">)</span>
    <span class="n">glColorMaterial</span><span class="p">(</span><span class="n">GL_FRONT_AND_BACK</span><span class="p">,</span> <span class="n">GL_AMBIENT_AND_DIFFUSE</span><span class="p">)</span>

    <span class="n">glMaterial</span><span class="p">(</span><span class="n">GL_FRONT_AND_BACK</span><span class="p">,</span> <span class="n">GL_SPECULAR</span><span class="p">,</span> <span class="n">SPECULAR_VALUE</span><span class="p">)</span>
    <span class="n">glMaterial</span><span class="p">(</span><span class="n">GL_FRONT_AND_BACK</span><span class="p">,</span> <span class="n">GL_EMISSION</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="png">
<h3><a class="toc-backref" href="#id20">PNG ファイルからテクスチャーを生成する</a><a class="headerlink" href="#png" title="Permalink to this headline">¶</a></h3>
<p>ポイントは Pillow の <tt class="docutils literal"><span class="pre">Image</span></tt> インスタンスの <tt class="docutils literal"><span class="pre">tostring</span></tt> 戻り値を <tt class="docutils literal"><span class="pre">glTexImage2D</span></tt> に渡すことだ。
ここではアルファチャンネルを含む PNG ファイルからテクスチャーデータを作成する例を示す。</p>
<div class="section" id="def-init">
<h4><a class="toc-backref" href="#id21">def init</a><a class="headerlink" href="#def-init" title="Permalink to this headline">¶</a></h4>
<p>まずはテクスチャー設定から。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
   <span class="n">glClearColor</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
   <span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEPTH_TEST</span><span class="p">)</span>
   <span class="n">glEnable</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">)</span>

   <span class="c"># Comment 1</span>
   <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;illvelo.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">))</span>
   <span class="k">assert</span> <span class="n">img</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;RGBA&#39;</span>

   <span class="c"># Comment 2</span>
   <span class="n">glTexImage2D</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">GL_RGBA</span><span class="p">,</span> <span class="n">GL_UNSIGNED_BYTE</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">tostring</span><span class="p">())</span>
   <span class="n">glTexParameterf</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">GL_TEXTURE_WRAP_S</span><span class="p">,</span> <span class="n">GL_REPEAT</span><span class="p">)</span>
   <span class="n">glTexParameterf</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">GL_TEXTURE_WRAP_T</span><span class="p">,</span> <span class="n">GL_REPEAT</span><span class="p">)</span>
   <span class="n">glTexParameterf</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">GL_TEXTURE_MAG_FILTER</span><span class="p">,</span> <span class="n">GL_LINEAR</span><span class="p">)</span>
   <span class="n">glTexParameterf</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">GL_TEXTURE_MIN_FILTER</span><span class="p">,</span> <span class="n">GL_LINEAR</span><span class="p">)</span>
   <span class="n">glTexEnvf</span><span class="p">(</span><span class="n">GL_TEXTURE_ENV</span><span class="p">,</span> <span class="n">GL_TEXTURE_ENV_MODE</span><span class="p">,</span> <span class="n">GL_DECAL</span><span class="p">)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Comment 1</dt>
<dd><a class="reference internal" href="python-pillow.html"><em>Pillow 利用ノート</em></a> で利用した PNG ファイルからテクスチャーを作成している。
ファイルのピクセルサイズがやや中途半端なので、決め打ちだが 256 ピクセル四方にリサイズする。</dd>
<dt>Comment 2</dt>
<dd><p class="first"><tt class="docutils literal"><span class="pre">glTexImage2D</span></tt> 呼び出しにより、テクスチャーデータを OpenGL に渡している。
後半の実引数群に注目したい。</p>
<p class="last">残りの関数呼び出しは、アプリケーションの目的に応じてパラメーターを指定すること。</p>
</dd>
</dl>
</div>
<div class="section" id="def-display">
<h4><a class="toc-backref" href="#id22">def display</a><a class="headerlink" href="#def-display" title="Permalink to this headline">¶</a></h4>
<p>次に描画ロジックを示す。明らかに手抜きコードだが、説明にはこれで十分だろう。
これを <tt class="docutils literal"><span class="pre">display</span></tt> の主要部分に加える。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="n">vx</span><span class="p">,</span> <span class="n">vy</span> <span class="o">=</span> <span class="mf">40.0</span><span class="p">,</span> <span class="mf">40.0</span>
<span class="n">tx</span><span class="p">,</span> <span class="n">ty</span> <span class="o">=</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">6.0</span>

<span class="n">vertices</span> <span class="o">=</span> <span class="p">(</span>
    <span class="o">-</span><span class="n">vx</span><span class="p">,</span> <span class="o">-</span><span class="n">vy</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
     <span class="n">vx</span><span class="p">,</span> <span class="o">-</span><span class="n">vy</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
     <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="o">-</span><span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,)</span>

<span class="n">texcoords</span> <span class="o">=</span> <span class="p">(</span>
    <span class="o">-</span><span class="n">tx</span><span class="p">,</span> <span class="o">-</span><span class="n">ty</span><span class="p">,</span>
    <span class="n">tx</span><span class="p">,</span> <span class="o">-</span><span class="n">ty</span><span class="p">,</span>
    <span class="n">tx</span><span class="p">,</span> <span class="n">ty</span><span class="p">,</span>
    <span class="o">-</span><span class="n">tx</span><span class="p">,</span> <span class="n">ty</span><span class="p">,)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">(</span>
    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,)</span>

<span class="k">def</span> <span class="nf">display</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;シーンレンダリング&quot;&quot;&quot;</span>

    <span class="n">glClear</span><span class="p">(</span><span class="n">GL_COLOR_BUFFER_BIT</span> <span class="o">|</span> <span class="n">GL_DEPTH_BUFFER_BIT</span><span class="p">)</span>

    <span class="n">glMatrixMode</span><span class="p">(</span><span class="n">GL_MODELVIEW</span><span class="p">)</span>
    <span class="n">glPushMatrix</span><span class="p">()</span>
    <span class="n">glLoadIdentity</span><span class="p">()</span>

    <span class="n">gluLookAt</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mf">1.58</span><span class="p">,</span>
              <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
              <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c"># プリミティブを描画する。</span>
    <span class="n">glPushAttrib</span><span class="p">(</span><span class="n">GL_CURRENT_BIT</span><span class="p">)</span>
    <span class="n">glPushClientAttrib</span><span class="p">(</span><span class="n">GL_CLIENT_VERTEX_ARRAY_BIT</span><span class="p">)</span>

    <span class="n">glEnableClientState</span><span class="p">(</span><span class="n">GL_VERTEX_ARRAY</span><span class="p">)</span>
    <span class="n">glEnableClientState</span><span class="p">(</span><span class="n">GL_TEXTURE_COORD_ARRAY</span><span class="p">)</span>
    <span class="n">glEnableClientState</span><span class="p">(</span><span class="n">GL_COLOR_ARRAY</span><span class="p">)</span>
    <span class="n">glVertexPointer</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">GL_FLOAT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vertices</span><span class="p">)</span>
    <span class="n">glTexCoordPointer</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">GL_FLOAT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">texcoords</span><span class="p">)</span>
    <span class="n">glColorPointer</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">GL_FLOAT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">colors</span><span class="p">)</span>
    <span class="n">glDrawArrays</span><span class="p">(</span><span class="n">GL_POLYGON</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

    <span class="n">glPopClientAttrib</span><span class="p">()</span>
    <span class="n">glPopAttrib</span><span class="p">()</span>
    <span class="n">glPopMatrix</span><span class="p">()</span>

    <span class="c"># バッファスワップ</span>
    <span class="n">glutSwapBuffers</span><span class="p">()</span>
</pre></div>
</div>
<p>実行すると以下のようなイメージ (320x240) を得るだろう。</p>
<a class="reference internal image-reference" href="_images/illvelo-texture.png"><img alt="_images/illvelo-texture.png" src="_images/illvelo-texture.png" style="width: 164.0px; height: 133.5px;" /></a>
</div>
</div>
<div class="section" id="id7">
<h3><a class="toc-backref" href="#id23">日本語テキストを描画する</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>PIL のテキスト描画機能と PyOpenGL のテクスチャー機能を活用したプログラム例。
要所のみを説明する。</p>
<div class="section" id="id8">
<h4><a class="toc-backref" href="#id24">def init</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p><tt class="docutils literal"><span class="pre">init</span></tt> のテクスチャー初期化コードに以下を含める。</p>
<div class="highlight-python3"><div class="highlight"><pre><span class="n">img</span> <span class="o">=</span> <span class="n">drawtext</span><span class="p">(</span><span class="s">u&#39;潔&#39;</span><span class="p">)</span>

<span class="c"># 残りは前項を参照。</span>
</pre></div>
</div>
</div>
<div class="section" id="def-drawtext">
<h4><a class="toc-backref" href="#id25">def drawtext</a><a class="headerlink" href="#def-drawtext" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python3"><div class="highlight"><pre><span class="k">def</span> <span class="nf">drawtext</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">initsize</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">point</span><span class="o">=</span><span class="mi">144</span><span class="p">,</span> <span class="n">margin</span> <span class="o">=</span> <span class="mi">4</span><span class="p">):</span>
    <span class="c"># 大きめのキャンヴァスを用意しておく。</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s">&#39;RGBA&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">initsize</span><span class="p">,</span> <span class="n">initsize</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">dr</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

    <span class="n">fnt</span> <span class="o">=</span> <span class="n">ImageFont</span><span class="o">.</span><span class="n">truetype</span><span class="p">(</span><span class="s">&#39;hgrme.ttc&#39;</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">dr</span><span class="o">.</span><span class="n">textsize</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">fnt</span><span class="p">)</span>
    <span class="n">dr</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">margin</span><span class="p">,</span> <span class="n">margin</span><span class="p">),</span> <span class="n">text</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">fnt</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s">&#39;white&#39;</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">crop</span><span class="p">((</span><span class="n">margin</span><span class="p">,</span> <span class="n">margin</span><span class="p">,</span> <span class="n">ext</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">margin</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="n">ext</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">margin</span><span class="o">*</span><span class="mi">3</span><span class="p">))</span>

    <span class="c"># TODO: img.size の各成分に最も近い最小の 2 のべき乗の値を使う。</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">initsize</span><span class="p">,</span> <span class="n">initsize</span><span class="p">),</span> <span class="n">Image</span><span class="o">.</span><span class="n">ANTIALIAS</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">img</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h4><a class="toc-backref" href="#id26">def display</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python3"><div class="highlight"><pre><span class="n">vx</span><span class="p">,</span> <span class="n">vy</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span>

<span class="n">vertices</span> <span class="o">=</span> <span class="p">(</span>
    <span class="o">-</span><span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="o">-</span><span class="n">vx</span><span class="p">,</span> <span class="o">-</span><span class="n">vy</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
     <span class="n">vx</span><span class="p">,</span> <span class="o">-</span><span class="n">vy</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
     <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,)</span>

<span class="n">texcoords</span> <span class="o">=</span> <span class="p">(</span>
    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">(</span>
    <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
    <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
    <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,)</span>

<span class="k">def</span> <span class="nf">display</span><span class="p">():</span>
    <span class="n">glClear</span><span class="p">(</span><span class="n">GL_COLOR_BUFFER_BIT</span> <span class="o">|</span> <span class="n">GL_DEPTH_BUFFER_BIT</span><span class="p">)</span>

    <span class="n">glMatrixMode</span><span class="p">(</span><span class="n">GL_MODELVIEW</span><span class="p">)</span>
    <span class="n">glPushMatrix</span><span class="p">()</span>
    <span class="n">glLoadIdentity</span><span class="p">()</span>

    <span class="n">gluLookAt</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.5</span><span class="p">,</span> <span class="mf">1.58</span><span class="p">,</span>
              <span class="mf">0.5</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">1.58</span><span class="p">,</span>
              <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">glPushAttrib</span><span class="p">(</span><span class="n">GL_ALL_ATTRIB_BITS</span><span class="p">)</span>
    <span class="n">glPushClientAttrib</span><span class="p">(</span><span class="n">GL_CLIENT_ALL_ATTRIB_BITS</span><span class="p">)</span>

    <span class="n">glEnableClientState</span><span class="p">(</span><span class="n">GL_VERTEX_ARRAY</span><span class="p">)</span>
    <span class="n">glEnableClientState</span><span class="p">(</span><span class="n">GL_TEXTURE_COORD_ARRAY</span><span class="p">)</span>
    <span class="n">glEnableClientState</span><span class="p">(</span><span class="n">GL_COLOR_ARRAY</span><span class="p">)</span>
    <span class="n">glVertexPointer</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">GL_FLOAT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vertices</span><span class="p">)</span>
    <span class="n">glTexCoordPointer</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">GL_FLOAT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">texcoords</span><span class="p">)</span>
    <span class="n">glColorPointer</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">GL_FLOAT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">colors</span><span class="p">)</span>
    <span class="n">glDrawArrays</span><span class="p">(</span><span class="n">GL_QUADS</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

    <span class="n">glPopClientAttrib</span><span class="p">()</span>

    <span class="n">glPopAttrib</span><span class="p">()</span>
    <span class="n">glPopMatrix</span><span class="p">()</span>

    <span class="n">glutSwapBuffers</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="def-reshape">
<h4><a class="toc-backref" href="#id27">def reshape</a><a class="headerlink" href="#def-reshape" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python3"><div class="highlight"><pre><span class="k">def</span> <span class="nf">reshape</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>

    <span class="c"># ... 略 ...</span>

    <span class="n">gluPerspective</span><span class="p">(</span><span class="mf">45.0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">width</span><span class="p">)</span><span class="o">/</span><span class="n">height</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span>
</pre></div>
</div>
<p>以上を実行すると、実行結果のスクリーンショットはだいたい次のようなものになる。</p>
<a class="reference internal image-reference" href="_images/pyopengl-text.png"><img alt="_images/pyopengl-text.png" src="_images/pyopengl-text.png" style="width: 164.0px; height: 133.5px;" /></a>
</div>
</div>
<div class="section" id="pil-glreadpixels">
<h3><a class="toc-backref" href="#id28">PIL + glReadPixels によるスクリーンショット取得</a><a class="headerlink" href="#pil-glreadpixels" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python3"><div class="highlight"><pre><span class="k">def</span> <span class="nf">capture_screen</span><span class="p">():</span>
   <span class="n">sx</span> <span class="o">=</span> <span class="n">glutGet</span><span class="p">(</span><span class="n">GLUT_WINDOW_WIDTH</span><span class="p">)</span>
   <span class="n">sy</span> <span class="o">=</span> <span class="n">glutGet</span><span class="p">(</span><span class="n">GLUT_WINDOW_HEIGHT</span><span class="p">)</span>

   <span class="n">pixels</span> <span class="o">=</span> <span class="n">glReadPixels</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">GL_RGBA</span><span class="p">,</span> <span class="n">GL_UNSIGNED_BYTE</span><span class="p">)</span>
   <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s">&quot;RGBA&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">),</span> <span class="n">pixels</span><span class="p">)</span>
   <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">FLIP_TOP_BOTTOM</span><span class="p">)</span>

   <span class="n">filename</span> <span class="o">=</span> <span class="n">raw_input</span><span class="p">(</span><span class="s">&#39;filename: &#39;</span><span class="p">)</span>
   <span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="s">&#39;%s saved&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
<p>この関数をキーボードイベントコールバックあたりから呼び出すようにしておくと便利。</p>
</div>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="index.html">読書ノート</a> &raquo;</li> 
      </ul>
    </div>
    <div id="footer">
      <div id="footer_logo">
        <a class="imga" href="https://showa-yojyo.github.io/" title="プレハブ小屋 Since 1999"><img src="_static/logos.png" width="88" height="31" /></a>
      </div>
      <div id="footer_copyright">
        Since 1999<br />
        Copyright &copy; 1999-2014,
        プレハブ小屋
        All rights reserved.
      </div>
      <div id="footer_spacer">
        <p>
          Last updated at 2014/11/02 (Sun) 02:17:41.
        </p>
      </div>
    </div>
  </body>
</html>