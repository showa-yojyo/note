<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>数値積分 &#8212; 読書ノート 1.5dev documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=1a9a5cd9" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=91898170"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script async="async" src="../_static/mathjax-v3.js?v=bf1ec211"></script>
    <script src="../_static/mermaid.js?v=578dbed1"></script>
    <link rel="next" title="常微分方程式" href="ode.html" />
    <link rel="prev" title="補間" href="interpolate.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="interpolate.html" title="Previous document">補間</a>
        </li>
        <li>
          <a href="ode.html" title="Next document">常微分方程式</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <section id="id1">
<h1><a class="toc-backref" href="#id5" role="doc-backlink">数値積分</a><a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h1>
<p><a class="reference external" href="https://www.scipy.org/">SciPy</a> を利用して、何か適当な実数値関数の定積分を計算する手順をいくつか記す。まずは区分求積法の計算法の代表例である台形公式と Simpson の公式を実装したと思われるSciPy の関数を紹介し、次に使い勝手のよい定積分計算関数を紹介する。</p>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#id1" id="id5">数値積分</a></p>
<ul>
<li><p><a class="reference internal" href="#id2" id="id6">台形公式</a></p></li>
<li><p><a class="reference internal" href="#simpson" id="id7">Simpson の公式</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id8">汎用目的積分関数</a></p></li>
<li><p><a class="reference internal" href="#id4" id="id9">実行結果</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="id2">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">台形公式</a><a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h2>
<p>関数 <code class="docutils literal notranslate"><span class="pre">scipy.integrate.trapz</span></code> を利用して、実数値関数の台形公式による定積分の近似値を得ることができる。手順は次のようなものだ。</p>
<ol class="arabic simple">
<li><p>被積分関数 <code class="docutils literal notranslate"><span class="pre">f</span></code> を Python の関数として定義または用意する。</p></li>
<li><p>積分区間上の列 <code class="docutils literal notranslate"><span class="pre">x</span></code> を用意する。</p></li>
<li><p>列 <code class="docutils literal notranslate"><span class="pre">x</span></code> に対し、関数を評価した値の列 <code class="docutils literal notranslate"><span class="pre">y</span></code> を作る。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scipy.integrate.trapz</span></code> を呼び出す。</p></li>
</ol>
<p>以下にコード例を示す。</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="sd">&quot;&quot;&quot;integrate.py: Demonstrate some SciPy integration functions.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">trapz</span><span class="p">,</span> <span class="n">simps</span><span class="p">,</span> <span class="n">quad</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># pylint: disable=invalid-name</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Integrand function.&quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<span class="c1"># Define sample points.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Compute the integral by using trapezoid rule.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Trapezoid method: &quot;</span><span class="p">,</span> <span class="n">trapz</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
<p><span class="math notranslate nohighlight">\(\displaystyle \int_{0}^{\pi} \sin x\,\dd{x}\)</span> という簡単な例で面白くないが、見ていこう。</p>
<p>まずは NumPy の関数 <code class="docutils literal notranslate"><span class="pre">linspace</span></code> を用いて、積分区間 <span class="math notranslate nohighlight">\({[0, \pi]}\)</span> を百等分した列 <code class="docutils literal notranslate"><span class="pre">x</span></code> を用意する。これはコード的には <code class="docutils literal notranslate"><span class="pre">np.ndarray</span></code> 型なので、単に <code class="docutils literal notranslate"><span class="pre">{y</span> <span class="pre">=</span>
<span class="pre">np.sin(x)}</span></code> とすることで関数値の列 <code class="docutils literal notranslate"><span class="pre">y</span></code> が得られる。これで計算の準備が整った。直ちに両者を関数 <code class="docutils literal notranslate"><span class="pre">trapz</span></code> の引数に与えて呼び出す。</p>
<p>実行結果は関連定積分関数の結果とまとめて後述する。</p>
</section>
<section id="simpson">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Simpson の公式</a><a class="headerlink" href="#simpson" title="Permalink to this heading">¶</a></h2>
<p>関数 <code class="docutils literal notranslate"><span class="pre">scipy.integrate.simps</span></code> を利用すると、前項同様の方法で定積分を計算できる。コードを、台形公式との違いのみを示す。</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute the integral by using Simpsons&#39;s rule.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Simpson&#39;s method: &quot;</span><span class="p">,</span> <span class="n">simps</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
<p>実行結果は関連定積分関数の結果とまとめて後述する。</p>
</section>
<section id="id3">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">汎用目的積分関数</a><a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h2>
<p>関数 <code class="docutils literal notranslate"><span class="pre">scipy.integrate.quad</span></code> を利用すると、今度はサンプリングの手間を省いて定積分を計算することになる。これは、被積分関数本体と、積分区間から定積分を計算する。</p>
<p>以下にコード例を示す。</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="sd">&quot;&quot;&quot;integrate.py: Demonstrate some SciPy integration functions.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">trapz</span><span class="p">,</span> <span class="n">simps</span><span class="p">,</span> <span class="n">quad</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># pylint: disable=invalid-name</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Integrand function.&quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<span class="c1"># Define sample points.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Compute the integral by using QUADPACK (Fortran).</span>
<span class="c1"># interval of integration; 0 to pi.</span>
<span class="n">I3</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;QUADPACK: &quot;</span><span class="p">,</span> <span class="n">I3</span><span class="p">)</span>
</pre></div>
</div>
<p>実行結果は関連定積分関数の結果とまとめて後述する。</p>
<p>この関数はどういう求積法を実装しているのか。ドキュメントによると &lt;a technique
from the Fortran library QUADPACK&gt; を利用したとあるので、かなり専門的なのかもしれない。当関数には実際は大量の引数が存在しており、求積法に対して微細な指示ができそうだ。例えば今回の例では有限区間の定積分計算を試したが、値が求まる限り無限区間も計算可能のようだ。</p>
</section>
<section id="id4">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">実行結果</a><a class="headerlink" href="#id4" title="Permalink to this heading">¶</a></h2>
<p>前述までの計算結果を一挙に記す。すべて <span class="math notranslate nohighlight">\({\displaystyle \int_{0}^{\pi} \sin
x\,\dx}\)</span> である。</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Trapezoid method:  1.99983216389
Simpson&#39;s method:  1.99999996902
QUADPACK:  (2.0, 2.220446049250313e-14)
</pre></div>
</div>
<p>この例では関数 <code class="docutils literal notranslate"><span class="pre">quad</span></code> の精度が圧倒的によいようだ。</p>
</section>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="interpolate.html" title="Previous document">補間</a>
        </li>
        <li>
          <a href="ode.html" title="Next document">常微分方程式</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
      </div>
      <div class="clearer"></div>
    </div>
<div class="footer">
  <ul>
    <li id="footer_logo">
      <a class="image-reference" href="https://showa-yojyo.github.io/" title="プレハブ小屋 Since 1999"><img src="../_static/logos.png"/></a>
    </li>
    <li id="footer_copyright">
      Copyright &copy; 1999-2023, プレハブ小屋 All rights reserved.
    </li>
  </ul>
</div>
  </body>
</html>