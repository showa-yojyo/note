<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>What’s New In Python 3.12 ノート &#8212; 読書ノート 1.6dev documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=1a9a5cd9" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=5a6f99c4"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/mermaid.js?v=578dbed1"></script>
    <link rel="next" title="What’s New In Python 3.13 ノート" href="python-3.13.html" />
    <link rel="prev" title="What’s New In Python 3.11 ノート" href="python-3.11.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
    <div class="related top">
      &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="python-3.11.html" title="Previous">What’s New In Python 3.11 ノート</a>
        </li>
      
        <li>
          <a href="python-3.13.html" title="Next">What’s New In Python 3.13 ノート</a>
          &rarr;
        </li>
    </ul>
  </nav>
    </div>


          <div class="body" role="main">
            
  <section id="what-s-new-in-python-3-12">
<h1>What’s New In Python 3.12 ノート<a class="headerlink" href="#what-s-new-in-python-3-12" title="Permalink to this heading">¶</a></h1>
<p><a class="reference external" href="https://docs.python.org/3/whatsnew/3.12.html">What’s New In Python 3.12</a> をたどりながら調査。興味のあるものしか読まない。</p>
<nav class="contents local" id="id1">
<p class="topic-title">ノート目次</p>
<ul class="simple">
<li><p><a class="reference internal" href="#new-features" id="id17">New Features</a></p>
<ul>
<li><p><a class="reference internal" href="#pep-695-type-parameter-syntax" id="id18">PEP 695: Type Parameter Syntax</a></p></li>
<li><p><a class="reference internal" href="#pep-701-syntactic-formalization-of-f-strings" id="id19">PEP 701: Syntactic formalization of f-strings</a></p></li>
<li><p><a class="reference internal" href="#pep-688-making-the-buffer-protocol-accessible-in-python" id="id20">PEP 688: Making the buffer protocol accessible in Python</a></p></li>
<li><p><a class="reference internal" href="#pep-709-comprehension-inlining" id="id21">PEP 709: Comprehension inlining</a></p></li>
<li><p><a class="reference internal" href="#improved-error-messages" id="id22">Improved Error Messages</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#new-features-related-to-type-hints" id="id23">New Features Related to Type Hints</a></p></li>
<li><p><a class="reference internal" href="#other-language-changes" id="id24">Other Language Changes</a></p></li>
<li><p><a class="reference internal" href="#new-modules" id="id25">New Modules</a></p></li>
<li><p><a class="reference internal" href="#improved-modules" id="id26">Improved Modules</a></p>
<ul>
<li><p><a class="reference internal" href="#array" id="id27"><code class="docutils literal notranslate"><span class="pre">array</span></code></a></p></li>
<li><p><a class="reference internal" href="#asyncio" id="id28"><code class="docutils literal notranslate"><span class="pre">asyncio</span></code></a></p></li>
<li><p><a class="reference internal" href="#calendar" id="id29"><code class="docutils literal notranslate"><span class="pre">calendar</span></code></a></p></li>
<li><p><a class="reference internal" href="#csv" id="id30"><code class="docutils literal notranslate"><span class="pre">csv</span></code></a></p></li>
<li><p><a class="reference internal" href="#fractions" id="id31"><code class="docutils literal notranslate"><span class="pre">fractions</span></code></a></p></li>
<li><p><a class="reference internal" href="#itertools" id="id32"><code class="docutils literal notranslate"><span class="pre">itertools</span></code></a></p></li>
<li><p><a class="reference internal" href="#math" id="id33"><code class="docutils literal notranslate"><span class="pre">math</span></code></a></p></li>
<li><p><a class="reference internal" href="#os-os-path" id="id34"><code class="docutils literal notranslate"><span class="pre">os</span></code>, <code class="docutils literal notranslate"><span class="pre">os.path</span></code></a></p></li>
<li><p><a class="reference internal" href="#pathlib" id="id35"><code class="docutils literal notranslate"><span class="pre">pathlib</span></code></a></p></li>
<li><p><a class="reference internal" href="#pdb" id="id36"><code class="docutils literal notranslate"><span class="pre">pdb</span></code></a></p></li>
<li><p><a class="reference internal" href="#random" id="id37"><code class="docutils literal notranslate"><span class="pre">random</span></code></a></p></li>
<li><p><a class="reference internal" href="#shutil" id="id38"><code class="docutils literal notranslate"><span class="pre">shutil</span></code></a></p></li>
<li><p><a class="reference internal" href="#sqlite3" id="id39"><code class="docutils literal notranslate"><span class="pre">sqlite3</span></code></a></p></li>
<li><p><a class="reference internal" href="#statistics" id="id40"><code class="docutils literal notranslate"><span class="pre">statistics</span></code></a></p></li>
<li><p><a class="reference internal" href="#sys" id="id41"><code class="docutils literal notranslate"><span class="pre">sys</span></code></a></p></li>
<li><p><a class="reference internal" href="#tempfile" id="id42"><code class="docutils literal notranslate"><span class="pre">tempfile</span></code></a></p></li>
<li><p><a class="reference internal" href="#typing" id="id43"><code class="docutils literal notranslate"><span class="pre">typing</span></code></a></p></li>
<li><p><a class="reference internal" href="#unicodedata" id="id44"><code class="docutils literal notranslate"><span class="pre">unicodedata</span></code></a></p></li>
<li><p><a class="reference internal" href="#unittest" id="id45"><code class="docutils literal notranslate"><span class="pre">unittest</span></code></a></p></li>
<li><p><a class="reference internal" href="#uuid" id="id46"><code class="docutils literal notranslate"><span class="pre">uuid</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#optimizations" id="id47">Optimizations</a></p></li>
<li><p><a class="reference internal" href="#deprecated" id="id48">Deprecated</a></p></li>
<li><p><a class="reference internal" href="#removed" id="id49">Removed</a></p>
<ul>
<li><p><a class="reference internal" href="#configparser" id="id50"><code class="docutils literal notranslate"><span class="pre">configparser</span></code></a></p></li>
<li><p><a class="reference internal" href="#distutils" id="id51"><code class="docutils literal notranslate"><span class="pre">distutils</span></code></a></p></li>
<li><p><a class="reference internal" href="#id4" id="id52"><code class="docutils literal notranslate"><span class="pre">unittest</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#porting-to-python-3-12" id="id53">Porting to Python 3.12</a></p>
<ul>
<li><p><a class="reference internal" href="#changes-in-the-python-api" id="id54">Changes in the Python API</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="new-features">
<h2><a class="toc-backref" href="#id17" role="doc-backlink">New Features</a><a class="headerlink" href="#new-features" title="Permalink to this heading">¶</a></h2>
<section id="pep-695-type-parameter-syntax">
<h3><a class="toc-backref" href="#id18" role="doc-backlink">PEP 695: Type Parameter Syntax</a><a class="headerlink" href="#pep-695-type-parameter-syntax" title="Permalink to this heading">¶</a></h3>
<p>Python の術語では generic というのだが、C++ の関数テンプレートやクラステンプレートに相当するコードの記法が改善した。例えば次のようなコードが合法になる：</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">std::minmax</span></code> のような Python 関数</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">minmax</span><span class="p">[</span><span class="n">T</span><span class="p">](</span><span class="n">a</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="k">if</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="k">else</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>さらに、<code class="docutils literal notranslate"><span class="pre">TypeAliasType</span></code> のオブジェクトを生成する <code class="docutils literal notranslate"><span class="pre">type</span></code> 文を使用して、型別名を宣言する新しい方法が導入された：</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">type</span></code> 文を用いた型別名の例</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">Point2D</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
<span class="nb">type</span> <span class="n">Point3D</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">T</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">TypeVarTuple</span></code> と <code class="docutils literal notranslate"><span class="pre">ParamSpec</span></code> 宣言する新文法：</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">type</span></code> による <code class="docutils literal notranslate"><span class="pre">TypeVarTuple</span></code> および <code class="docutils literal notranslate"><span class="pre">ParamSpec</span></code> の宣言例</span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">IntFunc</span><span class="p">[</span><span class="o">**</span><span class="n">P</span><span class="p">]</span> <span class="o">=</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>  <span class="c1"># ParamSpec</span>
<span class="nb">type</span> <span class="n">LabeledTuple</span><span class="p">[</span><span class="o">*</span><span class="n">Ts</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">Ts</span><span class="p">]</span>  <span class="c1"># TypeVarTuple</span>
</pre></div>
</div>
</div>
<p>一行目は <code class="docutils literal notranslate"><span class="pre">P</span> <span class="pre">=</span> <span class="pre">typing.ParamSpec('P')</span></code> を含意する。ただし <code class="docutils literal notranslate"><span class="pre">P</span></code> というオブジェクトを生成するわけではない。<code class="docutils literal notranslate"><span class="pre">IntFunc</span></code> が「単品」で使える。</p>
<p>二行目は <code class="docutils literal notranslate"><span class="pre">Ts</span> <span class="pre">=</span> <span class="pre">typing.TypeVarTuple('Ts')</span></code> を含意する。ただし <code class="docutils literal notranslate"><span class="pre">Ts</span></code> というオブジェクトを生成するわけではない。</p>
<p>また、束縛や制約を持つ <code class="docutils literal notranslate"><span class="pre">TypeVar</span></code> も同様に宣言可能だ：</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">type</span></code> による束縛 <code class="docutils literal notranslate"><span class="pre">TypeVar</span></code> および制約 <code class="docutils literal notranslate"><span class="pre">TypeVar</span></code> の宣言例</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">HashableSequence</span><span class="p">[</span><span class="n">T</span><span class="p">:</span> <span class="n">Hashable</span><span class="p">]</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>  <span class="c1"># TypeVar with bound</span>
<span class="nb">type</span> <span class="n">IntOrStrSequence</span><span class="p">[</span><span class="n">T</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">)]</span> <span class="o">=</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>  <span class="c1"># TypeVar with constraints</span>
</pre></div>
</div>
</div>
<p>一行目は <code class="docutils literal notranslate"><span class="pre">T</span> <span class="pre">=</span> <span class="pre">typing.TypeVar('T',</span> <span class="pre">bound=typing.Hashable)</span></code> を含意するが <code class="docutils literal notranslate"><span class="pre">T</span></code>
そのものとしては生成しない。</p>
<p>同様に、二行目は <code class="docutils literal notranslate"><span class="pre">T</span> <span class="pre">=</span> <span class="pre">typing.TypeVar('T',</span> <span class="pre">int,</span> <span class="pre">str)</span></code> を含意するが <code class="docutils literal notranslate"><span class="pre">T</span></code> そのものは生成しない。</p>
</section>
<section id="pep-701-syntactic-formalization-of-f-strings">
<h3><a class="toc-backref" href="#id19" role="doc-backlink">PEP 701: Syntactic formalization of f-strings</a><a class="headerlink" href="#pep-701-syntactic-formalization-of-f-strings" title="Permalink to this heading">¶</a></h3>
<p class="rubric">引用符の再利用</p>
<p>以前は f-string を囲む引用符と同じ記号を再利用すると <code class="docutils literal notranslate"><span class="pre">SyntaxError</span></code> が送出していた。例えば <code class="docutils literal notranslate"><span class="pre">f&quot;...&quot;</span></code> では <code class="docutils literal notranslate"><span class="pre">...</span></code> の部分に <code class="docutils literal notranslate"><span class="pre">&quot;</span></code> を入れることはできなかった。これが可能になった。</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">二重引用符を f-string の中でも使える</span><a class="headerlink" href="#id9" title="Permalink to this code">¶</a></div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="n">things</span> <span class="o">=</span> <span class="p">[]</span>

<span class="gp">In [2]: </span><span class="sa">f</span><span class="s2">&quot;These are the things: </span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">things</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="gh">Out[2]: </span><span class="go">&#39;These are the things: &#39;</span>
</pre></div>
</div>
</div>
<p>そして、f-strings は有効な Python 式を式部品の中に含むことができるようになったので、f-strings を入れ子にすることができるようになった。</p>
<p class="rubric">複数行の式とコメント</p>
<p>以前は f-string 式は一行で定義する必要があった。Python 3.12 では複数行にわたる
f-string を定義し、インラインコメントを追加できるようになった。</p>
<p class="rubric">バックスラッシュと Unicode 文字</p>
<p>以前の f-string 式はどんなバックスラッシュ文字をも含むことが不可能だった。特に、
Unicode エスケープシーケンスに悪影響があった。</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">以前は改行文字すら入れられなかった</span><a class="headerlink" href="#id10" title="Permalink to this code">¶</a></div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Hello&quot;</span><span class="p">,</span> <span class="s2">&quot;world&quot;</span><span class="p">]</span>

<span class="gp">In [2]: </span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="gh">Out[2]: </span><span class="go">&#39;Hello\nworld&#39;</span>
</pre></div>
</div>
</div>
<p class="rubric">エラーメッセージの精度向上</p>
<p>以上の文字列解析機能強化により、副産物として f-string のエラーメッセージがより正確になり、エラーの正確な場所が含まれるようになった。</p>
</section>
<section id="pep-688-making-the-buffer-protocol-accessible-in-python">
<h3><a class="toc-backref" href="#id20" role="doc-backlink">PEP 688: Making the buffer protocol accessible in Python</a><a class="headerlink" href="#pep-688-making-the-buffer-protocol-accessible-in-python" title="Permalink to this heading">¶</a></h3>
<p>メソッド <code class="docutils literal notranslate"><span class="pre">__buffer__()</span></code> を実装したクラスがバッファー型として使用できる。このメソッドはオブジェクトに内在する記憶域を開陳するオブジェクトを返す。</p>
<p>このようなオブジェクトの論理的な基底型が <code class="docutils literal notranslate"><span class="pre">collections.abc.Buffer</span></code> だ。これは型註釈などでバッファーオブジェクトを表現する標準的な方法を搭載している。</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">Example of <code class="docutils literal notranslate"><span class="pre">collections.abc.Buffer</span></code></span><a class="headerlink" href="#id11" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">need_buffer</span><span class="p">(</span><span class="n">b</span><span class="p">:</span> <span class="n">Buffer</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">memoryview</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

<span class="n">need_buffer</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;xy&quot;</span><span class="p">)</span>  <span class="c1"># ok</span>
<span class="n">need_buffer</span><span class="p">(</span><span class="s2">&quot;xy&quot;</span><span class="p">)</span>  <span class="c1"># rejected by static type checkers</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Buffer</span></code> はバッファー型を判定するために <code class="docutils literal notranslate"><span class="pre">isinstance()</span></code> と <code class="docutils literal notranslate"><span class="pre">issubclass()</span></code>
でも使える。</p>
<p>独自バッファー実装例は &lt;<a class="reference external" href="https://peps.python.org/pep-0688/">https://peps.python.org/pep-0688/</a>&gt; を見ろ。</p>
</section>
<section id="pep-709-comprehension-inlining">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">PEP 709: Comprehension inlining</a><a class="headerlink" href="#pep-709-comprehension-inlining" title="Permalink to this heading">¶</a></h3>
<p>内包記法周りが主に速度の点で強化。</p>
</section>
<section id="improved-error-messages">
<h3><a class="toc-backref" href="#id22" role="doc-backlink">Improved Error Messages</a><a class="headerlink" href="#improved-error-messages" title="Permalink to this heading">¶</a></h3>
<p>よりわかりやすいメッセージに改良。</p>
</section>
</section>
<section id="new-features-related-to-type-hints">
<h2><a class="toc-backref" href="#id23" role="doc-backlink">New Features Related to Type Hints</a><a class="headerlink" href="#new-features-related-to-type-hints" title="Permalink to this heading">¶</a></h2>
<p>型ヒントとモジュール <code class="docutils literal notranslate"><span class="pre">typing</span></code> に影響する主な変更点について書いてある。</p>
<div class="admonition-todo admonition" id="id2">
<p class="admonition-title">Todo</p>
<ul class="simple">
<li><p>PEP 692: Using <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> for more precise <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> typing</p></li>
<li><p>PEP 698: Override Decorator for Static Typing</p></li>
</ul>
<p>どちらも難しい。</p>
</div>
</section>
<section id="other-language-changes">
<h2><a class="toc-backref" href="#id24" role="doc-backlink">Other Language Changes</a><a class="headerlink" href="#other-language-changes" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>ヌル文字を含むソースコードを解析すると <code class="docutils literal notranslate"><span class="pre">SyntaxError</span></code> が生じる。</p></li>
<li><p>有効なエスケープシーケンスではないバックスラッシュ文字のペアが生じるのは
<code class="docutils literal notranslate"><span class="pre">DeprecationWarning</span></code> ではなく <code class="docutils literal notranslate"><span class="pre">SyntaxWarning</span></code> に変更した。正規表現を書いているときなどに出くわすかもしれない。</p></li>
<li><p><a class="reference internal" href="python-3.11.html"><span class="doc">What’s New In Python 3.11 ノート</span></a> であったように、数 <code class="docutils literal notranslate"><span class="pre">0o377</span></code> より大きな値の八進数エスケープが生じる例外が <code class="docutils literal notranslate"><span class="pre">DeprecationWarning</span></code> から <code class="docutils literal notranslate"><span class="pre">SyntaxWarning</span></code> に変更した。いずれエラーになる予定とのこと。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">try</span></code>-<code class="docutils literal notranslate"><span class="pre">except*</span></code> 構文が <code class="docutils literal notranslate"><span class="pre">ExceptionGroup</span></code> 全体を処理し、他の例外を一つ発生させる場合、その例外は <code class="docutils literal notranslate"><span class="pre">ExceptionGroup</span></code> にラップされなくなった。バージョン
3.11.4+ にもこの変更が適用された。</p></li>
<li><p>引数として <code class="docutils literal notranslate"><span class="pre">True</span></code> か <code class="docutils literal notranslate"><span class="pre">False</span></code> を期待する組み込み関数全てと拡張関数の
callable 全てが、<code class="docutils literal notranslate"><span class="pre">bool</span></code> と <code class="docutils literal notranslate"><span class="pre">int</span></code> だけでなく、任意の型の引数を受け付けるようになった。明示的に真偽値にキャストしなくて済むということだから便利だ。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sum()</span></code> で Neumaier 和を採用。浮動小数点数または <code class="docutils literal notranslate"><span class="pre">int</span></code> と浮動小数点数の混合を合計する際の精度と可換性が向上した。
<a class="reference external" href="https://github.com/python/cpython/issues/100425">Improve accuracy of builtin sum() for float inputs</a> を見ろ。</p></li>
<li><p>And more?</p></li>
</ul>
</section>
<section id="new-modules">
<h2><a class="toc-backref" href="#id25" role="doc-backlink">New Modules</a><a class="headerlink" href="#new-modules" title="Permalink to this heading">¶</a></h2>
<p>何もない。</p>
</section>
<section id="improved-modules">
<h2><a class="toc-backref" href="#id26" role="doc-backlink">Improved Modules</a><a class="headerlink" href="#improved-modules" title="Permalink to this heading">¶</a></h2>
<section id="array">
<h3><a class="toc-backref" href="#id27" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">array</span></code></a><a class="headerlink" href="#array" title="Permalink to this heading">¶</a></h3>
<p>クラス <code class="docutils literal notranslate"><span class="pre">array</span></code> が添字対応し、汎用型になる。以前は <code class="docutils literal notranslate"><span class="pre">a[0]</span></code> などが書けなかったということか？</p>
</section>
<section id="asyncio">
<h3><a class="toc-backref" href="#id28" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">asyncio</span></code></a><a class="headerlink" href="#asyncio" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>イベントループは各プラットフォームで利用可能な最適の見張りを使用するようになった。手動で見張りを設定することは勧められない。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">run()</span></code> に <code class="docutils literal notranslate"><span class="pre">loop_factory</span></code> 引数が追加。自家製イベントループ工場を指定可能。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">iscoroutine()</span></code> は <code class="docutils literal notranslate"><span class="pre">asyncio</span></code> がジェネレーターベースのコルーチンを支持しないため、ジェネレーターに対して <code class="docutils literal notranslate"><span class="pre">False</span></code> を返すように変更した。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wait()</span></code> と <code class="docutils literal notranslate"><span class="pre">as_completed()</span></code> はジェネレーターが <code class="docutils literal notranslate"><span class="pre">yield</span></code> するタスクを受け付けるようになった。</p></li>
</ul>
</section>
<section id="calendar">
<h3><a class="toc-backref" href="#id29" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">calendar</span></code></a><a class="headerlink" href="#calendar" title="Permalink to this heading">¶</a></h3>
<p>列挙型 <code class="docutils literal notranslate"><span class="pre">Month</span></code> および <code class="docutils literal notranslate"><span class="pre">Day</span></code> が追加。一年の月と曜日を定義する。</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">calendar.Month</span></code> and <code class="docutils literal notranslate"><span class="pre">calendar.Day</span></code></span><a class="headerlink" href="#id12" title="Permalink to this code">¶</a></div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">calendar</span> <span class="kn">import</span> <span class="n">Month</span><span class="p">,</span> <span class="n">Day</span>

<span class="gp">In [2]: </span><span class="n">Month</span>
<span class="gh">Out[2]: </span><span class="go">&lt;enum &#39;Month&#39;&gt;</span>

<span class="gp">In [3]: </span><span class="nb">list</span><span class="p">(</span><span class="n">Month</span><span class="p">)</span>
<span class="gh">Out[3]:</span>
<span class="go">[calendar.JANUARY,</span>
<span class="go"> calendar.FEBRUARY,</span>
<span class="go"> calendar.MARCH,</span>
<span class="go"> calendar.APRIL,</span>
<span class="go"> calendar.MAY,</span>
<span class="go"> calendar.JUNE,</span>
<span class="go"> calendar.JULY,</span>
<span class="go"> calendar.AUGUST,</span>
<span class="go"> calendar.SEPTEMBER,</span>
<span class="go"> calendar.OCTOBER,</span>
<span class="go"> calendar.NOVEMBER,</span>
<span class="go"> calendar.DECEMBER]</span>

<span class="gp">In [4]: </span><span class="nb">list</span><span class="p">(</span><span class="n">Day</span><span class="p">)</span>
<span class="gh">Out[4]:</span>
<span class="go">[calendar.MONDAY,</span>
<span class="go"> calendar.TUESDAY,</span>
<span class="go"> calendar.WEDNESDAY,</span>
<span class="go"> calendar.THURSDAY,</span>
<span class="go"> calendar.FRIDAY,</span>
<span class="go"> calendar.SATURDAY,</span>
<span class="go"> calendar.SUNDAY]</span>
</pre></div>
</div>
</div>
<div class="admonition- admonition">
<p class="admonition-title">利用者ノート</p>
<p>月曜の値は 0 であることを確認。</p>
</div>
</section>
<section id="csv">
<h3><a class="toc-backref" href="#id30" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">csv</span></code></a><a class="headerlink" href="#csv" title="Permalink to this heading">¶</a></h3>
<p>フラグに <code class="docutils literal notranslate"><span class="pre">QUOTE_NOTNULL</span></code> と <code class="docutils literal notranslate"><span class="pre">QUOTE_STRINGS</span></code> が追加。</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">QUOTE_NOTNULL</span></code></dt><dd><p>出力の場合、<code class="docutils literal notranslate"><span class="pre">None</span></code> でないフィールド全てを引用符で囲む。<code class="docutils literal notranslate"><span class="pre">QUOTE_ALL</span></code> と似ているようだがフィールド値が <code class="docutils literal notranslate"><span class="pre">None</span></code> である場合に、空の（引用符で囲まれていない）文字列を書き込むという点が異なる。空（引用符で囲まれていない）フィールドを <code class="docutils literal notranslate"><span class="pre">None</span></code> だと解釈し、それ以外は <code class="docutils literal notranslate"><span class="pre">QUOTE_ALL</span></code> と同じ動作をする。</p>
<p>入力の場合、空の（引用符で囲まれていない）フィールドを <code class="docutils literal notranslate"><span class="pre">None</span></code> として解釈し、それ以外は <code class="docutils literal notranslate"><span class="pre">QUOTE_ALL</span></code> として動作する。</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">QUOTE_STRINGS</span></code></dt><dd><p>出力の場合、文字列フィールドを常に引用符で囲む。<code class="docutils literal notranslate"><span class="pre">QUOTE_NONNUMERIC</span></code> に似ているようだが、フィールド値が <code class="docutils literal notranslate"><span class="pre">None</span></code> である場合に、空の（引用符で囲まれていない）文字列を書き込むという点が異なる。</p>
<p>入力の場合、空の（引用符で囲まれていない）文字列を <code class="docutils literal notranslate"><span class="pre">None</span></code> だと解釈し、それ以外は <code class="docutils literal notranslate"><span class="pre">QUOTE_NONNUMERIC</span></code> として動作する。</p>
</dd>
</dl>
</section>
<section id="fractions">
<h3><a class="toc-backref" href="#id31" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">fractions</span></code></a><a class="headerlink" href="#fractions" title="Permalink to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Fraction</span></code> 型のオブジェクトが関数 <code class="docutils literal notranslate"><span class="pre">format()</span></code> などでの浮動小数点数書式に対応した。</p>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">例えば e, E, f, F, g, G, % が使える。</span><a class="headerlink" href="#id13" title="Permalink to this code">¶</a></div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">fractions</span> <span class="kn">import</span> <span class="n">Fraction</span> <span class="k">as</span> <span class="n">F</span>

<span class="gp">In [2]: </span><span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

<span class="gp">In [3]: </span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.3e</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.3g</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.3%</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="gh">Out[3]: </span><span class="go">&#39;1.250e-01 0.125 0.125 12.500%&#39;</span>
</pre></div>
</div>
</div>
</section>
<section id="itertools">
<h3><a class="toc-backref" href="#id32" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">itertools</span></code></a><a class="headerlink" href="#itertools" title="Permalink to this heading">¶</a></h3>
<p>ジェネレーター <code class="docutils literal notranslate"><span class="pre">batched()</span></code> が追加。反復可能なデータを指定長の <code class="docutils literal notranslate"><span class="pre">tuple</span></code> に一括する。これはコード片を見るほうが理解が早い：</p>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">batched()</span></code></span><a class="headerlink" href="#id14" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">batched</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="c1"># batched(&#39;ABCDEFG&#39;, 3) → ABC DEF G</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;n must be at least one&#39;</span><span class="p">)</span>
    <span class="n">iterator</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">batch</span> <span class="o">:=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span><span class="n">iterator</span><span class="p">,</span> <span class="n">n</span><span class="p">)):</span>
        <span class="k">yield</span> <span class="n">batch</span>
</pre></div>
</div>
</div>
</section>
<section id="math">
<h3><a class="toc-backref" href="#id33" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">math</span></code></a><a class="headerlink" href="#math" title="Permalink to this heading">¶</a></h3>
<p>関数 <code class="docutils literal notranslate"><span class="pre">sumprod(p,</span> <span class="pre">q)</span></code> 追加。ドット積。</p>
<p>関数 <code class="docutils literal notranslate"><span class="pre">nextafter(x,</span> <span class="pre">y)</span></code> を拡張。一度に複数のステップを上下に移動するための
<code class="docutils literal notranslate"><span class="pre">steps</span></code> 引数を追加。拡張動機はこういうコードを書かざるを得なかったことがあったかららしい：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">nextafter</span><span class="p">(</span><span class="n">nextafter</span><span class="p">(</span><span class="n">nextafter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">inf</span><span class="p">),</span> <span class="n">inf</span><span class="p">),</span> <span class="n">inf</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="os-os-path">
<h3><a class="toc-backref" href="#id34" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">os</span></code>, <code class="docutils literal notranslate"><span class="pre">os.path</span></code></a><a class="headerlink" href="#os-os-path" title="Permalink to this heading">¶</a></h3>
<p>Windows に関係する新機能が多いようなので割愛。</p>
</section>
<section id="pathlib">
<h3><a class="toc-backref" href="#id35" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">pathlib</span></code></a><a class="headerlink" href="#pathlib" title="Permalink to this heading">¶</a></h3>
<p>ディレクトリー木を走査し、その中のファイルまたはディレクトリーすべての名前を生成するためのメソッド <code class="docutils literal notranslate"><span class="pre">walk()</span></code> がクラス <code class="docutils literal notranslate"><span class="pre">Path</span></code> に追加した。動作は関数
<code class="docutils literal notranslate"><span class="pre">os.walk()</span></code> と同様。</p>
<p><code class="docutils literal notranslate"><span class="pre">PurePath.relative_to()</span></code> に <code class="docutils literal notranslate"><span class="pre">walk_up</span></code> オプション引数が追加。結果に <code class="docutils literal notranslate"><span class="pre">..</span></code> が入ることが許される。この動作は関数 <code class="docutils literal notranslate"><span class="pre">os.path.relpath()</span></code> と整合する。</p>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">p.relative_to(other,</span> <span class="pre">walk_up=True)</span></code></span><a class="headerlink" href="#id15" title="Permalink to this code">¶</a></div>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">PurePosixPath</span>

<span class="gp">In [2]: </span><span class="n">p</span> <span class="o">=</span> <span class="n">PurePosixPath</span><span class="p">(</span><span class="s1">&#39;/etc/passwd&#39;</span><span class="p">)</span>

<span class="gp">In [3]: </span><span class="n">p</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="s1">&#39;/usr&#39;</span><span class="p">,</span> <span class="n">walk_up</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gh">Out[3]: </span><span class="go">PurePosixPath(&#39;../etc/passwd&#39;)</span>
</pre></div>
</div>
</div>
</section>
<section id="pdb">
<h3><a class="toc-backref" href="#id36" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">pdb</span></code></a><a class="headerlink" href="#pdb" title="Permalink to this heading">¶</a></h3>
<p>デバッグセッションのために一時的に値を保持し、現在のフレームや戻り値のような値に素早くアクセスできる簡易変数が追加。</p>
<p>一時的なグローバル変数を設定するには、例えば、<code class="docutils literal notranslate"><span class="pre">$foo</span> <span class="pre">=</span> <span class="pre">1</span></code> とすると、デバッガーセッションで使用できるグローバル変数 <code class="docutils literal notranslate"><span class="pre">$foo</span></code> を設定する。簡易変数はプログラムの実行が再開されると消去されるので、<code class="docutils literal notranslate"><span class="pre">foo</span> <span class="pre">=</span> <span class="pre">1</span></code> のような通常の変数を使う場合に比べてプログラムに支障をきたす可能性は低くなる。</p>
<p>簡易変数が三つ、あらかじめ用意されている：</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>簡易変数</p></th>
<th class="head"><p>意味</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">$_frame</span></code></p></td>
<td><p>デバッグしている現在のフレーム</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">$_retval</span></code></p></td>
<td><p>フレームが return している場合、その戻り値</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">$_exception</span></code></p></td>
<td><p>フレームが例外を raise している場合、その例外</p></td>
</tr>
</tbody>
</table>
</section>
<section id="random">
<h3><a class="toc-backref" href="#id37" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">random</span></code></a><a class="headerlink" href="#random" title="Permalink to this heading">¶</a></h3>
<p>二項分布 <code class="docutils literal notranslate"><span class="pre">binomialvariate(n=1,</span> <span class="pre">p=0.5)</span></code> 追加。各試行での成功確率を <code class="docutils literal notranslate"><span class="pre">p</span></code> とし、独立した <code class="docutils literal notranslate"><span class="pre">n</span></code> 回の試行の成功回数を返す。</p>
<p>指数分布 <code class="docutils literal notranslate"><span class="pre">expovariate()</span></code> に既定引数 <code class="docutils literal notranslate"><span class="pre">lambd=1.0</span></code> が追加。</p>
</section>
<section id="shutil">
<h3><a class="toc-backref" href="#id38" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">shutil</span></code></a><a class="headerlink" href="#shutil" title="Permalink to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">rmtree()</span></code> に引数 <code class="docutils literal notranslate"><span class="pre">onexc</span></code> が追加。これは <code class="docutils literal notranslate"><span class="pre">onerror</span></code> のようなエラーハンドラーであるが、例外オブジェクトを受け取るものだ。</p>
</section>
<section id="sqlite3">
<h3><a class="toc-backref" href="#id39" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">sqlite3</span></code></a><a class="headerlink" href="#sqlite3" title="Permalink to this heading">¶</a></h3>
<p>なんと CLI が実装された。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>sqlite3
<span class="go">sqlite3 shell, running on SQLite version 3.45.3</span>
<span class="go">Connected to a transient in-memory database</span>

<span class="go">Each command will be run using execute() on the cursor.</span>
<span class="go">Type &quot;.help&quot; for more information; type &quot;.quit&quot; or CTRL-D to quit.</span>
<span class="go">sqlite&gt;</span>
</pre></div>
</div>
</section>
<section id="statistics">
<h3><a class="toc-backref" href="#id40" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">statistics</span></code></a><a class="headerlink" href="#statistics" title="Permalink to this heading">¶</a></h3>
<p>関数 <code class="docutils literal notranslate"><span class="pre">correlation()</span></code> が拡張。ランク付けされたデータの Spearman 相関を計算するメソッド <code class="docutils literal notranslate"><span class="pre">ranked</span></code> を追加： <code class="docutils literal notranslate"><span class="pre">correlation(x,</span> <span class="pre">y,</span> <span class="pre">method='ranked')</span></code>.</p>
</section>
<section id="sys">
<h3><a class="toc-backref" href="#id41" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">sys</span></code></a><a class="headerlink" href="#sys" title="Permalink to this heading">¶</a></h3>
<p>今回は割愛。</p>
</section>
<section id="tempfile">
<h3><a class="toc-backref" href="#id42" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">tempfile</span></code></a><a class="headerlink" href="#tempfile" title="Permalink to this heading">¶</a></h3>
<p>関数 <code class="docutils literal notranslate"><span class="pre">mkdtemp(suffix=None,</span> <span class="pre">prefix=None,</span> <span class="pre">dir=None)</span></code> は <code class="docutils literal notranslate"><span class="pre">dir</span></code> 引数が相対パスであっても、絶対パスを常に返す。</p>
</section>
<section id="typing">
<h3><a class="toc-backref" href="#id43" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">typing</span></code></a><a class="headerlink" href="#typing" title="Permalink to this heading">¶</a></h3>
<div class="admonition-todo admonition" id="id3">
<p class="admonition-title">Todo</p>
<p>例によって難しいから後にする。</p>
</div>
</section>
<section id="unicodedata">
<h3><a class="toc-backref" href="#id44" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">unicodedata</span></code></a><a class="headerlink" href="#unicodedata" title="Permalink to this heading">¶</a></h3>
<p>Unicode データベースがバージョン <a class="reference external" href="https://www.unicode.org/versions/Unicode15.0.0/">15.0.0</a> に更新した。</p>
<div class="admonition- admonition">
<p class="admonition-title">読者ノート</p>
<p>個人的には使いたい文字がないので軽視する。</p>
</div>
</section>
<section id="unittest">
<h3><a class="toc-backref" href="#id45" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">unittest</span></code></a><a class="headerlink" href="#unittest" title="Permalink to this heading">¶</a></h3>
<p>コマンドラインオプション <code class="samp docutils literal notranslate"><span class="pre">--durations=</span><em><span class="pre">N</span></em></code> は最も遅いテストケース <cite>N</cite> 個を示す。</p>
</section>
<section id="uuid">
<h3><a class="toc-backref" href="#id46" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">uuid</span></code></a><a class="headerlink" href="#uuid" title="Permalink to this heading">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">uuid</span></code> CLI</span><a class="headerlink" href="#id16" title="Permalink to this code">¶</a></div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>uuid
<span class="go">8cb09e58-2154-4b36-9bea-2806403d956e</span>
</pre></div>
</div>
</div>
<div class="admonition- admonition">
<p class="admonition-title">読者ノート</p>
<p>これは使う可能性が高いから忘れないでおく。</p>
</div>
</section>
</section>
<section id="optimizations">
<h2><a class="toc-backref" href="#id47" role="doc-backlink">Optimizations</a><a class="headerlink" href="#optimizations" title="Permalink to this heading">¶</a></h2>
<p>ここは一般プログラマーには重要ではないかもしれない。ほとんどチェックしていない。</p>
</section>
<section id="deprecated">
<h2><a class="toc-backref" href="#id48" role="doc-backlink">Deprecated</a><a class="headerlink" href="#deprecated" title="Permalink to this heading">¶</a></h2>
<p>古いやり方をいつまで経っても採用し続けないように、一通りチェックする。</p>
<p>定数 <code class="docutils literal notranslate"><span class="pre">calendar.January</span></code> および <code class="docutils literal notranslate"><span class="pre">calendar.February</span></code> が咎められる。それぞれ列挙型メンバー <code class="docutils literal notranslate"><span class="pre">calendar.JANUARY</span></code> および <code class="docutils literal notranslate"><span class="pre">calendar.FEBRUARY</span></code> に置き換えろ。</p>
<p>クラス <code class="docutils literal notranslate"><span class="pre">datetime.datetime</span></code> で <code class="docutils literal notranslate"><span class="pre">utcnow()</span></code> と <code class="docutils literal notranslate"><span class="pre">utcfromtimestamp()</span></code> は将来のバージョンで削除される予定。代わりに：</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>

<span class="gp">In [2]: </span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
<span class="gh">Out[2]: </span><span class="go">datetime.datetime(2024, 9, 26, 2, 26, 26, 338492, tzinfo=datetime.timezone.utc)</span>

<span class="gp">In [3]: </span><span class="kn">import</span> <span class="nn">time</span>

<span class="gp">In [4]: </span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
<span class="gh">Out[4]: </span><span class="go">datetime.datetime(2024, 9, 26, 2, 28, 47, 722403, tzinfo=datetime.timezone.utc)</span>
</pre></div>
</div>
<p>関数 <code class="docutils literal notranslate"><span class="pre">suhtil.rmtree()</span></code> の <code class="docutils literal notranslate"><span class="pre">onerror</span></code> 引数。代わりに <code class="docutils literal notranslate"><span class="pre">onexc</span></code> 引数を使え。</p>
<p><code class="docutils literal notranslate"><span class="pre">sys.last_type</span></code>, <code class="docutils literal notranslate"><span class="pre">sys.last_value</span></code>, <code class="docutils literal notranslate"><span class="pre">sys.last_traceback</span></code> は咎められる。代わりに <code class="docutils literal notranslate"><span class="pre">sys.last_exc</span></code> を使え。</p>
<p><code class="docutils literal notranslate"><span class="pre">typing.</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">typing.Hashable</span></code> と <code class="docutils literal notranslate"><span class="pre">typing.Sized</span></code> はそれぞれ <code class="docutils literal notranslate"><span class="pre">collections.abc.Hashable</span></code>
と <code class="docutils literal notranslate"><span class="pre">collections.abc.Sized</span></code> の別名だった。</p>
<p>Python 3.9 から使用を咎められる <code class="docutils literal notranslate"><span class="pre">typing.ByteString</span></code> は、使用時に
<code class="docutils literal notranslate"><span class="pre">DeprecationWarning</span></code> を送出する。</p>
<p>次の非同期系送出関数。それぞれの単一引数版を使え：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">coroutine.throw(type[,</span> <span class="pre">value[,</span> <span class="pre">traceback]])</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">generator.throw(type[,</span> <span class="pre">value[,</span> <span class="pre">traceback]])</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">coroutine</span> <span class="pre">agen.athrow(type[,</span> <span class="pre">value[,</span> <span class="pre">traceback]])</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">bool</span></code> 値に対するビット反転演算子。Python 3.16 からはエラー。代わりに演算子
<code class="docutils literal notranslate"><span class="pre">not</span></code> を使え。</p>
<div class="admonition- admonition">
<p class="admonition-title">読者ノート</p>
<p><code class="docutils literal notranslate"><span class="pre">~True</span></code> と <code class="docutils literal notranslate"><span class="pre">~False</span></code> の値がそれぞれ <code class="docutils literal notranslate"><span class="pre">-2</span></code>, <code class="docutils literal notranslate"><span class="pre">-1</span></code> になる。</p>
</div>
</section>
<section id="removed">
<h2><a class="toc-backref" href="#id49" role="doc-backlink">Removed</a><a class="headerlink" href="#removed" title="Permalink to this heading">¶</a></h2>
<section id="configparser">
<h3><a class="toc-backref" href="#id50" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">configparser</span></code></a><a class="headerlink" href="#configparser" title="Permalink to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ParsingError</span></code> から <code class="docutils literal notranslate"><span class="pre">filename</span></code> 属性・引数がなくなった。代えて <code class="docutils literal notranslate"><span class="pre">source</span></code> 属性・引数を使え。</p>
<p>クラス <code class="docutils literal notranslate"><span class="pre">SafeConfigParser</span></code> はもはや存在しない。代わりに、より短い名前
<code class="docutils literal notranslate"><span class="pre">ConfigParser</span></code> を使え。</p>
<p>クラス <code class="docutils literal notranslate"><span class="pre">ConfigParser</span></code> からメソッド <code class="docutils literal notranslate"><span class="pre">readfp()</span></code> が消えた。代わりに
<code class="docutils literal notranslate"><span class="pre">read_file()</span></code> を使え。</p>
<div class="admonition- admonition">
<p class="admonition-title">読者ノート</p>
<p>手許のコードを確認したが、影響はないようだ。</p>
</div>
</section>
<section id="distutils">
<h3><a class="toc-backref" href="#id51" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">distutils</span></code></a><a class="headerlink" href="#distutils" title="Permalink to this heading">¶</a></h3>
<p>パッケージ全体が削除された。</p>
</section>
<section id="id4">
<h3><a class="toc-backref" href="#id52" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">unittest</span></code></a><a class="headerlink" href="#id4" title="Permalink to this heading">¶</a></h3>
<p>クラス <code class="docutils literal notranslate"><span class="pre">TestCase</span></code> のかなりのメソッド別名が取り除かれた。量が多いのでいちいち確認するしかないが、例えば <code class="docutils literal notranslate"><span class="pre">assertEquals()</span></code> は <code class="docutils literal notranslate"><span class="pre">assertEqual()</span></code> と改めろ。</p>
<p>テストコードが古い場合、道具を使って置換するといい：
&lt;<a class="reference external" href="https://github.com/isidentical/teyit">https://github.com/isidentical/teyit</a>&gt;</p>
</section>
</section>
<section id="porting-to-python-3-12">
<h2><a class="toc-backref" href="#id53" role="doc-backlink">Porting to Python 3.12</a><a class="headerlink" href="#porting-to-python-3-12" title="Permalink to this heading">¶</a></h2>
<p>本節以降、個人的には対応項目なし。</p>
<section id="changes-in-the-python-api">
<h3><a class="toc-backref" href="#id54" role="doc-backlink">Changes in the Python API</a><a class="headerlink" href="#changes-in-the-python-api" title="Permalink to this heading">¶</a></h3>
<p>正規表現における数値グループ参照とグループ名に対して、数値参照として受け入れられるのは ASCII 数字の並びだけになった。&lt;<a class="reference external" href="https://github.com/python/cpython/issues/91760">https://github.com/python/cpython/issues/91760</a>&gt;
参照。</p>
<p>関数 <code class="docutils literal notranslate"><span class="pre">random.randrange()</span></code> で、実引数が正の整数としては怪しい値 (e.g. 10.2) だと <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> を送出するようになった。</p>
<hr class="docutils" />
<p>興味がある項目は以上？</p>
</section>
</section>
</section>


          </div>
    <div class="related bottom">
      &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="python-3.11.html" title="Previous">What’s New In Python 3.11 ノート</a>
        </li>
      
        <li>
          <a href="python-3.13.html" title="Next">What’s New In Python 3.13 ノート</a>
          &rarr;
        </li>
    </ul>
  </nav>
    </div>

      </div>
      <div class="clearer"></div>
    </div>
<div class="footer">
  <ul>
    <li id="footer_logo">
      <a class="image-reference" href="index.html" title="読書ノート Home"><img src="_images/logo.svg"/></a>
    </li>
    <li id="footer_copyright">
      Copyright &copy; 1999-2024, プレハブ小屋 All rights reserved.
    </li>
  </ul>
</div>
  </body>
</html>