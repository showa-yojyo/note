<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>What’s New In Python 3.11 ノート &#8212; 読書ノート 1.6dev documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=c9b0a06a" />
    <script src="_static/documentation_options.js?v=4354bf25"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="_static/mathjax-v3.js?v=bf1ec211"></script>
    <script src="_static/mermaid.js?v=578dbed1"></script>
    <link rel="next" title="What’s New In Python 3.12 ノート" href="python-3.12.html" />
    <link rel="prev" title="What’s New In Python 3.10 ノート" href="python-3.10.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
    <div class="related top">
      &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="python-3.10.html" title="Previous">What’s New In Python 3.10 ノート</a>
        </li>
      
        <li>
          <a href="python-3.12.html" title="Next">What’s New In Python 3.12 ノート</a>
          &rarr;
        </li>
    </ul>
  </nav>
    </div>


          <div class="body" role="main">
            
  <section id="what-s-new-in-python-3-11">
<h1>What’s New In Python 3.11 ノート<a class="headerlink" href="#what-s-new-in-python-3-11" title="Link to this heading">¶</a></h1>
<p><a class="reference external" href="https://docs.python.org/3/whatsnew/3.11.html">What’s New In Python 3.11</a> をたどりながら調査。興味のあるものしか読まない。</p>
<nav class="contents local" id="id1">
<p class="topic-title">ノート目次</p>
<ul class="simple">
<li><p><a class="reference internal" href="#new-features" id="id7">New Features</a></p>
<ul>
<li><p><a class="reference internal" href="#pep-654-exception-groups-and-except" id="id8">PEP 654: Exception Groups and <code class="docutils literal notranslate"><span class="pre">except*</span></code></a></p></li>
<li><p><a class="reference internal" href="#pep-678-exceptions-can-be-enriched-with-notes" id="id9">PEP 678: Exceptions can be enriched with notes</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#new-features-related-to-type-hints" id="id10">New Features Related to Type Hints</a></p>
<ul>
<li><p><a class="reference internal" href="#pep-673-self-type" id="id11">PEP 673: <code class="docutils literal notranslate"><span class="pre">Self</span></code> type</a></p></li>
<li><p><a class="reference internal" href="#pep-675-arbitrary-literal-string-type" id="id12">PEP 675: Arbitrary literal string type</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#other-language-changes" id="id13">Other Language Changes</a></p></li>
<li><p><a class="reference internal" href="#new-modules" id="id14">New Modules</a></p></li>
<li><p><a class="reference internal" href="#improved-modules" id="id15">Improved Modules</a></p>
<ul>
<li><p><a class="reference internal" href="#contextlib" id="id16"><code class="docutils literal notranslate"><span class="pre">contextlib</span></code></a></p></li>
<li><p><a class="reference internal" href="#datetime" id="id17"><code class="docutils literal notranslate"><span class="pre">datetime</span></code></a></p></li>
<li><p><a class="reference internal" href="#enum" id="id18"><code class="docutils literal notranslate"><span class="pre">enum</span></code></a></p></li>
<li><p><a class="reference internal" href="#math" id="id19"><code class="docutils literal notranslate"><span class="pre">math</span></code></a></p></li>
<li><p><a class="reference internal" href="#operator" id="id20"><code class="docutils literal notranslate"><span class="pre">operator</span></code></a></p></li>
<li><p><a class="reference internal" href="#pathlib" id="id21"><code class="docutils literal notranslate"><span class="pre">pathlib</span></code></a></p></li>
<li><p><a class="reference internal" href="#re" id="id22"><code class="docutils literal notranslate"><span class="pre">re</span></code></a></p></li>
<li><p><a class="reference internal" href="#shutil" id="id23"><code class="docutils literal notranslate"><span class="pre">shutil</span></code></a></p></li>
<li><p><a class="reference internal" href="#string" id="id24"><code class="docutils literal notranslate"><span class="pre">string</span></code></a></p></li>
<li><p><a class="reference internal" href="#sys" id="id25"><code class="docutils literal notranslate"><span class="pre">sys</span></code></a></p></li>
<li><p><a class="reference internal" href="#timer" id="id26"><code class="docutils literal notranslate"><span class="pre">timer</span></code></a></p></li>
<li><p><a class="reference internal" href="#typing" id="id27"><code class="docutils literal notranslate"><span class="pre">typing</span></code></a></p></li>
<li><p><a class="reference internal" href="#unicodedata" id="id28"><code class="docutils literal notranslate"><span class="pre">unicodedata</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#optimizations" id="id29">Optimizations</a></p></li>
<li><p><a class="reference internal" href="#deprecated" id="id30">Deprecated</a></p></li>
<li><p><a class="reference internal" href="#removed" id="id31">Removed</a></p></li>
<li><p><a class="reference internal" href="#porting-to-python-3-11" id="id32">Porting to Python 3.11</a></p></li>
</ul>
</nav>
<section id="new-features">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">New Features</a><a class="headerlink" href="#new-features" title="Link to this heading">¶</a></h2>
<p>例外にかかわる二つの機能を習得する。</p>
<section id="pep-654-exception-groups-and-except">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">PEP 654: Exception Groups and <code class="docutils literal notranslate"><span class="pre">except*</span></code></a><a class="headerlink" href="#pep-654-exception-groups-and-except" title="Link to this heading">¶</a></h3>
<p>組み込み型 <code class="docutils literal notranslate"><span class="pre">ExceptionGroup</span></code> は複数の例外をまとめて発生させることを可能する。関連して、新しい例外捕捉構文 <code class="docutils literal notranslate"><span class="pre">except*</span></code> が登場。<code class="docutils literal notranslate"><span class="pre">ExceptionGroup</span></code> の部分に合致するものをまとめて拾う。</p>
<p>Python documentation <a class="reference external" href="https://docs.python.org/3/tutorial/errors.html#tut-exception-groups">8.9. Raising and Handling Multiple Unrelated Exceptions</a> を見ろ。</p>
<div class="admonition- admonition">
<p class="admonition-title">読者ノート</p>
<p>Composite パターンを思い出せ。</p>
</div>
</section>
<section id="pep-678-exceptions-can-be-enriched-with-notes">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">PEP 678: Exceptions can be enriched with notes</a><a class="headerlink" href="#pep-678-exceptions-can-be-enriched-with-notes" title="Link to this heading">¶</a></h3>
<p>例外型にメソッド <code class="docutils literal notranslate"><span class="pre">add_note()</span></code> が追加。例外処理ブロックで捕捉した例外オブジェクトに対して処理者が情報を追加するために用いる。追加した注意事項は既定のトレースバックに含まれる。</p>
<p>Python documentation <a class="reference external" href="https://docs.python.org/3/tutorial/errors.html#tut-exception-notes">8.10 Enriching Exceptions with Notes</a> を見ろ。</p>
<div class="admonition- admonition">
<p class="admonition-title">読者ノート</p>
<p>一つの例外オブジェクトに対して <code class="docutils literal notranslate"><span class="pre">add_note()</span></code> を複数回呼び出して情報追加を複数回に分けることが可能だ。</p>
</div>
</section>
</section>
<section id="new-features-related-to-type-hints">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">New Features Related to Type Hints</a><a class="headerlink" href="#new-features-related-to-type-hints" title="Link to this heading">¶</a></h2>
<p>型ヒントとモジュール <code class="docutils literal notranslate"><span class="pre">typing</span></code> に影響する主な変更点について書いてある。ここをチェックする前に次の資料を先に読んでおくと良い。要点を Python 公式より絞っていて入門者向きだ：</p>
<p><a class="reference external" href="https://mypy.readthedocs.io/en/stable/index.html">mypy</a></p>
<section id="pep-673-self-type">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">PEP 673: <code class="docutils literal notranslate"><span class="pre">Self</span></code> type</a><a class="headerlink" href="#pep-673-self-type" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">typing.Self</span></code> は現在囲まれているクラスを表す特別な型だ。メソッドが <code class="docutils literal notranslate"><span class="pre">return</span>
<span class="pre">self</span></code> で終わる場合や、クラスメソッドの場合に、その戻り値註釈として用いるのが基本的だ。</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">What’s New から持ってきた例</span><a class="headerlink" href="#id3" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Self</span>

<span class="k">class</span> <span class="nc">MyLock</span><span class="p">:</span>
  <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
      <span class="k">return</span> <span class="bp">self</span>
</pre></div>
</div>
</div>
</section>
<section id="pep-675-arbitrary-literal-string-type">
<h3><a class="toc-backref" href="#id12" role="doc-backlink">PEP 675: Arbitrary literal string type</a><a class="headerlink" href="#pep-675-arbitrary-literal-string-type" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">typing.LiteralString</span></code> はリテラル文字列のみを含む特殊な型だ。文字列リテラルはすべて <code class="docutils literal notranslate"><span class="pre">LiteralString</span></code> と互換性がある。しかし、単なる <code class="docutils literal notranslate"><span class="pre">str</span></code> として型付けられたオブジェクトは互換性がない。</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">PEP 675 から持ってきた例</span><a class="headerlink" href="#id4" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">LiteralString</span>

<span class="k">def</span> <span class="nf">add_limit</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="n">LiteralString</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LiteralString</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">query</span> <span class="o">+</span> <span class="s2">&quot; LIMIT = 1&quot;</span>

<span class="k">def</span> <span class="nf">my_query</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="n">LiteralString</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">sql_connection</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">add_limit</span><span class="p">(</span><span class="n">query</span><span class="p">),</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,))</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="other-language-changes">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">Other Language Changes</a><a class="headerlink" href="#other-language-changes" title="Link to this heading">¶</a></h2>
<p>開梱式が <code class="docutils literal notranslate"><span class="pre">for</span></code> 文の <code class="docutils literal notranslate"><span class="pre">in</span></code> 部分で書けるようになった。例：</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Starred unpacking expressions can now be used in for statements</span><a class="headerlink" href="#id5" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">*</span><span class="n">b</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
<p>非同期関数にある内包の内部で非同期内包を使用できるようになった。この場合、外側の内包は暗黙的に非同期になる。例：</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">bpo-33346 から持ってきた例：</span><a class="headerlink" href="#id6" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span> <span class="n">n</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span> <span class="k">async</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">some_async_function</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)}</span>
</pre></div>
</div>
</div>
<div class="admonition- admonition">
<p class="admonition-title">読者ノート</p>
<p>これをきちんと説明するのは難しい。</p>
</div>
<hr class="docutils" />
<p>次の二つが追加：</p>
<ul class="simple">
<li><p><strong class="program">python</strong> に対する <code class="docutils literal notranslate"><span class="pre">-P</span></code> コマンドラインオプション</p></li>
<li><p>環境変数 <span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONSAFEPATH</span></code></p></li>
</ul>
<p>このオプションはスクリプトの実行時に次のディレクトリーを <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> に自動的に入れることを無効にする：</p>
<ul class="simple">
<li><p>スクリプトを実行する場合は現在ディレクトリー</p></li>
<li><p>オプション <code class="docutils literal notranslate"><span class="pre">-c</span></code> と <code class="docutils literal notranslate"><span class="pre">-m</span></code> を使用する場合は現在ディレクトリー</p></li>
</ul>
<hr class="docutils" />
<p>F-strings の <code class="docutils literal notranslate"><span class="pre">format_spec</span></code> にオプション <code class="docutils literal notranslate"><span class="pre">z</span></code> が加わった。これは書式精度で丸めた後、負のゼロを正のゼロとして表記する：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mf">.0001</span>
<span class="gp">&gt;&gt;&gt; </span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="go">&#39;-0.0001&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="go">&#39;-0.00&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">z.2f</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="go">&#39;0.00&#39;</span>
</pre></div>
</div>
</section>
<section id="new-modules">
<h2><a class="toc-backref" href="#id14" role="doc-backlink">New Modules</a><a class="headerlink" href="#new-modules" title="Link to this heading">¶</a></h2>
<p>モジュール <code class="docutils literal notranslate"><span class="pre">toml</span></code> は <a class="reference external" href="https://toml.io/">TOML</a> という言語を解析する機能群を備えている。JSON, YAML
のようなものらしいが、おそらく当分使わない気がする。</p>
</section>
<section id="improved-modules">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">Improved Modules</a><a class="headerlink" href="#improved-modules" title="Link to this heading">¶</a></h2>
<section id="contextlib">
<h3><a class="toc-backref" href="#id16" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">contextlib</span></code></a><a class="headerlink" href="#contextlib" title="Link to this heading">¶</a></h3>
<p>一連の処理を <code class="docutils literal notranslate"><span class="pre">with</span></code> ブロックに記述し、それを特定のディレクトリーで実行した後、ブロックを抜ければ作業ディレクトリーが自動的に復元したい場合に
<code class="docutils literal notranslate"><span class="pre">contextlib.chdir()</span></code> を用いるとよい。</p>
<p><code class="docutils literal notranslate"><span class="pre">contextlib.chdir()</span></code> は <code class="docutils literal notranslate"><span class="pre">os.chdir()</span></code> の単純な context manager ラッパーだ。平行実行安全では全くない。</p>
</section>
<section id="datetime">
<h3><a class="toc-backref" href="#id17" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">datetime</span></code></a><a class="headerlink" href="#datetime" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">datetime</span> <span class="pre">import</span> <span class="pre">UTC</span></code> と書けるようになった。<code class="docutils literal notranslate"><span class="pre">UTC</span></code> は <code class="docutils literal notranslate"><span class="pre">timezone.utc</span></code>
と同じものだ。</p>
<p><code class="docutils literal notranslate"><span class="pre">datetime.date</span></code>, <code class="docutils literal notranslate"><span class="pre">datetime.time</span></code>, <code class="docutils literal notranslate"><span class="pre">datetime.datetime</span></code> の
<code class="docutils literal notranslate"><span class="pre">fromisoformat()</span></code> が ISO 8601 書式の大部分を解釈するようになった。おそらく上記改善と関係がある。</p>
</section>
<section id="enum">
<h3><a class="toc-backref" href="#id18" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">enum</span></code></a><a class="headerlink" href="#enum" title="Link to this heading">¶</a></h3>
<div class="admonition- admonition">
<p class="admonition-title">読者ノート</p>
<p>良い復習になるので <a class="reference external" href="https://docs.python.org/3/howto/enum.html#enum-basic-tutorial">Enum HOWTO</a> を読め。</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">StrEnum</span></code> が追加。メンバー値を文字列で定義する列挙型だ。<code class="docutils literal notranslate"><span class="pre">ReprEnum</span></code> も追加されたが、前者をもっぱら使えばいい。おそらく、このことと関連して
<code class="docutils literal notranslate"><span class="pre">Enum.__format__()</span></code> が <code class="docutils literal notranslate"><span class="pre">Enum.__str__()</span></code> と同じ結果をが常に返すようになった。</p>
<p><code class="docutils literal notranslate"><span class="pre">Flag</span></code> で次が実現可能になった：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">len(MyFlag.MY_MEMBER)</span></code></p></li>
<li><p>反復処理 (e.g. <code class="docutils literal notranslate"><span class="pre">list(MyFlag)</span></code>)</p></li>
<li><p>メンバーに対する演算子 <code class="docutils literal notranslate"><span class="pre">in</span></code> および <code class="docutils literal notranslate"><span class="pre">not</span> <span class="pre">in</span></code> の作用</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">Flag</span></code> を変更し、複合値 (e.g. 3, 6, 10) は別名として扱う。正準とみなされるのは
2 のべき乗値しかないようになった。反転フラグは正の等価値に変換される。</p>
<div class="admonition- admonition">
<p class="admonition-title">読者ノート</p>
<p><code class="docutils literal notranslate"><span class="pre">Flag</span></code> に関する一連の記述は、実のところ意味がよくわからない。</p>
</div>
</section>
<section id="math">
<h3><a class="toc-backref" href="#id19" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">math</span></code></a><a class="headerlink" href="#math" title="Link to this heading">¶</a></h3>
<p>関数 <code class="docutils literal notranslate"><span class="pre">exp2()</span></code> と <code class="docutils literal notranslate"><span class="pre">cbrt()</span></code> の追加。C99 にそれぞれある対応物の仕様に準じるものと思われる。</p>
<p><code class="docutils literal notranslate"><span class="pre">math.pow()</span></code> のコーナーケースの動作が IEE754 仕様と整合するように変更：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
<span class="go">inf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
<span class="go">inf</span>
</pre></div>
</div>
</section>
<section id="operator">
<h3><a class="toc-backref" href="#id20" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">operator</span></code></a><a class="headerlink" href="#operator" title="Link to this heading">¶</a></h3>
<p>関数 <code class="docutils literal notranslate"><span class="pre">call</span></code> が追加。呼び出し <code class="docutils literal notranslate"><span class="pre">call(obj,</span> <span class="pre">*args,</span> <span class="pre">**kwargs)</span></code> は呼び出し
<code class="docutils literal notranslate"><span class="pre">obj(*args,</span> <span class="pre">**kwargs)</span></code> に等しい。</p>
<div class="admonition- admonition">
<p class="admonition-title">読者ノート</p>
<p>古の組み込み関数 <code class="docutils literal notranslate"><span class="pre">apply</span></code> とは微妙に異なる。</p>
</div>
</section>
<section id="pathlib">
<h3><a class="toc-backref" href="#id21" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">pathlib</span></code></a><a class="headerlink" href="#pathlib" title="Link to this heading">¶</a></h3>
<p>クラス <code class="docutils literal notranslate"><span class="pre">Path</span></code> のメソッド <code class="docutils literal notranslate"><span class="pre">.glob()</span></code> および <code class="docutils literal notranslate"><span class="pre">.rglob()</span></code> は第一引数がパス名部品の区切り文字、つまり <code class="docutils literal notranslate"><span class="pre">os.sep</span></code> や <code class="docutils literal notranslate"><span class="pre">os.altsep</span></code> で終わっている場合、ディレクトリーのみを返す。</p>
<div class="admonition- admonition">
<p class="admonition-title">利用者ノート</p>
<p>Bash で言うところの <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">*</span></code> と <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">*/</span></code> の違いのようなものだろう。</p>
</div>
</section>
<section id="re">
<h3><a class="toc-backref" href="#id22" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">re</span></code></a><a class="headerlink" href="#re" title="Link to this heading">¶</a></h3>
<p>正規表現で原子グループ <code class="docutils literal notranslate"><span class="pre">(?&gt;...)</span></code> と所有量化子 <code class="docutils literal notranslate"><span class="pre">*+</span></code>, <code class="docutils literal notranslate"><span class="pre">++</span></code>, <code class="docutils literal notranslate"><span class="pre">?+</span></code>,
<code class="docutils literal notranslate"><span class="pre">{m,n}+</span></code> が使えるようになった。検索が失敗する場合に効率が上がることが期待できる。</p>
<p>原子グループの例を示す。正規表現は <a class="reference external" href="https://www.regular-expressions.info/atomic.html">Regex Tutorial - Atomic Grouping</a> より引用した：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;Consider the regex \b(integer|insert|in)\b and the subject integers. Obviously, because</span>
<span class="go">...: of the word boundaries, these don&#39;t match. What&#39;s not so obvious is that the regex engine will</span>
<span class="go">...: spend quite some effort figuring this out.&#39;&#39;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">re.findall(r&#39;\b(integer|insert|in)\b&#39;, s)</span>
<span class="go">[&#39;integer&#39;, &#39;insert&#39;, &#39;in&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">re.findall(r&#39;\b(integer|insert|in)\b&#39;, s)</span>
<span class="go">[&#39;integer&#39;, &#39;insert&#39;, &#39;in&#39;]</span>
</pre></div>
</div>
<p>所有量化子の例を示す。正規表現は <a class="reference external" href="https://www.regular-expressions.info/possessive.html">Regex Tutorial - Possessive Quantifiers</a> から引用した：</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&quot;[^&quot;]*&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;abc&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&quot;[^&quot;]*+&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;abc&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>《基本的には、<code class="samp docutils literal notranslate"><em><span class="pre">X</span></em><span class="pre">*+</span></code> の代わりに <code class="samp docutils literal notranslate"><span class="pre">(?&gt;</span><em><span class="pre">X</span></em><span class="pre">*)</span></code> と書く》そうだ。</p>
</section>
<section id="shutil">
<h3><a class="toc-backref" href="#id23" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">shutil</span></code></a><a class="headerlink" href="#shutil" title="Link to this heading">¶</a></h3>
<p>関数 <code class="docutils literal notranslate"><span class="pre">rmtree()</span></code> にオプション引数 <code class="docutils literal notranslate"><span class="pre">dir_fd</span></code> が追加。ファイル記述子を与える。ファイル記述子を与えると、この関数は第一引数であるパスを <code class="docutils literal notranslate"><span class="pre">dir_fd</span></code> からの相対パスであると解釈する。</p>
<div class="admonition- admonition">
<p class="admonition-title">読者ノート</p>
<p>これだけ読んでも何のことがわからぬならば <code class="docutils literal notranslate"><span class="pre">os.supports_dir_fd</span></code> と
<code class="docutils literal notranslate"><span class="pre">os.rmdir</span></code> を調べるといい。</p>
</div>
</section>
<section id="string">
<h3><a class="toc-backref" href="#id24" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">string</span></code></a><a class="headerlink" href="#string" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Template</span></code> に <code class="docutils literal notranslate"><span class="pre">get_identifiers()</span></code> と <code class="docutils literal notranslate"><span class="pre">is_valid()</span></code> が追加。それぞれは有効なプレースホルダー（「ここに◯◯を入れる」ことを示すもの）すべてと、無効なプレースホルダーがあるか否かを返す。</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">Template</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s1">&#39;$</span><span class="si">{who}</span><span class="s1"> liles $</span><span class="si">{what}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get_identifiers</span><span class="p">()</span>
<span class="go">[&#39;who&#39;, &#39;what&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s1">&#39;Give $</span><span class="si">{who}</span><span class="s1"> $100&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>
<span class="go">False</span>
</pre></div>
</div>
</section>
<section id="sys">
<h3><a class="toc-backref" href="#id25" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">sys</span></code></a><a class="headerlink" href="#sys" title="Link to this heading">¶</a></h3>
<p>関数 <code class="docutils literal notranslate"><span class="pre">exc_info()</span></code> は、例外 <code class="docutils literal notranslate"><span class="pre">e</span></code> が現在処理されているとすると、
<code class="docutils literal notranslate"><span class="pre">(type(e),</span> <span class="pre">e,</span> <span class="pre">e.__traceback__)</span></code> を返す。つまり、次の三点を知ることができる：</p>
<ul class="simple">
<li><p>例外型</p></li>
<li><p>例外オブジェクト自身</p></li>
<li><p>例外が最後に発生した時点でのコールスタック</p></li>
</ul>
<p>関数 <code class="docutils literal notranslate"><span class="pre">exception()</span></code> が追加。<code class="docutils literal notranslate"><span class="pre">sys.exc_info()[1]</span></code> を返す。</p>
</section>
<section id="timer">
<h3><a class="toc-backref" href="#id26" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">timer</span></code></a><a class="headerlink" href="#timer" title="Link to this heading">¶</a></h3>
<p>関数 <code class="docutils literal notranslate"><span class="pre">sleep()</span></code> が UNIX では <code class="docutils literal notranslate"><span class="pre">clock_nanosleep()</span></code> または <code class="docutils literal notranslate"><span class="pre">nanosleep()</span></code> を利用可能ならば用いるようになった。Windows では <span class="math notranslate nohighlight">\(10^{-7}\)</span> 秒の分解能を有するタイマーを用いるようになった。</p>
</section>
<section id="typing">
<h3><a class="toc-backref" href="#id27" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">typing</span></code></a><a class="headerlink" href="#typing" title="Link to this heading">¶</a></h3>
<p>先述の型ヒントにまつわる機能以外にも新機能がある。</p>
<div class="admonition-todo admonition" id="id2">
<p class="admonition-title">Todo</p>
<p>型ヒントの仕組みに慣れたらここを埋める。</p>
</div>
</section>
<section id="unicodedata">
<h3><a class="toc-backref" href="#id28" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">unicodedata</span></code></a><a class="headerlink" href="#unicodedata" title="Link to this heading">¶</a></h3>
<p>Unicode データベースがバージョン 14.0.0 に更新した。</p>
<div class="admonition- admonition">
<p class="admonition-title">読者ノート</p>
<p>個人的には使いたい文字がないので軽視する。</p>
</div>
</section>
</section>
<section id="optimizations">
<h2><a class="toc-backref" href="#id29" role="doc-backlink">Optimizations</a><a class="headerlink" href="#optimizations" title="Link to this heading">¶</a></h2>
<p>ここは一般プログラマーには重要ではないかもしれない。ほとんどチェックしていない。</p>
</section>
<section id="deprecated">
<h2><a class="toc-backref" href="#id30" role="doc-backlink">Deprecated</a><a class="headerlink" href="#deprecated" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">&#64;classmethod</span></code> を連結すること。他の記述子 (e.g. <code class="docutils literal notranslate"><span class="pre">property</span></code>) をラップするために使用できなくなった。</p>
<p><code class="docutils literal notranslate"><span class="pre">0o377</span></code> より大きな値を持つ <code class="docutils literal notranslate"><span class="pre">str</span></code> リテラルおよび <code class="docutils literal notranslate"><span class="pre">bytes</span></code> リテラルでの八進数エスケープは <code class="docutils literal notranslate"><span class="pre">DeprecationWarning</span></code> を送出するようになった。</p>
<p>パッケージ <code class="docutils literal notranslate"><span class="pre">lib2to3</span></code> および <strong class="program">2to3</strong> ツール。Python 3.10 以降を解析できないことがある。</p>
<p><code class="docutils literal notranslate"><span class="pre">locale.getdefaultlocale()</span></code> 関数。代えて：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">locale.setlocale()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">locale.getpreferredencoding(False)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">locale.getlocale()</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">locale.resetlocale()</span></code> 関数。代えて <code class="docutils literal notranslate"><span class="pre">locale.setlocale(locale.LC_ALL,</span> <span class="pre">&quot;&quot;)</span></code> を使え。</p>
</section>
<section id="removed">
<h2><a class="toc-backref" href="#id31" role="doc-backlink">Removed</a><a class="headerlink" href="#removed" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">asyncio.coroutine()</span></code> デコレーターが削除。ジェネレータベースのコルーチンは
<code class="docutils literal notranslate"><span class="pre">async</span></code>/<code class="docutils literal notranslate"><span class="pre">await</span></code> コードと互換。代わりに <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">def</span></code> を使え。</p>
</section>
<section id="porting-to-python-3-11">
<h2><a class="toc-backref" href="#id32" role="doc-backlink">Porting to Python 3.11</a><a class="headerlink" href="#porting-to-python-3-11" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">random.shuffle()</span></code> の <code class="docutils literal notranslate"><span class="pre">random</span></code> オプション引数が削除。以前はシャッフルに使用するランダム関数は任意に指定可能だったが、現在は <code class="docutils literal notranslate"><span class="pre">random.random()</span></code> が常に用いられる。</p>
<p><code class="docutils literal notranslate"><span class="pre">re</span></code> 正規表現構文において、グローバルインラインフラグ (e.g. <code class="docutils literal notranslate"><span class="pre">(?i)</span></code>) は正規表現の先頭以外での使用は咎められる。</p>
<p><code class="docutils literal notranslate"><span class="pre">re</span></code> モジュールでは、いくつかの長年のバグが修正され、まれに捕捉グループが誤ったものになることがあった。そのため、これらの場合には捕捉の出力が変わることがある。</p>
</section>
</section>


          </div>
    <div class="related bottom">
      &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="python-3.10.html" title="Previous">What’s New In Python 3.10 ノート</a>
        </li>
      
        <li>
          <a href="python-3.12.html" title="Next">What’s New In Python 3.12 ノート</a>
          &rarr;
        </li>
    </ul>
  </nav>
    </div>

      </div>
      <div class="clearer"></div>
    </div>
<div class="footer">
  <ul>
    <li id="footer_logo">
      <a class="image-reference" href="index.html" title="読書ノート Home"><img src="_images/logo.svg"/></a>
    </li>
    <li id="footer_copyright">
      Copyright &copy; 1999-2024, プレハブ小屋 All rights reserved.
    </li>
  </ul>
</div>
  </body>
</html>