======================================================================
トポロジカルソート
======================================================================
本稿では NetworkX_ の提供する機能を利用して、有向グラフのトポロジカルソートを実行する方法について述べる。
NetworkX_ でトポロジカルソートを実現する関数は
``nx.topological_sort`` と ``nx.topological_sort_recursive`` である。
まずは前者を見ていく。

.. contents::

先にグラフ概形とサンプルコード全体を示す。

.. image:: /_static/networkx-dag.png
   :alt: Public Domain
   :scale: 100%
   :target: http://commons.wikimedia.org/wiki/File:Directed_acyclic_graph_3.svg

.. literalinclude:: ../../sample/networkx/tsort.py
   :language: python3

基本事項
----------------------------------------------------------------------
グラフがトポロジカルソートを適用できる条件は、グラフが有向かつ閉路がないことが条件となる。
つまり、グラフが DAG であることが条件である。
NetworkX_ では関数 ``nx.is_directed_acyclic_graph`` でグラフが DAG であるか否かをテストできる。
そして実は DAG 性の判定はトポロジカルソートで実装されている。

そして、トポロジカルソートで少々注意を要するのは、一般的にはその結果が一意に決まらないということだろうか。
サンプルコードは Wikipedia_ で DAG を論じるときによく参照されるグラフを拝借した。
ページ中程に複数のソート結果が紹介されている。

関数 ``print_sort`` では関数 ``nx.topological_sort`` を呼び出し、実行結果を標準出力に書き出す。
結果はこのようになった。見事に Wikipedia_ のどのソート結果とも異なる順列が得られた。

.. code-block:: text

   [7, 5, 11, 3, 8, 9, 10, 2]

しかし、これもまたトポロジカルソートの要件を満たしていることが容易に確認できる。
ちなみに図のグラフのノードにわざわざ私が色を塗ったのは、色の明るいノードの順に得られるのでは、
という予想だった。そしてそれは見事に外れたようだ。

再帰版トポロジカルソート
----------------------------------------------------------------------
NetworkX_ におけるもう一つのトポロジカルソートの実装である。
DFS 法を再帰的に呼び出す方式によるものだ。

試しに先のグラフに recursive 版を適用してみると、異なるソート結果が得られた。
繰り返しになるが、トポロジカルソートの結果は一意に定まらないことは普通にあるので、
この違いは気にするようなものではない。

::

   >>> nx.topological_sort_recursive(G)
   [7, 5, 11, 3, 10, 8, 9, 2]

ちなみに先に紹介した ``nx.topological_sort`` の実装はスキーナ本（邦訳：『アルゴリズム実装マニュアル』）から取ってきているらしい。

キーワード引数
----------------------------------------------------------------------
NetworkX_ のマニュアルに仕様の説明は当然あるが、紙幅が余ったので記す。
両トポロジカルソート関数に共通するキーワード引数を説明する。

これらのキーワード引数を明示的に指示しない場合、
いずれの関数もグラフ全体に対してノードを preorder にトポロジカルソートする。

``nbunch=None``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
キーワード引数 ``nbunch`` で、グラフを走査するノード範囲（表現が微妙だが）を指定することができる。
例えば本稿の例で仮にノード ``3`` の descendants だけのトポロジカルソートが欲しいのであれば、
次のようにする。
::

   >>> nx.topological_sort(G, nbunch=(3,))
   [3, 8, 9, 10]

``reverse=False``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
キーワード引数 ``reverse`` を ``True`` にすると、逆順 (postorder) の結果が得られる。
結果紹介は省略。

.. _NetworkX: https://networkx.github.io/
.. _Wikipedia: http://en.wikipedia.org/wiki/Topological_sorting
