<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Amazon DynamoDB 利用ノート &#8212; 読書ノート 1.6dev documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=1a9a5cd9" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=5a6f99c4"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/mermaid.js?v=578dbed1"></script>
    <link rel="next" title="バックアップ＆復旧ノート" href="../backup-restore.html" />
    <link rel="prev" title="Neo4j 利用ノート" href="neo4j.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
    <div class="related top">
      &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="neo4j.html" title="Previous">Neo4j 利用ノート</a>
        </li>
      
        <li>
          <a href="../backup-restore.html" title="Next">バックアップ＆復旧ノート</a>
          &rarr;
        </li>
    </ul>
  </nav>
    </div>


          <div class="body" role="main">
            
  <section id="amazon-dynamodb">
<h1>Amazon DynamoDB 利用ノート<a class="headerlink" href="#amazon-dynamodb" title="Permalink to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Since<span class="colon">:</span></dt>
<dd class="field-odd"><p>2012</p>
</dd>
<dt class="field-even">Official site<span class="colon">:</span></dt>
<dd class="field-even"><p>&lt;<a class="reference external" href="https://aws.amazon.com/dynamodb/">https://aws.amazon.com/dynamodb/</a>&gt;</p>
</dd>
<dt class="field-odd">CLI<span class="colon">:</span></dt>
<dd class="field-odd"><p>AWS Command Line Interface (AWS CLI); <strong class="command">aws</strong></p>
</dd>
</dl>
<p>まずは <a class="reference external" href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/">開発者向け文書</a> にざっと目を通しておけ。</p>
<p>インストール手順は次のようなものだ。あらかじめ適当なディレクトリーに移動しておくこと：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>curl<span class="w"> </span>-O<span class="w"> </span>https://d1ni2b6xgvw0s0.cloudfront.net/v2.x/dynamodb_local_latest.tar.gz
<span class="gp">$ </span>tar<span class="w"> </span>xvzf<span class="w"> </span>dynamodb_local_latest.tar.gz<span class="w"> </span>--one-top-level<span class="w"> </span>dynamodb
</pre></div>
</div>
<p>サービス稼動方法はこう：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>dynamodb
<span class="gp">$ </span>java<span class="w"> </span>-D<span class="s2">&quot;java.library.path=./DynamoDBLocal_lib&quot;</span><span class="w"> </span>-jar<span class="w"> </span>DynamoDBLocal.jar<span class="w"> </span>-sharedDb
<span class="go">Initializing DynamoDB Local with the following configuration:</span>
<span class="go">Port:   8000</span>
<span class="go">InMemory:       false</span>
<span class="go">DbPath: null</span>
<span class="go">SharedDb:       true</span>
<span class="go">shouldDelayTransientStatuses:   false</span>
<span class="go">CorsParams:     null</span>
</pre></div>
</div>
<p>こうして起動した場合は停止手順は <kbd class="kbd docutils literal notranslate">Ctrl</kbd> + <kbd class="kbd docutils literal notranslate">C</kbd> で良い。</p>
<p>実はまだサービスを稼動する条件が整っていない。並行して AWS Command Line
Interface (AWS CLI) をインストールする：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>curl<span class="w"> </span><span class="s2">&quot;https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip&quot;</span><span class="w"> </span>-o<span class="w"> </span><span class="s2">&quot;awscliv2.zip&quot;</span>
<span class="gp">$ </span>unzip<span class="w"> </span>awscliv2.zip
<span class="gp">$ </span>sudo<span class="w"> </span>./aws/install
<span class="gp">$ </span>aws<span class="w"> </span>--version
<span class="go">aws-cli/2.14.5 Python/3.11.6 Linux/5.15.133.1-microsoft-standard-WSL2 exe/x86_64.ubuntu.22 prompt/off</span>
<span class="gp">$ </span>aws<span class="w"> </span>configure
<span class="go">AWS Access Key ID [None]: fakeMyKeyId</span>
<span class="go">AWS Secret Access Key [None]: fakeSecretAccessKey</span>
<span class="go">Default region name [None]: ap-northeast-1</span>
<span class="go">Default output format [None]: json</span>
<span class="gp">$ </span>aws<span class="w"> </span>dynamodb<span class="w"> </span>list-tables<span class="w"> </span>--endpoint-url<span class="w"> </span>http://localhost:8000
<span class="go">{</span>
<span class="go">    &quot;TableNames&quot;: []</span>
<span class="go">}</span>
</pre></div>
</div>
<p>ここまで上手く行ったら Developer Guide Getting started with DynamoDB に記載されている <code class="docutils literal notranslate"><span class="pre">aws</span> <span class="pre">dynamodb</span></code> から始まるコマンドを試す。ダウンロード版 DynamoDB を利用するため、掲載されているコマンドのすべてに対してオプション <code class="docutils literal notranslate"><span class="pre">--endpoint-url</span>
<span class="pre">http://localhost:8000</span></code> を追加的に指定する必要が本来ある。ここで、その代わりとなる環境変数を設定する：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">export</span><span class="w"> </span><span class="nv">AWS_ENDPOINT_URL</span><span class="o">=</span>http://localhost:8000
</pre></div>
</div>
<p>Get started の章で試せるコマンド群を列挙しておく。<cite>先頭の `aws dynamodb`</cite> は省略する：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">create-table</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">describe-table</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update-continuous-backups</span></code>: UnknownOperationException</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">put-item</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get-item</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update-item</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update-table</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">query</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delete-table</span></code></p></li>
</ul>
<p>操作によっては <code class="docutils literal notranslate"><span class="pre">execute-statement</span></code> コマンドを実行する別解もある。例えば</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>aws<span class="w"> </span>dynamodb<span class="w"> </span>query<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--table-name<span class="w"> </span>Music<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--key-condition-expression<span class="w"> </span><span class="s2">&quot;Artist = :name&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--expression-attribute-values<span class="w"> </span><span class="s1">&#39;{&quot;:name&quot;:{&quot;S&quot;:&quot;Acme Band&quot;}}&#39;</span>
</pre></div>
</div>
<p>は次のコマンド実行でも同じ出力を得る：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>aws<span class="w"> </span>dynamodb<span class="w"> </span>execute-statement<span class="w"> </span>--statement<span class="w"> </span><span class="s2">&quot;SELECT * FROM Music</span>
<span class="go">  WHERE Artist=&#39;Acme Band&#39;&quot;</span>
</pre></div>
</div>
<div class="admonition- admonition">
<p class="admonition-title">読者ノート</p>
<p>チュートリアルの最後がテーブル削除であるのが素晴らしい。データベースがチュートリアル開始直前と同じ状態に戻して終了することを意味するのだから。</p>
</div>
<p>Getting started with DynamoDB and the AWS SDKs の実習は Python からやりたい。文書にあるように GitHub リポジトリーを丸ごと clone してもよいが、要所を示すために必要最低限のファイルを手作業でダウンロード、環境構築、デモ実施をする手順の概略を次に示す：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>mkdir<span class="w"> </span>-p<span class="w"> </span>sandbox-dynamodb/python/GettingStarted
<span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>sandbox-dynamodb/python
<span class="gp">$ </span><span class="nv">AWSDOCS_URL</span><span class="o">=</span>https://raw.githubusercontent.com/awsdocs/aws-doc-sdk-examples/main/python/example_code/dynamodb
<span class="gp">$ </span>curl<span class="w"> </span>-O<span class="w"> </span><span class="si">${</span><span class="nv">AWSDOCS_URL</span><span class="si">}</span>/README.md
<span class="gp">$ </span>curl<span class="w"> </span>-O<span class="w"> </span><span class="si">${</span><span class="nv">AWSDOCS_URL</span><span class="si">}</span>/requirements.txt
<span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>GettingStarted
<span class="gp">$ </span>curl<span class="w"> </span>-O<span class="w"> </span><span class="si">${</span><span class="nv">AWSDOCS_URL</span><span class="si">}</span>/GettingStarted/scenario_getting_started_movies.py
<span class="gp">$ </span>curl<span class="w"> </span>-O<span class="w"> </span><span class="si">${</span><span class="nv">AWSDOCS_URL</span><span class="si">}</span>/GettingStarted/question.py
<span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>..
<span class="gp">$ </span>python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>.venv
<span class="gp">$ </span><span class="nb">source</span><span class="w"> </span>.venv/bin/activate
<span class="gp">$ </span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
<span class="gp">$ </span>python<span class="w"> </span>GettingStarted/scenario_getting_started_movies.py
<span class="gp">$ </span>deactivate
</pre></div>
</div>
<p>これで対話的なアプリケーションが開始する。README をよく読まなくても、Python コードで DynamoDB にアクセスできていることが納得できる。</p>
</section>


          </div>
    <div class="related bottom">
      &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="neo4j.html" title="Previous">Neo4j 利用ノート</a>
        </li>
      
        <li>
          <a href="../backup-restore.html" title="Next">バックアップ＆復旧ノート</a>
          &rarr;
        </li>
    </ul>
  </nav>
    </div>

      </div>
      <div class="clearer"></div>
    </div>
<div class="footer">
  <ul>
    <li id="footer_logo">
      <a class="image-reference" href="../index.html" title="読書ノート Home"><img src="../_images/logo.svg"/></a>
    </li>
    <li id="footer_copyright">
      Copyright &copy; 1999-2024, プレハブ小屋 All rights reserved.
    </li>
  </ul>
</div>
  </body>
</html>