<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>ffprobe ノート &#8212; 読書ノート 1.6dev documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=1a9a5cd9" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=5a6f99c4"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/mermaid.js?v=578dbed1"></script>
    <link rel="next" title="ffplay ノート" href="ffplay.html" />
    <link rel="prev" title="準備編" href="basic.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="basic.html" title="Previous document">準備編</a>
        </li>
        <li>
          <a href="ffplay.html" title="Next document"><strong class="program">ffplay</strong> ノート</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <section id="ffprobe">
<h1><a class="toc-backref" href="#id10" role="doc-backlink"><strong class="program">ffprobe</strong> ノート</a><a class="headerlink" href="#ffprobe" title="Permalink to this heading">¶</a></h1>
<p><strong class="program">ffprobe</strong> は MP4 ファイルなどから情報を収集し、何らかのテキスト形式で出力する。例えば、使用されているコンテナーの形式や、その中に含まれる各メディアストリームの属性を確認するといった用途に向いている。</p>
<p><strong class="program">ffprobe</strong> は、スタンドアロンアプリケーションとして、またはテキストフィルターと組み合わせて、より高度な処理、例えば統計処理やプロットを行うというような用途に便利だ。コマンドの構文は次のように単純なものだ：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bash$ ffprobe [options] input_url</span>
</pre></div>
</div>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#ffprobe" id="id10"><strong class="program">ffprobe</strong> ノート</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id11">例：フレーム数を得る</a></p></li>
<li><p><a class="reference internal" href="#id2" id="id12">ファイルの構成を把握する</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id13">セクションエントリーを出力する</a></p></li>
<li><p><a class="reference internal" href="#id4" id="id14">ファイル要素の情報を得る</a></p>
<ul>
<li><p><a class="reference internal" href="#id5" id="id15">ストリーム情報を得る</a></p></li>
<li><p><a class="reference internal" href="#id6" id="id16">コンテナー形式を得る</a></p></li>
<li><p><a class="reference internal" href="#id7" id="id17">パケット情報を得る</a></p></li>
<li><p><a class="reference internal" href="#id8" id="id18">フレームまたは字幕情報を得る</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id9" id="id19">出力書式を指定する</a></p>
<ul>
<li><p><a class="reference internal" href="#default" id="id20"><code class="docutils literal notranslate"><span class="pre">default</span></code></a></p></li>
<li><p><a class="reference internal" href="#csv" id="id21"><code class="docutils literal notranslate"><span class="pre">csv</span></code></a></p></li>
<li><p><a class="reference internal" href="#flat" id="id22"><code class="docutils literal notranslate"><span class="pre">flat</span></code></a></p></li>
<li><p><a class="reference internal" href="#json" id="id23"><code class="docutils literal notranslate"><span class="pre">json</span></code></a></p></li>
<li><p><a class="reference internal" href="#xml" id="id24"><code class="docutils literal notranslate"><span class="pre">xml</span></code></a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<section id="id1">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">例：フレーム数を得る</a><a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h2>
<p>簡単かつ一般的な例を挙げて、重要なコマンドラインオプションのいくつかを習得する。例えば、ビデオのフレーム数を得るには次のコマンドを実行するのだが、長くて覚えられない：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bash$ ffprobe \</span>
<span class="go">  -select_streams v:0</span>
<span class="go">  -count_frames \</span>
<span class="go">  -show_entries stream=nb_read_frames \</span>
<span class="go">  -print_format csv \</span>
<span class="go">  input.mp4</span>
</pre></div>
</div>
<p>オプション <code class="docutils literal notranslate"><span class="pre">-select_streams</span> <span class="pre">STREAM_SPEC</span></code> を用いると、指定ストリームしか選択しない。ストリームに関連するオプションにしか影響しない（後で述べる）。この例ではストリーム指定が <code class="docutils literal notranslate"><span class="pre">v:0</span></code> であるので、映像 0 のみを選択する。忘れぬうちに述べておくと FFmpeg では序数を 0 から開始する。</p>
<p>オプション <code class="docutils literal notranslate"><span class="pre">-count_frames</span></code> はストリームごとにフレーム数を勘定し、対応するストリームセクション (<code class="docutils literal notranslate"><span class="pre">nb_read_frames</span></code>) に報告するものだ。この例ではストリーム指定が <code class="docutils literal notranslate"><span class="pre">v:0</span></code> なので、映像 0 のフレーム数しか報告しない。</p>
<p>オプション <code class="docutils literal notranslate"><span class="pre">-show_entries</span> <span class="pre">SECTION_ENTRIES</span></code> はエントリーのリストを指定してそれらの情報を出力する。セクション名を指定し、その後に <code class="docutils literal notranslate"><span class="pre">=</span></code> を付けない場合、含まれるすべてのセクションとともにエントリーすべてが出力される。この例では
<code class="docutils literal notranslate"><span class="pre">stream=nb_read_frames</span></code> なので、対応ストリーム <code class="docutils literal notranslate"><span class="pre">v:0</span></code> 全体ではなく、その
<code class="docutils literal notranslate"><span class="pre">nb_read_frames</span></code> だけが出力される。このオプションについては後ほど詳述する。</p>
<p>オプション <code class="docutils literal notranslate"><span class="pre">-print_format</span> <span class="pre">WRITER</span></code> については後述。この例では <code class="docutils literal notranslate"><span class="pre">csv</span></code> なので
CSV 形式のテキストが出力される。</p>
</section>
<section id="id2">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">ファイルの構成を把握する</a><a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h2>
<p><strong class="program">ffprobe</strong> の出力するセクションの構造および情報を出力する。実行結果を一度は見ておくことを強く勧める。後ほど述べる <code class="docutils literal notranslate"><span class="pre">-show</span></code> 系オプション各種の意味を把握しやすくなる。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ffprobe -show_sections input.mp4</span>
</pre></div>
</div>
</section>
<section id="id3">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">セクションエントリーを出力する</a><a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h2>
<p>先述のように、オプション <code class="docutils literal notranslate"><span class="pre">-show_entries</span> <span class="pre">SECTION_ENTRIES</span></code> を指定する。
<code class="docutils literal notranslate"><span class="pre">SECTION_ENTRIES</span></code> はセクションエントリーの一覧をコロンで区切った文字列を指定する。セクションエントリーそれぞれは、セクション名と、オプションでそのセクションにローカルなエントリーのリストがカンマ <code class="docutils literal notranslate"><span class="pre">,</span></code> で区切られた形で続く。例えば
<code class="docutils literal notranslate"><span class="pre">width,height</span></code> など。セクション名を指定し、その後に <code class="docutils literal notranslate"><span class="pre">=</span></code> を付けない場合、含まれるすべてのセクションとともにエントリーすべてが出力される。</p>
<p>例コマンドをいくつか挙げる：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bash$ ffprobe -of flat -select_streams v:0 -show_entries stream=width,height input.mp4</span>
<span class="go">bash$ ffprobe -of default=nw=1 -select_streams v:0 -show_entries packet=pts_time input.mp4 | head</span>
<span class="go">bash$ ffprobe -show_entries stream=duration input.mp4</span>
<span class="go">bash$ ffprobe -select_streams v:0 -show_entries frame=pict_type input.mp4 | head</span>
<span class="go">bash$ ffprobe -select_streams v:0 -show_entries stream=bit_rate input.mp4</span>
<span class="go">bash$ ffprobe -select_streams v:0 -show_entries stream=codec_name,codec_long_name,profile,codec_tag_string input.mp4</span>
<span class="go">bash$ ffprobe -select_streams v:0 -show_entries stream=pix_fmt input.mp4</span>
</pre></div>
</div>
</section>
<section id="id4">
<h2><a class="toc-backref" href="#id14" role="doc-backlink">ファイル要素の情報を得る</a><a class="headerlink" href="#id4" title="Permalink to this heading">¶</a></h2>
<p>次の四オプションについて記す：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-show_streams</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-show_format</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-show_packets</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-show_frames</span></code></p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bash$ ffprobe -show_streams input.mp4</span>
<span class="go">bash$ ffprobe -show_format input.mp4</span>
<span class="go">bash$ ffprobe -show_packets input.mp4</span>
<span class="go">bash$ ffprobe -show_frames input.mp4</span>
</pre></div>
</div>
<section id="id5">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">ストリーム情報を得る</a><a class="headerlink" href="#id5" title="Permalink to this heading">¶</a></h3>
<p>オプション <code class="docutils literal notranslate"><span class="pre">-show_streams</span></code> は入力に含まれるストリームの情報を出力する。オプション <code class="docutils literal notranslate"><span class="pre">-print_format</span></code> の値にもよるが、ストリーム情報は出力の <code class="docutils literal notranslate"><span class="pre">STREAMS</span></code> というセクションに含まれる。例えば JSON 形式で出力すると、次のような構造のテキストが出力される（キー名は小文字になる）：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{
    &quot;streams&quot;: [
        {
            ...
        },
        ...
    ]
}
</pre></div>
</div>
<p>映像ストリームと音声ストリームとで構成が異なるので、詳しくは手許の適当なビデオファイルで確認するといい。</p>
</section>
<section id="id6">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">コンテナー形式を得る</a><a class="headerlink" href="#id6" title="Permalink to this heading">¶</a></h3>
<p>オプション <code class="docutils literal notranslate"><span class="pre">-show_format</span></code> は入力のコンテナー形式に関する情報を表示する。各属性はセクション <code class="docutils literal notranslate"><span class="pre">FORMAT</span></code> に先のオプションと同様に含まれる。この出力で確認できる有用そうな属性を挙げておく：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">filename</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nb_streams</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">format_name</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">format_long_name</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">start_time</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">duration</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">size</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bit_rate</span></code></p></li>
</ul>
</section>
<section id="id7">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">パケット情報を得る</a><a class="headerlink" href="#id7" title="Permalink to this heading">¶</a></h3>
<p>オプション <code class="docutils literal notranslate"><span class="pre">-show_packets</span></code> は入力が含むパケットに関する情報を表示する。例によって各パケットの情報は <code class="docutils literal notranslate"><span class="pre">PACKET</span></code> という名前を持つ専用のセクションにある。</p>
<p>パケットというのは、音声や映像のデータの送受信単位だと考えられる。各パケットにはファイルの小さな断片が含まれている。プレイヤーはこのパケットの流れを受け取り、映像や音声に変換して再生する。</p>
</section>
<section id="id8">
<h3><a class="toc-backref" href="#id18" role="doc-backlink">フレームまたは字幕情報を得る</a><a class="headerlink" href="#id8" title="Permalink to this heading">¶</a></h3>
<p>オプション <code class="docutils literal notranslate"><span class="pre">-show_frames</span></code> は入力が含む各フレームおよび字幕の情報を表示する。例によって各フレームの情報は <code class="docutils literal notranslate"><span class="pre">FRAME</span></code> または <cite>SUBTITLE``</cite> という名称の専用セクションにある。</p>
<p>フレームには <code class="docutils literal notranslate"><span class="pre">media_type</span></code> という属性があり、この値によって構成が異なる。例：<code class="docutils literal notranslate"><span class="pre">video</span></code> には <code class="docutils literal notranslate"><span class="pre">width</span></code>, <code class="docutils literal notranslate"><span class="pre">height</span></code> があるが、<code class="docutils literal notranslate"><span class="pre">audio</span></code> にはない。</p>
</section>
</section>
<section id="id9">
<h2><a class="toc-backref" href="#id19" role="doc-backlink">出力書式を指定する</a><a class="headerlink" href="#id9" title="Permalink to this heading">¶</a></h2>
<p><strong class="program">ffprobe</strong> のオプション <code class="docutils literal notranslate"><span class="pre">-print_format</span></code> a.k.a. <code class="docutils literal notranslate"><span class="pre">-of</span></code> の引数
<code class="docutils literal notranslate"><span class="pre">WRITER</span></code> について記す。</p>
<p><code class="docutils literal notranslate"><span class="pre">WRITER</span></code> には <strong class="program">ffprobe</strong> が対応する出力書式を与える。さらに、<code class="docutils literal notranslate"><span class="pre">WRITER</span></code>
は採用するオプションを指定する一つ以上の引数を受け取ることができる。オプションはコロンで区切られた <code class="docutils literal notranslate"><span class="pre">key=value</span></code> のペアのリストとして与えるものとする。</p>
<p>また、各書式オプションにはさらにオプションが用意されているものがある。有効な <code class="docutils literal notranslate"><span class="pre">WRITER</span></code> のうち、よく用いられるものを次に挙げる：</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Writer</p></th>
<th class="head"><p>Format</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">default</span></code></p></td>
<td><p>既定の書式</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">csv</span></code></p></td>
<td><p>CSV</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">flat</span></code></p></td>
<td><p>プレーンテキスト</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">xml</span></code></p></td>
<td><p>XML</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">json</span></code></p></td>
<td><p>JSON</p></td>
</tr>
</tbody>
</table>
<section id="default">
<h3><a class="toc-backref" href="#id20" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">default</span></code></a><a class="headerlink" href="#default" title="Permalink to this heading">¶</a></h3>
<p>書式 <code class="docutils literal notranslate"><span class="pre">default</span></code> は次のような出力をする：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[SECTION]
key1=val1
...
keyN=valN
[/SECTION]
</pre></div>
</div>
<p>次のオプションがあり、どれも利用価値がある。既定値は <code class="docutils literal notranslate"><span class="pre">0</span></code> なので出力が長くなる。</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">nokey</span></code>, <code class="docutils literal notranslate"><span class="pre">nk</span></code></dt><dd><p><code class="docutils literal notranslate"><span class="pre">1</span></code> を指定すると、フィールドのキー部分を出力しないようになる。</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[SECTION]
val1
...
valN
[/SECTION]
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">noprint_wrappers</span></code>, <code class="docutils literal notranslate"><span class="pre">nw</span></code></dt><dd><p><code class="docutils literal notranslate"><span class="pre">1</span></code> を指定すると、セクションタグを出力しないようになる。</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>key1=val1
...
keyN=valN
</pre></div>
</div>
</dd>
</dl>
</section>
<section id="csv">
<h3><a class="toc-backref" href="#id21" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">csv</span></code></a><a class="headerlink" href="#csv" title="Permalink to this heading">¶</a></h3>
<p>既定では、書式 <code class="docutils literal notranslate"><span class="pre">csv</span></code> は次のような出力を生じる：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>section,val1, ... ,valN
</pre></div>
</div>
<p>次のオプションがある：</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">item_sep</span></code>, <code class="docutils literal notranslate"><span class="pre">s</span></code></dt><dd><p>カンマ以外の文字で区切りたい場合にはこのオプションでそれを指示する。</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">nokey</span></code>, <code class="docutils literal notranslate"><span class="pre">nk</span></code></dt><dd><p>書式 <cite>default</cite> と意味は同じ。ただし書式 <code class="docutils literal notranslate"><span class="pre">csv</span></code> では既定値が <code class="docutils literal notranslate"><span class="pre">1</span></code> であることが異なる。</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">escape</span></code>, <code class="docutils literal notranslate"><span class="pre">e</span></code></dt><dd><p>エスケープ方法を <code class="docutils literal notranslate"><span class="pre">c</span></code>, <code class="docutils literal notranslate"><span class="pre">csv</span></code>, <code class="docutils literal notranslate"><span class="pre">none</span></code> から指定する。今はこのオプションの存在を知ってさえいればいい。</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">print_section</span></code>, <code class="docutils literal notranslate"><span class="pre">p</span></code></dt><dd><p>各行の先頭にセクション名を出力する (<code class="docutils literal notranslate"><span class="pre">1</span></code>) かどうか。</p>
</dd>
</dl>
</section>
<section id="flat">
<h3><a class="toc-backref" href="#id22" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">flat</span></code></a><a class="headerlink" href="#flat" title="Permalink to this heading">¶</a></h3>
<p>平坦な出力をする。</p>
<p>各行が <code class="docutils literal notranslate"><span class="pre">streams.stream.3.tags.foo=bar</span></code> のような明示的な <code class="docutils literal notranslate"><span class="pre">key=value</span></code> を含む自由形式の出力だ。出力はシェルエスケープされており、区切り文字が英数字かアンダースコアである限り、シェルスクリプトに直接埋め込める。</p>
</section>
<section id="json">
<h3><a class="toc-backref" href="#id23" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">json</span></code></a><a class="headerlink" href="#json" title="Permalink to this heading">¶</a></h3>
<p>各セクションを JSON 記法で出力する。改行文字を調整するオプションがある。</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">compact</span></code>, <code class="docutils literal notranslate"><span class="pre">c</span></code></dt><dd><p><code class="docutils literal notranslate"><span class="pre">1</span></code> に設定すると各セクションが一行で出力される。</p>
</dd>
</dl>
</section>
<section id="xml">
<h3><a class="toc-backref" href="#id24" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">xml</span></code></a><a class="headerlink" href="#xml" title="Permalink to this heading">¶</a></h3>
<p>XML 形式で出力する。FFmpeg の <code class="file docutils literal notranslate"><span class="pre">datadir</span></code> に XML スキーマ記述ファイル
<code class="file docutils literal notranslate"><span class="pre">ffprobe.xsd</span></code> がインストールされている。このスキーマの最新版は
&lt;<a class="reference external" href="http://www.ffmpeg.org/schema/ffprobe.xsd">http://www.ffmpeg.org/schema/ffprobe.xsd</a>&gt; にある（実際は開発版にリダイレクト）。</p>
</section>
</section>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="basic.html" title="Previous document">準備編</a>
        </li>
        <li>
          <a href="ffplay.html" title="Next document"><strong class="program">ffplay</strong> ノート</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
      </div>
      <div class="clearer"></div>
    </div>
<div class="footer">
  <ul>
    <li id="footer_logo">
      <a class="image-reference" href="https://showa-yojyo.github.io/" title="プレハブ小屋 Since 1999"><img src="../_static/logos.png"/></a>
    </li>
    <li id="footer_copyright">
      Copyright &copy; 1999-2024, プレハブ小屋 All rights reserved.
    </li>
  </ul>
</div>
  </body>
</html>